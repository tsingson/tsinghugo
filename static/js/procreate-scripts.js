var app=angular.module('community',['ngRoute','ngCookies','ngSanitize']);var $body=jQuery('body');var windowLoaded=!1;var debugging="console";var THREADPAGINATIONCOUNT=20;var POSTPAGINATIONCOUNT=20;var searchTimeout=!1;var searchValueTimeout=!1;var emailValidationTimeout=!1;var usernameValidationTimeout=!1;var isMobile=$(window).outerWidth()<656;var isPad=/iPad/i.test(navigator.userAgent);var isGridTwo=$(window).outerWidth()<974&&$(window).outerWidth()>655;var formFiles=[];var galleryGutter=21;app.run(['UserService','GalleryService','MarketService','UtilityService','DiscussionService','RoleService','AclService','IsotopeService','PollService','PopoverService','ModalService','SliderService','ReportService','LikeService','NewsService','BetaService','NotificationsService','AdminService','SearchService','HandbookService','InstagramService','PrizeService','$rootScope','$window','$location','$route','$routeParams','$sce','$http','$q',function(UserService,GalleryService,MarketService,UtilityService,DiscussionService,RoleService,AclService,IsotopeService,PollService,PopoverService,ModalService,SliderService,ReportService,LikeService,NewsService,BetaService,NotificationsService,AdminService,SearchService,HandbookService,InstagramService,PrizeService,$rootScope,$window,$location,$route,$routeParams,$sce,$http,$q){$('body').removeClass('preload');$(window).resize(function(){isMobile=$(window).outerWidth()<656;isGridTwo=$(window).outerWidth()<974&&$(window).outerWidth()>655;if(!$rootScope.$$phase){$rootScope.$apply()}
$rootScope.applySectionPointer(!0)});$body.on('touchstart',function(e){if(!$(e.target).parents('.forceTouchActive').length){$rootScope.endLongHold()}});$rootScope.flagLongPress=function(id){$body.addClass('forceTouchEvent');$('.forceTouchActive').find('.forceTouchOptions').attr('style','');$('.forceTouchActive').removeClass('forceTouchActive');$('#image-'+id).addClass('forceTouchActive');$('.forceTouchActive').find('.forceTouchOptions').css({'opacity':1,'transform':'scale(1)','-webkit-transform':'scale(1)'})};$rootScope.endLongHold=function(){$body.removeClass('forceTouchEvent');$('.forceTouchActive').find('.forceTouchOptions').attr('style','');$('.forceTouchActive').removeClass('forceTouchActive')};window.addEventListener('orientationchange',function(){isMobile=$(window).outerWidth()<656;isGridTwo=$(window).outerWidth()<974&&$(window).outerWidth()>655;if(!$rootScope.$$phase){$rootScope.$apply()}
$rootScope.applySectionPointer(!0)});$rootScope.sectionNavClass='';$rootScope.lastScrollTop=0;window.addEventListener('scroll',function(){if(!$('#profile-nav').length){var st=$(this).scrollTop();if(st>=($rootScope.lastScrollTop)){$rootScope.sectionNavClass=''}else{if(st===0||st<0){$rootScope.sectionNavClass=''}else{$rootScope.sectionNavClass='fixed-section-nav'}}
$rootScope.lastScrollTop=st;$rootScope.$apply()}});var partials='templates/partials/';var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var monthsFull=["January","February","March","April","May","June","July","August","September","October","November","December"];var original=$location.path;$location.path=function(path,reload){if(reload===!1){var lastRoute=$route.current;var un=$rootScope.$on('$locationChangeSuccess',function(){$route.current=lastRoute;un()})}
return original.apply($location,[path])};$rootScope.days=[{value:"",name:"Day",disabled:!0}];$rootScope.months=[{value:"",name:"Month",disabled:!0},{value:"01",name:"January"},{value:"02",name:"February"},{value:"03",name:"March"},{value:"04",name:"April"},{value:"05",name:"May"},{value:"06",name:"June"},{value:"07",name:"July"},{value:"08",name:"August"},{value:"09",name:"September"},{value:"10",name:"October"},{value:"11",name:"November"},{value:"12",name:"December"}];$rootScope.years=[{value:"",name:"Year",disabled:!0}];for(var d=1;d<=31;d ++){var prepend='';if(d<10){prepend='0'}
$rootScope.days.push({value:prepend+d,name:d})}
var dt=new Date();for(var y=1900+dt.getYear();y>=1900;y --){$rootScope.years.push({value:y,name:y})}
$rootScope.initialLoad='';$rootScope.latestPollTime='';$rootScope.previousRoute='';$rootScope.canClaim=!1;$rootScope.modalShow=!1;$rootScope.popoverShow=!1;$rootScope.bucketShow=!1;$rootScope.sliderShow=!1;$rootScope.showcaseStart=!1;$rootScope.recentPos=0;$rootScope.popularPos=0;$rootScope.featuredPos=0;$rootScope.galleryLazyLoading=!1;$rootScope.galleryFinishedLoading=!1;$rootScope.galleryNextPage=!1;$rootScope.loadingThreads=!1;$rootScope.loadingPosts=!1;$rootScope.welcomeBannerShow=!1;$rootScope.resetShowcase=!1;$rootScope.globalToggleable=[];$rootScope.globalToggleable.options=[];$rootScope.sectionName='';$rootScope.showSectionPointer=!1;$rootScope.scrollIntervalRef=!1;$rootScope.baseOuterWidth=$(window).outerWidth();$rootScope.loginSliderViewTemplate=partials+'slider/loginSliderView.htm';$rootScope.accountSliderViewTemplate=partials+'slider/accountSliderView.htm';$rootScope.imageReplySliderViewTemplate=partials+'slider/imageReplySliderView.htm';$rootScope.newsReplySliderViewTemplate=partials+'slider/newsReplySliderView.htm';$rootScope.discMediaModalViewTemplate=partials+'modal/discMediaModalView.htm';$rootScope.discLinkModalViewTemplate=partials+'modal/discLinkModalView.htm';$rootScope.newsImageModalViewTemplate=partials+'modal/newsImageModalView.htm';$rootScope.videoModalViewTemplate=partials+'modal/videoModalView.htm';$rootScope.moveThreadModalViewTemplate=partials+'modal/moveThreadModalView.htm';$rootScope.likesModalViewTemplate=partials+'modal/likesModalView.htm';$rootScope.imageReportModalViewTemplate=partials+'modal/imageReportModalView.htm';$rootScope.reportModalViewTemplate=partials+'modal/reportModalView.htm';$rootScope.loaderModalViewTemplate=partials+'modal/loaderModalView.htm';$rootScope.loginModalViewTemplate=partials+'modal/loginModalView.htm';$rootScope.handbookModalViewTemplate=partials+'modal/handbookModalView.htm';$rootScope.pocketHandbookModalViewTemplate=partials+'modal/pocketHandbookModalView.htm';$rootScope.imageBucketTemplate=partials+'modal/imageBucketView.htm';$rootScope.galleryItemGalleryTemplate=partials+'galleryItemGallery.htm';$rootScope.galleryItemProfileTemplate=partials+'galleryItemProfile.htm';$rootScope.marketItemMarketTemplate=partials+'marketItemMarket.htm';$rootScope.marketItemProfileTemplate=partials+'marketItemProfile.htm';$rootScope.discussionsTemplate=partials+'discussions/index.htm';$rootScope.boardTemplate=partials+'discussions/board.htm';$rootScope.threadListItemTemplate=partials+'discussions/threadListItem.htm';$rootScope.threadTemplate=partials+'discussions/thread.htm';$rootScope.createThreadTemplate=partials+'discussions/createThread.htm';$rootScope.artworkUploadItemProfileTemplate=partials+'artworkUploadItemProfile.htm';$rootScope.marketUploadItemProfileTemplate=partials+'marketUploadItemProfile.htm';$rootScope.galleryItemGalleryContent=partials+'gallery/galleryItemDescription.htm';$rootScope.galleryItemPreview=partials+'gallery/galleryItemPreview.htm';$rootScope.competitionUploadItemTemplate=partials+'dragAndDrop/competitionUploadItem.htm';$rootScope.imageUploadItemTemplate=partials+'dragAndDrop/imageUploadItem.htm';$rootScope.brushUploadItemTemplate=partials+'dragAndDrop/brushUploadItem.htm';$rootScope.swatchUploadItemTemplate=partials+'dragAndDrop/swatchUploadItem.htm';$rootScope.bundleUploadItemTemplate=partials+'dragAndDrop/bundleUploadItem.htm';$rootScope.bucketUploadItemTemplate=partials+'dragAndDrop/bucketUploadItem.htm';$rootScope.setUploadItemTemplate=partials+'dragAndDrop/setUploadItem.htm';$rootScope.artworkSearchItemTemplate=partials+'search/artworkItem.htm';$rootScope.userSearchItemTemplate=partials+'search/userItem.htm';$rootScope.threadSearchItemTemplate=partials+'search/threadItem.htm';$rootScope.linkSearchItemTemplate=partials+'search/linkItem.htm';$rootScope.adminNavTemplate='templates/admin/partials/nav.htm';$rootScope.pollObject={page:'',scope:{}};$rootScope.previousCall=!1;$rootScope.showPageLoader='';$rootScope.animationClass='';$rootScope.searchClass='';$rootScope.userMenuClass='';$rootScope.navMenuClass='';$rootScope.previewClass='';$rootScope.currentPath='';$rootScope.linkClicked=!1;$rootScope.stopImageLoad=!1;$rootScope.notificationsOpen=!1;$rootScope.adminBucketAvailable=!1;$rootScope.showMobileFourOneVideoOptions=!1;$rootScope.notificationsBanner={message:'',notifications:[],visible:!1};$rootScope.mobileWindowClass='';$rootScope.mobileScrollPos=0;$rootScope.touchRecords=[];$rootScope.formFields={};$rootScope.newsArticleFields={};$rootScope.registerFields={};$rootScope.searchTerm='';$rootScope.utcTime=new Date();UtilityService.getUTCTime();$rootScope.loggedIn=!1;$rootScope.user='';$rootScope.$watch('loggedIn',function(){$rootScope.toggleUserMenu('close');SliderService.hide();ModalService.hide();PopoverService.hide()});$rootScope.$watch('notificationsOpen',function(newVal){if(newVal){NotificationsService.flagNotificationsRead(!0)}});$rootScope.gallery=GalleryService.getData;$rootScope.market=MarketService.getData;$rootScope.discussions=DiscussionService.getData;$rootScope.users=UserService.getData;$rootScope.roles=RoleService.getData;$rootScope.acl=AclService.getData;$rootScope.util=UtilityService.getData;$rootScope.reports=ReportService.getData;$rootScope.news=NewsService.getData;$rootScope.handbook=HandbookService.getData;$rootScope.instagram=InstagramService.getData;$rootScope.beta=BetaService.getData;$rootScope.notifications=NotificationsService.getData;$rootScope.admin=AdminService.getData;$rootScope.search=SearchService.getData;$rootScope.competitions=PrizeService.getData;UserService.load();NotificationsService.load();PollService.beginPolling();$rootScope.logout=function(){UserService.reset();PrizeService.clearEntryData();$rootScope.toggleUserMenu('close')};$rootScope.$on('$routeChangeStart',function(event,next,prev){$(window).unbind('scroll');$rootScope.bodyClass='';if($rootScope.isDefined(prev)){$rootScope.previousRoute=prev.$$route.originalPath}
$rootScope.pollObject={page:'',scope:{}};if(PollService.isBroken()){PollService.restartPolling()}
if($rootScope.loggedIn){if(next.templateUrl==='templates/register.htm'){$location.path('/showcase')}}else{if(defined(prev)&&next.templateUrl==='templates/profile.htm'){$location.path('/showcase')}else if(next.templateUrl==='templates/discussionsCreate.htm'){$location.path('/discussions')}}
$rootScope.applyFooter(next.templateUrl!=='templates/gallery.htm'&&next.templateUrl!=='templates/user.htm');$rootScope.resetNavs();$rootScope.notificationsOpen=!1;$rootScope.updateMetadataByPath(next.$$route.originalPath)});$rootScope.$on('$routeChangeSuccess',function(event,next){if($rootScope.inArray(next.$$route.originalPath,['/beta','/discover','/ipad','/ipad/preview','/faq','/press','/privacy-policy','/terms-conditions','/pocket/beta/terms-conditions','/procreate/private-beta/terms-conditions','/sitemap','/prize','/prize/terms-conditions'])){$rootScope.applyInverse(!0);$rootScope.applyDiscover(!1);$rootScope.applyPocket(!1)}else if($rootScope.inArray(next.$$route.originalPath,['/','/pocket/beta'])){$rootScope.applyInverse(!1);$rootScope.applyDiscover(!0);$rootScope.applyPocket(!1)}else if($rootScope.inArray(next.$$route.originalPath,['/pocket'])){$rootScope.applyInverse(!1);$rootScope.applyDiscover(!1);$rootScope.applyPocket(!0)}else{$rootScope.applyInverse(!1);$rootScope.applyDiscover(!1);$rootScope.applyPocket(!1)}
if($rootScope.inArray(next.$$route.originalPath,['/','/ipad','/ipad/preview','/pocket','/pocket/beta','/beta','/discover','/support','/faq','/insight','/press','/privacy-policy','/terms-conditions','/pocket/beta/terms-conditions','/procreate/private-beta/terms-conditions','/prize','/prize/terms-conditions'])){$rootScope.applyRemoveBeta(!0)}else{$rootScope.applyRemoveBeta(!1)}
if($rootScope.inArray(next.$$route.originalPath,['/ipad'])){$rootScope.applyiPadPage(!0)}else{$rootScope.applyiPadPage(!1)}
if($rootScope.linkClicked){$(document).scrollTop(0)}
$rootScope.sectionName=defined(next.params.section)?next.params.section:'';$rootScope.applySectionPointer();$rootScope.linkClicked=!1});$rootScope.getUser=function(id,type){type=defined(type)?type:'user';switch(type){case 'image':return defined($rootScope.gallery().images[id])?$rootScope.users().users[$rootScope.gallery().images[id].userId]:{};case 'product':return defined($rootScope.market().products[id])?$rootScope.users().users[$rootScope.market().products[id].userId]:{};case 'user':return defined($rootScope.users().users[id])?$rootScope.users().users[id]:{}}
return{}};$rootScope.applySectionPointer=function(stopAnimate){var pointer=$('.nav-target-bg');var targetName=$rootScope.sectionName!==''?$rootScope.sectionName:'';if(targetName===''){pointer.css('background-color','');$rootScope.showSectionPointer=!1}else{var target=document.getElementById(targetName+'-menu-item');var position=target.getBoundingClientRect();var pointerPos=(Math.round(position.left+(target.clientWidth/2)))+'px';pointer.css('background-color','transparent');if(!$rootScope.showSectionPointer){pointer.animate({left:pointerPos},{queue:!1,duration:0});$rootScope.showSectionPointer=!0}else{if(stopAnimate){pointer.animate({left:pointerPos},{queue:!1,duration:0})}else{pointer.animate({left:pointerPos},{queue:!1,duration:400})}}}};$rootScope.flagLinkClicked=function(){$rootScope.linkClicked=!0};$rootScope.getImage=function(id){return defined($rootScope.gallery().images[id])?$rootScope.gallery().images[id]:{}};$rootScope.getProduct=function(id){return defined($rootScope.market().products[id])?$rootScope.market().products[id]:{}};$rootScope.getRole=function(id){return defined($rootScope.roles().roles[id])?$rootScope.roles().roles[id]:{}};$rootScope.getResource=function(id){return defined($rootScope.acl().resources[id])?$rootScope.acl().resources[id]:{}};$rootScope.getBoard=function(id){return defined($rootScope.discussions().boards[id])?$rootScope.discussions().boards[id]:{}};$rootScope.getThread=function(id){return defined($rootScope.discussions().threads[id])?$rootScope.discussions().threads[id]:{}};$rootScope.getDiscTag=function(id){return defined($rootScope.discussions().tags[id])?$rootScope.discussions().tags[id]:{}};$rootScope.getReport=function(id){return defined($rootScope.reports().reports[id])?$rootScope.reports().reports[id]:{}};$rootScope.getNewsArticle=function(id){return defined($rootScope.news().articles[id])?$rootScope.news().articles[id]:{}};$rootScope.getHandbookArticle=function(id){return defined($rootScope.handbook().articles[id])?$rootScope.handbook().articles[id]:{}};$rootScope.getInstagramArticle=function(id){return defined($rootScope.instagram().articles[id])?$rootScope.instagram().articles[id]:{}};$rootScope.getCompetition=function(id){return defined($rootScope.competitions().competitions[id])?$rootScope.competitions().competitions[id]:{}};$rootScope.getCompetitionEntry=function(compId,id){return defined($rootScope.getCompetition(compId).entries)&&defined($rootScope.getCompetition(compId).entries[id])?$rootScope.getCompetition(compId).entries[id]:{}};$rootScope.getNewsCategory=function(id){return defined($rootScope.news().categories[id])?$rootScope.news().categories[id]:{}};$rootScope.getBetaTypes=function(id){return defined($rootScope.beta().types[id])?$rootScope.beta().types[id]:{}};$rootScope.getAdminImage=function(id){return defined($rootScope.admin().images[id])?$rootScope.admin().images[id]:{}};$rootScope.getSearchLink=function(id){return defined($rootScope.search().linkData[id])?$rootScope.search().linkData[id]:{}};$rootScope.getSearchTerm=function(id){return defined($rootScope.search().terms[id])?$rootScope.search().terms[id]:{}};$rootScope.getPost=function(threadId,id){if(typeof threadId!=='undefined'){var thread=$rootScope.getThread(threadId);if(!$rootScope.isEmpty(thread)){for(var i=0;i<thread.posts.length;i ++){if($rootScope.isDefined(thread.posts[i])&&thread.posts[i].post.id===id){return thread.posts[i]}}}}
return{}};$rootScope.getAverageColorFromURL=function(url){if(defined(url)){var img=new Image();var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');img.addEventListener('load',function(){var width=canvas.width=img.naturalWidth;var height=canvas.height=img.naturalHeight;ctx.drawImage(img,0,0);var imageData=ctx.getImageData(0,0,width,height);var data=imageData.data;var r=0;var g=0;var b=0;for(var i=0,l=data.length;i<l;i+=4){r+=data[i];g+=data[i+1];b+=data[i+2]}
r=Math.floor(r/(data.length/4));g=Math.floor(g/(data.length/4));b=Math.floor(b/(data.length/4));return{r:r,g:g,b:b}},!1);img.src=url}};$rootScope.getOrientation=function(file,callback){console.log('getOrientation is active');var reader=new FileReader();reader.onload=function(e){var view=new DataView(e.target.result);if(view.getUint16(0,!1)!=0xFFD8){return callback(-2)}
var length=view.byteLength,offset=2;while(offset<length){if(view.getUint16(offset+2,!1)<=8)return callback(-1);var marker=view.getUint16(offset,!1);offset+=2;if(marker==0xFFE1){if(view.getUint32(offset+=2,!1)!=0x45786966){return callback(-1)}
var little=view.getUint16(offset+=6,!1)==0x4949;offset+=view.getUint32(offset+4,little);var tags=view.getUint16(offset,little);offset+=2;for(var i=0;i<tags;i++){if(view.getUint16(offset+(i*12),little)==0x0112){return callback(view.getUint16(offset+(i*12)+8,little))}}}else if((marker&0xFF00)!=0xFF00){break}else{offset+=view.getUint16(offset,!1)}}
return callback(-1)};reader.readAsArrayBuffer(file)};$rootScope.claimDiscussionElements=function(){UserService.claimDiscussionElements()};$rootScope.getReply=function(threadId,postId,id){var post=$rootScope.getPost(threadId,postId);return!$rootScope.isEmpty(post)?post.post.replies[id]:{}};$rootScope.isImageController=function(){if(defined($route.current)){return $route.current.$$route.controller==="imageController"}
return!1};$rootScope.getImageClass=function(id){var imageClass=$rootScope.isInspired(id)?'inspired ':'';if($rootScope.getImage(id).mature=='1'){imageClass+='isMature'+((!$rootScope.loggedIn||$rootScope.getUser($rootScope.user).mature!='1')?' mature':'')}
return imageClass};$rootScope.artworkLeave=function(id){$('.item-artwork[data-id="'+id+'"]').removeClass('hover');$rootScope.globalToggleable.options['artwork'+id]=!1};$rootScope.artworkEnter=function(id){$('.item-artwork[data-id="'+id+'"]').addClass('hover');$rootScope.globalToggleable.options['artwork'+id]=!0};$rootScope.inArray=function(needle,haystack){var length=haystack.length;for(var i=0;i<length;i++){if(haystack[i]===needle)return!0}
return!1};$rootScope.homeLink=function(){var basePaths=['/','/support','/beta','/faq'];if($location.path().indexOf('discussions')!==-1){return'/discussions'}
if(basePaths.indexOf($location.path())!==-1){return'/'}
return'/showcase'};$rootScope.applyInverse=function(show){var $body=$('body');if((!$body.hasClass('inverse')&&show)||($body.hasClass('inverse')&&!show)){$body.toggleClass('inverse')}};$rootScope.applyiPadPage=function(show){var $body=$('body');if((!$body.hasClass('ipad-product-page')&&show)||($body.hasClass('ipad-product-page')&&!show)){$body.toggleClass('ipad-product-page')}};$rootScope.applyDiscover=function(show){var $body=$('body');if(!show){if($body.hasClass('discover')){$body.removeClass('discover')}
if($body.hasClass('block-1-visible')){$body.removeClass('block-1-visible')}
if($body.hasClass('block-2-visible')){$body.removeClass('block-2-visible')}
if($body.hasClass('block-3-visible')){$body.removeClass('block-3-visible')}}else{if(!$body.hasClass('discover')){$body.addClass('discover')}
if(!$body.hasClass('block-1-visible')){$body.addClass('block-1-visible')}
if($body.hasClass('block-2-visible')){$body.removeClass('block-2-visible')}
if($body.hasClass('block-3-visible')){$body.removeClass('block-3-visible')}
$rootScope.scrollToTop()}};$rootScope.applyPocket=function(show){var $body=$('body');var pocketPanels=11;if(!show){if($body.hasClass('pocket-page')){$body.removeClass('pocket-page')}
for(var i=0;i<pocketPanels;i++){if($body.hasClass('panel-0'+i+'-visible')){$body.removeClass('panel-0'+i+'-visible')}}
if($body.hasClass('panel-10-visible')){$body.removeClass('panel-10-visible')}
if($body.hasClass('panel-11-visible')){$body.removeClass('panel-11-visible')}}else{if(!$body.hasClass('pocket-page')){$body.addClass('pocket-page')}
for(var i=0;i<pocketPanels;i++){if($body.hasClass('panel-0'+i+'-visible')){$body.removeClass('panel-0'+i+'-visible')}}
if($body.hasClass('panel-10-visible')){$body.removeClass('panel-10-visible')}
if($body.hasClass('panel-11-visible')){$body.removeClass('panel-11-visible')}
$rootScope.scrollToTop()}};$rootScope.applyScrollToTop=function(){if(!$rootScope.isMobile()&&!$rootScope.isPad()){$rootScope.scrollToTop()}};$rootScope.applyRemoveBeta=function(show){var $body=$('body');if((!$body.hasClass('not-beta')&&show)||($body.hasClass('not-beta')&&!show)){$body.toggleClass('not-beta')}};$rootScope.applyFooter=function(show){var $body=$('body');if((!$body.hasClass('footer')&&show)||($body.hasClass('footer')&&!show)){$body.toggleClass('footer')}};$rootScope.generateImageFromInspiration=function(inspiration){var image=GalleryService.generateImageFromImageData(inspiration);GalleryService.addOrUpdateImage(image)};$rootScope.parseContent=function(content){if(content){var urlRegexp=/\[url src="([^"]+)"\]([^\[]+)\[\/url\]/g;var urlResults=[];var urlMatch=urlRegexp.exec(content);var baseUrlRegexp=/(http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/g;var baseUrlResults=[];var urlWWWFixRegexp=/href="(www|Www|WWw|WwW|WWW|wWw|wWW|wwW)\.[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?/g;var urlWWWFixResults=[];var videoUrlRegexp=/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%&?;=\-]*)?/g;var videoUrlResults=[];var mediaRegexp=/\[media src="([^"]+)"\]([^\[]*)\[\/media\]/g;var mediaResults=[];var mediaMatch=mediaRegexp.exec(content);var quoteRegexp=/\[quote author="([^"]+)"\]([^\[]*)\[\/quote\]/g;var quoteResults=[];var quoteMatch=quoteRegexp.exec(content);var result,i,src,origTitle,title;while(urlMatch!==null){result=[];for(i=1;i<urlMatch.length;i ++){result.push(urlMatch[i])}
urlResults.push(result);urlMatch=urlRegexp.exec(content)}
while(mediaMatch!==null){result=[];for(i=1;i<mediaMatch.length;i ++){result.push(mediaMatch[i])}
mediaResults.push(result);mediaMatch=mediaRegexp.exec(content)}
while(quoteMatch!==null){result=[];for(i=1;i<quoteMatch.length;i ++){result.push(quoteMatch[i])}
quoteResults.push(result);quoteMatch=quoteRegexp.exec(content)}
for(i=0;i<urlResults.length;i ++){src=urlResults[i][0];origTitle=typeof urlResults[i][1]!=='undefined'?urlResults[i][1]:'';title=origTitle!==''?origTitle:src;content=content.replace('[url src="'+src+'"]'+origTitle+'[/url]','<a target="_blank" href="'+src+'">'+title+'</a>')}
for(i=0;i<quoteResults.length;i ++){title=quoteResults[i][0];src=typeof quoteResults[i][1]!=='undefined'?quoteResults[i][1]:'';content=content.replace('[quote author="'+title+'"]'+src+'[/quote]','<blockquote><div class="author">'+title+'</div>'+src+'</blockquote>')}
for(i=0;i<mediaResults.length;i ++){src=mediaResults[i][0];origTitle=typeof mediaResults[i][1]!=='undefined'?mediaResults[i][1]:'';title=origTitle!==''?origTitle:src;var video=parseVideo(src).type;if(src.match(/\.(jpg|jpeg|gif|png)$/)!==null||src.match(/^((http[s]?):\/)?\/?(forums\.procreate\.art\/index\.php\?action=dlattach;)+(.)*(;image)+?$/)!==null){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<div class="embed-image"><div class="container"><img src="'+src+'" title="'+title+'" /></div></div>')}else if(src.match(/\.(jpg|jpeg|gif|png)$/)!==null||src.match(/^((http[s]?):\/)?\/?(archive\.procreate\.art\/index\.php\?action=dlattach;)+(.)*(;image)+?$/)!==null){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<div class="embed-image"><div class="container"><img src="'+src+'" title="'+title+'" /></div></div>')}else if(video!==''){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]',src)}else{content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<a target="_blank" href="'+src+'">'+title+'</a>')}}
var videoUrlMatch=videoUrlRegexp.exec(content);while(videoUrlMatch!==null){result=[];for(i=0;i<videoUrlMatch.length;i ++){result.push(videoUrlMatch[i])}
videoUrlResults.push(result);videoUrlMatch=videoUrlRegexp.exec(content)}
for(i=0;i<videoUrlResults.length;i ++){src=videoUrlResults[i][0];var tempContent=content.split(src);if(tempContent[0].substr(-1)!=='"'&&tempContent[0].substr(-1)!=="'"){content=content.replace(src,createVideo(src))}}
var baseUrlMatch=baseUrlRegexp.exec(content);while(baseUrlMatch!==null){result=[];for(i=0;i<baseUrlMatch.length;i ++){result.push(baseUrlMatch[i])}
baseUrlResults.push(result);baseUrlMatch=baseUrlRegexp.exec(content)}
for(i=0;i<baseUrlResults.length;i ++){src=baseUrlResults[i][0];var tempContent=content.split(src);if(src.substr(-3)==="<br"){src=src.slice(0,-3)}
if(src.indexOf("</p>")!==-1){src=src.substring(0,src.indexOf("</p>"))}
if(tempContent[0].substr(-1)!=='"'&&tempContent[0].substr(-1)!=="'"&&tempContent[0].substr(-1)!=="<"){content=content.replace(src,'<a target="_blank" href="'+src+'">'+src+'</a>')}}
var wwwUrlFixMatch=urlWWWFixRegexp.exec(content);while(wwwUrlFixMatch!==null){result=[];for(i=0;i<wwwUrlFixMatch.length;i ++){result.push(wwwUrlFixMatch[i])}
urlWWWFixResults.push(result);wwwUrlFixMatch=urlWWWFixRegexp.exec(content)}
for(i=0;i<urlWWWFixResults.length;i ++){src=urlWWWFixResults[i][0];src=src.slice(0,6)+"http://"+src.slice(6);content=content.replace(urlWWWFixResults[i][0],src)}}
return $sce.trustAsHtml(content)};$rootScope.parseEditContent=function(content){return $sce.trustAsHtml(content)};$rootScope.interestedInBeta=function(typeId){if($rootScope.getBetaTypes(typeId)!={}&&defined($rootScope.getUser($rootScope.user).betaUsers)){for(var i=0;i<$rootScope.getUser($rootScope.user).betaUsers.length;i ++){if($rootScope.getUser($rootScope.user).betaUsers[i].beta_type_id==typeId&&$rootScope.getUser($rootScope.user).betaUsers[i].status==1){return!0}}}
return!1};$rootScope.selectedInBeta=function(typeId){if($rootScope.getBetaTypes(typeId)!={}){if(defined($rootScope.getUser($rootScope.user).betaUsers)){for(var i=0;i<$rootScope.getUser($rootScope.user).betaUsers.length;i ++){if($rootScope.getUser($rootScope.user).betaUsers[i].beta_type_id==typeId){return $rootScope.getUser($rootScope.user).betaUsers[i].selected==1}}}}
return!1};$rootScope.registerInterest=function(id){if($('#terms').is(':checked')){$rootScope.toggleInterest(id,!0)}else{alert("You must agree to the terms and conditions to proceed.")}};$rootScope.toggleInterest=function(typeId,overrideForce){var found=!1;if($rootScope.checkCanPerform(!0,!0)){if($rootScope.getBetaTypes(typeId)!={}){if(defined($rootScope.getUser($rootScope.user).betaUsers)){for(var i=0;i<$rootScope.getUser($rootScope.user).betaUsers.length;i ++){if($rootScope.getUser($rootScope.user).betaUsers[i].beta_type_id==typeId&&$rootScope.getUser($rootScope.user).betaUsers[i].status==1){found=!0;break}}}
if(defined(overrideForce)){if(found&&!overrideForce){BetaService.deleteBetaUser(typeId)}else if(!found&&!overrideForce){alert("You have shown interest in this beta yet.")}else if(!found&&overrideForce){BetaService.createBetaUser(typeId)}else{alert("You have already shown interest in this beta.")}}else{if(found){BetaService.deleteBetaUser(typeId)}else{BetaService.createBetaUser(typeId)}}}}};$rootScope.isDefined=function(value){return defined(value)};$rootScope.isEmpty=function(obj){for(var i in obj){if(obj.hasOwnProperty(i)){return!1}}
return!0};$rootScope.objLength=function(obj){var size=0;for(var i in obj){if(obj.hasOwnProperty(i)){size ++}}
return size};$rootScope.isOwner=function(id,type){type=defined(type)?type:'image';if($rootScope.user===''){return!1}
switch(type){case 'image':return $rootScope.getImage(id).userId===$rootScope.getUser($rootScope.user).id;case 'product':return $rootScope.getProduct(id).userId===$rootScope.getUser($rootScope.user).id}};$rootScope.isValid=function(){var valid;if(parseInt($rootScope.getUser($rootScope.user).active)!==0){valid=!0}
return valid};$rootScope.isBanned=function(){var banned;if(parseInt($rootScope.getUser($rootScope.user).status)===2){banned=!0}
return banned};$rootScope.isInspired=function(id){if(defined($rootScope.user)&&defined($rootScope.getUser($rootScope.user))&&defined($rootScope.users().inspiration)){return $rootScope.users().inspiration.indexOf(""+id)!==-1}
return!1};$rootScope.isVisibleImage=function(id){var $element=$('div[data-id='+id+']').get(0);var padding=-800;if(typeof $element==='undefined'){return!1}
return($element.offsetTop+padding<(window.pageYOffset+window.innerHeight)&&$element.offsetLeft+padding<(window.pageXOffset+window.innerWidth)&&($element.offsetTop+$element.offsetHeight-padding)>window.pageYOffset&&($element.offsetLeft+$element.offsetWidth-padding)>window.pageXOffset)};$rootScope.isInViewport=function(id){var $element=$('div[data-id='+id+']').get(0);var padding=-1000;if(typeof $element==='undefined'){return!1}
return($element.offsetTop+padding<(window.pageYOffset+window.innerHeight)&&$element.offsetLeft+padding<(window.pageXOffset+window.innerWidth)&&($element.offsetTop+$element.offsetHeight-padding)>window.pageYOffset&&($element.offsetLeft+$element.offsetWidth-padding)>window.pageXOffset)};$rootScope.isAdminUser=function(){return $rootScope.getUser($rootScope.user).admin==='1'};$rootScope.isSavageUser=function(){return $rootScope.getUser($rootScope.user).savage==='1'};$rootScope.isModeratorUser=function(){return $rootScope.isAdminUser()||$rootScope.getUser($rootScope.user).moderator==='1'};$rootScope.canFeature=function(){return['14','15','122','146','163','17062'].indexOf($rootScope.user)!==-1};$rootScope.isPad=function(){return/iPad/i.test(navigator.userAgent)};$rootScope.loadShowcase=function(){$rootScope.resetShowcase=!0};$rootScope.refreshPage=function(){location.reload()};$rootScope.removeOrphan=function(string){if(defined(string)){var string=string.replace(/[ ](?=[^ ]*$)/gm,'\u00a0');return $sce.trustAsHtml(string)}
return''};$rootScope.isThreadLocked=function(threadId){return $rootScope.getThread(threadId).status==siteDefaults.discussions.status.thread_locked};$rootScope.flagFeaturedImage=function(imageId,flag){GalleryService.flagFeatured(imageId,flag)};$rootScope.flagInspiredImage=function(imageId){if(!$rootScope.isOwner(imageId)&&$rootScope.checkCanPerform(!0,!0)){GalleryService.updateInspirationImage(imageId,!$rootScope.isInspired(imageId))}};$rootScope.fileDialog=function($type){var $targetElem="#"+$type+"File";var $fileInput=jQuery($targetElem);$fileInput.trigger('click')};$rootScope.popoverSwitch=function(action){PopoverService.hide();setTimeout(function(){action()},300);if(!$rootScope.$$phase){$rootScope.$apply()}};$rootScope.deleteGalleryItem=function(id){PopoverService.initialise('delete',{graphic:{classes:'red',visible:!0},title:'Delete Artwork',description:'Are you sure you want to permanently delete this artwork?',confirmButton:{text:'Delete',action:function(){GalleryService.removeUserImage($rootScope.user,$rootScope.getUser($rootScope.user).token,id);PopoverService.hide()},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$rootScope.featureGalleryItem=function(id){PopoverService.initialise('feature',{graphic:{classes:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'blue':'red'),visible:!0},title:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'Feature':'Un-Feature')+' Artwork',description:'Are you sure you want to '+($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'feature':'un-feature')+' this artwork '+($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'in':'from')+' the Showcase?',confirmButton:{text:$rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'Feature!':'Un-Feature',action:function(){if($rootScope.getImage(id).featured==='0'){$rootScope.flagFeaturedImage(id,'1')}else{$rootScope.flagFeaturedImage(id,'0')}
PopoverService.hide()},classes:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'blue':'red'),visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$rootScope.banItem=function(id,type){PopoverService.initialise('ban',{graphic:{classes:'red',visible:!0},title:'Ban Content',description:'Are you sure you want to ban this content?',confirmButton:{text:'Yes, Continue',action:function(){PopoverService.hide();$rootScope.instantReport(id,type,{reason:($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()?'Moderator':'Admin')+' Has Marked as Banned',level:1})},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$rootScope.matureGalleryItem=function(id){PopoverService.initialise('mature',{graphic:{classes:'red',visible:!0},title:'Mature Content',description:'Are you sure you want to mark this content as mature?',confirmButton:{text:'Yes, Continue',action:function(){PopoverService.hide();$rootScope.instantReport(id,'image',{reason:($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()?'Moderator':'Admin')+' Has Marked as Mature',level:2})},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$rootScope.reportItem=function(id,type){var content=type==='image'?'image_report':'report';var canFormData=new FormData();var reportOptions=[];if(content==='image_report'){reportOptions=[{text:'It contains mature content',action:function(){PopoverService.initialise('report-submit',{graphic:{classes:'red',visible:!0},title:'Submit your report',confirmButton:{text:'Report',action:function(){PopoverService.hide();$rootScope.instantReport(id,type,{reason:$rootScope.reportForm.reason,level:2})},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}})},classes:'blue',visible:!0},{text:'It\'s breaching the site\'s content restrictions',action:function(){PopoverService.initialise('report-submit',{graphic:{classes:'red',visible:!0},title:'Submit your report',confirmButton:{text:'Report',action:function(){PopoverService.hide();$rootScope.instantReport(id,type,{reason:$rootScope.reportForm.reason,level:1})},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}})},classes:'blue',visible:!0}]}else{reportOptions=[{text:'It\'s breaching the site\'s content restrictions',action:function(){PopoverService.initialise('report-submit',{graphic:{classes:'red',visible:!0},title:'Submit your report',confirmButton:{text:'Report',action:function(){PopoverService.hide();$rootScope.instantReport(id,type,{reason:$rootScope.reportForm.reason,level:1})},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}})},classes:'blue',visible:!0}]}
$rootScope.reportForm={};PopoverService.initialise('loader',{graphic:{visible:!1}});canFormData.append('schema','reportCanReport');canFormData.append('userId',$rootScope.user);canFormData.append('token',$rootScope.getUser($rootScope.user).token);switch(type){case 'image':canFormData.append('galleryItemId',id);break;case 'market':canFormData.append('marketItemId',id);break;case 'image_reply':canFormData.append('galleryItemCommentId',id);break;case 'news_reply':canFormData.append('newsArticleCommentId',id);break;case 'market_reply':canFormData.append('marketItemCommentId',id);break;case 'post':canFormData.append('discPostId',id);break;case 'reply':canFormData.append('discReplyId',id);break}
$rootScope.ajaxQuery(canFormData,function(data){if(defined(data.success)){PopoverService.initialise('report',{graphic:{classes:'red',visible:!0},title:'Why are you reporting this content?',listOptions:reportOptions,dismissButton:{text:'Cancel',visible:!0}})}else{PopoverService.initialise('default',{graphic:{visible:!1},title:'Oops!',description:'You have already reported this content.',dismissButton:{visible:!0}})}},!0);PopoverService.show()};$rootScope.instantReport=function(id,type,options){var formData=new FormData();var $reason=options.reason;var $level=options.level;if($level){formData.append('schema','reportCreate');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);switch(type){case 'image':formData.append('galleryItemId',id);break;case 'market':formData.append('marketItemId',id);break;case 'image_reply':formData.append('galleryItemCommentId',id);break;case 'news_reply':formData.append('newsArticleCommentId',id);break;case 'market_reply':formData.append('marketItemCommentId',id);break;case 'post':formData.append('discPostId',id);break;case 'reply':formData.append('discReplyId',id);break}
formData.append('level',$level);formData.append('reason',$reason);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){PopoverService.initialise('default',{graphic:{visible:!1},title:'Success!',description:'Your report was successfully.',dismissButton:{visible:!0}});if(!$rootScope.$$phase){$rootScope.$apply()}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)}else{alert("Please select what's wrong.")}};$rootScope.optionsGalleryItemAdmin=function(id,options){PopoverService.initialise('default',{description:'Artwork Options',buttonOptions:[{text:'Edit',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id+"/edit")},classes:'edit-icon',visible:$rootScope.isAdminUser()},{text:'Mark as Mature',action:function(){$rootScope.popoverSwitch(function(){$rootScope.matureGalleryItem(id)})},classes:'red mature-icon',visible:$rootScope.isAdminUser()||$rootScope.isModeratorUser()},{text:'Mark as Banned',action:function(){$rootScope.popoverSwitch(function(){$rootScope.banItem(id,'image')})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$rootScope.deleteGalleryItem(id)})},classes:'red delete-icon',visible:$rootScope.isAdminUser()},{text:'Back',action:function(){$rootScope.optionsGalleryItem(id)},classes:'thin',visible:options.area==='gallery'},{text:'Back',action:function(){$rootScope.optionsArtwork(id)},classes:'thin',visible:options.area==='artwork'}],dismissButton:{visible:!0}});PopoverService.show()};$rootScope.optionsGalleryItem=function(id){PopoverService.initialise('default',{description:'Artwork Options',buttonOptions:[{text:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'Feature':'Un-Feature'),action:function(){$rootScope.popoverSwitch(function(){$rootScope.featureGalleryItem(id)})},classes:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'blue':'red'),visible:$rootScope.canFeature()},{text:'Edit',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id+"/edit")},classes:'',visible:$rootScope.isOwner(id)},{text:'Open in New Tab',action:function(){PopoverService.hide()},classes:'',visible:!$rootScope.isOwner(id)&&$rootScope.loggedIn,target:'/'+$rootScope.getUser(id,"image").username+'/artwork/'+id},{text:'View Profile',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'',visible:!$rootScope.isOwner(id)&&$rootScope.loggedIn},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem(id,'image')})},classes:'red',visible:(!$rootScope.isOwner(id)||($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$rootScope.deleteGalleryItem(id)})},classes:'red',visible:$rootScope.isOwner(id)},{text:'More...',action:function(){$rootScope.optionsGalleryItemAdmin(id,{area:'gallery'})},classes:'thin',visible:$rootScope.isModeratorUser()&&!$rootScope.isOwner(id)}],dismissButton:{visible:!0}});PopoverService.show()};$rootScope.reportArtwork=function(imageId){if($rootScope.checkCanPerform(!0,!0)){$('.item-artwork[data-id='+imageId+']').removeClass('options-active');$rootScope.report(imageId,'image')}};$rootScope.reportArtworkReply=function(imageReplyId){if($rootScope.checkCanPerform(!0,!0)){$rootScope.report(imageReplyId,'image_reply')}};$rootScope.reportNewsComment=function(newsCommentId){if($rootScope.checkCanPerform(!0,!0)){$rootScope.report(newsCommentId,'news_reply')}};$rootScope.reportReply=function(replyId){if($rootScope.checkCanPerform(!0,!0)){$rootScope.report(replyId,'reply')}};$rootScope.reportPost=function(postId){if($rootScope.checkCanPerform(!0,!0)){$rootScope.report(postId,'post')}};$rootScope.binaryLocked={follow:{thread:[],board:[]},like:{comment:[],newsComment:[],image:[],post:[],reply:[]},vote:{thread:[]}};$rootScope.openModalVideo=function(path,poster,key,showFirst){ModalService.getData().posterUrl=poster;ModalService.getData().videoUrl=path;ModalService.getData().showFirst=showFirst;if($rootScope.isMobile()){$rootScope.showMobileFourOneVideoOptions=!1;var $$$$=document.querySelector.bind(document);setTimeout(function(){var player;if(key==='fourOneModalVideoLoaded'){player=$$$$('#mobilePlayer2')}else{player=$$$$('#mobilePlayer1')}
player.play();var requestFullScreen=player.requestFullScreen||player.mozRequestFullScreen||player.webkitRequestFullScreen;if(requestFullScreen){requestFullScreen.bind(player)()}
player.addEventListener('ended',function(){if(key==='fourOneModalVideoLoaded'){$rootScope.showMobileFourOneVideoOptions=!0}
if(!$rootScope.$$phase){$rootScope.$apply()}})},100)}else{ModalService.initialise('','','Close',function(){if($('#modalPlayer').length){$('#modalPlayer').get(0).pause()}
ModalService.hide()},'',function(){if($('#modalPlayer').length){$('#modalPlayer').get(0).pause()}
ModalService.hide()},!1,'video');ModalService.getData().modalEvent=key;$('body').off('fourOneModalVideoLoaded').on('fourOneModalVideoLoaded',function(){$('#modalPlayer').on('play',function(){ModalService.getData().videoId='pocket';ModalService.getData().finished=!1;if(!$rootScope.$$phase){$rootScope.$apply()}});$('#modalPlayer').on('ended',function(){ModalService.getData().finished=!0;if(!$rootScope.$$phase){$rootScope.$apply()}})});ModalService.show()}};$rootScope.getTabTitle=function(type){type=defined(type)?type:'none';switch(type){case 'portfolio':return'Portfolio';case 'about':return'Biography';case 'inspiration':return'Inspiration';case 'discussions':return'Discussions';case 'store':return'Store';case 'system':return'System';case 'all':return'All';case 'none':return'No Title'}
return!1};$rootScope.targetTabClick=function(id,direction){var $leftTab=jQuery('#'+id+'-tab-toggle.tab-toggle-container .toggle-option.left');var $rightTab=jQuery('#'+id+'-tab-toggle.tab-toggle-container .toggle-option.right');var $targetTabToggle=jQuery('#'+id+'-tab-toggle.tab-toggle-container');var $targetTabContent=jQuery('#'+id+'-tab-content.tab-content-container');if(defined(direction)&&direction==='left'){if($targetTabToggle.hasClass('alt')&&$targetTabContent.hasClass('alt')){$targetTabToggle.removeClass('alt');$targetTabContent.removeClass('alt')}}else if(defined(direction)&&direction==='right'){if(!$targetTabToggle.hasClass('alt')&&!$targetTabContent.hasClass('alt')){$targetTabToggle.addClass('alt');$targetTabContent.addClass('alt')}}};$rootScope.openAdminBucket=function(reference,rgb){AdminService.initialise(reference,rgb);AdminService.show()};$rootScope.getDate=function(date){if(defined(date)){date=date.replace(' ','T');var fullDate=new Date(date);return fullDate.getDate()}
return""};$rootScope.getMonth=function(date){if(defined(date)){date=date.replace(' ','T');var fullDate=new Date(date);return("0"+(fullDate.getMonth()+1)).slice(-2)}
return""};$rootScope.getYear=function(date){if(defined(date)){date=date.replace(' ','T');var fullDate=new Date(date);return fullDate.getFullYear()}
return""};$rootScope.sortArray=function(arrayToReverse,sortFunction){if(typeof arrayToReverse==='object'){return jQuery.map(arrayToReverse,function(value,index){return[value]}).sort(sortFunction)}
if(typeof arrayToReverse==='Array'){return arrayToReverse.sort(sortFunction)}
return arrayToReverse};$rootScope.sortByLastPost=function(a,b){if($rootScope.getThread(a).updated>$rootScope.getThread(b).updated){return-1}
if($rootScope.getThread(a).updated<$rootScope.getThread(b).updated){return 1}
return 0};$rootScope.threadOrdering=function(a,b){if($rootScope.getThread(a.value.id).updated>$rootScope.getThread(b.value.id).updated){return-1}
if($rootScope.getThread(a.value.id).updated<$rootScope.getThread(b.value.id).updated){return 1}
return 0};$rootScope.getThreadsByPage=function(arr,page){var returnArray=[];if(defined(arr)){for(var i=(page-1)*THREADPAGINATIONCOUNT;i<page*THREADPAGINATIONCOUNT;i ++){if(defined(arr[i])){returnArray.push(arr[i])}}}
return returnArray};$rootScope.arrFromMyObj=function(myObj){if(typeof myObj!=='undefined'&&myObj!==null){return Object.keys(myObj).map(function(key){return myObj[key]})}
return[]};$rootScope.getPostsByPage=function(arr,page){var returnArray=[];if(defined(arr)){for(var i=(page-1)*POSTPAGINATIONCOUNT;i<page*POSTPAGINATIONCOUNT;i ++){if(defined(arr[i])){returnArray.push(arr[i])}}}
return returnArray};$rootScope.setPageLoader=function(show){$rootScope.showPageLoader=show?'loading-show':''};$rootScope.checkAnimatable=function(animate){if($rootScope.previousCall!==animate){$rootScope.animationClass='view-animate'}else{$rootScope.animationClass=''}
$rootScope.previousCall=animate};$rootScope.isLiked=function($primaryId,$secondaryId,$thirdId,type){type=defined(type)?type:'image';var image=$rootScope.getImage($primaryId);var newsArticle=$rootScope.getNewsArticle($primaryId);var post=$rootScope.getPost($primaryId,$secondaryId);switch(type){case 'image':return!$rootScope.isEmpty(image)?image.likes.indexOf($rootScope.user)!==-1:!1;case 'comment':return!$rootScope.isEmpty(image)?image.galleryComments[$secondaryId].likes.indexOf($rootScope.user)!==-1:!1;case 'commentReply':return!$rootScope.isEmpty(image)?image.galleryComments[$secondaryId].replies[$thirdId].likes.indexOf($rootScope.user)!==-1:!1;case 'newsComment':return!$rootScope.isEmpty(newsArticle)?newsArticle.comments[$secondaryId].likes.indexOf($rootScope.user)!==-1:!1;case 'newsCommentReply':return!$rootScope.isEmpty(newsArticle)?newsArticle.comments[$secondaryId].replies[$thirdId].likes.indexOf($rootScope.user)!==-1:!1;case 'post':return!$rootScope.isEmpty(post)?post.post.likes.indexOf($rootScope.user)!==-1:!1;case 'postReply':var reply=$rootScope.getReply($primaryId,$secondaryId,$thirdId);return!$rootScope.isEmpty(reply)?reply.likes.indexOf($rootScope.user)!==-1:!1}
return!1};$rootScope.isMobile=function(){return isMobile};$rootScope.isGridTwo=function(){return isGridTwo};$rootScope.performImageLike=function($imageId){if($rootScope.loggedIn){var image=$rootScope.getImage($imageId);if(image.userId===$rootScope.user){alert("You cant like your own content.")}else if(image.likes.indexOf($rootScope.user)===-1){GalleryService.likeImage($rootScope.user,$rootScope.getUser($rootScope.user).token,$imageId)}else{GalleryService.removeImageLike($rootScope.user,$rootScope.getUser($rootScope.user).token,$imageId)}}else{alert("You must login to like content")}};$rootScope.performCommentLike=function($imageId,$commentId){if($rootScope.loggedIn){var image=$rootScope.getImage($imageId);if(image.galleryComments[$commentId].userId===$rootScope.user){alert("You cant like your own content.")}else if(image.galleryComments[$commentId].likes.indexOf($rootScope.user)===-1){GalleryService.likeComment($rootScope.user,$rootScope.getUser($rootScope.user).token,$imageId,$commentId,!1)}else{GalleryService.removeCommentLike($rootScope.user,$rootScope.getUser($rootScope.user).token,$imageId,$commentId,!1)}}else{alert("You must login to like content")}};$rootScope.performNewsCommentLike=function($newsArticle,$commentId){if($rootScope.loggedIn){var newsArticle=$rootScope.getNewsArticle($newsArticle);if(newsArticle.comments[$commentId].userId===$rootScope.user){alert("You cant like your own content.")}else if(newsArticle.comments[$commentId].likes.indexOf($rootScope.user)===-1){NewsService.likeComment($rootScope.user,$rootScope.getUser($rootScope.user).token,$newsArticle,$commentId,!1)}else{NewsService.removeCommentLike($rootScope.user,$rootScope.getUser($rootScope.user).token,$newsArticle,$commentId,!1)}}else{alert("You must login to like content")}};$rootScope.performCommentReplyLike=function($imageId,$commentId,$replyId){if($rootScope.loggedIn){var image=$rootScope.getImage($imageId);if(image.galleryComments[$commentId].replies[$replyId].userId===$rootScope.user){alert("You cant like your own content.")}else if(image.galleryComments[$commentId].replies[$replyId].likes.indexOf($rootScope.user)===-1){GalleryService.likeComment($rootScope.user,$rootScope.getUser($rootScope.user).token,$imageId,$commentId,$replyId)}else{GalleryService.removeCommentLike($rootScope.user,$rootScope.getUser($rootScope.user).token,$imageId,$commentId,$replyId)}}else{alert("You must login to like content")}};$rootScope.performNewsCommentReplyLike=function($newsArticle,$commentId,$replyId){if($rootScope.loggedIn){var newsArticle=$rootScope.getNewsArticle($newsArticle);if(newsArticle.comments[$commentId].replies[$replyId].userId===$rootScope.user){alert("You cant like your own content.")}else if(newsArticle.comments[$commentId].replies[$replyId].likes.indexOf($rootScope.user)===-1){NewsService.likeComment($rootScope.user,$rootScope.getUser($rootScope.user).token,$newsArticle,$commentId,$replyId)}else{NewsService.removeCommentLike($rootScope.user,$rootScope.getUser($rootScope.user).token,$newsArticle,$commentId,$replyId)}}else{alert("You must login to like content")}};$rootScope.performReplyLike=function($threadId,$postId,$replyId){if($rootScope.loggedIn){var post=$rootScope.getPost($threadId,$postId);var reply=$rootScope.getReply($threadId,$postId,$replyId);if(reply.userId===$rootScope.user){alert("You cant like your own content.")}else if(reply.likes.indexOf($rootScope.user)===-1){DiscussionService.likeReply($rootScope.user,$rootScope.getUser($rootScope.user).token,$threadId,post.position,$replyId)}else{DiscussionService.likeReplyRemove($rootScope.user,$rootScope.getUser($rootScope.user).token,$threadId,post.position,$replyId)}}else{alert("You must login to like content")}};$rootScope.performPostLike=function($threadId,$postId){if($rootScope.loggedIn){var post=$rootScope.getPost($threadId,$postId);var position=post.position;if(post.post.op==='1'){position='0'}
if(post.post.userId===$rootScope.user){alert("You cant like your own content.")}else if(post.post.likes.indexOf($rootScope.user)===-1){DiscussionService.likePost($rootScope.user,$rootScope.getUser($rootScope.user).token,$threadId,position,$postId)}else{DiscussionService.likePostRemove($rootScope.user,$rootScope.getUser($rootScope.user).token,$threadId,position,$postId)}}else{alert("You must login to like content")}};$rootScope.viewImageLikes=function(id){var view={id:id,type:'image'};PopoverService.initialise('likes',{title:'Likes',content:PopoverService.generateContent('likes_view',view),dismissButton:{visible:!0}});PopoverService.show()};$rootScope.viewCommentLikes=function(id){var view={id:id,type:'image_comment'};PopoverService.initialise('likes',{title:'Likes',content:PopoverService.generateContent('likes_view',view),dismissButton:{visible:!0}});PopoverService.show()};$rootScope.viewNewsCommentLikes=function(id){var view={id:id,type:'news_comment'};PopoverService.initialise('likes',{title:'Likes',content:PopoverService.generateContent('likes_view',view),dismissButton:{visible:!0}});PopoverService.show()};$rootScope.viewOpPostLikes=function(id){var view={id:id,type:'thread'};PopoverService.initialise('likes',{title:'Likes',content:PopoverService.generateContent('thread_likes_view',view),dismissButton:{visible:!0}});PopoverService.show()};$rootScope.viewPostLikes=function(id){var view={id:id,type:'post'};PopoverService.initialise('likes',{title:'Likes',content:PopoverService.generateContent('likes_view',view),dismissButton:{visible:!0}});PopoverService.show()};$rootScope.viewReplyLikes=function(id){var view={id:id,type:'reply'};PopoverService.initialise('likes',{title:'Likes',content:PopoverService.generateContent('likes_view',view),dismissButton:{visible:!0}});PopoverService.show()};$rootScope.getThreadPositionByThread=function(boardId,threadId){var board=$rootScope.getBoard(boardId);board.threads.forEach(function(thread){if(thread.id==threadId){return thread.position}})};$rootScope.performThreadVote=function($threadId,vote){if($rootScope.loggedIn){var thread=$rootScope.getThread($threadId);if(thread.userId===$rootScope.user){alert("You cant vote on your own content.")}else if((thread.upVotes.indexOf($rootScope.user)!==-1&&vote)||(thread.downVotes.indexOf($rootScope.user)!==-1&&!vote)){DiscussionService.removeVoteThread($rootScope.user,$rootScope.getUser($rootScope.user).token,$threadId,vote)}else{var voted=(thread.upVotes.indexOf($rootScope.user)!==-1)||(thread.downVotes.indexOf($rootScope.user)!==-1);DiscussionService.voteThread($rootScope.user,$rootScope.getUser($rootScope.user).token,$threadId,vote,voted)}}else{alert("You must login to like content")}};$rootScope.userHasVoted=function($threadId,vote){if($rootScope.loggedIn){var thread=$rootScope.getThread($threadId);return defined(thread.upVotes)&&((thread.upVotes.indexOf($rootScope.user)!==-1&&vote)||(thread.downVotes.indexOf($rootScope.user)!==-1&&!vote))}
return!1};$rootScope.scrollToTop=function(){$('html, body').animate({scrollTop:0},700)};$rootScope.getThumbHeight=function(id){var baseWidth=$rootScope.getImage(id).width;var baseHeight=$rootScope.getImage(id).height;var initWidth=278;var initHeight=494;var height=0;if($(window).outerWidth()<656){initWidth=177;initHeight=314}
if($(window).outerWidth()<414){initWidth=157;initHeight=279}
if($(window).outerWidth()<375){initWidth=280;initHeight=497}
if(baseWidth==0){return''}
if(initWidth/baseWidth<=initHeight/baseHeight){var finalWidth=baseWidth>initWidth?initWidth:baseWidth;height=baseHeight/(baseWidth/finalWidth)}else{height=baseHeight>initHeight?initHeight:height}
return height};$rootScope.toggleLogin=function(){PopoverService.initialise('login',{graphic:{classes:'blue',visible:!0},title:'Log in',dismissButton:{visible:!0},topLeftLink:{text:'Forgot?',action:function(){PopoverService.hide();$rootScope.redirect('/forgot')},classes:'',visible:!0},topRightLink:{text:'Sign Up',action:function(){PopoverService.hide();$rootScope.redirect('/register')},classes:'',visible:!0}});PopoverService.show()};$rootScope.toggleUserMenu=function(type){switch(type){case 'open':$rootScope.navMenuClass='';if($rootScope.loggedIn){if($rootScope.isMobile()){SliderService.initialise('Manage Account','account',{},SliderService.hide);SliderService.show()}else{$rootScope.userMenuClass='open'}
$rootScope.notificationsOpen=!0}else{if($rootScope.isMobile()){SliderService.initialise('Log in or Register','login',{},SliderService.hide);SliderService.show()}else{ModalService.initialise('Log in','','Done',ModalService.hide,'Cancel',ModalService.hide,2,'login');ModalService.show()}}
break;case 'close':$rootScope.userMenuClass='';$rootScope.notificationsOpen=!1;if($rootScope.isMobile()){SliderService.hide()}else if(!$rootScope.loggedIn){ModalService.hide()}
break;default:if($rootScope.userMenuClass==='open'){$rootScope.userMenuClass='';$rootScope.notificationsOpen=!1;if($rootScope.isMobile()){SliderService.hide()}else{ModalService.hide()}}else{$rootScope.navMenuClass='';if($rootScope.isMobile()){if($rootScope.loggedIn){SliderService.initialise('Manage Account','account',{},SliderService.hide)}else{SliderService.initialise('Log in or Register','login',{},SliderService.hide)}
$rootScope.notificationsOpen=!0;SliderService.show()}else{if($rootScope.loggedIn){$rootScope.notificationsOpen=!0;$rootScope.userMenuClass='open'}else{ModalService.initialise('Log in','','Done',ModalService.hide,'Cancel',ModalService.hide,2,'login');ModalService.show()}}}}};$rootScope.toggleNavMenu=function(type){switch(type){case 'open':$rootScope.navMenuClass='open';$rootScope.userMenuClass='';ModalService.hide();break;case 'close':$rootScope.navMenuClass='';break;default:if($rootScope.navMenuClass==='open'){$rootScope.navMenuClass=''}else{$rootScope.navMenuClass='open';$rootScope.userMenuClass='';ModalService.hide()}}};$rootScope.resetNavs=function(){$rootScope.userMenuClass='';if($rootScope.sliderShow){SliderService.hide()}
ModalService.hide();$rootScope.endLongHold();$rootScope.navMenuClass=''};$rootScope.redirect=function(link,name,type){if(defined(name)&&name){$window.open(link,name)}else{if(defined(type)&&type){$window.location.url(link)}else{$rootScope.linkClicked=!0;$location.url(link);if(link==='/search'){$rootScope.resetNavs('search')}else{$rootScope.resetNavs()}
$rootScope.previewClass=''}}};$rootScope.getTabName=function(value){switch(value){case 'featured':return'Featured';break;case 'popular':return'Popular';break;case 'recent':return'Recent';break;default:console.log('Invalid Tab Name, Check: getTabName() function');break}};$rootScope.artworkClick=function($event,link){$event.stopPropagation();if($($event.target).is('li')||$($event.target).is('.item-action')){$event.preventDefault()}else{$rootScope.redirect(link)}};$rootScope.requestValidationCode=function(){var formData=new FormData();formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','userConfirmationRequest');$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){alert("Confirmation Email has been sent.")}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert.log(errors)}},!0)};$rootScope.toggleArtworkOptions=function($event,type){var $artwork=$('.item-artwork');if(defined(type)){$(document).off('click touch').on('click touch',function(e){if($(e.target).is('.artworkOptions')){var $this=$($event.target);if($this.parent().parent().hasClass('options-active')){$this.parent().parent().removeClass('options-active');$rootScope.globalToggleable.options=[]}else{$artwork.removeClass('options-active');$rootScope.globalToggleable.options=[];$this.parent().parent().addClass('options-active');$rootScope.globalToggleable.options[type]=!0}}else if(!$(e.target).is('.popover')){$artwork.removeClass('options-active');$rootScope.globalToggleable.options=[];$event.stopPropagation()}
if(!$rootScope.$$digest){$rootScope.$apply()}})}else{console.log('Toggle Type Not Defined')}};$rootScope.togglePostOptions=function($event,type){var $postOptions=$('.postOptionsWrap');if(defined(type)){$(document).off('click touch').on('click touch',function(e){if($(e.target).is('.postOptions')){var $this=$($event.target);if($this.parent().hasClass('options-active')){$this.parent().removeClass('options-active');$rootScope.globalToggleable.options=[]}else{$postOptions.removeClass('options-active');$rootScope.globalToggleable.options=[];$this.parent().addClass('options-active');$rootScope.globalToggleable.options[type]=!0}}else if(!$(e.target).is('.popover')){$postOptions.removeClass('options-active');$rootScope.globalToggleable.options=[];$event.stopPropagation()}
if(!$rootScope.$$digest){$rootScope.$apply()}})}else{console.log('Toggle Type Not Defined')}};$rootScope.shortNumber=function(number){return Math.abs(Number(number))>=1.0e+9?Math.floor(Math.abs(Number(number))/1.0e+9)+"B":Math.abs(Number(number))>=1.0e+6?Math.floor(Math.abs(Number(number))/1.0e+6)+"M":Math.abs(Number(number))>=1.0e+3?Math.floor(Math.abs(Number(number))/1.0e+3)+"K":Math.abs(Number(number))};$rootScope.$on('$p',function(){$rootScope.resetNavs()});$rootScope.getThreadRating=function(upVotes,downVotes){var diff=upVotes-downVotes;if(diff>=10){return'+'+diff}};$rootScope.isNewThreadFunction=function(created){if(defined(created)){var previousTime=new Date(created.replace(/\s/,'T')).getTime();var diff=(Math.abs($rootScope.utcTime.getTime()-previousTime))/(1000*60*60*24);if(diff<=2){return!0}}
return!1};var msPerMinute=60*1000;var msPerHour=msPerMinute*60;var msPerDay=msPerHour*24;var msPerWeek=msPerDay*7;var msPerFortnight=msPerDay*14;var msPerMonth=msPerDay*30;var msPerYear=msPerDay*365;$rootScope.timeFunction=function(previous,type){if(defined(previous)){type=defined(type)?type:'';var calDate=new Date(previous.replace(/\s/,'T'));var previousTime=new Date(previous.replace(/\s/,'T')).getTime();var elapsed=$rootScope.utcTime.getTime()-previousTime;var prefix='';var segue='';switch(type){case 'post':prefix='';segue='on ';break;case 'image':prefix='Published ';segue='on ';break;case 'product':prefix='Uploaded ';segue='on ';break}
if(elapsed<1000){return prefix+'Just now'}
if(elapsed<msPerMinute){return prefix+Math.round(elapsed/1000)+' second'+(Math.round(elapsed/1000)!==1?'s ':' ')+'ago'}
if(elapsed<msPerHour){return prefix+Math.round(elapsed/msPerMinute)+' minute'+(Math.round(elapsed/msPerMinute)!==1?'s ':' ')+'ago'}
if(elapsed<msPerDay){return prefix+Math.round(elapsed/msPerHour)+' hour'+(Math.round(elapsed/msPerHour)!==1?'s ':' ')+'ago'}
if(elapsed<msPerFortnight){return prefix+Math.round(elapsed/msPerDay)+' day'+(Math.round(elapsed/msPerDay)!==1?'s ':' ')+'ago'}
return prefix+segue+calDate.getDate()+' '+months[calDate.getMonth()]+' '+calDate.getFullYear()}
return''};$rootScope.timeFunctionMini=function(previous){if(defined(previous)){var previousTime=new Date(previous.replace(/\s/,'T')).getTime();var elapsed=$rootScope.utcTime.getTime()-previousTime;if(elapsed<1000){return'now'}
if(elapsed<msPerMinute){return Math.round(elapsed/1000)+'s'}
if(elapsed<msPerHour){return Math.round(elapsed/msPerMinute)+'m'}
if(elapsed<msPerDay){return Math.round(elapsed/msPerHour)+'h'}
if(elapsed<msPerWeek){return Math.round(elapsed/msPerDay)+'d'}
if(elapsed<msPerYear){return Math.round(elapsed/msPerWeek)+'w'}
return Math.round(elapsed/msPerYear)+'y'}
return''};$rootScope.getArticleDate=function(time){if(defined(time)){var baseTime=new Date(time);var date=baseTime.getDate();var month=monthsFull[baseTime.getMonth()];var year=baseTime.getFullYear();return month+' '+date+', '+year}
return''};$rootScope.getArticleYear=function(time){if(defined(time)){var baseTime=new Date(time);return baseTime.getFullYear()}
return''};$rootScope.checkCanPerform=function(valid,banned){var canProceed=!0;valid=defined(valid)?valid:!1;banned=defined(banned)?banned:!1;if(valid&&parseInt($rootScope.getUser($rootScope.user).active)===0){alert("You need to validate your account before performing that action.");canProceed=!1}
if(banned&&parseInt($rootScope.getUser($rootScope.user).status)===2){alert("A banned account cannot performing that action.");canProceed=!1}
return canProceed};$rootScope.timeAgo=$rootScope.timeFunction;$rootScope.timeAgoMini=$rootScope.timeFunctionMini;$rootScope.isNewThread=$rootScope.isNewThreadFunction;$rootScope.$watch('utcTime',function(){$rootScope.timeAgo=function(){};$rootScope.timeAgo=$rootScope.timeFunction;$rootScope.timeAgoMini=function(){};$rootScope.timeAgoMini=$rootScope.timeFunctionMini;$rootScope.isNewThread=function(){};$rootScope.isNewThread=$rootScope.isNewThreadFunction});$rootScope.httpQuery=function(query,callback){$http({method:'POST',url:APIURL,data:query,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;callback(data)}).catch(function(response){console.log(response)})};$rootScope.ajaxQuery=function(formData,callback,loader){if(defined(loader)&&loader){showLoader(!0)}
$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);if(defined(loader)&&loader){showLoader(!1)}
callback(data)},error:function(response){alert("There was an error with your request.  Please try again later.")
if(defined(loader)&&loader){showLoader(!1)}}})};$rootScope.debug=function(val){console.log(val)};$rootScope.openPressKitsModal=function(){ModalService.initialise('Choose Press Kit','','Done',function(){ModalService.hide()},'',function(){ModalService.hide()},!1,'press-kits','');ModalService.show()};$rootScope.updateMetadataByPath=function(path){var meta;var type=metaDefaults.default.type,title=metaDefaults.default.title,description=metaDefaults.default.description,image=metaDefaults.default.image;var pathParts=path.split('/');var useExtra=!1;$rootScope.currentPath=path;switch(pathParts[1]){case 'discussions':title=metaDefaults[pathParts[1]].title;description=metaDefaults[pathParts[1]].description;image=metaDefaults[pathParts[1]].image;break;case 'insight':title=metaDefaults[pathParts[1]].title;description=metaDefaults[pathParts[1]].description;image=metaDefaults[pathParts[1]].image;break;case 'showcase':if(defined(pathParts[2])&&(pathParts[2]==='featured'||pathParts[2]==='popular'||pathParts[2]==='recent')){useExtra=!0}
case 'ipad':if(defined(pathParts[2])&&(pathParts[2]==='preview')){useExtra=!0}
case 'pocket':case 'register':case 'marketplace':case 'beta':case 'support':case 'handbook':case 'faq':case 'search':case 'prize':case 'terms-conditions':case 'privacy-policy':case 'sitemap':var metaObj=metaDefaults[pathParts[1]];if(useExtra){metaObj=metaDefaults[pathParts[1]][pathParts[2]]}
type=metaObj.type;title=metaObj.title;description=metaObj.description;image=metaObj.image;break}
meta={type:type,url:metaDefaults.default.url,site_name:metaDefaults.default.site_name,title:title,description:description,image:image};updateMetadata(meta)};$rootScope.performVote=function(id,vote){PrizeService.performVote(id,vote)};$rootScope.getEntryVotedClass=function(entryId){if(defined($rootScope.competitions().votes[entryId])){return $rootScope.competitions().votes[entryId].vote==='1'?'vote-yes':'vote-no'}
return'none'};$rootScope.loadFullEntry=function(compId,entryId,voting){var entry=$rootScope.getCompetitionEntry(compId,entryId);entry.voting=voting;if(voting){entry.currentVoteClass=$rootScope.getEntryVotedClass(entryId)}
PopoverService.initialise('entryFull',{graphic:{visible:!1},title:entry.title,description:entry.description,content:entry,dismissButton:{visible:!0}});PopoverService.show()}}]);var parseVideo=function(url){var type='';var isMatch=url.match(/(http:|https:|)\/\/(player.|www.)?(vimeo\.com|youtu(be\.com|\.be|be\.googleapis\.com))\/(video\/|embed\/|watch\?v=|v\/)?([A-Za-z0-9._%-]*)(\&\S+)?/);if(isMatch&&RegExp.$3.indexOf('youtu')>-1){type='youtube'}else if(isMatch&&RegExp.$3.indexOf('vimeo')>-1){type='vimeo'}
return{type:type,id:RegExp.$6}};var createVideo=function(url){var videoObj=parseVideo(url);if(videoObj.type==='youtube'){return'<div class="embed-video"><div class="container"><iframe src="https://www.youtube.com/embed/'+videoObj.id+'" frameborder="0"></iframe></div></div>'}else if(videoObj.type==='vimeo'){return'<div class="embed-video"><div class="container"><iframe src="https://player.vimeo.com/video/'+videoObj.id+'" frameborder="0"></iframe></div></div>'}
return!1};var createNewsVideo=function(url,caption){var videoObj=parseVideo(url);if(videoObj.type==='youtube'){return'<figure class="generic-video"><div class="embed-video"><div class="container"><iframe src="https://www.youtube.com/embed/'+videoObj.id+'" frameborder="0"></iframe></div></div><figcaption>'+caption+'</figcaption></figure>'}else if(videoObj.type==='vimeo'){return'<figure class="generic-video"><div class="embed-video"><div class="container"><iframe src="https://player.vimeo.com/video/'+videoObj.id+'" frameborder="0"></iframe></div></div><figcaption>'+caption+'</figcaption></figure>'}
return!1};var showLoader=function(show){var $loader=jQuery('#loader-container');if($loader.hasClass('show')!==show){$loader.toggleClass('show')}};var showModuleLoader=function(id,show){var $elm=jQuery(id);if($elm.hasClass('loader')!==show){$elm.toggleClass('loader')}};var objInArrayById=function(arr,obj){for(var i=0;i<arr.length;i++){if(arr[i].id===obj.id){return!0}}
return!1};var getObjFromArrayByValue=function(arr,value){if(defined(arr)){for(var i=0;i<arr.length;i++){if(arr[i].value==value){return arr[i]}}}
return!1};var defined=function(elm){return typeof elm!=='undefined'};var updateMetadata=function(meta){$('meta[name=description]').attr('content',meta.description);$('meta[property="og:url"]').attr('content',meta.url);$('meta[property="og:type"]').attr('content',meta.type);$('meta[property="og:title"]').attr('content',meta.title);$('meta[property="og:description"]').attr('content',meta.description);$('meta[property="og:site_name"]').attr('content',meta.site_name);$('meta[property="og:image"]').attr('content',meta.image);$('meta[name="twitter:title"]').attr('content',meta.title);$('meta[name="twitter:description"]').attr('content',meta.description);$('meta[name="twitter:image"]').attr('content',meta.image);document.title=meta.title};var addToDebug=function(log){if(jQuery('body').hasClass('developer')){switch(debugging){case 'console':console.log(log);break;case 'display':jQuery('#debugger').append(log+"<br />");break;case 'alert':alert(log);break}}};jQuery(document).ready(function(){windowLoaded=!0});app.config(function($httpProvider,$routeProvider,$locationProvider,$anchorScrollProvider){$routeProvider.when("/",{templateUrl:"templates/index/index.php",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'},page:function($route){$route.current.params.page='discover'}}}).when("/pocket",{templateUrl:"templates/pocket/index.php",controller:'parallaxController',resolve:{section:function($route){$route.current.params.section='discover'},page:function($route){$route.current.params.page='pocket-keyframes'}}}).when("/pocket/beta",{templateUrl:"templates/pocket/beta.php",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'}}}).when("/pocket/beta/terms-conditions",{templateUrl:"templates/terms-conditions/beta/index.htm",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'}}}).when("/ipad",{templateUrl:"templates/ipad/index.php",controller:'parallaxController',resolve:{section:function($route){$route.current.params.section='discover'},page:function($route){$route.current.params.page='pad-keyframes'},mobileOverride:function($route){$route.current.params.mobileOverride='true'}}}).when("/procreate/private-beta/terms-conditions",{templateUrl:"templates/terms-conditions/private-beta/index.htm",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'}}}).when("/prize",{templateUrl:"templates/prize/index.php",controller:'prizeController',resolve:{section:function($route){$route.current.params.section='discover'},page:function($route){$route.current.params.page='prize'}}}).when("/prize/terms-conditions",{templateUrl:"templates/terms-conditions/prize/index.htm",controller:'prizeController',resolve:{section:function($route){$route.current.params.section='discover'},page:function($route){$route.current.params.page='terms'}}}).when("/support",{templateUrl:"templates/support/index.php",controller:'contentController',resolve:{section:function($route){$route.current.params.section='support'}}}).when("/faq",{templateUrl:"templates/faq/index.php",controller:'contentController',resolve:{section:function($route){$route.current.params.section='support'},tab:function($route){$route.current.params.page='faq'}}}).when("/insight",{templateUrl:"templates/news/index.htm",controller:'newsController',resolve:{section:function($route){$route.current.params.section='insight'},tab:function($route){$route.current.params.page='articles'}}}).when("/insight/:year",{templateUrl:"templates/news/index.htm",controller:'newsController',resolve:{section:function($route){$route.current.params.section='insight'},tab:function($route){$route.current.params.page='articles'}}}).when("/insight/:year/:articleUrl",{templateUrl:"templates/news/article.htm",controller:'newsController',resolve:{section:function($route){$route.current.params.section='insight'},tab:function($route){$route.current.params.page='articles'}}}).when("/privacy-policy",{templateUrl:"templates/privacy-policy/index.htm",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'}}}).when("/terms-conditions",{templateUrl:"templates/terms-conditions/index.htm",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'}}}).when("/beta",{templateUrl:"templates/404.htm",controller:'contentController',resolve:{section:function($route){$route.current.params.section='discover'}}}).when("/404",{templateUrl:"templates/404.htm",controller:'contentController'}).when("/thread404",{templateUrl:"templates/thread404.htm",controller:'contentController'}).when("/board404",{templateUrl:"templates/board404.htm",controller:'contentController'}).when("/unknown",{templateUrl:"templates/404.htm",controller:'contentController'}).when("/press",{templateUrl:"templates/404.htm",controller:'contentController'}).when("/discover",{templateUrl:"templates/404.htm",controller:'contentController'}).when("/admin",{templateUrl:"templates/admin/base.htm",controller:'adminController'}).when("/admin/users",{templateUrl:"templates/admin/users.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='users'}}}).when("/admin/notifications",{templateUrl:"templates/admin/notifications.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='notifications'}}}).when("/admin/users/:user/delete",{templateUrl:"templates/admin/users/delete.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='users'}}}).when("/admin/search/terms",{templateUrl:"templates/admin/search/terms.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='searchTerms'}}}).when("/admin/search/terms/create",{templateUrl:"templates/admin/search/termsCreate.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='searchTerms'}}}).when("/admin/search/terms/:id",{templateUrl:"templates/admin/search/termsEdit.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='searchTerms'}}}).when("/admin/search/links",{templateUrl:"templates/admin/search/links.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='searchLinks'}}}).when("/admin/search/links/create",{templateUrl:"templates/admin/search/linksCreate.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='searchLinks'}}}).when("/admin/search/links/:id",{templateUrl:"templates/admin/search/linksEdit.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='searchLinks'}}}).when("/admin/resources",{templateUrl:"templates/admin/resources.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='resources'}}}).when("/admin/resources/create",{templateUrl:"templates/admin/resourcesCreate.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='interface'}}}).when("/admin/roles",{templateUrl:"templates/admin/roles.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='roles'}}}).when("/admin/roles/create",{templateUrl:"templates/admin/roleCreate.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='roles'}}}).when("/admin/roles/:role/users",{templateUrl:"templates/admin/roleUsers.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='roleUser'}}}).when("/admin/roles/:role/users/add",{templateUrl:"templates/admin/roleUsersAdd.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='interface'}}}).when("/admin/roles/:role/users/delete",{templateUrl:"templates/admin/roleUsersDelete.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='interface'}}}).when("/admin/roles/:role/permissions",{templateUrl:"templates/admin/rolePermissions.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='rolePermissions'}}}).when("/admin/roles/:role/permissions/add",{templateUrl:"templates/admin/rolePermissionsAdd.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='interface'}}}).when("/admin/tags/",{templateUrl:"templates/admin/tagManage.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='tagManage'}}}).when("/admin/tags/boards/:boardId/",{templateUrl:"templates/admin/tagBoardManage.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='tagBoardManage'}}}).when("/admin/reports/",{templateUrl:"templates/admin/reports.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='reports'}}}).when("/admin/reports/galleryItems",{templateUrl:"templates/admin/reports/galleryItems.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='galleryItemsReports'}}}).when("/admin/reports/galleryItemBannings",{templateUrl:"templates/admin/reports/galleryItemBannings.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='galleryItemBanningReports'}}}).when("/admin/reports/marketItems",{templateUrl:"templates/admin/reports/marketItems.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='marketItemsReports'}}}).when("/admin/reports/galleryComments",{templateUrl:"templates/admin/reports/galleryComments.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='galleryCommentsReports'}}}).when("/admin/reports/insightsComments",{templateUrl:"templates/admin/reports/newsComments.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='newsCommentsReports'}}}).when("/admin/reports/marketComments",{templateUrl:"templates/admin/reports/marketComments.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='marketCommentsReports'}}}).when("/admin/reports/discussionPosts",{templateUrl:"templates/admin/reports/discussionPosts.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='discussionPostsReports'}}}).when("/admin/reports/discussionReplies",{templateUrl:"templates/admin/reports/discussionReplies.htm",controller:'adminController',resolve:{tab:function($route){$route.current.params.page='discussionRepliesReports'}}}).when("/admin/competitions",{templateUrl:"templates/admin/competition.htm",controller:'prizeController',resolve:{tab:function($route){$route.current.params.page='competition'}}}).when("/admin/competition/create",{templateUrl:"templates/admin/competition/create.htm",controller:'prizeController',resolve:{tab:function($route){$route.current.params.page='competition'}}}).when("/admin/competition/:competition/edit",{templateUrl:"templates/admin/competition/edit.htm",controller:'prizeController',resolve:{tab:function($route){$route.current.params.page='competition'}}}).when("/admin/competition/:competition/vote",{templateUrl:"templates/admin/competition/vote.htm",controller:'prizeController',resolve:{tab:function($route){$route.current.params.page='competition'},process:function($route){$route.current.params.process='voting'}}}).when("/admin/competition/:competition/vote/:pagepos",{templateUrl:"templates/admin/competition/vote.htm",controller:'prizeController',resolve:{tab:function($route){$route.current.params.page='competition'},process:function($route){$route.current.params.process='voting'}}}).when("/admin/competition/:competition/results",{templateUrl:"templates/admin/competition/results.htm",controller:'prizeController',resolve:{tab:function($route){$route.current.params.page='competition'},process:function($route){$route.current.params.process='results'}}}).when("/admin/handbook",{templateUrl:"templates/admin/handbook/articleList.htm",controller:'handbookController',resolve:{tab:function($route){$route.current.params.page='handbook'}}}).when("/admin/handbook/articles",{templateUrl:"templates/admin/handbook/articleList.htm",controller:'handbookController',resolve:{tab:function($route){$route.current.params.page='handbook'}}}).when("/admin/handbook/articles/create",{templateUrl:"templates/admin/handbook/articleCreate.htm",controller:'handbookController'}).when("/admin/handbook/articles/:id",{templateUrl:"templates/admin/handbook/articleEdit.htm",controller:'handbookController',resolve:{tab:function($route){$route.current.params.page='handbook'}}}).when("/admin/instagram",{templateUrl:"templates/admin/instagram/articleList.htm",controller:'instagramController',resolve:{tab:function($route){$route.current.params.page='instagram'}}}).when("/admin/instagram/articles",{templateUrl:"templates/admin/instagram/articleList.htm",controller:'instagramController',resolve:{tab:function($route){$route.current.params.page='instagram'}}}).when("/admin/instagram/articles/create",{templateUrl:"templates/admin/instagram/articleCreate.htm",controller:'instagramController'}).when("/admin/instagram/articles/:id",{templateUrl:"templates/admin/instagram/articleEdit.htm",controller:'instagramController',resolve:{tab:function($route){$route.current.params.page='instagram'}}}).when("/admin/insight",{templateUrl:"templates/admin/newsRoom/index.htm",controller:'newsController'}).when("/admin/insight/articles",{templateUrl:"templates/admin/newsRoom/articleList.htm",controller:'newsController',resolve:{tab:function($route){$route.current.params.page='articles'}}}).when("/admin/insight/articles/create",{templateUrl:"templates/admin/newsRoom/articleCreate.htm",controller:'newsController'}).when("/admin/insight/articles/:id",{templateUrl:"templates/admin/newsRoom/articleEdit.htm",controller:'newsController',resolve:{tab:function($route){$route.current.params.page='articles'}}}).when("/admin/insight/articles/:id/share",{templateUrl:"templates/admin/newsRoom/articleShare.htm",controller:'newsController',resolve:{tab:function($route){$route.current.params.page='articles'}}}).when("/admin/insight/categories",{templateUrl:"templates/admin/newsRoom/categoryList.htm",controller:'newsController',resolve:{tab:function($route){$route.current.params.page='categories'}}}).when("/admin/insight/categories/create",{templateUrl:"templates/admin/newsRoom/categoryCreate.htm",controller:'newsController'}).when("/admin/beta",{templateUrl:"templates/admin/beta/index.htm",controller:'betaController'}).when("/admin/beta/create",{templateUrl:"templates/admin/beta/typeCreate.htm",controller:'betaController'}).when("/admin/beta/:type",{templateUrl:"templates/admin/beta/type.htm",controller:'betaController'}).when("/admin/beta/:type/edit",{templateUrl:"templates/admin/beta/typeEdit.htm",controller:'betaController'}).when("/search",{templateUrl:"templates/search.htm",controller:'searchController'}).when("/search/:term",{templateUrl:"templates/search.htm",controller:'searchController'}).when("/showcase",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='featured'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/showcase/featured",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='featured'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/showcase/featured/:page",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='featured'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/showcase/popular",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='popular'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/showcase/popular/:page",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='popular'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/showcase/recent",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='recent'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/showcase/recent/:page",{templateUrl:"templates/gallery.htm",controller:'galleryController',resolve:{section:function($route){$route.current.params.section='showcase'},tab:function($route){$route.current.params.tab='recent'},sectionTabs:function($route){$route.current.params.sectionTabs=['featured','popular','recent']}}}).when("/register",{templateUrl:"templates/register.htm",controller:'registerController'}).when("/marketplace",{templateUrl:"templates/market.htm",controller:'marketController',resolve:{section:function($route){$route.current.params.section='marketplace'}}}).when("/discussions",{templateUrl:"templates/discussions.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/discussions/redirect/:redirect",{templateUrl:"templates/discussions.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/discussions/:board",{templateUrl:"templates/discussions.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/discussions/:board/create",{templateUrl:"templates/discussionsCreate.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/discussions/:board/:category",{templateUrl:"templates/discussions.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/discussions/:board/:category/:thread",{templateUrl:"templates/discussions.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/discussions/:board/:category/:thread/:post",{templateUrl:"templates/discussions.htm",controller:'discussionsController',resolve:{section:function($route){$route.current.params.section='discussions'}}}).when("/notifications",{templateUrl:"templates/notificationsCenter.htm",controller:'notificationsController'}).when("/settings",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='account'}}}).when("/settings/account",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='account'}}}).when("/settings/profile",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='profile'}}}).when("/settings/safety",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='safety'}}}).when("/settings/store",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='store'}}}).when("/settings/notifications",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='notifications'}}}).when("/settings/accessibility",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='accessibility'}}}).when("/settings/data",{templateUrl:"templates/profile.htm",controller:'profileController',resolve:{tab:function($route){$route.current.params.tab='data'}}}).when("/confirmation",{templateUrl:"templates/confirmation.htm",controller:'profileController'}).when("/unsubscribe",{templateUrl:"templates/unsubscribe.htm",controller:'profileController',resolve:{unsubscribeCode:function($route){$route.current.params.unsubscribeCode='unsubscribe'}}}).when("/forgot",{templateUrl:"templates/forgot.htm",controller:'profileController'}).when("/welcome",{templateUrl:"templates/welcome.htm",controller:'profileController'}).when("/nate",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='nate'}}}).when("/nick",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='nick'}}}).when("/james",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='james'}}}).when("/lloyd",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='lloyd'}}}).when("/meskell",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='meskell'}}}).when("/dafydd",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='dafydd'}}}).when("/jofi",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='jofi'}}}).when("/jess",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='jess'}}}).when("/aimee",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='aimee'}}}).when("/matt",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'},username:function($route){$route.current.params.username='matt'}}}).when("/:username",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='portfolio'}}}).when("/:username/portfolio",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='portfolio'}}}).when("/:username/about",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='about'}}}).when("/:username/store",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='store'}}}).when("/:username/inspiration",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='inspiration'}}}).when("/:username/discussions",{templateUrl:"templates/user.htm",controller:'userController',resolve:{tab:function($route){$route.current.params.tab='discussions'}}}).when("/:username/market/upload",{templateUrl:"templates/marketUpload.htm",controller:'userController'}).when("/:username/store/:productId",{templateUrl:"templates/product.htm",controller:'productController'}).when("/:username/store/:productId/edit",{templateUrl:"templates/product.htm",controller:'productController'}).when("/:username/artwork/:imageId",{templateUrl:"templates/image.htm",controller:'imageController'}).when("/:username/artwork/:imageId/edit",{templateUrl:"templates/imageUpdate.htm",controller:'imageController'}).when("/:username/artwork/:imageId/:extra",{templateUrl:"templates/image.htm",controller:'imageController'});$locationProvider.html5Mode(!0);$httpProvider.defaults.useXDomain=!0;$anchorScrollProvider.disableAutoScrolling()});app.directive('fireEvent',function(){return function(scope,element,attr){if(windowLoaded){jQuery('body').trigger(attr.fireEvent,[element])}else{jQuery(document).ready(function(){jQuery('body').trigger(attr.fireEvent,[element])})}}});app.directive('onartworkload',function(){return{restrict:'A',link:function(scope,element){element.bind('load',function(){element.siblings('.artworkThumb').remove()})}}});app.directive('touched',function(){return{restrict:'A',link:function(scope,element){element.on('touchstart',function(){element.addClass('touched')});element.on('touchend',function(){element.removeClass('touched')})}}});app.directive('hover',function(){return{restrict:'A',link:function(scope,element){element.on('mouseover',function(){element.addClass('hover')});element.on('mouseleave',function(){element.removeClass('hover')})}}});app.directive('hoverWithColor',function(){return{restrict:'A',link:function(scope,element){element.mouseover(function(){if(!isMobile&&!isPad){var $itemObject=element.find('.item-object');var red=$itemObject.data('r');var green=$itemObject.data('g');var blue=$itemObject.data('b');var rgba=''+red+', '+green+', '+blue;var boxShadow='0px 64px 64px 0px rgba('+rgba+', 0.25), 0px 32px 32px 0px rgba('+rgba+', 0.25), 0px 16px 16px 0px rgba('+rgba+', 0.25), 0px 8px 8px 0px rgba('+rgba+', 0.25), 0px 4px 4px 0px rgba('+rgba+', 0.25)';$itemObject.css('box-shadow',boxShadow);element.addClass('hover')}});element.mouseleave(function(){if(!isMobile&&!isPad){element.find('.item-object').css('box-shadow','');element.removeClass('hover')}})}}});app.directive('events',function(){return{restrict:'A',link:function(scope,element){element.on('touchstart',function(){element.addClass('touched')});element.on('touchend',function(){element.removeClass('touched')});element.on('mouseover',function(){element.addClass('hover')});element.on('mouseleave',function(){element.removeClass('hover')})}}});app.directive('click-hover',function(){return{restrict:'A',link:function(scope,element){element.on('click',function(){element.addClass('click');setTimeout(function(){element.removeClass('click')},100)});element.on('mouseover',function(){element.addClass('hover')});element.on('mouseleave',function(){element.removeClass('hover')})}}});app.directive('longHoldEnabled',function($timeout){return{restrict:'C',link:function($scope,$elm,$attrs){$scope.actioning=!1;$scope.preventClick=!1;$elm.bind('touchstart',function(evt){$scope.initX=evt.originalEvent.touches[0].clientX;$scope.initY=evt.originalEvent.touches[0].clientY;$scope.longPress=!0;$scope.actioning=!0;$scope.click=!0;$scope._pressed=null;$scope.preventClick=$('body').hasClass('forceTouchEvent');$scope._pressed=$timeout(function(){$scope.actioning=!1;$scope.preventClick=!0;$scope.click=!1;if($scope.longPress&&$attrs.onLongPress){$scope.$apply(function(){$scope.$eval($attrs.onLongPress,{$event:evt})})}},350)});$elm.bind('touchmove',function(evt){if($scope.actioning){if(Math.abs($scope.initX-evt.originalEvent.touches[0].clientX)>10||Math.abs($scope.initY-evt.originalEvent.touches[0].clientY)>10){$timeout.cancel($scope._pressed);$scope.click=!1;$scope.preventClick=!0}}});$elm.bind('touchend',function(evt){$scope.longPress=!1;$scope.actioning=!1;$timeout.cancel($scope._pressed);if($scope.click&&$attrs.onClick){$scope.$apply(function(){$scope.$eval($attrs.onClick,{$event:evt})})}});$elm.bind('click',function(evt){if($scope.preventClick){evt.preventDefault()}})}}});app.directive('addColour',function(){return{restrict:'A',scope:{r:'@',g:'@',b:'@'},link:function(scope,element,attr){jQuery(element).data('r',scope.r);jQuery(element).data('g',scope.g);jQuery(element).data('b',scope.b)}}});app.directive('reflowOnRemove',function(){return{restrict:'A',link:function(scope,element){scope.$on('$destroy',function(){setTimeout(reflowIsotope,50)})}}});app.directive('dragAndDrop',function(){return{restrict:'E',templateUrl:'templates/partials/dragAndDrop/dropZone.htm',controller:function($scope,$element,$attrs){$scope.$broadcast('initialise',$attrs)}}});app.directive('parallax',function($timeout,$window){return{restrict:'A',scope:{mousemove:'=',magnitude:'=',smoothing:'='},link:function(scope,element,attr){var all;all=element.find('.parallax-layer');if(!scope.magnitude){scope.magnitude=7.5}
if(window.DeviceMotionEvent){if(!scope.smoothing){scope.smoothing=10}
var acceleration_array=new Array(scope.smoothing).fill({x:0,y:0});var x_initial;var y_initial;var current_acceleration={x:0,y:0};var multiplier=0;var centerAll=function(){x_initial=current_acceleration.x;y_initial=current_acceleration.y;multiplier=(window.innerWidth/40)};window.ondevicemotion=function(event){current_acceleration.x=event.accelerationIncludingGravity.x;current_acceleration.y=event.accelerationIncludingGravity.y;if(!x_initial&&!y_initial){centerAll()}
var offsets={x:x_initial-event.accelerationIncludingGravity.x,y:y_initial-event.accelerationIncludingGravity.y};var smoothed=smooth(offsets);var y=-smoothed.y;var x=-smoothed.x;if(window.orientation===0){y=smoothed.y;x=smoothed.x}else if(window.orientation===90){y=smoothed.x;x=-smoothed.y}else if(window.orientation===-90){y=-smoothed.x;x=smoothed.y}
y=damp(y);x=damp(x);if(all){all.each(function(index){var i=index+1;var transform_string='translate3d('+(-i*scope.magnitude*x)+'px, '+(i*scope.magnitude*y)+'px, 0)';$(this).css({transform:transform_string,webkitTransform:transform_string,msTransform:transform_string})})}};window.addEventListener('orientationchange',function(event){window.setTimeout(function(){centerAll()},250)});var smooth=function(value){acceleration_array.push(value);acceleration_array.shift();var avg={x:0,y:0};var totals={x:0,y:0};acceleration_array.forEach(function(item){totals.x+=item.x;totals.y+=item.y});avg.x=totals.x/acceleration_array.length;avg.y=totals.y/acceleration_array.length;return avg};function damp(value){return Math.atan((1/50)*value)*multiplier}}else{if(scope.mousemove!==!1){var currentpoint=null;var startpoint={x:0,y:0};var initialized=!1;var initialize=function(){startpoint={x:currentpoint.x,y:currentpoint.y};initialized=!0};angular.element($window).on('mousemove',function(event){currentpoint={x:event.pageX,y:event.pageY};if(!initialized){initialize()}
if(all){all.each(function(index){var translatex=(currentpoint.x-startpoint.x)/(125*(all.length-index))*scope.magnitude;var translatey=(currentpoint.y-startpoint.y)/(125*(all.length-index))*scope.magnitude;var transform_string='translate3d('+translatex+'px,'+translatey+'px, 0)';$(this).css({transform:transform_string,webkitTransform:transform_string,msTransform:transform_string})})}})}}}}});app.directive('fileOnChange',function(){return{restrict:'A',link:function(scope,element,attrs){var onChangeHandler=scope.$eval(attrs.fileOnChange);element.on('change',onChangeHandler);element.on('$destroy',function(){element.off()})}}});app.directive("bnLazySrc",function($window,$document){var lazyLoader=(function(){var images=[];var renderTimer=null;var renderDelay=100;var win=$($window);var doc=$document;var documentHeight=doc.height();var documentTimer=null;var documentDelay=2000;var isWatchingWindow=!1;function addImage(image){images.push(image);if(!renderTimer){startRenderTimer()}
if(!isWatchingWindow){startWatchingWindow()}}
function removeImage(image){for(var i=0;i<images.length;i++){if(images[i]===image){images.splice(i,1);break}}
if(!images.length){clearRenderTimer();stopWatchingWindow()}}
function checkDocumentHeight(){if(renderTimer){return}
var currentDocumentHeight=doc.height();if(currentDocumentHeight===documentHeight){return}
documentHeight=currentDocumentHeight;startRenderTimer()}
function checkImages(){console.log("Checking for visible images...");var visible=[];var hidden=[];var windowHeight=win.height();var scrollTop=win.scrollTop();var topFoldOffset=scrollTop;var bottomFoldOffset=(scrollTop+windowHeight)+1000;console.log('topOffet: '+topFoldOffset);console.log('bottomOffet: '+bottomFoldOffset);for(var i=0;i<images.length;i++){var image=images[i];if(image.isVisible(topFoldOffset,bottomFoldOffset)){visible.push(image)}else{hidden.push(image)}}
for(var i=0;i<visible.length;i++){visible[i].render()}
images=hidden;clearRenderTimer();if(!images.length){stopWatchingWindow()}}
function clearRenderTimer(){clearTimeout(renderTimer);renderTimer=null}
function startRenderTimer(){renderTimer=setTimeout(checkImages,renderDelay)}
function startWatchingWindow(){isWatchingWindow=!0;win.on("resize.bnLazySrc",windowChanged);win.on("scroll.bnLazySrc",windowChanged);documentTimer=setInterval(checkDocumentHeight,documentDelay)}
function stopWatchingWindow(){isWatchingWindow=!1;win.off("resize.bnLazySrc");win.off("scroll.bnLazySrc");clearInterval(documentTimer)}
function windowChanged(){if(!renderTimer){startRenderTimer()}}
return({addImage:addImage,removeImage:removeImage})})();function LazyImage(element){var source=null;var isRendered=!1;var height=null;function isVisible(topFoldOffset,bottomFoldOffset){if(!element.is(":visible")){return(!1)}
if(height===null){height=element.height()}
var top=element.offset().top;var bottom=(top+height);return(((top<=bottomFoldOffset)&&(top>=topFoldOffset))||((bottom<=bottomFoldOffset)&&(bottom>=topFoldOffset))||((top<=topFoldOffset)&&(bottom>=bottomFoldOffset)))}
function render(){isRendered=!0;renderSource()}
function setSource(newSource){source=newSource;if(isRendered){renderSource()}}
function renderSource(){element[0].className=element[0].className+" image-visible";element[0].src=source}
return({isVisible:isVisible,render:render,setSource:setSource})}
function link($scope,element,attributes){var lazyImage=new LazyImage(element);lazyLoader.addImage(lazyImage);attributes.$observe("bnLazySrc",function(newSource){lazyImage.setSource(newSource)});$scope.$on("$destroy",function(){lazyLoader.removeImage(lazyImage)})}
return({link:link,restrict:"A"})});var padKeyFrames=[{'frame':'#pad-intro','height':'210%','animations':[{'selector':'#pad-intro .pencil','start':0,'end':'210%','period':[0,'100%','210%'],'translateY':[0,'-30%','-30%']},{'selector':'#pad-intro .device','start':0,'end':'210%','period':[0,'100%','210%'],'translateY':[0,'-15%','-15%']},{'selector':'#pad-intro .intro-copy-item p','start':0,'end':'210%','type':'class-toggle','period':['50%','210%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-intro .background','start':0,'end':'210%','period':[0,'100%','160%','210%'],'opacity':[1,1,0,0]},{'selector':'#pad-intro canvas','start':0,'end':'210%','type':'class-toggle','period':[0,'150%'],'class':['blob-off','blob-on']}]},{'frame':'#pad-new-features-one','height':'225%','animations':[{'selector':'#pad-new-features-one .background','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-new-features-one .second p','start':0,'end':'225%','type':'class-toggle','period':['35%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-new-features-one .content-overlay','start':0,'end':'225%','period':[0,'80%','225%'],'opacity':[0,1,1]},{'selector':'#pad-new-features-one video','start':0,'end':'225%','period':[0,'125%','200%','225%'],'opacity':[1,1,0,0]},{'selector':'#pad-gallery .first p','start':0,'end':'225%','type':'class-toggle','period':['175%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-gallery .device','start':0,'end':'225%','period':[0,'225%'],'translateY':['-5%','-5%']}]},{'frame':'#pad-gallery','height':'object','animations':[{'selector':'#pad-gallery .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-gallery .device','start':0,'end':'100%','period':[0,'40%','100%'],'translateY':['-5%','5%','5%']},{'selector':'#pad-gallery .second video','start':0,'end':'100%','type':'play-video','period':['6%','100%']},{'selector':'#pad-gallery .background','start':0,'end':'100%','period':[0,'50%','75%','100%'],'opacity':[1,1,0,0]},{'selector':'#pad-gallery canvas','start':0,'end':'100%','type':'class-toggle','period':[0,'70%'],'class':['blob-off','blob-on']},{'selector':'#pad-gallery .third p','start':0,'end':'100%','type':'class-toggle','period':['15%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-painting','height':'235%','animations':[{'selector':'#pad-painting .background','start':0,'end':'235%','period':[0,'115%','235%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-painting .second p','start':0,'end':'235%','type':'class-toggle','period':['35%','235%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-painting .content-overlay','start':0,'end':'235%','period':[0,'80%','235%'],'opacity':[0,1,1]},{'selector':'#pad-painting img','start':0,'end':'235%','period':[0,'135%','210%','235%'],'opacity':[1,1,0,0]},{'selector':'#pad-brushes .background .content','start':0,'end':'235%','period':[0,'135%','235%'],'translateY':['20%','20%','0']},{'selector':'#pad-brushes .first p','start':0,'end':'235%','type':'class-toggle','period':['205%','235%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-brushes','height':'100%','animations':[{'selector':'#pad-brushes .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':['0','-20%']},{'selector':'#pad-brushes .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-brushes .background video','start':0,'end':'100%','type':'play-video','period':[0,'100%']},{'selector':'#pad-brushes','start':0,'end':'100%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']},{'selector':'#pad-superpowers .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':['20%','0%']},{'selector':'#pad-superpowers .first p','start':0,'end':'100%','type':'class-toggle','period':['70%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-superpowers','height':'100%','animations':[{'selector':'#pad-superpowers .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':['0%','-20%']},{'selector':'#pad-superpowers .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-superpowers','start':0,'end':'100%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']},{'selector':'#pad-layers .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':['20%',0]},{'selector':'#pad-layers .first p','start':0,'end':'100%','type':'class-toggle','period':['70%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-layers','height':'100%','animations':[{'selector':'#pad-layers .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,'-20%']},{'selector':'#pad-layers .first p','start':0,'end':'100%','type':'class-layers','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-layers','start':0,'end':'100%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']}]},{'frame':'#pad-applepencil-image','height':'235%','animations':[{'selector':'#pad-applepencil-image .background','start':0,'end':'235%','period':[0,'115%','235%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-applepencil-image .second p','start':0,'end':'235%','type':'class-toggle','period':['35%','235%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-applepencil-image .content-overlay','start':0,'end':'235%','period':[0,'80%','235%'],'opacity':[0,1,1]},{'selector':'#pad-applepencil-image img','start':0,'end':'235%','period':[0,'135%','210%','235%'],'opacity':[1,1,0,0]},{'selector':'#pad-select-transform .first p','start':0,'end':'235%','type':'class-toggle','period':['8%','235%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-select-transform .device','start':0,'end':'235%','period':[0,'235%'],'translateY':['-5%','-5%']}]},{'frame':'#pad-select-transform','height':'object','animations':[{'selector':'#pad-select-transform .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-select-transform .device','start':0,'end':'100%','period':[0,'40%','100%'],'translateY':['-5%','5%','5%']},{'selector':'#pad-select-transform .second video','start':0,'end':'100%','type':'play-video','period':['8%','100%']},{'selector':'#pad-select-transform .background','start':0,'end':'100%','period':[0,'50%','75%','100%'],'opacity':[1,1,0,0]},{'selector':'#pad-select-transform canvas','start':0,'end':'100%','type':'class-toggle','period':[0,'70%'],'class':['blob-off','blob-on']},{'selector':'#pad-select-transform .third p','start':0,'end':'100%','type':'class-toggle','period':['15%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-color','height':'225%','animations':[{'selector':'#pad-color .background','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-color .second p','start':0,'end':'225%','type':'class-toggle','period':['35%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-color .content-overlay','start':0,'end':'225%','period':[0,'80%','225%'],'opacity':[0,1,1]},{'selector':'#pad-color img','start':0,'end':'225%','period':[0,'125%','200%','225%'],'opacity':[1,1,0,0]},{'selector':'#pad-color','start':0,'end':'225%','type':'class-toggle','period':['155%','225%'],'class':['blur-off','blur-on']},{'selector':'#pad-gestures .background .content','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':['20%','20%',0]},{'selector':'#pad-gestures .first p','start':0,'end':'225%','type':'class-toggle','period':['195%','225%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-gestures','height':'100%','animations':[{'selector':'#pad-gestures .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,'-20%']},{'selector':'#pad-gestures .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-gestures','start':0,'end':'100%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']},{'selector':'#pad-quickmenu .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':['20%',0]},{'selector':'#pad-quickmenu .first p','start':0,'end':'100%','type':'class-toggle','period':['70%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-quickmenu','height':'100%','animations':[{'selector':'#pad-quickmenu .background .content','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,'-20%']},{'selector':'#pad-quickmenu .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-quickmenu','start':0,'end':'100%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']}]},{'frame':'#pad-timelapse','height':'225%','animations':[{'selector':'#pad-timelapse .background','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-timelapse .second p','start':0,'end':'225%','type':'class-toggle','period':['35%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-timelapse .content-overlay','start':0,'end':'225%','period':[0,'80%','225%'],'opacity':[0,1,1]},{'selector':'#pad-timelapse video','start':0,'end':'225%','period':[0,'125%','200%','225%'],'opacity':[1,1,0,0]},{'selector':'#pad-timelapse','start':0,'end':'225%','type':'class-toggle','period':['155%','225%'],'class':['blur-off','blur-on']}]},{'frame':'#outro','height':'100%','animations':[{'selector':'#pad-ada .ada','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['show','show']}]}];var mobilePadKeyFrames=[{'frame':'#pad-intro','height':'210%','animations':[{'selector':'#pad-intro .intro-copy-item p','start':0,'end':'210%','type':'class-toggle','period':['50%','210%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-intro .background','start':0,'end':'210%','period':[0,'100%','160%','210%'],'opacity':[1,1,0,0]},{'selector':'#pad-intro canvas','start':0,'end':'210%','type':'class-toggle','period':[0,'150%'],'class':['blob-off','blob-on']}]},{'frame':'#pad-new-features-one','height':'225%','animations':[{'selector':'#pad-new-features-one .background','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-new-features-one .second p','start':0,'end':'225%','type':'class-toggle','period':['35%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-new-features-one .content-overlay','start':0,'end':'225%','period':[0,'80%','225%'],'opacity':[0,1,1]},{'selector':'#pad-new-features-one','start':0,'end':'225%','period':[0,'125%','200%','225%'],'opacity':[1,1,0,0]},{'selector':'#pad-new-features-one','start':0,'end':'225%','type':'class-toggle','period':['155%','225%'],'class':['blur-off','blur-on']},{'selector':'#pad-gallery .first p','start':0,'end':'225%','type':'class-toggle','period':['175%','225%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-gallery','height':'object','animations':[{'selector':'#pad-gallery .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-gallery .second video','start':0,'end':'100%','type':'play-video','period':['8%','100%']},{'selector':'#pad-gallery .pad-item','start':0,'end':'100%','period':[0,'40%','55%','100%'],'opacity':[1,1,0,0]},{'selector':'#pad-gallery .pad-item','start':0,'end':'100%','type':'class-toggle','period':['40%','100%'],'class':['blur-off','blur-on']},{'selector':'#pad-gallery .third p','start':0,'end':'100%','type':'class-toggle','period':['5%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-painting','height':'235%','animations':[{'selector':'#pad-painting .background','start':0,'end':'235%','period':[0,'115%','235%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-painting .second p','start':0,'end':'235%','type':'class-toggle','period':['35%','235%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-painting .content-overlay','start':0,'end':'235%','period':[0,'80%','235%'],'opacity':[0,1,1]},{'selector':'#pad-painting','start':0,'end':'235%','type':'class-toggle','period':[0,'215%'],'class':['disappear','appear']},{'selector':'#pad-brushes .first p','start':0,'end':'235%','type':'class-toggle','period':['195%','235%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-brushes','height':'70%','animations':[{'selector':'#pad-brushes .first p','start':0,'end':'70%','type':'class-toggle','period':[0,'70%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-brushes .background video','start':0,'end':'70%','type':'play-video','period':[0,'70%']},{'selector':'#pad-brushes','start':0,'end':'70%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']},{'selector':'#pad-superpowers .first p','start':0,'end':'70%','type':'class-toggle','period':['30%','70%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-superpowers','height':'70%','animations':[{'selector':'#pad-superpowers .first p','start':0,'end':'70%','type':'class-toggle','period':[0,'70%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-superpowers','start':0,'end':'70%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']},{'selector':'#pad-layers .first p','start':0,'end':'70%','type':'class-toggle','period':['30%','70%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-layers','height':'70%','animations':[{'selector':'#pad-layers .first p','start':0,'end':'70%','type':'class-layers','period':[0,'70%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-layers','start':0,'end':'70%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']}]},{'frame':'#pad-applepencil-image','height':'235%','animations':[{'selector':'#pad-applepencil-image .background','start':0,'end':'235%','period':[0,'115%','235%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-applepencil-image .second p','start':0,'end':'235%','type':'class-toggle','period':['35%','235%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-applepencil-image .content-overlay','start':0,'end':'235%','period':[0,'80%','235%'],'opacity':[0,1,1]},{'selector':'#pad-applepencil-image img','start':0,'end':'235%','period':[0,'135%','210%','235%'],'opacity':[1,1,0,0]},{'selector':'#pad-select-transform .first p','start':0,'end':'235%','type':'class-toggle','period':['8%','235%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-select-transform .device','start':0,'end':'235%','period':[0,'235%'],'translateY':['-5%','-5%']}]},{'frame':'#pad-select-transform','height':'object','animations':[{'selector':'#pad-select-transform .first p','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-select-transform .second video','start':0,'end':'100%','type':'play-video','period':['8%','100%']},{'selector':'#pad-select-transform .pad-item','start':0,'end':'100%','period':[0,'40%','55%','100%'],'opacity':[1,1,0,0]},{'selector':'#pad-select-transform .pad-item','start':0,'end':'100%','type':'class-toggle','period':['40%','100%'],'class':['blur-off','blur-on']},{'selector':'#pad-select-transform .third p','start':0,'end':'100%','type':'class-toggle','period':['5%','100%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-color','height':'225%','animations':[{'selector':'#pad-color .background','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-color .second p','start':0,'end':'225%','type':'class-toggle','period':['35%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-color .content-overlay','start':0,'end':'225%','period':[0,'80%','225%'],'opacity':[0,1,1]},{'selector':'#pad-color','start':0,'end':'225%','period':[0,'125%','200%','225%'],'opacity':[1,1,0,0]},{'selector':'#pad-color','start':0,'end':'225%','type':'class-toggle','period':['155%','225%'],'class':['blur-off','blur-on']},{'selector':'#pad-gestures .first p','start':0,'end':'225%','type':'class-toggle','period':['185%','225%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-gestures','height':'70%','animations':[{'selector':'#pad-gestures .first p','start':0,'end':'70%','type':'class-toggle','period':[0,'70%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-gestures','start':0,'end':'70%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']},{'selector':'#pad-quickmenu .first p','start':0,'end':'70%','type':'class-toggle','period':['30%','70%'],'class':['text-visible-off','text-visible-on']}]},{'frame':'#pad-quickmenu','height':'70%','animations':[{'selector':'#pad-quickmenu .first p','start':0,'end':'70%','type':'class-toggle','period':[0,'70%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-quickmenu','start':0,'end':'70%','type':'class-toggle','period':[0,'50%'],'class':['disappear','appear']}]},{'frame':'#pad-timelapse','height':'225%','animations':[{'selector':'#pad-timelapse .background','start':0,'end':'225%','period':[0,'125%','225%'],'translateY':[0,0,'7.5%']},{'selector':'#pad-timelapse .second p','start':0,'end':'225%','type':'class-toggle','period':['35%','225%'],'class':['text-visible-off','text-visible-on']},{'selector':'#pad-timelapse .content-overlay','start':0,'end':'225%','period':[0,'80%','225%'],'opacity':[0,1,1]},{'selector':'#pad-timelapse','start':0,'end':'225%','period':[0,'125%','200%','225%'],'opacity':[1,1,0,0]},{'selector':'#pad-timelapse','start':0,'end':'225%','type':'class-toggle','period':['155%','225%'],'class':['blur-off','blur-on']}]},{'frame':'#outro','height':'100%','animations':[{'selector':'#pad-ada .ada','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['show','show']}]}];var pocketKeyFrames=[{'frame':'#01','height':'100%','animations':[{'selector':'#02 .left-image','start':0,'end':'100%','period':[0,'30%','100%'],'translateY':['40%','40%',0]},{'selector':'#02 .center-image','start':0,'end':'100%','period':[0,'30%','100%'],'translateY':['10%','10%',0]},{'selector':'#02 .right-image','start':0,'end':'100%','period':[0,'30%','100%'],'translateY':['20%','20%',0]}]},{'frame':'#02','height':'object','animations':[{'selector':'#02 .left-image','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,0]},{'selector':'#02 .center-image','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,0]},{'selector':'#02 .right-image','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,0]}]},{'frame':'#core-features','height':'object','animations':[{'selector':'#slider .panel-06 .pocket-copy-container','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-06 .pocket-copy-container','start':0,'end':'100%','type':'class-toggle','period':[0,'100%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-06 .iphone-x','start':'50%','end':'100%','nonMobile':!0,'period':[0,'50%'],'rotateZ':[0,0],'translateY':['-10%','-30%']}]},{'frame':'#slider','height':'object','mobileOnly':!0,'animations':[{'selector':'#slider .panel-06 .pocket-copy-container','start':0,'end':'100%','type':'class-toggle','period':[0,'7%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-09 .pocket-copy-container','start':0,'end':'100%','type':'class-toggle','period':['5%','40%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-07 .pocket-copy-container','start':0,'end':'100%','type':'class-toggle','period':['40%','70%'],'class':['text-visible-off','text-visible-on']},{'selector':'#10 .left-image','start':'67%','end':'100%','period':[0,'33%'],'translateY':['20%',0]},{'selector':'#10 .center-image','start':'67%','end':'100%','period':[0,'33%'],'translateY':['60%',0]},{'selector':'#10 .right-image','start':'67%','end':'100%','period':[0,'33%'],'translateY':['100%',0]}]},{'frame':'#slider','height':'235%','nonMobile':!0,'animations':[{'selector':'#slider .panel-06 .pocket-copy-container','start':0,'end':'235%','type':'class-toggle','period':[0,'50%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-06 .iphone-x','start':0,'end':'120%','period':[0,'120%'],'rotateZ':[0,40],'translateY':['-30%','-180%']},{'selector':'#slider .panel-09 .pocket-copy-container','start':0,'end':'235%','type':'class-toggle','period':['25%','130%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-09 .iphone-x','start':0,'end':'190%','period':[0,'150%','190%'],'rotateZ':[20,-40,-40],'translateY':['10%','-60%','-60%']},{'selector':'#slider .panel-07 .pocket-copy-container','start':0,'end':'235%','type':'class-toggle','period':['75%','180%'],'class':['text-visible-off','text-visible-on']},{'selector':'#slider .panel-07 .iphone-x','start':0,'end':'235%','period':[0,'40%','220%','235%'],'rotateZ':[-28,-28,40,40],'translateY':['20%','20%','-60%','-60%']},{'selector':'#10 .left-image','start':'135%','end':'235%','period':[0,'50%','100%'],'translateY':['10%','10%',0]},{'selector':'#10 .center-image','start':'135%','end':'235%','period':[0,'50%','100%'],'translateY':['30%','30%',0]},{'selector':'#10 .right-image','start':'135%','end':'235%','period':[0,'50%','100%'],'translateY':['50%','50%',0]}]},{'frame':'#10','height':'object','animations':[{'selector':'#10 .left-image','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,0]},{'selector':'#10 .center-image','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,0]},{'selector':'#10 .right-image','start':0,'end':'100%','period':[0,'100%'],'translateY':[0,0]}]},{'frame':'#11','height':'object','animations':[]}];app.controller('adminController',['$scope','UtilityService','RoleService','UserService','GalleryService','DiscussionService','ReportService','SearchService','AclService','$rootScope','$routeParams','$location',function($scope,UtilityService,RoleService,UserService,GalleryService,DiscussionService,ReportService,SearchService,AclService,$rootScope,$routeParams,$location){$rootScope.checkAnimatable(!1);$rootScope.adminBucketAvailable=!0;$scope.featureOrder='';$scope.role=$routeParams.role;$scope.boardId=$routeParams.boardId;$scope.userId=defined($routeParams.user)?$routeParams.user:'';$scope.itemId=defined($routeParams.id)?$routeParams.id:'';$scope.adminTab='';$scope.searchedUsers=[];$scope.deleteUser={};$scope.itemObject={};switch($routeParams.page){case 'articles':$scope.adminTab='articles';break;case 'users':$scope.adminTab='users';if($scope.userId!==''){var query='schema=adminDeleteUserPrepare&deleteId='+$scope.userId+UserService.getUserDetails();showLoader(!0);$rootScope.httpQuery(query,function(data){showLoader(!1);if(defined(data.success)){$scope.deleteUser=data.details}})}
break;case 'roles':$scope.adminTab='roles';RoleService.loadRoles();break;case 'resources':$scope.adminTab='resources';AclService.loadResources();break;case 'roleUser':$scope.adminTab='roles';RoleService.loadRoleUsers($scope.role);break;case 'notifications':$scope.adminTab='notifications';break;case 'reports':$scope.adminTab='reports';ReportService.loadReportCategories();break;case 'galleryItemsReports':$scope.adminTab='reports';ReportService.loadReports('galleryItem');break;case 'galleryItemBanningReports':$scope.adminTab='reports';ReportService.loadImageBannings('galleryItemBanning');break;case 'marketItemsReports':$scope.adminTab='reports';ReportService.loadReports('marketItem');break;case 'galleryCommentsReports':$scope.adminTab='reports';ReportService.loadReports('galleryItemComments');break;case 'newsCommentsReports':$scope.adminTab='reports';ReportService.loadReports('newsArticleComments');break;case 'marketCommentsReports':$scope.adminTab='reports';ReportService.loadReports('marketItemComments');break;case 'discussionPostsReports':$scope.adminTab='reports';ReportService.loadReports('discPosts');break;case 'discussionRepliesReports':$scope.adminTab='reports';ReportService.loadReports('discReplies');break;case 'tagManage':case 'tagBoardManage':$scope.adminTab='tags';DiscussionService.load();break;case 'searchTerms':$scope.adminTab='searchTerms';SearchService.loadTerms(!1,!1,!1,$scope);break;case 'searchLinks':$scope.adminTab='searchLinks';SearchService.loadLinks(!1,!1,!1,$scope);break;default:$scope.adminTab='home';UtilityService.loadTagCategories();GalleryService.loadFeatureOrder($scope);break}
$scope.keywordCategory=$rootScope.util().tagCategories[0];$scope.createCategoryTag=function(){var catLabel=$('#catLabel').val();UtilityService.createCategoryTag($rootScope.user,$rootScope.getUser($rootScope.user).token,catLabel)};$scope.createKeyword=function(){var keywordCategory=$('#keywordCategory').val();var keywordLabel=$('#keywordLabel').val();UtilityService.createKeywordTag($rootScope.user,$rootScope.getUser($rootScope.user).token,keywordCategory,keywordLabel)};$scope.createDiscussionTag=function(){var tagLabel=$('#tagLabel').val();UtilityService.createDiscussionsTag($rootScope.user,$rootScope.getUser($rootScope.user).token,tagLabel)};$scope.addDiscussionTagToBoard=function(tagId){DiscussionService.addTagToBoard($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.boardId,tagId)};$scope.removeDiscussionTagFromBoard=function(tagId){DiscussionService.removeTagFromBoard($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.boardId,tagId)};$scope.updateFeatureOrder=function(){var order=$('#featureOrder').val();GalleryService.updateFeatureOrder(order)};$scope.searchUserForm=function(){var formData=new FormData(jQuery('#admin-search-user-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){data.users.forEach(function(user){if(!objInArrayById($scope.searchedUsers,user)){$scope.searchedUsers.push(user)}});$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.notificationCreate=function(){var formData=new FormData(jQuery('#admin-create-notification-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){alert("notification created")}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.processCreateTerm=function(){var formData=new FormData(jQuery('#term-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){SearchService.addOrUpdateTerm(data.term);$location.path('/admin/search/terms/');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.processUpdateTerm=function(){var formData=new FormData(jQuery('#term-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){SearchService.addOrUpdateTerm(data.term);$location.path('/admin/search/terms/');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.deleteTerm=function(termId){SearchService.deleteTerm(termId)};$scope.processCreateLink=function(){var formData=new FormData(jQuery('#link-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){SearchService.addOrUpdateLink(data.link);$location.path('/admin/search/links/');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.processUpdateLink=function(){var formData=new FormData(jQuery('#link-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){SearchService.addOrUpdateLink(data.link);$location.path('/admin/search/links/');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.deleteLink=function(linkId){SearchService.deleteLink(linkId)};$scope.processRoleForm=function(){var formData=new FormData(jQuery('#role-create-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){RoleService.addOrUpdateRole(data.role);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.processResourceForm=function(){var formData=new FormData(jQuery('#resource-create-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){AclService.addOrUpdateResource(data.resource);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.processRoleUserForm=function(){var formData=new FormData(jQuery('#role-add-user-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){data.users.forEach(function(user){UserService.addOrUpdateUser(RoleService.generateUserFromRoleData(user));RoleService.addUserToRole(user.id,$scope.role,!1)});$location.path('/admin/roles/'+$scope.role+'/users/');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.processRoleUserDeleteForm=function(){var formData=new FormData(jQuery('#role-delete-user-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){var users=data.removed.split(',');users.forEach(function(user){RoleService.removeUserFromRole(user,$scope.role)});$location.path('/admin/roles/'+$scope.role+'/users/');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}})};$scope.postPermanentFine=function(postId){ReportService.postPermanentlyFine(postId)};$scope.postFine=function(postId){ReportService.postFine(postId)};$scope.postFlagBan=function(postId){ReportService.postFlagBan(postId)};$scope.replyPermanentFine=function(replyId){ReportService.replyPermanentlyFine(replyId)};$scope.replyFine=function(replyId){ReportService.replyFine(replyId)};$scope.replyFlagBan=function(replyId){ReportService.replyFlagBan(replyId)};$scope.galleryImageCommentPermanentFine=function(imageId){ReportService.galleryImageCommentPermanentlyFine(imageId)};$scope.galleryImageCommentFine=function(imageId){ReportService.galleryImageCommentFine(imageId)};$scope.galleryImageCommentFlagBan=function(imageId){ReportService.galleryImageCommentFlagBan(imageId)};$scope.newsArticleCommentPermanentFine=function(commentId){ReportService.newsArticleCommentPermanentFine(commentId)};$scope.newsArticleCommentFine=function(commentId){ReportService.newsArticleCommentFine(commentId)};$scope.newsArticleCommentFlagBan=function(commentId){ReportService.newsArticleCommentFlagBan(commentId)};$scope.galleryImagePermanentFine=function(imageId){ReportService.galleryImagePermanentlyFine(imageId)};$scope.galleryImageFine=function(imageId){ReportService.galleryImageFine(imageId)};$scope.galleryImageFlagBan=function(imageId){ReportService.galleryImageFlagBan(imageId)};$scope.galleryImageFlagMature=function(imageId){ReportService.galleryImageFlagMature(imageId)};$scope.hasTag=function(boardId,tag){if(!defined($rootScope.getBoard(boardId).tags)){return!1}
return $rootScope.getBoard(boardId).tags.indexOf(tag.id)!==-1}}]);app.controller('adminBucketController',['$scope','AdminService','$routeParams','$rootScope',function($scope,AdminService,$routeParams,$rootScope){$rootScope.checkAnimatable(!1);$scope.uploadPercent=0;$scope.pos=0;$scope.baseCount=siteDefaults.gallery.loadCount;if(!defined($routeParams.tab)||$routeParams.tab===''){$scope.redirectOnLoad=!0}else{$rootScope.settingsTab=$routeParams.tab}
$scope.cancelClick=function(){AdminService.hide()};if($rootScope.isAdminUser()){AdminService.loadBucketImages($scope.pos,$scope.baseCount,1)}
$rootScope.$watch('loggedIn',function(newVal){if(newVal&&$rootScope.isAdminUser()){AdminService.loadBucketImages($scope.pos,$scope.baseCount,1)}});$scope.selectItem=function(image){AdminService.select(image)};$scope.uploadBucketItem=function(uploads,resetCallback){if($rootScope.checkCanPerform(!0,!0)){if($scope.submitting){alert("Please wait for your current submission to complete.")}else{var formData=new FormData(jQuery('#bucketDropZone').find('form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','adminBucketSave');for(var i=0;i<uploads.length;i++){formData.append('bucketItem'+i,uploads[i].file)}
$scope.submitting=!0;$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadPercent=1},xhr:showProgress,success:function(response){var data=JSON.parse(response);if(defined(data.success)){resetCallback();data.bucketItems.forEach(function(bucketItem){AdminService.addOrUpdateImage(AdminService.generateImageFromBucketData(bucketItem))});if(data.bucketItems.length===1){AdminService.select(AdminService.generateImageFromBucketData(data.bucketItems[0]))}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}
$scope.uploadPercent=0;$scope.submitting=!1;if(!$scope.$$phase){$scope.$apply()}}})}}};var showProgress=function(){var xhr=$.ajaxSettings.xhr();var percentageComplete=1;xhr.upload.onprogress=function(evt){percentageComplete=Math.round(evt.loaded/evt.total*100);if(percentageComplete===99){percentageComplete=percentageComplete+1}
$scope.uploadPercent=percentageComplete};return xhr}}]);app.controller('betaController',['$scope','$http','$rootScope','$location','$routeParams','BetaService',function($scope,$http,$rootScope,$location,$routeParams,BetaService){$rootScope.checkAnimatable(!1);$scope.typeFields={};$scope.typeId=$routeParams.type;BetaService.loadTypes($scope);if(defined($routeParams.type)){BetaService.loadUsers($scope.typeId)}
$scope.processTypeCreateForm=function(){var formData=new FormData(jQuery('#create-type-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){BetaService.addOrUpdateType(data.type);$location.path('/admin/beta');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)};$scope.processTypeEditForm=function(){var formData=new FormData(jQuery('#edit-type-form')[0]);formData.append('type_id',$scope.typeId);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){BetaService.addOrUpdateType(data.type);$location.path('/admin/beta');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)};$scope.toggleSelect=function(betaUserId,selected){selected=selected=='1'?0:1;BetaService.editUser($scope.typeId,betaUserId,selected)};$scope.toggleSelectAll=function(){BetaService.bulkSelect($scope.typeId)};$scope.downloadCsv=function(){var csvContent="data:text/csv;charset=utf-8,";$rootScope.beta().types[$scope.typeId].betaUsers.forEach(function(user){if(user.status==1&&user.selected==1){csvContent+=user.fname+","+user.lname+","+user.email+"\r\n"}});var encodedUri=encodeURI(csvContent);window.open(encodedUri)}}]);app.controller('contentController',['$scope','$rootScope','$timeout','$routeParams','$location','ModalService','GalleryService',function($scope,$rootScope,$timeout,$routeParams,$location,ModalService,GalleryService){$rootScope.setPageLoader(!0);$rootScope.checkAnimatable(!0);$scope.page=defined($routeParams.page)?$routeParams.page:"";$scope.featureColumns=[1,2,3,4,5,6,7,8,9,10];$scope.staggerArray=[310,370,280,310,250,260,380,310,370,280];$scope.page=$routeParams.page?$routeParams.page:'';$rootScope.bodyClass='content';$('.pocket-hero-display').css('display','block');var timeoutComplete=function(){$rootScope.setPageLoader(!1)};if($scope.page==="discover"){GalleryService.loadGallery('featured',0,40,$rootScope.initialLoad,1);$(window).unbind('scroll').on('scroll',function(){var $portfolioContainer=$("#porfolio-section");var $heroContainer=$("#hero-01-section");var $heroDisplay=$(".hero-01-preview-container");var startPos=$portfolioContainer.get(0).offsetHeight;var viewportHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0);var pos=$(this).scrollTop();var $body=$('body');if(pos+viewportHeight>startPos){window.requestAnimationFrame(function(){$.each($scope.featureColumns,function(i,col){var stagger=$scope.staggerArray[col-1];var currentHeight=pos+$portfolioContainer.outerHeight();if([1,3,6,7].indexOf(col)>=0&&currentHeight<=$body.outerHeight()-400){stagger=stagger*(currentHeight/($body.outerHeight()-400))}else if([2,5,8,9].indexOf(col)>=0&&currentHeight<=$body.outerHeight()-400){stagger=stagger*(currentHeight/($body.outerHeight()-600))}else if([4].indexOf(col)>=0&&currentHeight<$body.outerHeight()-400){stagger=stagger*(currentHeight/($body.outerHeight()-800))}
if(currentHeight<=$body.outerHeight()-400){$('#portfolio-col-'+col).css({'transform':'translate3d(0, -'+stagger+'px, 0','-webkit-transform':'translate3d(0, -'+stagger+'px, 0'})}})})}
if(pos>$heroContainer.outerHeight()+$heroContainer.get(0).offsetHeight){$heroDisplay.css('display','none')}else{$heroDisplay.css('display','block')}})}
$scope.pocketScrollPoints=function(){var body=$('body');var nav=$('nav');if(body.hasClass('pocket-page')){body.addClass('panel-01-visible');$(window).scroll(function(){var scroll=$(window).scrollTop();var panels=document.getElementsByClassName("pocket-panel");for(var i=0;i<panels.length;i++){var navHeight;if($rootScope.isMobile()){navHeight=0}else{navHeight=nav.get(0).offsetHeight}
var panelOffset=0;var panelHeight=panels.item(i).offsetHeight+navHeight;if(panels.item(i).getAttribute('id')==='01'){if(scroll<panelOffset+panelHeight){body.addClass('panel-'+panels.item(i).getAttribute('id')+'-visible')}else{body.removeClass('panel-'+panels.item(i).getAttribute('id')+'-visible')}}else{panelOffset=panels.item(i).offsetTop+navHeight;panelHeight=panels.item(i).offsetHeight;if((scroll>panelOffset)&&(scroll<panelOffset+panelHeight)){body.addClass('panel-'+panels.item(i).getAttribute('id')+'-visible')}else{body.removeClass('panel-'+panels.item(i).getAttribute('id')+'-visible')}}}})}};$scope.pocketScrollPoints();var doneTyping=function(searchTerm){var answers=0;var totalCount=0;$('.search-here').each(function(){var headingData=$(this).data("id");var headingLocation="."+headingData;if($(this).children(':visible').length===0){if($(headingLocation).is(':visible')){$(headingLocation).slideUp(200);$('span[data-link-to="'+$(this).attr('data-id')+'"]').hide()}
if($(this).is(':visible')){$(this).addClass('hide-margin')}}else{if(!$(headingLocation).is(':visible')){$(headingLocation).slideDown(200);$('span[data-link-to="'+$(this).attr('data-id')+'"]').show()}
if(!$(this).is(':visible')){$(this).removeClass('hide-margin')}
answers++}
$(this).find('.question-block').each(function(){if($(this).is(':visible')){totalCount ++}})});if(answers===0){$('.search-hide').fadeOut(100)}else{if($('#search-content').height()<1000){$('.search-hide').fadeOut(100)}else{$('.search-hide').fadeIn(200)}}
var $quicklinks=$('#quicklinks').find('.wrapper');switch(answers){case 3:$quicklinks.attr('class','wrapper');break;case 2:$quicklinks.attr('class','wrapper three');break;case 1:$quicklinks.attr('class','wrapper two');break;default:$quicklinks.attr('class','wrapper one')}
var $resultsSlide=$('#results-slide');if($resultsSlide.length){$resultsSlide.find('.results').html(totalCount);if(totalCount===0){$resultsSlide.find('.scrollResults').hide()}else{$resultsSlide.find('.scrollResults').show()}
if(typeof searchTerm!=='undefined'){if(searchTerm.length>0){$resultsSlide.show()}else{$resultsSlide.hide()}}}};$timeout(timeoutComplete,400);setupVideos();setupModal();$scope.highlight=new Hilitor('search-content');$scope.highlight.setMatchType("open");$(document).ready(function(){var $reset=$('#reset');var $search=$('#search');var $resultsSlide=$('#results-slide');var $searchBlock=$('#faq-search-block');var $headerBlock=$('#faq-heading');var $quicklinks=$('#quicklinks');var $headProcreate=$('#head-procreate');var $headPocket=$('#head-pocket');var $headGeneral=$('#head-general');var $searchAnchor=$('.search-anchor');var $pageWrapper=$('#page-wrapper');$search.on('keyup change',function(){if($(this).val()===''){$reset.hide()}else{$reset.show()}});$search.on('click touch',function(){if($(document).scrollTop()<$headerBlock.height()){$('html, body').animate({scrollTop:$("#faq-search-block").offset().top-30},600)}});$('.link').on('click touch',function(){var offset=80;var $this=$(this);if($this.attr('data-link-to')==="head-procreate"&&$search.val()===''){offset=45}
if($this.attr('data-link-to')==="faq-search-block"){offset=55}
$('html, body').animate({scrollTop:$('#'+$this.attr('data-link-to')).offset().top-offset},600,'swing',function(){if($this.attr('data-link-to')==="faq-search-block"){$search.focus()}})});$reset.on('click touch',function(){$search.val('');$reset.hide();$resultsSlide.hide();$scope.highlight.apply('');$quicklinks.find('.wrapper').attr('class','wrapper');$quicklinks.find('.link').show();$quicklinks.attr('class','');$headProcreate.show();$headPocket.show();$headGeneral.show();$('.question-block').show();$search.focus()});$resultsSlide.on('click touch',function(){$('html, body').animate({scrollTop:$resultsSlide.offset().top},400)});$(window).scroll(function(){var headerHeight=$headerBlock.height()+$searchBlock.height();var procreateHeight=$headProcreate.is(':visible')?$headProcreate.height()+$('#body-procreate').height():0;var pocketHeight=$headPocket.is(':visible')?$headPocket.height()+$('#body-pocket').height():0;var generalHeight=$headGeneral.is(':visible')?$headGeneral.height()+$('#body-general').height():0;var scrollPos=$(document).scrollTop();if(scrollPos>=headerHeight){if(!$pageWrapper.hasClass('fixed')){$pageWrapper.addClass('show-search')}
if(scrollPos+85<headerHeight+procreateHeight){$quicklinks.attr('class','show-procreate')}else if(scrollPos+85<headerHeight+procreateHeight+pocketHeight){$quicklinks.attr('class','show-pocket')}else if(scrollPos+85<headerHeight+procreateHeight+pocketHeight+generalHeight){$quicklinks.attr('class','show-general')}}else{$pageWrapper.removeClass('show-search')}});if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){if(orientation===-90||orientation===90){$searchAnchor.addClass('active')}else if(orientation===180||orientation===0){$searchAnchor.removeClass('active')}
$(window).bind('orientationchange',function(event){if(orientation===-90||orientation===90){$searchAnchor.addClass('active')}else if(orientation===180||orientation===0){$searchAnchor.removeClass('active')}});$('div.hidden').css('display','table')}(function(){var typingTimer;var typingTimer2;var doneTypingIntervalShort=200;var doneTypingInterval=500;var $input=$('#search');$input.on('keyup',function(){if(typingTimer){clearTimeout(typingTimer)}
var divTarget="div.inner-block div.question-block";var count=0;var theText=$(this).val();var $resultsSlide=$('#results-slide');if($resultsSlide.length){$resultsSlide.find('.search-term').html(theText)}
$scope.highlight.apply(theText);$(divTarget).each(function(){var hasSearchTag=defined($(this).attr('data-search-tag'));if($(this).text().search(new RegExp(theText,"i"))<0&&(!hasSearchTag||(hasSearchTag&&$(this).attr('data-search-tag').search(new RegExp(theText,"i"))<0))){$(this).fadeOut()}else{$(this).fadeIn();count++}
if($(this).text().search(new RegExp(theText,"i"))<0&&hasSearchTag&&$(this).attr('data-search-tag').search(new RegExp(theText,"i"))>=0){if(!$(this).hasClass('suggested')){$(this).addClass('suggested')}}else{$(this).removeClass('suggested')}});doneTyping(theText);clearTimeout(typingTimer);clearTimeout(typingTimer2);typingTimer=setTimeout(doneTyping,doneTypingInterval);typingTimer2=setTimeout(doneTyping,doneTypingIntervalShort)});$input.on('keydown',function(){clearTimeout(typingTimer);clearTimeout(typingTimer2)})}());if($scope.page!==""&&$scope.page==="faq"){if($location.$$url.indexOf('faq#')!==-1){var param=$location.$$url.split('faq#')[1];setTimeout(function(){var anchor=$('a[name="'+param+'"]');anchor.addClass('current');$(document).scrollTop(anchor.offset().top-42)}.bind(param),300)}}});$scope.openHandbookModal=function(){ModalService.initialise('Choose Download','','Done',function(){ModalService.hide()},'',function(){ModalService.hide()},!1,'handbook','');ModalService.show()};$scope.openPocketHandbookModal=function(){ModalService.initialise('Choose Download','','Done',function(){ModalService.hide()},'',function(){ModalService.hide()},!1,'pocketHandbook','');ModalService.show()};$scope.getFirstImage=function(col){return $rootScope.gallery().featured[col-1]};$scope.getSecondImage=function(col){return $rootScope.gallery().featured[9+col]};$scope.getThirdImage=function(col){return $rootScope.gallery().featured[19+col]};$scope.getFourthImage=function(col){return $rootScope.gallery().featured[29+col]};$scope.getFeatureImageHeight=function(id){var baseWidth=$rootScope.getImage(id).width;var baseHeight=$rootScope.getImage(id).height;var initWidth=225;var initHeight=399;var height=0;if(baseWidth==0){return''}
if(initWidth/baseWidth<=initHeight/baseHeight){var finalWidth=baseWidth>initWidth?initWidth:baseWidth;height=baseHeight/(baseWidth/finalWidth)}else{height=baseHeight>initHeight?initHeight:height}
return height}}]);app.controller('discussionsController',['$scope','$location','UserService','DiscussionService','ModalService','BetaService','PopoverService','$routeParams','$rootScope','$http',function($scope,$location,UserService,DiscussionService,ModalService,BetaService,PopoverService,$routeParams,$rootScope,$http){$scope.boardFormData={};$scope.categoryFormData={};$scope.threadFormData={};$scope.postFormData={};$scope.board=$routeParams.board;$scope.topic=$routeParams.topic;$scope.category=$routeParams.category;$scope.thread=$routeParams.thread;$scope.redirectPath=$routeParams.redirect;$rootScope.adminBucketAvailable=!1;$scope.uploadPercent=0;$scope.uploadValue=339.292;$scope.uploading=!1;$scope.catId=$routeParams.c;$scope.page=$routeParams.page?$routeParams.page:1;$scope.post=$routeParams.post?$routeParams.post:'';$scope.toggleable=[];$rootScope.pollObject={page:'discussions',scope:{threadId:$scope.thread,post:$scope.post,page:$scope.page}};if(defined($scope.redirectPath)){var query='schema=DiscussionLoadRedirect&type=';var attempt=!0;if(defined($scope.board)){query+='board&id='+$scope.board.split('.')[0]}else if(defined($scope.topic)){query+='thread&id='+$scope.topic.split('.')[0]}else{attempt=!1}
showLoader(!0);if(attempt){$rootScope.httpQuery(query,function(data){$location.url(data.redirect);$('#main').css('height','');showLoader(!1)})}else{$location.url('/discussions');showLoader(!1)}}else if($scope.board==="redirect"){$location.url('/discussions');showLoader(!1)}else{DiscussionService.load($scope.board,$scope.category,$scope.thread,$scope.post,$scope.page,$scope)}
$scope.paginationAvailable=function(){if(!defined($scope.thread)&&!defined($scope.category)){if(defined($rootScope.discussions().boards[$scope.board])&&$rootScope.discussions().boards[$scope.board].thread_count>THREADPAGINATIONCOUNT){return!0}}else if(!defined($scope.thread)){if(defined($rootScope.discussions().boards[$scope.board])&&defined($rootScope.discussions().boards[$scope.board].categories[$scope.category])&&$rootScope.discussions().boards[$scope.board].categories[$scope.category].thread_count>THREADPAGINATIONCOUNT){return!0}}else{if(defined($rootScope.discussions().threads[$scope.thread])&&$rootScope.discussions().threads[$scope.thread].post_count>POSTPAGINATIONCOUNT){return!0}}
return!1};$scope.getPageUrl=function(page){if(!defined($scope.thread)&&!defined($scope.category)){return"discussions/"+$scope.board+"?page="+page}else if(!defined($scope.thread)){return"discussions/"+$scope.board+"/"+$scope.category+"?page="+page}
return"discussions/"+$scope.board+"/"+$scope.category+"/"+$scope.thread+"?page="+page};$scope.getPageArray=function(){var returnArr=[];var actualThreadCount=0;if(!defined($scope.thread)&&!defined($scope.category)){if(defined($rootScope.discussions().boards[$scope.board])){actualThreadCount=$rootScope.discussions().boards[$scope.board].thread_count-$rootScope.discussions().boards[$scope.board].featured.length;for(var i=1;i<=Math.ceil(actualThreadCount/THREADPAGINATIONCOUNT);i ++){returnArr.push(i)}}}else if(!defined($scope.thread)){if(defined($rootScope.discussions().boards[$scope.board])&&defined($rootScope.discussions().boards[$scope.board].categories[$scope.category])){actualThreadCount=$rootScope.discussions().boards[$scope.board].categories[$scope.category].thread_count-$rootScope.discussions().boards[$scope.board].categories[$scope.category].featured.length;for(var j=1;j<=Math.ceil(actualThreadCount/THREADPAGINATIONCOUNT);j ++){returnArr.push(j)}}}else{if(defined($rootScope.discussions().threads[$scope.thread])){for(var k=1;k<=Math.ceil($rootScope.discussions().threads[$scope.thread].post_count/POSTPAGINATIONCOUNT);k ++){returnArr.push(k)}}}
return returnArr};$scope.getPageSnapshot=function(page,fullArray){var gap=2;if($rootScope.isMobile()){gap=1}
page=page/1;fullArray.splice(-1,1);if(page<=gap+1){return fullArray.slice(1,gap*2+1)}
if(page>=fullArray.length+1-gap){var start=fullArray.length-gap*2<1?1:fullArray.length-gap*2;return fullArray.slice(start,fullArray.length)}
return fullArray.slice(page-gap-1,page+gap)};$scope.pageBreak=function(pre,page,fullArray){var gap=2;if($rootScope.isMobile()){gap=1}
return(pre?page>gap+2:page<fullArray.length-gap-1)&&fullArray.length>3+2*gap};$scope.moveThread=function(threadId){$rootScope.moveThreadForm={};$rootScope.moveThreadForm.currentBoardId=$rootScope.getThread(threadId).disc_board_id;PopoverService.initialise('move-thread',{graphic:{classes:'blue',visible:!0},title:'Move Thread',description:'Which do board you want to move this thread to:',confirmButton:{text:'Move',action:function(){var formData=new FormData();var boardId=$rootScope.moveThreadForm.newBoardId;formData.append('schema','discussionThreadMove');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);if(boardId){if($rootScope.getThread(threadId).disc_board_id===boardId){alert("The thread is already in that board")}else{formData.append('threadId',threadId);formData.append('catId',$scope.getFirstCategoryId(boardId));formData.append('boardId',boardId);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);if(defined(data.success)){PopoverService.hide();DiscussionService.deleteThreadFromBoard($scope.board,$rootScope.getThreadPositionByThread($scope.board,threadId));DiscussionService.incrementThreadCount($scope.board,-1);DiscussionService.incrementThreadCount(boardId,1);$location.url('/discussions/'+boardId+'/'+$scope.getFirstCategoryId(boardId)+'/'+threadId);if(!$scope.$$phase){$scope.$apply()}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
PopoverService.initialise('default',{graphic:{visible:!1},title:'Error!',description:errors,dismissButton:{visible:!0}});PopoverService.show()}}})}}},classes:'blue',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$scope.lockThread=function(threadId){PopoverService.initialise('lock',{graphic:{classes:'blue',visible:!0},title:'Lock Thread',description:'Are you sure you want to lock this thread?',confirmButton:{text:'Yes, lock it down!',action:function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('threadId',threadId);if($rootScope.isThreadLocked(threadId)){formData.append('schema','discussionThreadLockRemove')}else{formData.append('schema','discussionThreadLock')}
$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){if($rootScope.getThread(threadId).status===siteDefaults.discussions.status.thread_locked){DiscussionService.lockThread(threadId)}else{DiscussionService.unlockThread(threadId)}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
PopoverService.initialise('default',{graphic:{visible:!1},title:'Error!',description:errors,dismissButton:{visible:!0}});PopoverService.show()}})}
PopoverService.hide()},classes:'blue',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$scope.deleteThread=function(threadId){PopoverService.initialise('delete',{graphic:{classes:'red',visible:!0},title:'Delete Thread',description:'Are you sure you want to permanently delete this thread?',confirmButton:{text:'Delete',action:function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();formData.append('schema','discussionThreadDelete');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('threadId',threadId);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){DiscussionService.deleteThreadFromBoard($scope.board,$rootScope.getThreadPositionByThread($scope.board,threadId));DiscussionService.deleteThread(threadId);DiscussionService.incrementThreadCount($scope.board,-1);$location.path('/discussions/'+$scope.board);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
PopoverService.initialise('default',{graphic:{visible:!1},title:'Error!',description:errors,dismissButton:{visible:!0}});PopoverService.show()}})}
PopoverService.hide()},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$scope.processThreadForm=function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData($('#disc-thread-form')[0]);var content=document.getElementById('content').innerHTML;var itemCount=0;var stillInside=[];if($scope.uploading){alert("Please wait for your current submission to finish.")}else{formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);for(var f=0;f<formFiles.content.length;f++){if(content.indexOf('src="'+formFiles.content[f].name+'" ref="'+formFiles.content[f].size+'"')!==-1){formData.append('file'+itemCount,formFiles.content[f]);stillInside.push(formFiles.content[f]);itemCount++}}
formData.append('fullCount',itemCount);$scope.uploading=!0;$('#disc-thread-form').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadValue=339.292},xhr:showProgress,success:function(response){var data=JSON.parse(response);$scope.uploadValue=0;if(!$scope.$$phase){$scope.$apply()}
setTimeout(function(){$('#disc-thread-form').toggleClass('active');if(defined(data.success)){DiscussionService.addThreadToBoard($scope.board,data.thread.id,$rootScope.getBoard($scope.board).threads.length);DiscussionService.incrementThreadCount($scope.board,1);$rootScope.getUser($rootScope.user).threadFollows[data.thread.id]=data.follow;$location.path('/discussions/'+$scope.board+'/'+data.thread.disc_cat_id+'/'+data.thread.id);formFiles.content=[];$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
ModalService.initialise('Create thread error','<fieldset class="stacked"><p>'+errors+'.</p></fieldset>','Close',ModalService.hide,!1,!1,!1);ModalService.show()}
$scope.uploadValue=339.292;$scope.uploading=!1;if(!$scope.$$phase){$scope.$apply()}},500)},error:function(response){alert("There was an error with your request, please try again later");$scope.uploadValue=339.292;$scope.uploading=!1;$('#disc-thread-form').removeClass('active');if(!$scope.$$phase){$scope.$apply()}
console.log(response)}})}}};$scope.processEditThreadForm=function(threadId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData($('#'+threadId+'-disc-thread-edit-form')[0]);var content=document.getElementById(threadId+'-thread-edit-content').innerHTML;var title=document.getElementById('threadEditTitle').innerHTML;var itemCount=0;var stillInside=[];if($scope.uploading){alert("Please wait for your current submission to finish.")}else{formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);formData.append('title',title);for(var f=0;f<formFiles[threadId+'-thread-edit-content'].length;f++){if(content.indexOf('src="'+formFiles[threadId+'-thread-edit-content'][f].name+'" ref="'+formFiles[threadId+'-thread-edit-content'][f].size+'"')!==-1){formData.append('file'+itemCount,formFiles[threadId+'-thread-edit-content'][f]);stillInside.push(formFiles[threadId+'-thread-edit-content'][f]);itemCount++}}
formData.append('fullCount',itemCount);$scope.uploading=!0;$('#'+threadId+'-disc-thread-edit-form').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadValue=339.292},xhr:showProgress,success:function(response){var data=JSON.parse(response);$scope.uploadValue=0;if(!$scope.$$phase){$scope.$apply()}
setTimeout(function(){$('#'+threadId+'-disc-thread-edit-form').toggleClass('active');if(defined(data.success)){DiscussionService.updateThread($scope.thread,$scope.board,$scope.category,data.thread);$scope.toggleable['editThread'+threadId]=!1;if($scope.board!==data.thread.disc_board_id||$scope.category!==data.thread.disc_cat_id){$location.path('/discussions/'+data.thread.disc_board_id+'/'+data.thread.disc_cat_id+'/'+data.thread.id)}
formFiles[threadId+'-thread-edit-content']=[];$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
ModalService.initialise('Create thread error','<fieldset class="stacked"><p>'+errors+'.</p></fieldset>','Close',ModalService.hide,!1,!1,!1);ModalService.show()}
$scope.uploadValue=339.292;$scope.uploading=!1;if(!$scope.$$phase){$scope.$apply()}},500)},error:function(response){alert("There was an error with your request, please try again later");$scope.uploadValue=339.292;$scope.uploading=!1;$('#'+threadId+'-disc-thread-edit-form').removeClass('active');if(!$scope.$$phase){$scope.$apply()}
console.log(response)}})}}};$scope.deletePost=function(postPosition,postId){PopoverService.initialise('delete',{graphic:{classes:'red',visible:!0},title:'Delete Post',description:'Are you sure you want to permanently delete this post?',confirmButton:{text:'Delete',action:function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();formData.append('schema','discussionPostDelete');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('postId',postId);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){DiscussionService.deletePostFromThread($scope.thread,postPosition);DiscussionService.incrementPostCount($scope.thread,-1);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
PopoverService.initialise('default',{graphic:{visible:!1},title:'Error!',description:errors,dismissButton:{visible:!0}});PopoverService.show()}})}
PopoverService.hide()},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$scope.followingBoard=function(boardId){if($rootScope.loggedIn&&typeof $rootScope.getUser($rootScope.user).boardFollows!=='undefined'){return typeof $rootScope.getUser($rootScope.user).boardFollows[boardId]!=='undefined'}
return!1};$scope.followingThread=function(threadId){if($rootScope.loggedIn&&typeof $rootScope.getUser($rootScope.user).threadFollows!=='undefined'){return typeof $rootScope.getUser($rootScope.user).threadFollows[threadId]!=='undefined'}
return!1};$scope.toggleFollowBoard=function(){if($rootScope.checkCanPerform(!0,!0)){if(defined($scope.board)){var follow=$scope.followingBoard($scope.board)?0:1;DiscussionService.toggleFollowBoard($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.board,follow)}}};$scope.toggleFollowThread=function(){if($rootScope.checkCanPerform(!0,!0)){if(defined($scope.thread)){var follow=$scope.followingThread($scope.thread)?0:1;DiscussionService.toggleFollowThread($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.thread,follow)}}};$scope.isThreadUnread=function(threadId){var threadUpdated=new Date($rootScope.getThread(threadId).updated);var followUpdated;if($scope.followingThread(threadId)){followUpdated=new Date($rootScope.getUser($rootScope.user).threadFollows[threadId].updated);if(followUpdated.getTime()<threadUpdated.getTime()){return!0}}else if($scope.followingBoard($scope.board)){followUpdated=new Date($rootScope.getUser($rootScope.user).boardFollows[$scope.board].updated);if(followUpdated.getTime()<threadUpdated.getTime()){return!0}}
return!1};$scope.toggleFeatureThread=function(){if($rootScope.getThread($scope.thread).featured==1){DiscussionService.unFeatureThread($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.thread,$scope.board)}else{DiscussionService.featureThread($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.thread,$scope.board)}};$scope.processPostForm=function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData($('#disc-post-form')[0]);var content=document.getElementById('0-content').innerHTML;var itemCount=0;var stillInside=[];if($scope.uploading){alert("Please wait for your current submission to finish.")}else{formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);for(var f=0;f<formFiles['0-content'].length;f++){if(content.indexOf('src="'+formFiles['0-content'][f].name+'" ref="'+formFiles['0-content'][f].size+'"')!==-1){formData.append('file'+itemCount,formFiles['0-content'][f]);stillInside.push(formFiles['0-content'][f]);itemCount++}}
formData.append('fullCount',itemCount);$scope.uploading=!0;$('#disc-post-form').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadValue=339.292},xhr:showProgress,success:function(response){var data=JSON.parse(response);$scope.uploadValue=0;if(!$scope.$$phase){$scope.$apply()}
setTimeout(function(){$('#disc-post-form').toggleClass('active');if(defined(data.success)){DiscussionService.addorUpdatePostToThread(data.post);DiscussionService.incrementPostCount($scope.thread,1);$('#0-content').empty();if($scope.page!==$scope.getPageArray().length){$location.url($scope.getPageUrl($scope.getPageArray().length))}
formFiles['0-content']=[]}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
ModalService.initialise('Create thread error','<fieldset class="stacked"><p>'+errors+'.</p></fieldset>','Close',ModalService.hide,!1,!1,!1);ModalService.show()}
$scope.uploadValue=339.292;$scope.uploading=!1;if(!$scope.$$phase){$scope.$apply()}},500)},error:function(response){alert("There was an error with your request, please try again later");$scope.uploadValue=339.292;$scope.uploading=!1;$('#disc-post-form').removeClass('active');if(!$scope.$$phase){$scope.$apply()}
console.log(response)}})}}};$scope.getFirstCategoryId=function(boardId){var board=$rootScope.getBoard(boardId);if(!$rootScope.isEmpty(board)){for(var cat in board.categories){return cat}}
return 0};$scope.processEditPostForm=function(postPosition,postId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData($('#'+postId+'-disc-post-edit-form')[0]);var content=document.getElementById(postId+'-post-edit-content').innerHTML;var itemCount=0;var stillInside=[];if($scope.uploading){alert("Please wait for your current submission to finish.")}else{formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);for(var f=0;f<formFiles[postId+'-post-edit-content'].length;f++){if(content.indexOf('src="'+formFiles[postId+'-post-edit-content'][f].name+'" ref="'+formFiles[postId+'-post-edit-content'][f].size+'"')!==-1){formData.append('file'+itemCount,formFiles[postId+'-post-edit-content'][f]);stillInside.push(formFiles[postId+'-post-edit-content'][f]);itemCount++}}
formData.append('fullCount',itemCount);$scope.uploading=!0;$('#'+postId+'-disc-post-edit-form').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadValue=339.292},xhr:showProgress,success:function(response){var data=JSON.parse(response);$scope.uploadValue=0;if(!$scope.$$phase){$scope.$apply()}
setTimeout(function(){$('#'+postId+'-disc-post-edit-form').toggleClass('active');if(defined(data.success)){DiscussionService.updatePost($scope.thread,postPosition,data.post);$scope.toggleable['editPost'+postId]=!1;formFiles[postId+'-post-edit-content']=[];$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
ModalService.initialise('Create thread error','<fieldset class="stacked"><p>'+errors+'.</p></fieldset>','Close',ModalService.hide,!1,!1,!1);ModalService.show()}
$scope.uploadValue=339.292;$scope.uploading=!1;if(!$scope.$$phase){$scope.$apply()}},500)},error:function(response){alert("There was an error with your request, please try again later");$scope.uploadValue=339.292;$scope.uploading=!1;$('#'+postId+'-disc-post-edit-form').removeClass('active');if(!$scope.$$phase){$scope.$apply()}
console.log(response)}})}}};$scope.deleteReply=function(postPosition,replyId){PopoverService.initialise('delete',{graphic:{classes:'red',visible:!0},title:'Delete Reply',description:'Are you sure you want to permanently delete this reply?',confirmButton:{text:'Delete',action:function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();formData.append('schema','discussionReplyDelete');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('replyId',replyId);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){DiscussionService.deleteReplyFromPost($scope.thread,postPosition,replyId);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
PopoverService.initialise('default',{graphic:{visible:!1},title:'Error!',description:errors,dismissButton:{visible:!0}});PopoverService.show()}})}
PopoverService.hide()},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$scope.processReplyForm=function(replyId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData($('#'+replyId+'-disc-reply-form')[0]);var content=document.getElementById(replyId+'-content').innerHTML;var itemCount=0;var stillInside=[];if($scope.uploading){alert("Please wait for your current submission to finish.")}else{formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);for(var f=0;f<formFiles[replyId+'-content'].length;f++){if(content.indexOf('src="'+formFiles[replyId+'-content'][f].name+'" ref="'+formFiles[replyId+'-content'][f].size+'"')!==-1){formData.append('file'+itemCount,formFiles[replyId+'-content'][f]);stillInside.push(formFiles[replyId+'-content'][f]);itemCount++}}
formData.append('fullCount',itemCount);$scope.uploading=!0;$('#'+replyId+'-disc-reply-form').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadValue=339.292},xhr:showProgress,success:function(response){var data=JSON.parse(response);$scope.uploadValue=0;if(!$scope.$$phase){$scope.$apply()}
setTimeout(function(){$('#'+replyId+'-disc-reply-form').toggleClass('active');if(defined(data.success)){DiscussionService.addReplyToPost(data.reply);$('#'+replyId+'-content').empty();formFiles[replyId+'-content']=[]}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
ModalService.initialise('Create thread error','<fieldset class="stacked"><p>'+errors+'.</p></fieldset>','Close',ModalService.hide,!1,!1,!1);ModalService.show()}
$scope.uploadValue=339.292;$scope.uploading=!1;if(!$scope.$$phase){$scope.$apply()}},500)},error:function(response){alert("There was an error with your request, please try again later");$scope.uploadValue=339.292;$scope.uploading=!1;$('#'+replyId+'-disc-reply-form').removeClass('active');if(!$scope.$$phase){$scope.$apply()}
console.log(response)}})}}};$scope.processEditReplyForm=function(postPosition,replyId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData($('#'+replyId+'-disc-reply-edit-form')[0]);var content=document.getElementById(replyId+'-edit-content').innerHTML;var itemCount=0;var stillInside=[];if($scope.uploading){alert("Please wait for your current submission to finish.")}else{formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);for(var f=0;f<formFiles[replyId+'-edit-content'].length;f++){if(content.indexOf('src="'+formFiles[replyId+'-edit-content'][f].name+'" ref="'+formFiles[replyId+'-edit-content'][f].size+'"')!==-1){formData.append('file'+itemCount,formFiles[replyId+'-edit-content'][f]);stillInside.push(formFiles[replyId+'-edit-content'][f]);itemCount++}}
formData.append('fullCount',itemCount);$scope.uploading=!0;$('#'+replyId+'-disc-reply-edit-form').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadValue=339.292},xhr:showProgress,success:function(response){var data=JSON.parse(response);$scope.uploadValue=0;if(!$scope.$$phase){$scope.$apply()}
setTimeout(function(){$('#'+replyId+'-disc-reply-edit-form').toggleClass('active');if(defined(data.success)){DiscussionService.updateReply($scope.thread,postPosition,replyId,data.reply);$scope.toggleable['edit'+replyId]=!1;formFiles[replyId+'-edit-content']=[];$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
ModalService.initialise('Create thread error','<fieldset class="stacked"><p>'+errors+'.</p></fieldset>','Close',ModalService.hide,!1,!1,!1);ModalService.show()}
$scope.uploadValue=339.292;$scope.uploading=!1;if(!$scope.$$phase){$scope.$apply()}},500)},error:function(response){alert("There was an error with your request, please try again later");$scope.uploadValue=339.292;$scope.uploading=!1;$('#'+replyId+'-disc-reply-edit-form').removeClass('active');if(!$scope.$$phase){$scope.$apply()}
console.log(response)}})}}};$scope.toggleThreadTag=function(tagId){if($rootScope.getThread($scope.thread).tags.indexOf(tagId)===-1){DiscussionService.addTagToThread($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.thread,tagId)}else{DiscussionService.removeTagFromthread($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.thread,tagId)}};$scope.optionsThread=function(board,thread){PopoverService.initialise('default',{description:'Thread Options',buttonOptions:[{text:($rootScope.getThread(thread).featured===1?'Un-Feature':'Feature'),action:function(){PopoverService.hide();$scope.toggleFeatureThread()},classes:'',visible:$rootScope.isAdminUser()&&$rootScope.loggedIn},{text:($rootScope.isThreadLocked(thread)?'Unlock':'Lock'),action:function(){PopoverService.hide();$scope.lockThread(thread)},classes:'',visible:$rootScope.isModeratorUser()&&$rootScope.loggedIn},{text:'Manage Tags',action:function(){$scope.manageThreadTags(board,thread)},classes:'',visible:$rootScope.isSavageUser()&&$rootScope.loggedIn&&$rootScope.getBoard(board).tags.length>0},{text:'Move Thread',action:function(){PopoverService.hide();$scope.moveThread(thread)},classes:'',visible:$rootScope.isModeratorUser()&&$rootScope.loggedIn},{text:'Edit Post',action:function(){PopoverService.hide();$scope.toggleable['editThread'+thread]=!$scope.toggleable['editThread'+thread]},classes:'',visible:($rootScope.user===$rootScope.getThread(thread).userId||$rootScope.isAdminUser())&&$rootScope.loggedIn&&!$rootScope.isThreadLocked(thread)&&!$scope.toggleable['editThread'+thread]},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem($rootScope.getThread(thread).posts[0].post.id,'post')})},classes:'red',visible:($rootScope.user!==$rootScope.getThread(thread).userId||($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Mark as Banned',action:function(){$rootScope.popoverSwitch(function(){$rootScope.banItem($rootScope.getThread(thread).posts[0].post.id,'post')})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$scope.deleteThread(thread)})},classes:'red',visible:$rootScope.isAdminUser()||($rootScope.user===$rootScope.getThread(thread).userId&&!defined($rootScope.getThread(thread).posts[1]))}],dismissButton:{visible:!0}});PopoverService.show()};$scope.manageThreadTags=function(board,thread){var boardTags=$rootScope.getBoard(board).tags;var numberOfTags=boardTags.length;var tagOptions=[];var tagOptionsPlusFive=[];var tagOptionsPlusTen=[];if(numberOfTags>15){console.log('Too many board tags.')}
for(var i=0;i<5;i++){if(!(i>numberOfTags)){tagOptions.push({text:$rootScope.getDiscTag(boardTags[i]).value,action:function(){PopoverService.hide();$scope.toggleThreadTag(boardTags[this])}.bind(i),classes:$rootScope.getDiscTag($rootScope.getThread(thread).tags[0]).value===$rootScope.getDiscTag(boardTags[i]).value?'blue capitalize':'capitalize',visible:!0})}}
tagOptions.unshift({text:'Back',action:function(){$scope.optionsThread(board,thread)},classes:'thin',visible:!0});if(numberOfTags>5){for(var plusFiveNum=5;plusFiveNum<10;plusFiveNum++){if(!(plusFiveNum>numberOfTags)){tagOptionsPlusFive.push({text:$rootScope.getDiscTag(boardTags[plusFiveNum]).value,action:function(){PopoverService.hide();$scope.toggleThreadTag(boardTags[this])}.bind(plusFiveNum),classes:$rootScope.getDiscTag($rootScope.getThread(thread).tags[0]).value===$rootScope.getDiscTag(boardTags[plusFiveNum]).value?'blue capitalize':'capitalize',visible:!0})}}
tagOptionsPlusFive.unshift({text:'Back',action:function(){PopoverService.initialise('default',{description:'Manage Tags',buttonOptions:tagOptions,dismissButton:{visible:!0}})},classes:'thin',visible:!0});tagOptions.push({text:'More...',action:function(){PopoverService.initialise('default',{description:'Manage Tags',buttonOptions:tagOptionsPlusFive,dismissButton:{visible:!0}})},classes:'thin',visible:!0})}
if(numberOfTags>10){for(var plusTenNum=10;plusTenNum<15;plusTenNum++){if(!(plusTenNum>numberOfTags)){tagOptionsPlusTen.push({text:$rootScope.getDiscTag(boardTags[plusTenNum]).value,action:function(){PopoverService.hide();$scope.toggleThreadTag(boardTags[this])}.bind(plusTenNum),classes:$rootScope.getDiscTag($rootScope.getThread(thread).tags[0]).value===$rootScope.getDiscTag(boardTags[plusTenNum]).value?'blue capitalize':'capitalize',visible:!0})}}
tagOptionsPlusTen.unshift({text:'Back',action:function(){PopoverService.initialise('default',{description:'Manage Tags',buttonOptions:tagOptionsPlusFive,dismissButton:{visible:!0}})},classes:'thin',visible:!0});tagOptionsPlusFive.push({text:'More...',action:function(){PopoverService.initialise('default',{description:'Manage Tags',buttonOptions:tagOptionsPlusTen,dismissButton:{visible:!0}})},classes:'thin',visible:!0})}
PopoverService.initialise('default',{description:'Manage Tags',buttonOptions:tagOptions,dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsThreadPost=function(post){PopoverService.initialise('default',{description:'Comment Options',buttonOptions:[{text:'Edit Post',action:function(){PopoverService.hide();$scope.toggleable['editPost'+post.post.id]=!$scope.toggleable['editPost'+post.post.id]},classes:'',visible:(($rootScope.user===post.post.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn)&&!$scope.toggleable['editPost'+post.post.id]},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem(post.post.id,'post')})},classes:'red',visible:($rootScope.user!==post.post.userId||(($rootScope.isModeratorUser()&&$rootScope.user!==post.post.userId)&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Mark as Banned',action:function(){$rootScope.popoverSwitch(function(){$rootScope.banItem(post.post.id,'post')})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$scope.deletePost(post.position,post.post.id)})},classes:'red',visible:(($rootScope.user===post.post.userId&&$rootScope.isEmpty(post.post.replies))||$rootScope.isAdminUser())&&$rootScope.loggedIn}],dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsThreadPostReply=function(post,reply){PopoverService.initialise('default',{description:'Comment Options',buttonOptions:[{text:'Edit Reply',action:function(){PopoverService.hide();$scope.toggleable['edit'+reply.id]=!$scope.toggleable['edit'+reply.id]},classes:'',visible:(($rootScope.user===reply.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn)&&!$scope.toggleable['edit'+reply.id]},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem(reply.id,'reply')})},classes:'red',visible:($rootScope.user!==reply.userId||(($rootScope.isModeratorUser()&&$rootScope.user!==post.post.userId)&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Mark as Banned',action:function(){$rootScope.popoverSwitch(function(){$rootScope.banItem(reply.id,'reply')})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$scope.deleteReply(post.position,reply.id)})},classes:'red',visible:($rootScope.user===reply.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn}],dismissButton:{visible:!0}});PopoverService.show()};$scope.isInBeta=function(betaId){if($rootScope.isModeratorUser()){return!0}
var userBetaUsers=$rootScope.getUser($rootScope.user).betaUsers;if(defined(userBetaUsers)&&userBetaUsers.length>0){for(var i=0;i<userBetaUsers.length;i ++){if(betaId==userBetaUsers[i].beta_type_id){return!0}}}
return!1};if(typeof $scope.thread!=='undefined'&&$rootScope.loggedIn){if($scope.followingThread($scope.thread)||$scope.followingBoard($scope.board)){DiscussionService.updatedThreadFollow($rootScope.user,$rootScope.getUser($rootScope.user).token,$scope.thread,$scope.board)}}
var showProgress=function(){var xhr=$.ajaxSettings.xhr();var percentageComplete=1;xhr.upload.onprogress=function(evt){percentageComplete=Math.round(evt.loaded/evt.total*100);if(percentageComplete===100){percentageComplete=percentageComplete-1}
$scope.uploadPercent=percentageComplete;$scope.uploadValue=339.292*(1-percentageComplete/100);if(!$scope.$$phase){$scope.$apply()}};return xhr}}]);app.controller('dropController',['$scope','UserService','GalleryService','MarketService','UtilityService','$rootScope',function($scope,UserService,GalleryService,MarketService,UtilityService,$rootScope){$scope.uploads=[];$scope.types=[];$scope.maxUploadCount=0;$scope.forceFormat=!1;$scope.id='';$scope.submission='';$scope.uploadFunction='';$scope.$on('initialise',function(event,args){$scope.types=args.types.split(',');$scope.id=args.id;$scope.forceFormat=defined(args.forceFormat)?args.forceFormat:!1;$scope.submission=defined(args.submission)?args.submission:'';$scope.maxUploadCount=args.limit;$scope.uploadFunction=args.uploadFunction;addDropListener()});$scope.mergeSelection=function(){var newArray=[];var customSet={type:'set',files:[],selected:!1};for(var i=0;i<$scope.uploads.length;i ++){if($scope.uploads[i].selected===!0){if($scope.uploads[i].type==='set'){jQuery.each($scope.uploads[i].files,function(i,elm){customSet.files.push({type:elm.type,file:elm.file})})}else{customSet.files.push({type:$scope.uploads[i].type,file:$scope.uploads[i].file})}}else{newArray.push($scope.uploads[i]);newArray[newArray.length-1].index=newArray.length-1}}
customSet.index=newArray.length;newArray.push(customSet);$scope.uploads=newArray};$scope.combineSelection=function(){var newArray=[];var customBundle={type:'bundle',files:[],selected:!1};for(var i=0;i<$scope.uploads.length;i ++){if($scope.uploads[i].selected===!0){switch($scope.uploads[i].type){case 'image':customBundle.files.push({type:$scope.uploads[i].type,thumb:$scope.uploads[i].thumb,file:$scope.uploads[i].file,color:$scope.uploads[i].color});break;case 'set':customBundle.files.push({type:$scope.uploads[i].type,files:$scope.uploads[i].files,thumb:!1,color:!1});break;case 'bundle':jQuery.each($scope.uploads[i].files,function(i,elm){customBundle.files.push({type:elm.type,file:elm.file,thumb:elm.thumb,color:elm.color})});break;default:customBundle.files.push({type:$scope.uploads[i].type,file:$scope.uploads[i].file,thumb:!1,color:!1})}}else{newArray.push($scope.uploads[i]);newArray[newArray.length-1].index=newArray.length-1}}
customBundle.index=newArray.length;newArray.push(customBundle);$scope.uploads=newArray};$scope.validMerge=function(){var result=!0;jQuery.each($scope.uploads,function(i,elm){if(elm.selected===!0&&!(elm.type==='set'||elm.type==='brush')){result=!1;return!1}});return result&&$scope.multiSelect()};$scope.multiSelect=function(){var count=0;jQuery.each($scope.uploads,function(i,elm){if(elm.selected===!0){count ++}});return count>1};$scope.anySelection=function(){var count=0;jQuery.each($scope.uploads,function(i,elm){if(elm.selected===!0){count ++}});return count>0};$scope.allSelected=function(){var count=0;jQuery.each($scope.uploads,function(i,elm){if(elm.selected===!0){count ++}});return count>=$scope.uploads.length};$scope.upload=function(){$scope[$scope.uploadFunction]($scope.uploads,$scope.resetImages)};$scope.fileDialog=function(){jQuery('#'+$scope.id).find('.dropFiles').trigger('click')};$scope.select=function(index){$scope.uploads[index].selected=!$scope.uploads[index].selected;var elementId=jQuery('#uploadItemNumber-'+index);elementId.toggleClass('selected');console.log(elementId)};$scope.deselectAll=function(){for(var i=0;i<$scope.uploads.length;i ++){if($scope.isSelected(i)){$scope.select(i)}}};$scope.selectAll=function(){for(var i=0;i<$scope.uploads.length;i ++){if(!$scope.isSelected(i)){$scope.select(i)}}};$scope.invertSelection=function(){for(var i=0;i<$scope.uploads.length;i ++){$scope.select(i)}};$scope.isSelected=function(index){return $scope.uploads[index].selected};$scope.breakAppart=function(index){var newArray=[];for(var i=0;i<$scope.uploads.length;i ++){if(i===index){switch($scope.uploads[i].type){case 'set':jQuery.each($scope.uploads[i].files,function(i,elm){switch(elm.type){case 'set':newArray.push({type:elm.type,files:elm.files,selected:!1,index:newArray.length});break;default:newArray.push({type:elm.type,file:elm.file,selected:!1,index:newArray.length})}});break;case 'bundle':jQuery.each($scope.uploads[i].files,function(i,elm){switch(elm.type){case 'set':newArray.push({type:elm.type,files:elm.files,selected:!1,index:newArray.length});break;case 'image':newArray.push({type:elm.type,files:elm.files,selected:!1,thumb:elm.thumb,color:elm.color,index:newArray.length});break;default:newArray.push({type:elm.type,file:elm.file,selected:!1,index:newArray.length})}});break}}else{newArray.push($scope.uploads[i]);newArray[newArray.length-1].index=newArray.length-1}}
$scope.uploads=newArray};$scope.removeItem=function(index){for(var i=0;i<$scope.uploads.length;i ++){if(i>index){$scope.uploads[i].index --}}
$scope.uploads.splice(index,1)};$scope.resetImages=function(){var parentContainer=jQuery('#'+$scope.id);$scope.uploads=[];parentContainer.find('.dropFiles').val('');parentContainer.find('.upload-bar').css('width','0%')};var addDropListener=function(){var parentContainer=jQuery('#'+$scope.id);var dropZone=parentContainer.find('.drop-zone').get(0);var $fileInput=parentContainer.find('.dropFiles');dropZone.ondragover=function(e){$(this).addClass('hover-active');e.preventDefault()};dropZone.ondragenter=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.ondragleave=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.ondragout=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.ondrop=function(e){e.preventDefault();$(this).removeClass('hover-active');if($scope.maxUploadCount!==0){if(currentUploadCount()+e.dataTransfer.files.length>$scope.maxUploadCount){alert("Unable to upload these files, you have exceeded the maximum upload count.");return!1}}
$fileInput.get(0).files=e.dataTransfer.files};$fileInput.off('change').on('change',function(){if($rootScope.checkCanPerform(!0,!0)){var _this=this;if(_this.files&&_this.files[0]){jQuery.each(_this.files,function(i,elm){switch(isValidItem(elm)){case 'image':generateImage(elm);break;case 'brush':generateFile(elm,'brush');break;case 'set':generateSetFile(elm,'set');break;case 'swatches':generateFile(elm,'swatches');break;case 'template':generateFile(elm,'template');break;default:alert("Invalid File Type");break}})}}
$fileInput.get(0).value=''})};var generateImage=function(file){var reader=new FileReader();var index=$scope.uploads.length;$scope.uploads.push({thumb:'',type:'image',selected:!1,file:'',color:'',loading:!0,index:index,orientation:0});$rootScope.getOrientation(file,function(orientation){switch(orientation){case 3:$scope.uploads[index].orientation='180cw';break;case 6:$scope.uploads[index].orientation='90cw';break;case 8:$scope.uploads[index].orientation='90ccw';break}});if(!$scope.$$phase){$scope.$apply()}
reader.onload=function(e){var img=new Image();img.onload=function(){$scope.uploads[index].thumb=img.src;$scope.uploads[index].file=file;$scope.uploads[index].color=getAverageColor(img);$scope.uploads[index].loading=!1;if(!$scope.$$phase){$scope.$apply()}};img.src=URL.createObjectURL(file)};reader.readAsDataURL(file)};var generateSetFile=function(file,type){$scope.uploads.push({type:type,files:[{type:'set',file:file}],selected:!1,index:$scope.uploads.length});if(!$scope.$$phase){$scope.$apply()}};var generateFile=function(file,type){$scope.uploads.push({type:type,file:file,selected:!1,index:$scope.uploads.length});if(!$scope.$$phase){$scope.$apply()}};var currentUploadCount=function(){return $scope.uploads.length};var isValidItem=function(file){var type='';switch(file.name.split('.').pop().toLowerCase()){case 'png':case 'jpg':case 'jpeg':type='image';break;case 'set':type='set';break;case 'brush':type='brush';break;case 'swatches':type='swatches';break;case 'procreate':type='template';break}
if(jQuery.inArray(type,$scope.types)>=0){return type}
return!1}}]);app.controller('galleryController',['$scope','GalleryService','ModalService','IsotopeService','$routeParams','$location','$rootScope',function($scope,GalleryService,ModalService,IsotopeService,$routeParams,$location,$rootScope){$rootScope.applyFooter(!1);$rootScope.bodyClass='';$rootScope.adminBucketAvailable=!1;var scrollStopTimeout;$rootScope.initialLoad=$rootScope.latestPollTime;$scope.baseCount=siteDefaults.gallery.loadCount;$scope.pageCount=siteDefaults.gallery.pageCount;$rootScope.galleryPage=defined($routeParams.page)?$routeParams.page:1;$rootScope.loaderOverride='';if(defined($routeParams.tab)&&$routeParams.tab!==''){$rootScope.galleryTab=$routeParams.tab}
$scope.clearGalleries=function(){switch($rootScope.galleryTab){case "recent":$rootScope.recentPos=0;GalleryService.clearRecentGallery();IsotopeService.clearGalleryData('image','recent');break;case "popular":$rootScope.popularPos=0;GalleryService.clearPopularGallery();IsotopeService.clearGalleryData('image','popular');break;case "featured":$rootScope.featuredPos=0;GalleryService.clearFeaturedGallery();IsotopeService.clearGalleryData('image','featured');break}};if($rootScope.resetShowcase){$scope.clearGalleries();$rootScope.showcaseStart=!1;$rootScope.resetShowcase=!1}
$scope.performLoad=function(type,pos){$rootScope.galleryNextPage=(pos+$scope.baseCount==$scope.pageCount);if(!$rootScope.showcaseStart){$rootScope.showcaseStart=!0;GalleryService.loadGallery(type,pos,$scope.baseCount,$rootScope.initialLoad,$rootScope.galleryPage)}else{$rootScope.galleryLazyLoading=!1;$rootScope.loaderOverride=''}
$(window).unbind('scroll').bind('scroll',function(){clearTimeout(scrollStopTimeout);$rootScope.stopImageLoad=!0;scrollStopTimeout=setTimeout(function(){$rootScope.stopImageLoad=!1;if(!$scope.$$phase)$scope.$apply()},500);if($rootScope.galleryLazyLoading||$rootScope.galleryFinishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){if(pos+$scope.baseCount==$scope.pageCount){$rootScope.galleryNextPage=!0}else{pos+=$scope.baseCount;$rootScope.galleryLazyLoading=!0;GalleryService.loadGallery(type,pos,$scope.baseCount,$rootScope.initialLoad,$rootScope.galleryPage)}}})};$scope.$watch(function(){return $rootScope.galleryTab},function(newVal){$rootScope.galleryFinishedLoading=!1;$rootScope.galleryLazyLoading=!0;$rootScope.loaderOverride='enhance';switch(newVal){case "recent":$scope.performLoad(newVal,$rootScope.recentPos);break;case "popular":$scope.performLoad(newVal,$rootScope.popularPos);break;case "featured":$scope.performLoad(newVal,$rootScope.featuredPos);break}},!0);$scope.$watch(function(){return GalleryService.getData().featured},function(newVal){IsotopeService.synchroniseGroup(newVal,'#featured','image','featured','',$scope)},!0);$scope.$watch(function(){return GalleryService.getData().popular},function(newVal){IsotopeService.synchroniseGroup(newVal,'#popular','image','popular','',$scope)},!0);$scope.$watch(function(){return GalleryService.getData().gallery},function(newVal){IsotopeService.synchroniseGroup(newVal,'#gallery','image','recent','',$scope)},!0);$('body').off("domLoadComplete").on("domLoadComplete",function(){switch($rootScope.galleryTab){case "featured":IsotopeService.synchroniseGroup(GalleryService.getData().featured,'#featured','image','featured','',$scope);break;case "popular":IsotopeService.synchroniseGroup(GalleryService.getData().popular,'#popular','image','popular','',$scope);break;case "recent":IsotopeService.synchroniseGroup(GalleryService.getData().gallery,'#gallery','image','recent','',$scope);break}})}]);app.controller('imageController',['$scope','UserService','GalleryService','ModalService','SliderService','PopoverService','$location','$routeParams','$rootScope',function($scope,UserService,GalleryService,ModalService,SliderService,PopoverService,$location,$routeParams,$rootScope){$scope.username=$routeParams.username;$scope.imageId=$routeParams.imageId;$scope.calculateAspectRatioFit=function(){$scope.imageViewportWidth=$('#imageViewport').width();$scope.imageViewportHeight=!$rootScope.isMobile()?Math.round($scope.imageViewportWidth*4/3):1000;if(defined($rootScope.getImage($scope.imageId).width)){$scope.imageNaturalWidth=$rootScope.getImage($scope.imageId).width;$scope.imageNaturalHeight=$rootScope.getImage($scope.imageId).height}else{$scope.imageNaturalWidth=$scope.imageViewportWidth;$scope.imageNaturalHeight=$scope.imageViewportWidth}
var ratio=[$scope.imageViewportWidth/$scope.imageNaturalWidth,$scope.imageViewportHeight/$scope.imageNaturalHeight];ratio=Math.min(ratio[0],ratio[1]);if($scope.imageNaturalWidth<=$scope.imageViewportWidth&&$scope.imageNaturalHeight<=$scope.imageViewportHeight){$scope.imageActualWidth=$scope.imageNaturalWidth;$scope.imageActualHeight=$scope.imageNaturalHeight}else if($scope.imageActualWidth>$scope.imageActualHeight){$scope.imageActualWidth=Math.round($scope.imageNaturalWidth*ratio);$scope.imageActualHeight=$scope.imageNaturalHeight*ratio}else if($scope.imageActualWidth===$scope.imageActualHeight){$scope.imageActualWidth=Math.round($scope.imageNaturalWidth*ratio);$scope.imageActualHeight=Math.round($scope.imageNaturalHeight*ratio)}else{$scope.imageActualWidth=$scope.imageNaturalWidth*ratio;$scope.imageActualHeight=Math.round($scope.imageNaturalHeight*ratio)}
return!0};$scope.calculateAspectRatioFit();$(window).on('resize',function(){$scope.calculateAspectRatioFit()});window.addEventListener("orientationchange",function(){$scope.calculateAspectRatioFit()},!1);$scope.activeComment={id:0,alias:'',username:''};$scope.hashtags=[];$scope.toggleable=[];if(defined($scope.imageId)){$rootScope.pollObject={page:'image',scope:{imageId:$scope.imageId}};GalleryService.loadUserImage($scope.imageId,function(){$scope.calculateAspectRatioFit()})}
$scope.searchKeyword=function(keyword){$rootScope.redirect('/search');$rootScope.search.term=keyword};$scope.isOwner=function(){return $rootScope.loggedIn&&$scope.username===$rootScope.getUser($rootScope.user).username};$scope.convertKeywordsHashtags=function(keywords){if(defined(keywords)){var keywordList=keywords.split(',');return keywordList}};$scope.openReply=function(comment){SliderService.initialise('Reply to '+comment.alias,'image-reply',comment,SliderService.hide);SliderService.show()};$scope.closeReply=function(){$('.commentInput').empty();$scope.activeComment.id=0;$scope.activeComment.alias='';$scope.activeComment.username=''};$scope.createGalleryItemComment=function(comment){if($rootScope.checkCanPerform(!0,!0)){if($scope.isMobile()){}
var formData=new FormData(jQuery('#'+comment+'-comment-create-form')[0]);var content=document.getElementById(comment+'-content').innerText;formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);$('#'+comment+'-content').empty();$scope.activeComment={id:0,alias:'',username:''};if(defined(data.success)){if(data.comment.comment_id==='0'){GalleryService.addCommentToImage($scope.imageId,data.comment,!1)}else{GalleryService.addCommentToImageComment($scope.imageId,data.comment.comment_id,data.comment,!1);SliderService.addCommentToSlider(data.comment)}
$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};$scope.imageCommentOrdering=function(a,b){if($rootScope.getImage($scope.imageId).galleryComments[a.value].created>$rootScope.getImage($scope.imageId).galleryComments[b.value].created){return-1}
if($rootScope.getImage($scope.imageId).galleryComments[a.value].created<$rootScope.getImage($scope.imageId).galleryComments[b.value].created){return 1}
return 0};$scope.editComment=function(commentId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();var content=document.getElementById(commentId+'-content-edit').innerText;$scope.toggleable['saving'+commentId]=!$scope.toggleable['saving'+commentId];formData.append('schema','galleryCommentEdit');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('commentId',commentId);formData.append('content',content);formData.append('status',0);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);$scope.toggleable['saving'+commentId]=!$scope.toggleable['saving'+commentId];$scope.toggleable['edit'+commentId]=!$scope.toggleable['edit'+commentId];if(defined(data.success)){GalleryService.editComment($scope.imageId,data.comment);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};$rootScope.deleteComment=function(commentId,replyId){PopoverService.initialise('delete',{graphic:{classes:'red',visible:!0},title:'Delete '+(replyId?'Reply':'Comment'),description:'Are you sure you want to permanently delete this '+(replyId?'reply?':'comment?'),confirmButton:{text:'Delete',action:function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();formData.append('schema','galleryCommentDelete');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);if(replyId){formData.append('commentId',replyId)}else{formData.append('commentId',commentId)}
showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);console.log(data);showLoader(!1);if(defined(data.success)){GalleryService.deleteComment($scope.imageId,commentId,replyId);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}
PopoverService.hide()},classes:'red',visible:!0},dismissButton:{text:'Cancel',visible:!0}});PopoverService.show()};$scope.editGalleryItem=function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData(jQuery('#gallery-edit-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);if(defined(data.success)){alert("Your image has been updated.");GalleryService.addOrUpdateImage(GalleryService.generateImageFromImageData(data.galleryItem));if(data.galleryItem.private==='1'){GalleryService.removeFromGallery(data.galleryItem);GalleryService.removeFromPopularGallery(data.galleryItem);GalleryService.removeFromFeatureGallery(data.galleryItem)}
$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};$scope.goBack=function(){window.history.back()};$scope.optionsArtwork=function(id){PopoverService.initialise('default',{description:'Artwork Options',buttonOptions:[{text:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'Feature':'Un-Feature'),action:function(){$rootScope.popoverSwitch(function(){$rootScope.featureGalleryItem(id)})},classes:($rootScope.getImage(id).featured==='0'&&$rootScope.getImage(id).featured!=='1'?'blue':'red'),visible:$rootScope.canFeature()},{text:'Edit',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id+"/edit")},classes:'',visible:$rootScope.isOwner(id)},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem(id,'image')})},classes:'red',visible:(!$rootScope.isOwner(id)||($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$rootScope.deleteGalleryItem(id)})},classes:'red',visible:$rootScope.isOwner(id)},{text:'More...',action:function(){$rootScope.optionsGalleryItemAdmin(id,{area:'artwork'})},classes:'thin',visible:$rootScope.isModeratorUser()&&!$rootScope.isOwner(id)}],dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsArtworkComment=function(comment){PopoverService.initialise('default',{description:'Comment Options',buttonOptions:[{text:'Edit',action:function(){PopoverService.hide();$scope.toggleable['edit'+comment.id]=!$scope.toggleable['edit'+comment.id]},classes:'',visible:(($rootScope.user===comment.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn)&&!$scope.toggleable['edit'+comment.id]},{text:'Save',action:function(){PopoverService.hide();$scope.toggleable['edit'+comment.id]=!$scope.toggleable['edit'+comment.id]},classes:'blue',visible:(($rootScope.user===comment.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn)&&$scope.toggleable['edit'+comment.id]},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem(comment.id,'image_reply')})},classes:'red',visible:($rootScope.user!==comment.userId||($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Mark as Banned',action:function(){$rootScope.popoverSwitch(function(){$rootScope.banItem(comment.id,'image_reply')})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$scope.deleteComment(comment.id)})},classes:'red',visible:($rootScope.user===comment.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn}],dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsArtworkCommentReply=function(comment,reply){PopoverService.initialise('default',{description:'Reply Options',buttonOptions:[{text:'Edit',action:function(){PopoverService.hide();$scope.toggleable['edit'+reply.id]=!$scope.toggleable['edit'+reply.id]},classes:'',visible:(($rootScope.user===reply.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn)&&!$scope.toggleable['edit'+reply.id]},{text:'Save',action:function(){PopoverService.hide();$scope.toggleable['edit'+reply.id]=!$scope.toggleable['edit'+reply.id]},classes:'blue',visible:(($rootScope.user===reply.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn)&&$scope.toggleable['edit'+reply.id]},{text:'Report',action:function(){$rootScope.popoverSwitch(function(){$rootScope.reportItem(reply.id,'image_reply')})},classes:'red',visible:($rootScope.user!==reply.userId||($rootScope.isModeratorUser()&&!$rootScope.isAdminUser()))&&$rootScope.loggedIn},{text:'Mark as Banned',action:function(){$rootScope.popoverSwitch(function(){$rootScope.banItem(reply.id,'image_reply')})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$rootScope.popoverSwitch(function(){$scope.deleteComment(comment.id,reply.id)})},classes:'red',visible:($rootScope.user===reply.userId||$rootScope.isAdminUser())&&$rootScope.loggedIn}],dismissButton:{visible:!0}});PopoverService.show()};function shareDialog(url){var winTop=(screen.height/2)-(620/2);var winLeft=(screen.width/2)-(440/2);window.open(url,'sharer','top='+winTop+',left='+winLeft+',toolbar=0,status=0,width='+620+',height='+440)}
$(".facebook.fire").click(function(event){event.stopPropagation();shareDialog('https://www.facebook.com/sharer.php?s=100&p[title]='+$rootScope.getImage($scope.imageId).title+' - '+$rootScope.getUser($scope.imageId,'image').fname+' '+$rootScope.getUser($scope.imageId,'image').lname+'&p[summary]='+$rootScope.getImage($scope.imageId).description+'&p[url]=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getImage($scope.imageId).id+'/')});$(".twitter.fire").click(function(event){event.stopPropagation();shareDialog('https://twitter.com/intent/tweet?text=@procreate '+$rootScope.getImage($scope.imageId).title+' - '+$rootScope.getUser($scope.imageId,'image').fname+' '+$rootScope.getUser($scope.imageId,'image').lname+'&url=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getImage($scope.imageId).id+'/&hashtags=procreate')});$(".linkedin.fire").click(function(event){event.stopPropagation();shareDialog('https://www.linkedin.com/shareArticle?mini=true&url=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getImage($scope.imageId).id+'/&title='+$rootScope.getImage($scope.imageId).title+' - '+$rootScope.getUser($scope.imageId,'image').fname+' '+$rootScope.getUser($scope.imageId,'image').lname+'&summary='+$rootScope.getImage($scope.imageId).description)});$(".pinterest.fire").click(function(event){event.stopPropagation();shareDialog('https://pinterest.com/pin/create/button/?url=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getImage($scope.imageId).id+'/&media='+$rootScope.getImage($scope.imageId).image+'&description='+$rootScope.getImage($scope.imageId).title+' - '+$rootScope.getUser($scope.imageId,'image').fname+' '+$rootScope.getUser($scope.imageId,'image').lname+'%0A'+$rootScope.getImage($scope.imageId).description)});var clipboard=new Clipboard('.link-copy-fire');clipboard.on('success',function(e){console.info('Action:',e.action);console.info('Text:',e.text);console.info('Trigger:',e.trigger);e.clearSelection()});clipboard.on('error',function(e){console.error('Action:',e.action);console.error('Trigger:',e.trigger)});$("#artwork-link").click(function(){$(this).select()})}]);app.controller('loginController',['$scope','$http','$rootScope','$location','UserService','NotificationsService',function($scope,$http,$rootScope,$location,UserService,NotificationsService){$scope.formData={};$scope.processForm=function(suffix){suffix=typeof suffix!=='undefined'?'-'+suffix:'';var formData=new FormData(jQuery('#login-form'+suffix)[0]);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);if(defined(data.success)){UserService.save(data.user);data.inspiration.forEach(function(inspiration){UserService.addPersonalInspirationToUser(inspiration.imageId)});NotificationsService.load();$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}}]);app.controller('marketController',['$scope','MarketService','$rootScope','$routeParams',function($scope,MarketService,$rootScope,$routeParams){$rootScope.checkAnimatable(!1);$scope.basePos=0;$scope.baseCount=25;$rootScope.bodyClass='';MarketService.loadMarket($scope.basePos,$scope.baseCount);$scope.loadMore=function(){$scope.basePos+=$scope.baseCount-1;MarketService.loadMarket($scope.basePos,$scope.baseCount)}}]);app.controller('modalController',['$scope','ModalService',function($scope,ModalService){$scope.modalData=ModalService.getData;$scope.cancelClick=function(){$scope.modalData().cancelCallback()};$scope.confirmClick=function(){$scope.modalData().confirmCallback()};$scope.resumeVideo=function(){$scope.modalData().playing=!0;$('#modalPlayer').get(0).play()};$scope.restartVideo=function(){$scope.modalData().playing=!0;$('#modalPlayer').get(0).currentTime=0;$('#modalPlayer').get(0).play()}}]);app.controller('navController',['$http','$scope','$rootScope','SearchService','UserService',function($http,$scope,$rootScope,SearchService,UserService){$scope.showSearchHistory=UserService.getCurrentSearchHistory().length>0;$scope.term='';var searchAnimationTimeout;var currentWidth=$(window).outerWidth();$(window).resize(function(){if(currentWidth<656&&$(window).outerWidth()>=656||currentWidth>=656&&$(window).outerWidth()<656){$rootScope.searchClass='';$scope.term='';$scope.displaySearch('resize')}
currentWidth=$(window).outerWidth()});$scope.updateSearchTerm=function(term){$scope.term=term;$scope.performSearch()};$scope.performSearch=function(){UserService.updateSearchHistory($scope.term);SearchService.termSearched($scope.term);$scope.toggleSearch('searched');$rootScope.redirect('/search/'+$scope.term)};$scope.$watch('term',function(newVal){if(newVal!==''){$scope.showSearchHistory=!1;if(searchValueTimeout){clearTimeout(searchValueTimeout)}
searchValueTimeout=setTimeout(function(){SearchService.updateSuggested($scope,newVal);searchValueTimeout=!1},10)}else{$scope.showSearchHistory=UserService.getCurrentSearchHistory().length>0;SearchService.loadInitialSuggested()}});$scope.toggleSearch=function(type){var $searchInput=$('#nav-search-input');$searchInput.off('focus');switch(type){case 'mobile':if($rootScope.searchClass==='search'){$scope.performSearch()}else{$rootScope.searchClass='search';$scope.displaySearch('mobile-open')}
break;case 'open':if($rootScope.searchClass==='search'){$scope.performSearch()}else{$rootScope.searchClass='search';$rootScope.navMenuClass='';$rootScope.userMenuClass='';$scope.displaySearch(type)}
break;case 'searched':$rootScope.searchClass='search search-performed';$scope.displaySearch(type);$searchInput.on('focus',function(){$rootScope.searchClass='search';$scope.displaySearch('search-again')});break;case 'close':$rootScope.searchClass='';$scope.term='';if($rootScope.isMobile()){$scope.displaySearch('mobile-close')}else{$scope.displaySearch(type)}
break;default:if($rootScope.searchClass==='search'){$rootScope.searchClass='';$scope.displaySearch('close')}else{$rootScope.searchClass='search';$scope.displaySearch('open')}
break}};$scope.toggleFixedSectionNav=function(type){console.log('in toggle');switch(type){case 'show':$rootScope.sectionNavClass='fixed-section-nav';break;case 'hide':$rootScope.sectionNavClass='';break;default:if($rootScope.sectionNavClass='fixed-section-nav'){$rootScope.sectionNavClass=''}else{$rootScope.sectionNavClass='fixed-section-nav'}
break}};$scope.displaySearch=function(type){clearTimeout(searchAnimationTimeout);var $mobileSearchIcon=$('#mobile-search-icon');var $mobileUser=$('#mobile-nav-user');var $mobileHamburger=$('#mobile-hamburger');var $branding=$('#nav-branding');var $searchIcon=$('#search-menu-item #search-icon-svg');var $searchIconContainer=$('#search-menu-item .search-icon');var $searchContainer=$('.search-container');var $searchPointer=$('#search-menu-item #search-pointer-svg');var $searchCancel=$('.nav-search-tools .cancel-icon');var $searchInput=$('#searchForm');var $searchBox=$('.nav-search-box');var $searchTools=$('.nav-search-tools');var primaryOpenSpeed=500;var SecondaryOpenSpeed=300;switch(type){case 'mobile-open':$searchBox.css('opacity','1');$mobileSearchIcon.animate({left:"-10px"},{queue:!1,duration:primaryOpenSpeed});$mobileUser.animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});$mobileHamburger.animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});$branding.animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});searchAnimationTimeout=setTimeout(function(){$searchCancel.animate({opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed});$searchTools.css('width','100%');$searchInput.css('top','0');$searchInput.css('width','100%');$searchCancel.css('right','-15px');$searchCancel.css('position','absolute');$searchInput.find('input').css('padding','0 30px');$searchCancel.find('svg').css('width','20px');$searchCancel.find('svg').css('height','25px');$searchTools.css('height','55px');$searchInput.find('input').css('height','55px');$searchCancel.css('height','55px');$mobileSearchIcon.find('svg').animate({opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed});$searchInput.animate({opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed});$searchBox.animate({top:"0",color:"rgba(0, 0, 0, 0.1)"},{queue:!1,duration:(SecondaryOpenSpeed*1.5)});$searchInput.find('input').focus()},primaryOpenSpeed);break;case 'mobile-close':$searchInput.find('input').blur();$mobileSearchIcon.animate({left:"28px"},{queue:!1,duration:primaryOpenSpeed});$searchCancel.animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});$mobileSearchIcon.find('svg').animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});$searchInput.animate({opacity:"0"},{queue:!1,duration:50,complete:function(){$searchInput.css('top','')}});$searchBox.animate({top:"-265px",color:"transparent"},{queue:!1,duration:(SecondaryOpenSpeed*1.5)});searchAnimationTimeout=setTimeout(function(){$searchBox.css('opacity','0');$searchTools.css('width','');$searchInput.css('top','');$searchCancel.css('right','');$searchCancel.css('position','');$searchInput.css('width','');$searchInput.find('input').css('padding','');$searchCancel.find('svg').css('width','');$searchCancel.find('svg').css('height','');$searchTools.css('height','');$searchInput.find('input').css('height','');$searchCancel.css('height','');$mobileUser.animate({opacity:"1"},{queue:!1,duration:primaryOpenSpeed});$mobileHamburger.animate({opacity:"1"},{queue:!1,duration:primaryOpenSpeed});$branding.animate({opacity:"1"},{queue:!1,duration:primaryOpenSpeed})},(primaryOpenSpeed/2));break;case 'open':$searchBox.css('opacity','1');$searchIcon.animate({width:"15px",height:"15px"},{queue:!1,duration:primaryOpenSpeed});$searchIconContainer.animate({padding:"15px 12px 15px 13px"},{queue:!1,duration:primaryOpenSpeed});$searchContainer.animate({width:"516px",right:"50%"},{queue:!1,duration:primaryOpenSpeed});$('.nav-primary-items .menu-link').each(function(i,obj){$(this).animate({left:"-100px",opacity:"0"},{queue:!1,duration:SecondaryOpenSpeed})});searchAnimationTimeout=setTimeout(function(){$searchPointer.animate({top:"0"},{queue:!1,duration:SecondaryOpenSpeed});$searchCancel.animate({opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed});$searchInput.css('top','0');$searchInput.animate({opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed});$searchBox.animate({top:"0",color:"rgba(0, 0, 0, 0.1)"},{queue:!1,duration:(SecondaryOpenSpeed*1.5)})},primaryOpenSpeed);break;case 'searched':$searchPointer.animate({top:"-15px"},{queue:!1,duration:primaryOpenSpeed});if($rootScope.isMobile()){$mobileSearchIcon.find('svg').animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed})}
if($rootScope.isMobile()){$searchBox.animate({top:"-265px",color:"transparent"},{queue:!1,duration:(primaryOpenSpeed)})}else{$searchBox.animate({top:"-205px",color:"transparent"},{queue:!1,duration:(primaryOpenSpeed)})}
searchAnimationTimeout=setTimeout(function(){$searchBox.css('opacity','0')},primaryOpenSpeed);$searchInput.find('input').blur();break;case 'search-again':$searchBox.css('opacity','1');$searchPointer.animate({top:"0"},{queue:!1,duration:SecondaryOpenSpeed});if($rootScope.isMobile()){$mobileSearchIcon.find('svg').animate({opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed})}
$searchBox.animate({top:"0",color:"rgba(0, 0, 0, 0.1)"},{queue:!1,duration:(SecondaryOpenSpeed*1.5)});break;case 'close':$searchInput.find('input').blur();$searchIcon.animate({width:"13px",height:"13px"},{queue:!1,duration:primaryOpenSpeed});$searchIconContainer.animate({padding:"16px 5px 16px 5px"},{queue:!1,duration:primaryOpenSpeed});$searchContainer.animate({width:"23px",right:"258px"},{queue:!1,duration:primaryOpenSpeed});searchAnimationTimeout=setTimeout(function(){$searchBox.css('opacity','0');$('.nav-primary-items .menu-link').each(function(i,obj){$(this).animate({left:"0",opacity:"1"},{queue:!1,duration:SecondaryOpenSpeed})})},(primaryOpenSpeed/2));$searchPointer.animate({top:"-15px"},{queue:!1,duration:SecondaryOpenSpeed});$searchCancel.animate({opacity:"0"},{queue:!1,duration:(SecondaryOpenSpeed/2)});$searchInput.animate({opacity:"0"},{queue:!1,duration:50,complete:function(){$searchInput.css('top','')}});$searchBox.animate({top:"-205px",color:"transparent"},{queue:!1,duration:(SecondaryOpenSpeed*1.5)});break;case 'resize':$searchInput.find('input').blur();$searchIcon.animate({width:"13px",height:"13px"},{queue:!1,duration:primaryOpenSpeed});$searchIconContainer.animate({padding:"16px 5px 16px 5px"},{queue:!1,duration:primaryOpenSpeed});$searchContainer.animate({width:"23px",right:"258px"},{queue:!1,duration:primaryOpenSpeed});$mobileSearchIcon.animate({left:"28px"},{queue:!1,duration:primaryOpenSpeed});$searchPointer.animate({top:"-15px"},{queue:!1,duration:primaryOpenSpeed});$searchCancel.animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});$mobileSearchIcon.find('svg').animate({opacity:"0"},{queue:!1,duration:primaryOpenSpeed});$searchInput.animate({opacity:"0"},{queue:!1,duration:50,complete:function(){$searchInput.css('top','')}});$('.nav-primary-items .menu-link').each(function(){$(this).css('opacity','1');$(this).css('left','0')});$mobileUser.css('opacity','1');$mobileHamburger.css('opacity','1');$branding.css('opacity','1');searchAnimationTimeout=setTimeout(function(){$searchBox.css('opacity','0');$searchTools.css('width','');$searchInput.css('top','');$searchCancel.css('right','');$searchCancel.css('position','');$searchInput.css('width','');$searchInput.find('input').css('padding','');$searchCancel.find('svg').css('width','');$searchCancel.find('svg').css('height','');$searchTools.css('height','');$searchInput.find('input').css('height','');$searchCancel.css('height','')},(primaryOpenSpeed/2));if($rootScope.isMobile()){$searchBox.animate({top:"-265px",color:"transparent"},{queue:!1,duration:(primaryOpenSpeed/2)})}else{$searchBox.animate({top:"-205px",color:"transparent"},{queue:!1,duration:(primaryOpenSpeed/2)})}
break;default:console.log('Unknown Action: displaySearch (Function)');break}}}]);app.controller('newsController',['$scope','NewsService','UserService','SliderService','ModalService','$rootScope','$routeParams','$location','$sce',function($scope,NewsService,UserService,SliderService,ModalService,$rootScope,$routeParams,$location,$sce){$rootScope.checkAnimatable(!1);$scope.toggleable=[];$scope.newsArticleFields={};$scope.articleId=$routeParams.id;$scope.year=$routeParams.year;$scope.articleUrl=$routeParams.articleUrl;$rootScope.adminBucketAvailable=!0;$scope.canvasOptions={percentageValue:50,success:!1};NewsService.loadCategories();switch($routeParams.page){case 'articles':NewsService.loadArticles($scope);break}
$rootScope.pollObject={page:'news',scope:{articleUrl:$scope.articleUrl,articleYear:$scope.year}};$scope.parseArticleTitle=function(string){if(defined(string)){string=string.replace(/[ ](?=[^ ]*$)/gm,'\u00a0');string=string.replace('Procreate Pocket 2','Procreate'+'\u00a0'+'Pocket'+'\u00a0'+'2');string=string.replace('Procreate Pocket','Procreate'+'\u00a0'+'Pocket');string=string.replace('our Undo','our'+'\u00a0'+'Undo');return $sce.trustAsHtml(string)}
return''};$scope.goBack=function(){window.history.back()};$scope.processCategoryForm=function(){var formData=new FormData(jQuery('#news-category-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){NewsService.addOrUpdateCategory(data.category);$location.path('/admin/news/categories');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)};$scope.processArticleForm=function(reference){var formData=new FormData(jQuery(reference)[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',$('#content').html());if(reference==='#news-article-edit-form'){formData.append('articleId',$scope.articleId)}
if($('#catId').val()===null){alert("Please select a category")}else if($('#displayDate').val()===''){alert("Please select a display date")}else if($('#displayDate').val()===''){alert("Please select a live date")}else{$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){NewsService.addOrUpdateArticle(data.article);$scope.newsArticleFields.display_date=new Date(data.article.display_date.replace(/-/g,"/"));$scope.newsArticleFields.live_date=new Date(data.article.live_date.replace(/-/g,"/"));$location.path('/insight/'+$scope.newsArticleFields.display_date.getFullYear()+'/'+$scope.newsArticleFields.url);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)}};$scope.getSafeDomain=function(url){return url.replace("https://images.procreate.art","/imageBucket")};$scope.resetCanvasView=function(){$scope.canvasOptions={percentageValue:50,success:!1}};$scope.dataURLtoBlob=function(dataurl){var arr=dataurl.split(','),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n)}
return new Blob([u8arr],{type:mime})};$scope.html2canvas=function(){$rootScope.setPageLoader(!0);html2canvas(document.getElementById("storyCapture"),{letterRendering:!0}).then(function(canvas){var image=document.getElementById("storyImage");image.src=canvas.toDataURL("image/png");var downloadLink=document.getElementById("storyImageDownload");var strDataURI=image.src.substr(22,image.src.length);var blob=$scope.dataURLtoBlob(image.src);var objurl=URL.createObjectURL(blob);downloadLink.download=$scope.newsArticleFields.url+".png";downloadLink.href=objurl;$scope.canvasOptions.success=!0;$rootScope.setPageLoader(!1)})};$scope.resetCat=function(catId){$('#catEditTitle'+catId).html($rootScope.getNewsCategory(catId).title);$('#catEditUrl'+catId).html($rootScope.getNewsCategory(catId).url);$('#catEditHex'+catId).html($rootScope.getNewsCategory(catId).hex);$scope.toggleable['edit'+catId]=!$scope.toggleable['edit'+catId]};$scope.saveCat=function(catId){var formData=new FormData();formData.append('schema','newsCategoryUpdate');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('catId',catId);formData.append('title',$('#catEditTitle'+catId).html());formData.append('url',$('#catEditUrl'+catId).html());formData.append('hex',$('#catEditHex'+catId).html());$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){NewsService.addOrUpdateCategory(data.category)}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}
$scope.toggleable['edit'+catId]=!$scope.toggleable['edit'+catId];$scope.$apply()},!0)};$scope.createNewsItemComment=function(comment){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData(jQuery('#'+comment+'-comment-create-form')[0]);var content=document.getElementById(comment+'-content').innerText;formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',content);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);$('#'+comment+'-content').empty();if(defined(data.success)){if(data.comment.news_comment_id==='0'){NewsService.addCommentToNews(data.comment.news_article_id,data.comment)}else{NewsService.addCommentToNewsComment(data.comment.news_article_id,data.comment.news_comment_id,data.comment,!1)}
$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};$scope.editComment=function(commentId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();var content=document.getElementById(commentId+'-content-edit').innerText;$scope.toggleable['saving'+commentId]=!$scope.toggleable['saving'+commentId];formData.append('schema','newsCommentEdit');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('commentId',commentId);formData.append('content',content);formData.append('status',0);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);$scope.toggleable['saving'+commentId]=!$scope.toggleable['saving'+commentId];$scope.toggleable['edit'+commentId]=!$scope.toggleable['edit'+commentId];if(defined(data.success)){NewsService.editComment(data.comment.news_article_id,data.comment);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};$scope.deleteComment=function(newsArticleId,commentId,replyId){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData();formData.append('schema','newsCommentDelete');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);if(replyId){formData.append('commentId',replyId)}else{formData.append('commentId',commentId)}
showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);console.log(data);showLoader(!1);if(defined(data.success)){NewsService.deleteComment(newsArticleId,commentId,replyId);$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};$scope.parseNewsContent=function(content){var mediaRegexp=/\[media src="([^"]+)"\]([^\[]*)\[\/media\]/g;var mediaResults=[];var mediaMatch=mediaRegexp.exec(content);var newsRegexp=/\[newsImage type="([^"]+)" src="([^"]+)" rgb="([^"]*)" src2="([^"]*)" rgb2="([^"]*)"\]([^\[]*)\[\/newsImage\]/g;var newsResults=[];var newsMatch=newsRegexp.exec(content);var videoRegexp=/\[video src="([^"]+)"\]([^\[]*)\[\/video\]/g;var videoResults=[];var videoMatch=videoRegexp.exec(content);var reviewRegexp=/\[review user="([^"]+)" date="([^"]+)" rating="([^"]*)" title="([^"]*)"\]([^\[]*)\[\/review\]/g;var reviewResults=[];var reviewMatch=reviewRegexp.exec(content);var quoteRegexp=/\[quote name="([^"]+)" date="([^"]+)" link="([^"]+)"\]([^\[]*)\[\/quote\]/g;var quoteResults=[];var quoteMatch=quoteRegexp.exec(content);var result,i,src,origTitle,title,video;while(mediaMatch!==null){result=[];for(i=1;i<mediaMatch.length;i ++){result.push(mediaMatch[i])}
mediaResults.push(result);mediaMatch=mediaRegexp.exec(content)}
while(videoMatch!==null){result=[];for(i=1;i<videoMatch.length;i ++){result.push(videoMatch[i])}
videoResults.push(result);videoMatch=videoRegexp.exec(content)}
while(newsMatch!==null){result=[];for(i=1;i<newsMatch.length;i ++){result.push(newsMatch[i])}
newsResults.push(result);newsMatch=newsRegexp.exec(content)}
while(reviewMatch!==null){result=[];for(i=1;i<reviewMatch.length;i ++){result.push(reviewMatch[i])}
reviewResults.push(result);reviewMatch=reviewRegexp.exec(content)}
while(quoteMatch!==null){result=[];for(i=1;i<quoteMatch.length;i ++){result.push(quoteMatch[i])}
quoteResults.push(result);quoteMatch=quoteRegexp.exec(content)}
for(i=0;i<mediaResults.length;i ++){src=mediaResults[i][0];origTitle=typeof mediaResults[i][1]!=='undefined'?mediaResults[i][1]:'';title=origTitle!==''?origTitle:src;video=createVideo(src);if(src.match(/\.(jpg|jpeg|gif|png)$/)!==null||src.match(/^((http[s]?):\/)?\/?(forums\.procreate\.art\/index\.php\?action=dlattach;)+(.)*(;image)+?$/)!==null){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<div class="embed-image"><div class="container"><img src="'+src+'" title="'+title+'" /></div></div>')}else if(video!==!1){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]',video)}else{content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<a target="_blank" href="'+src+'">'+title+'</a>')}}
for(i=0;i<videoResults.length;i ++){src=videoResults[i][0];origTitle=typeof videoResults[i][1]!=='undefined'?videoResults[i][1]:'';title=origTitle!==''?origTitle:'';video=createNewsVideo(src,title);if(video!==!1){content=content.replace('[video src="'+src+'"]'+origTitle+'[/video]',video)}}
for(i=0;i<newsResults.length;i ++){var type=newsResults[i][0];var src2=newsResults[i][3];var rgb=newsResults[i][2];var rgb2=newsResults[i][4];src=newsResults[i][1];title=typeof newsResults[i][5]!=='undefined'?newsResults[i][5]:'';var old='[newsImage type="'+type+'" src="'+src+'" rgb="'+rgb+'" src2="'+src2+'" rgb2="'+rgb2+'"]'+title+'[/newsImage]';switch(type){case '1':content=content.replace(old,'<figure class="generic-image"><img src="'+src+'" alt="'+title+'" style="color: '+rgb+';" /><figcaption>'+title+'</figcaption></figure>');break;case '2':content=content.replace(old,'<figure class="ipad-landscape"><img src="'+src+'" alt="'+title+'" style="color: '+rgb+';" /><figcaption>'+title+'</figcaption></figure>');break;case '3':content=content.replace(old,'<figure class="iphone-landscape"><img src="'+src+'" alt="'+title+'" style="color: '+rgb+';" /><figcaption>'+title+'</figcaption></figure>');break;case '4':content=content.replace(old,'<figure class="iphone-portrait-dual"><div class="split"><img src="'+src+'" title="'+title+'" style="color: '+rgb+';" /><img src="'+src2+'" title="'+title+'" style="color: '+rgb2+';" /></div><figcaption>'+title+'</figcaption></figure>');break}}
for(i=0;i<reviewResults.length;i ++){var reviewUser=reviewResults[i][0];var reviewDate=reviewResults[i][1];var reviewRating=reviewResults[i][2];var reviewTitle=reviewResults[i][3];var reviewText=typeof reviewResults[i][4]!=='undefined'?reviewResults[i][4]:'';var oldReview='[review user="'+reviewUser+'" date="'+reviewDate+'" rating="'+reviewRating+'" title="'+reviewTitle+'"]'+reviewText+'[/review]';content=content.replace(oldReview,'<div class="review"><div class="review-left"><div class="title">'+reviewTitle+'</div><div class="rating type-'+reviewRating+'-star"></div></div><div class="review-right"><div class="date">'+reviewDate+'</div><div class="user">'+reviewUser+'</div></div><div class="review-content">'+reviewText+'</div></div>')}
for(i=0;i<quoteResults.length;i ++){var quoteName=quoteResults[i][0];var quoteDate=quoteResults[i][1];var quoteLink=quoteResults[i][2];var quoteText=typeof quoteResults[i][3]!=='undefined'?quoteResults[i][3]:'';var oldQuote='[quote name="'+quoteName+'" date="'+quoteDate+'" link="'+quoteLink+'"]'+quoteText+'[/quote]';if(quoteLink.length===''){content=content.replace(oldQuote,'<blockquote class="article-quote"><p>'+$scope.parseArticleTitle(quoteText)+'</p><footer class="quote-info"><cite>'+quoteName+'<span class="quote-date">'+quoteDate+'</span></cite></footer></blockquote>')}else{content=content.replace(oldQuote,'<blockquote class="article-quote"><p>'+$scope.parseArticleTitle(quoteText)+'</p><footer class="quote-info"><a target="_blank" href="'+quoteLink+'" title="'+quoteName+'"><cite>'+quoteName+'<span class="quote-date">'+quoteDate+'</span></cite></a></footer></blockquote>')}}
return $sce.trustAsHtml(content)};var clipboard=new Clipboard('.clipCopyArticle');clipboard.on('success',function(e){var $clipCopied=$('.clipCopied');$clipCopied.css('display','none');$clipCopied.css('opacity','1');$clipCopied.css('color','#0076ff');$clipCopied.fadeIn(100);setTimeout(function(){$clipCopied.fadeOut(300)},1500);e.clearSelection()});clipboard.on('error',function(e){alert("Copy to clipboard failed.")})}]);app.controller('notificationsController',['$scope','UserService','NotificationsService','$routeParams','$rootScope',function($scope,UserService,NotificationsService,$routeParams,$rootScope){$rootScope.applyFooter(!1);$scope.baseCount=30;$scope.pos=0;$scope.lazyLoading=!0;$scope.canLoad=!1;$scope.finishedLoading=!1;NotificationsService.clearFullData();NotificationsService.loadFull($rootScope.recentPos,$scope.baseCount,function(notificationFoundLength){$scope.lazyLoading=!1;if(notificationFoundLength){setTimeout(function(){$scope.canLoad=!0},100)}else{$scope.finishedLoading=!0}});$(window).unbind('scroll').bind('scroll',function(){if(!$scope.canLoad||$scope.finishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){$scope.pos+=$scope.baseCount;$scope.lazyLoading=!0;$scope.canLoad=!1;NotificationsService.loadFull($scope.pos,$scope.baseCount,function(notificationFoundLength){$scope.lazyLoading=!1;if(notificationFoundLength){setTimeout(function(){$scope.canLoad=!0},100)}else{$scope.finishedLoading=!0}})}})}]);app.controller('notificationsCenterController',['$scope','UserService','$location','$routeParams','$rootScope',function($scope,UserService,$location,$routeParams,$rootScope){$rootScope.checkAnimatable(!1);$rootScope.applyFooter(!0);$scope.userId='';$scope.isCurrentUser=!1;$scope.redirectOnLoad=!1;if(!defined($routeParams.tab)||$routeParams.tab===''){$scope.redirectOnLoad=!0}else{$rootScope.userTab=$routeParams.tab}
$rootScope.$watch('userTab',function(newVal,oldVal,scope){switch(newVal){case "all":break;case "portfolio":break;case "discussions":break;case "system":break}},!0);$scope.loadTab=function(tab){$rootScope.userTab=tab;if($rootScope.userTab==='all'){$location.path('/notifications',!1)}else{$location.path('/notifications/'+$rootScope.userTab,!1)}};$scope.getNotificationMessage=function(type){var message='';switch(type){case 'systemAccountBanned':message="Your account has been banned.";break;case 'systemAccountActivate':message="You need to activate your account.";break;case 'systemNewArticle':message="See Savage's latest article: [Article].";break;case 'systemNewAnnouncement':message="See Savage's latest Press Release.";break;case 'systemNewUpdate':message="Update now available for [customText].";break;case 'ownerDiscussionLike':message="[user] likes your discussion: [discussion.title].";break;case 'ownerDiscussionLikeBundle':message="[user] & [numberOfUsers] others like your discussion: [discussion.title].";break;case 'ownerDiscussionPost':message="[user] posted in your discussion: [discussion.title].";break;case 'ownerDiscussionPostBundle':message="[numberOfNewPosts] new posts in your discussion: [discussion.title].";break;case 'ownerDiscussionRemoved':message="Your Discussion: [discussion.title] has been removed.";break;case 'ownerDiscussionLocked':message="Your Discussion: [discussion.title] has been locked.";break;case 'ownerDiscussionMoved':message="Your Discussion: [discussion.title] has been moved to [discussion.board].";break;case 'ownerDiscussionPostLike':message="[user] likes your post.";break;case 'ownerDiscussionPostLikeBundle':message="[user] & [numberOfUsers] others like your post.";break;case 'ownerDiscussionsPostComment':message="[user] commented on your post [comment.preview].";break;case 'ownerDiscussionsPostCommentBundle':message="[numberOfNewComments] new comments on your post.";break;case 'involvedDiscussionPost':message="[user] posted in discussion: [discussion.title].";break;case 'involvedDiscussionPostBundle':message="[numberOfNewPosts] new posts in discussion: [discussion.title].";break;case 'ownerDiscussionPostRemoved':message="Your post has been Removed.";break;case 'ownerDiscussionPostCommentLike':message="[user] likes your comment.";break;case 'ownerDiscussionPostCommentLikeBundle':message="[user] & [numberOfUsers] others like your comment.";break;case 'involvedDiscussionPostComment':message="[user] also commented on [user]'s post.";break;case 'involvedDiscussionPostCommentBundle':message="[numberOfNewComments] new comments on this post.";break;case 'ownerDiscussionPostCommentRemoved':message="Your comment has been Removed.";break;case 'involvedDiscussionPostRemoved':message="A post you commented on has been Removed.";break;case 'involvedDiscussionLocked':message="The Discussion: [discussion.title] you were involved in has been locked.";break;case 'involvedDiscussionRemoved':message="The Discussion: [discussion.title] you were involved in has been locked.";break;case 'involvedDiscussionMoved':message="The Discussion: [discussion.title] you were involved in has been moved to [discussion.board].";break;case 'ownerPortfolioFollow':message="[user] has started following you.";break;case 'ownerPortfolioFollowBundle':message="[user] & [numberOfUsers] others have started following you.";break;case 'ownerPortfolioFollowersMilestone':message="You have reach [milestoneNumber] followers.";break;case 'ownerPortfolioViewsMilestone':message="Your Profile has been viewed more than [milestoneNumber] times.";break;case 'ownerPortfolioArtworkViewsMilestone':message="Your Artworks have been viewed more than [milestoneNumber] times.";break;case 'ownerPortfolioArtworkLike':message="[user] likes your artwork.";break;case 'ownerPortfolioArtworkLikeBundle':message="[user] & [numberOfUsers] others like your artwork.";break;case 'ownerPortfolioArtworkInspire':message="[user] found your artwork inspiring.";break;case 'ownerPortfolioArtworkInspireBundle':message="[user] & [numberOfUsers] others found your artwork inspiring.";break;case 'ownerPortfolioArtworkComment':message="[user] commented on your artwork.";break;case 'ownerPortfolioArtworkCommentBundle':message="[numberOfNewComments] new comments on your artwork.";break;case 'ownerPortfolioArtworkMature':message="Your artwork has been marked as mature.";break;case 'ownerPortfolioArtworkFeatured':message="Your artwork has been featured by Procreate.";break;case 'ownerPortfolioArtworkRemoved':message="Your artwork has been removed.";break;case 'ownerPortfolioArtworkCommentLike':message="[user] likes your comment.";break;case 'ownerPortfolioArtworkCommentLikeBundle':message="[user] & [numberOfUsers] others like your comment.";break;case 'ownerPortfolioArtworkCommentReply':message="[user] replied to your comment.";break;case 'ownerPortfolioArtworkCommentReplyBundle':message="[numberOfNewComments] new replies to your comment.";break;case 'ownerPortfolioArtworkCommentRemoved':message="Your comment has been removed.";break;case 'ownerPortfolioArtworkCommentReplyLike':message="[user] likes your reply.";break;case 'ownerPortfolioArtworkCommentReplyLikeBundle':message="[user] & [numberOfUsers] others like your reply.";break;case 'ownerPortfolioArtworkCommentReplyRemoved':message="Your reply has been removed.";break;case 'involvedPortfolioArtworkCommentReply':message="[user] also replied to this comment.";break;case 'involvedPortfolioArtworkCommentReplyBundle':message="[numberOfNewReplies] new replies to this comment.";break;case 'involvedPortfolioArtworkCommentReplyRemoved':message="A comment you replied to has been removed.";break;default:message="Error: Notification Type Unknown";break}
return message}}]);app.controller('popoverController',['$scope','$rootScope','PopoverService','LikeService','GalleryService',function($scope,$rootScope,PopoverService,LikeService,GalleryService){$scope.popoverData=PopoverService.getData;$scope.dismissClick=function(){$scope.popoverData().options.dismissButton.action()};$scope.confirmClick=function(){$scope.popoverData().options.confirmButton.action()};$scope.popoverSwitch=function(action){PopoverService.hide();setTimeout(function(){action()},300);if(!$rootScope.$$phase){$rootScope.$apply()}};$scope.deleteGalleryItem=function(id){PopoverService.initialise('default',{graphic:{classes:'red',visible:!0},title:'Delete Artwork',description:'Are you sure you want to permanently delete this artwork.',confirmButton:{text:'Delete',action:function(){GalleryService.removeUserImage($rootScope.user,$rootScope.getUser($rootScope.user).token,id);PopoverService.hide()},classes:'red',visible:!0},dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsGalleryItemAdmin=function(id){PopoverService.initialise('default',{description:'Artwork Options',buttonOptions:[{text:'View Profile',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'profile-icon',visible:$rootScope.isAdminUser()||$rootScope.isModeratorUser()},{text:'Manage',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id+"/edit")},classes:'edit-icon',visible:$rootScope.isAdminUser()},{text:'Mark as Banned',action:function(){$scope.popoverSwitch(function(){})},classes:'red ban-icon',visible:$rootScope.isAdminUser()},{text:'Delete',action:function(){$scope.popoverSwitch(function(){$scope.deleteGalleryItem(id)})},classes:'red delete-icon',visible:$rootScope.isAdminUser()},{text:'Back',action:function(){$scope.optionsGalleryItemDesktop(id)},classes:'thin',visible:!($rootScope.isPad()||$rootScope.isMobile())},{text:'Back',action:function(){$scope.optionsGalleryItem(id)},classes:'thin',visible:$rootScope.isPad()||$rootScope.isMobile()}],dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsGalleryItemDesktop=function(id){PopoverService.initialise('default',{description:'Artwork Options',buttonOptions:[{text:'Edit',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id+"/edit")},classes:'',visible:$rootScope.isOwner(id)},{text:'Feature',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'blue',visible:$rootScope.canFeature()},{text:'Share',action:function(){},classes:'',visible:!0},{text:'View Profile',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'',visible:!0},{text:'Mark as Mature',action:function(){PopoverService.hide()},classes:'red mature-icon',visible:$rootScope.isAdminUser()||$rootScope.isModeratorUser()},{text:'More...',action:function(){$scope.optionsGalleryItemAdmin(id)},classes:'thin',visible:$rootScope.isAdminUser()&&!$rootScope.isOwner(id)},{text:'More...',action:function(){$scope.optionsGalleryItemAdmin(id)},classes:'thin',visible:$rootScope.isModeratorUser()&&!$rootScope.isOwner(id)&&!$rootScope.isAdminUser()},{text:'Report',action:function(){$scope.popoverSwitch(function(){})},classes:'red',visible:!($rootScope.isOwner(id)||$rootScope.isAdminUser())&&$rootScope.loggedIn},{text:'Delete',action:function(){$scope.popoverSwitch(function(){$scope.deleteGalleryItem(id)})},classes:'red',visible:$rootScope.isOwner(id)}],dismissButton:{visible:!0}});PopoverService.show()};$scope.optionsGalleryItem=function(id){PopoverService.initialise('default',{description:'Artwork Options',buttonOptions:[{text:'Feature',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'blue',visible:$rootScope.canFeature()},{text:'Edit',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id+"/edit")},classes:'',visible:$rootScope.isOwner(id)},{text:'Share',action:function(){},classes:'',visible:!0},{text:'View Profile',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'',visible:$rootScope.isMobile()},{text:'Mark as Mature',action:function(){PopoverService.hide()},classes:'red mature-icon',visible:$rootScope.isAdminUser()||$rootScope.isModeratorUser()},{text:'More...',action:function(){$scope.optionsGalleryItemAdmin(id)},classes:'thin',visible:$rootScope.isAdminUser()&&!$rootScope.isOwner(id)},{text:'More...',action:function(){$scope.optionsGalleryItemAdmin(id)},classes:'thin',visible:$rootScope.isModeratorUser()&&!$rootScope.isOwner(id)&&!$rootScope.isAdminUser()},{text:'Report',action:function(){$scope.popoverSwitch(function(){})},classes:'red',visible:!($rootScope.isOwner(id)||$rootScope.isModeratorUser())&&$rootScope.loggedIn},{text:'Delete',action:function(){$scope.popoverSwitch(function(){$scope.deleteGalleryItem(id)})},classes:'red',visible:$rootScope.isOwner(id)}],dismissButton:{visible:!0}});PopoverService.show()};$scope.reportGalleryItem=function(id){PopoverService.initialise('default',{title:'Report Artwork',buttonOptions:[{text:'Expand',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id)},classes:'blue',visible:!0},{text:'View Artist',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'blue',visible:!0},{text:'Feature',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'blue',visible:$rootScope.canFeature()},{text:'Delete',action:function(){$scope.popoverSwitch(function(){$scope.deleteGalleryItem(id)})},classes:'red',visible:$rootScope.isAdminUser()||$rootScope.isOwner(id)}],listOptions:[{text:'Expand',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username+"/artwork/"+id)},classes:'blue',visible:!0},{text:'View Artist',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'blue',visible:!0},{text:'Feature',action:function(){PopoverService.hide();$rootScope.redirect("/"+$rootScope.getUser(id,'image').username)},classes:'blue',visible:$rootScope.canFeature()},{text:'Delete',action:function(){$scope.popoverSwitch(function(){$scope.deleteGalleryItem(id)})},classes:'red',visible:$rootScope.isAdminUser()||$rootScope.isOwner(id)}],dismissButton:{visible:!0}});PopoverService.show()}}]);app.controller('productController',['$scope','UserService','MarketService','$location','$routeParams','$rootScope',function($scope,UserService,MarketService,$location,$routeParams,$rootScope){$rootScope.checkAnimatable(!1);$scope.username=$routeParams.username;$scope.productId=$routeParams.productId;MarketService.loadUserProduct($scope.productId);$scope.isOwner=function(){return $rootScope.loggedIn&&$scope.username===$rootScope.getUser($rootScope.user).username};$scope.editMarketItem=function(){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData(jQuery('#market-edit-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);showLoader(!0);$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,success:function(response){var data=JSON.parse(response);showLoader(!1);if(defined(data.success)){alert("Your product has been updated.");MarketService.addOrUpdateProduct(MarketService.generateProductFromProductData(data.productItem));$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}}})}};function shareDialog(url){var winTop=(screen.height/2)-(620/2);var winLeft=(screen.width/2)-(440/2);window.open(url,'sharer','top='+winTop+',left='+winLeft+',toolbar=0,status=0,width='+620+',height='+440)}
$(".facebook.fire").click(function(event){event.stopPropagation();shareDialog('https://www.facebook.com/sharer.php?s=100&p[title]='+$rootScope.getProduct($scope.productId).title+' - '+$rootScope.getUser($scope.productId,'product').fname+' '+$rootScope.getUser($scope.productId,'product').lname+'&p[summary]='+$rootScope.getProduct($scope.productId).description+'&p[url]=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getProduct($scope.productId).id+'/')});$(".twitter.fire").click(function(event){event.stopPropagation();shareDialog('https://twitter.com/intent/tweet?text=@procreate '+$rootScope.getProduct($scope.productId).title+' - '+$rootScope.getUser($scope.productId,'product').fname+' '+$rootScope.getUser($scope.productId,'product').lname+'&url=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getProduct($scope.productId).id+'/&hashtags=procreate')});$(".linkedin.fire").click(function(event){event.stopPropagation();shareDialog('https://www.linkedin.com/shareArticle?mini=true&url=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getProduct($scope.productId).id+'/&title='+$rootScope.getProduct($scope.productId).title+' - '+$rootScope.getUser($scope.productId,'product').fname+' '+$rootScope.getUser($scope.productId,'product').lname+'&summary='+$rootScope.getProduct($scope.productId).description)});$(".pinterest.fire").click(function(event){event.stopPropagation();shareDialog('https://pinterest.com/pin/create/button/?url=http://com-stage.procreate.art/'+$scope.username+'/'+$rootScope.getProduct($scope.productId).id+'/&media='+$rootScope.getProduct($scope.productId).image+'&description='+$rootScope.getProduct($scope.productId).title+' - '+$rootScope.getUser($scope.productId,'product').fname+' '+$rootScope.getUser($scope.productId,'product').lname+'%0A'+$rootScope.getProduct($scope.productId).description)});var clipboard=new Clipboard('.link-copy-fire');clipboard.on('success',function(e){console.info('Action:',e.action);console.info('Text:',e.text);console.info('Trigger:',e.trigger);e.clearSelection()});clipboard.on('error',function(e){console.error('Action:',e.action);console.error('Trigger:',e.trigger)});$("#artwork-link").click(function(){$(this).select()})}]);app.controller('profileController',['$scope','UserService','BetaService','$routeParams','$location','$rootScope',function($scope,UserService,BetaService,$routeParams,$location,$rootScope){$rootScope.checkAnimatable(!1);$scope.redirectOnLoad=!1;$scope.activationCode=$routeParams.activationCode?$routeParams.activationCode:'';$scope.activationStatus=0;$scope.unsubscribeCode=$routeParams.unsubscribeCode?$routeParams.unsubscribeCode:'';$scope.unsubscribeStatus=0;$scope.forgotPassStatus=0;$scope.forgotCode=$routeParams.forgotCode?$routeParams.forgotCode:'';$scope.forgotName=$routeParams.forgotName?$routeParams.forgotName:'';$scope.accountEditted=!1;$scope.profileEditted=!1;$scope.securityEditted=!1;$scope.passwordEditted=!1;$scope.emailEditted=!1;BetaService.loadTypes();if($scope.forgotName!==''&&$scope.forgotCode!==''){$scope.forgotPassStatus=2;var formData=new FormData();formData.append('schema','userForgotCheck');formData.append('forgotCode',$scope.forgotCode);formData.append('forgotName',$scope.forgotName);$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){UserService.save(data.user);$scope.forgotPassStatus=3}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
if(data.errors.type==='timeout'){$scope.forgotPassStatus=10}else{$scope.forgotPassStatus=9}
console.log(errors)}},!1)}
$rootScope.$watch('loggedIn',function(newVal,oldVal){if(newVal&&$scope.activationCode!==''&&$scope.activationStatus===0){var formData=new FormData();formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','userEmailConfirm');formData.append('activationCode',$scope.activationCode);$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){var user={};user.id=$rootScope.user;user.active='1';UserService.addOrUpdateUser(user);if(defined(data.canClaim)&&data.canClaim){$rootScope.canClaim=!0}
$scope.activationStatus=1;if($rootScope.canClaim){$rootScope.welcomeBannerShow=!0}
$location.path('/'+$rootScope.getUser(user.id).username);if(!$scope.$$phase){$scope.$apply()}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
$scope.activationStatus=9;console.log(errors)}},!1)}
if(newVal&&$scope.unsubscribeCode!==''&&$scope.unsubscribeStatus===0){var formData=new FormData();formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','userUnsubscribe');$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){var user={};user.id=$rootScope.user;user.email_announcements='0';UserService.addOrUpdateUser(user);$scope.unsubscribeStatus=1}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
$scope.unsubscribeStatus=9;console.log(errors)}},!1)}else if(newVal){$scope.updateFormField()}else if(oldVal&&!newVal){$location.path('/showcase')}});$scope.showBetaSection=function(){return $rootScope.interestedInBeta(5)};$scope.updateFormField=function(){var user=$rootScope.getUser($rootScope.user);$rootScope.formFields={};for(var property in user){if(user.hasOwnProperty(property)){$rootScope.formFields[property]=user[property]}}
$rootScope.formFields.dobYear=getObjFromArrayByValue($rootScope.years,$rootScope.getYear(user.date_of_birth));$rootScope.formFields.dobMonth=getObjFromArrayByValue($rootScope.months,$rootScope.getMonth(user.date_of_birth));$rootScope.formFields.dobDay=getObjFromArrayByValue($rootScope.days,$rootScope.getDate(user.date_of_birth));$rootScope.formFields.oldPassword='';$rootScope.formFields.password1='';$rootScope.formFields.password2='';$rootScope.formFields.cover='';$rootScope.formFields.avatar=''};if($rootScope.user!==''){$scope.updateFormField()}
$scope.forgotPasswordForm=function(){var formData=new FormData(jQuery('#forgot-form')[0]);$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){$scope.forgotPassStatus=1}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!1)};$scope.resetPasswordForm=function(){var formData=new FormData(jQuery('#reset-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){alert("Your password has been updated");$location.url('/'+$rootScope.getUser($rootScope.user).username);if(!$scope.$$phase){$scope.$apply()}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors);$scope.forgotPassStatus=9}},!1)};var $body=jQuery('body');if(!defined($routeParams.tab)||$routeParams.tab===''){$scope.redirectOnLoad=!0}else{$rootScope.settingsTab=$routeParams.tab}
var avatarDrop=function(){addImageDropListener("#avatarDropZone","#avatarFile","#avatarImage","#module-view","#avatarRGB")};var coverDrop=function(){addImageDropListener("#coverDropZone","#coverFile","#coverImage","#module-view","#coverRGB")};$body.on('avatarDrop',avatarDrop);$body.on('coverDrop',coverDrop);var addImageDropListener=function(dropId,fileId,thumbId,loaderId,rgbId){var dropZone=jQuery(dropId).get(0);var $fileInput=jQuery(fileId);var $thumbObject=jQuery(thumbId);dropZone.ondragover=dropZone.ondragenter=function(e){e.preventDefault()};dropZone.ondrop=function(e){e.preventDefault();addToDebug('file dropped');$thumbObject.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAIAAAADnC86AAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADKGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0OTBBMjVBMUY0QTcxMUU4OTdGNzlGMTZFRDA1MkMwQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0OTBBMjVBMkY0QTcxMUU4OTdGNzlGMTZFRDA1MkMwQyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjQ5MEEyNTlGRjRBNzExRTg5N0Y3OUYxNkVEMDUyQzBDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjQ5MEEyNUEwRjRBNzExRTg5N0Y3OUYxNkVEMDUyQzBDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+7F2c8AAAADJJREFUeNrszQENAAAIAyC1f9hHMIabgwJ0krowdUQsFovFYrFYLBaLxWKxWPwxXgEGADFQAyDbfk31AAAAAElFTkSuQmCC');$thumbObject.css('transform','rotate(0deg)');for(var property in e.dataTransfer){addToDebug(property);addToDebug(e.dataTransfer[property])}
showModuleLoader(loaderId,!0);$fileInput.get(0).files=e.dataTransfer.files;$(dropId).removeClass('hover-active')};$fileInput.off('change').on('change',function(){var _this=this;if(_this.files&&_this.files[0]){var reader=new FileReader();reader.onload=function(e){var img=new Image();img.onload=function(){$thumbObject.attr('src',e.target.result);$rootScope.getOrientation(_this.files[0],function(orientation){switch(orientation){case 3:$thumbObject.css('transform','rotate(180deg)');break;case 6:$thumbObject.css('transform','rotate(90deg)');break;case 8:$thumbObject.css('transform','rotate(-90deg)');break}});var rgb=getAverageColor(img);$(rgbId).val(rgbToHex(rgb.r,rgb.g,rgb.b))};img.src=URL.createObjectURL(_this.files[0]);$thumbObject.src=img.src};reader.readAsDataURL(_this.files[0]);if($thumbObject.attr('id')==="coverImage"){$rootScope.formFields.cover=!0}else{$rootScope.formFields.avatar=!0}}})};$scope.resetAvatar=function(){var $fileInput=$("#avatarFile");var $thumbObject=$("#avatarImage");$fileInput.get(0).value='';$fileInput.get(0).type='';$fileInput.get(0).type='file';$thumbObject.attr('src',$rootScope.getUser($rootScope.user).avatar);$("#avatarRGB").val('');$rootScope.formFields.avatar=!1};$scope.resetCover=function(){var $fileInput=jQuery("#coverFile");var $thumbObject=jQuery("#coverImage");$fileInput.get(0).value='';$fileInput.get(0).type='';$fileInput.get(0).type='file';$thumbObject.attr('src',$rootScope.getUser($rootScope.user).cover);$("#coverRGB").val('');$rootScope.formFields.cover=!1};$rootScope.$watch('formFields',function(newVal){var user=$rootScope.getUser($rootScope.user);$scope.accountEditted=!1;$scope.profileEditted=!1;$scope.securityEditted=!1;$scope.passwordEditted=!1;$scope.emailEditted=!1;if(newVal.email!==user.email){$scope.accountEditted=!0}
if(newVal.fname!==user.fname){$scope.accountEditted=!0}
if(newVal.lname!==user.lname){$scope.accountEditted=!0}
if(newVal.location!==user.location){$scope.accountEditted=!0}
if(defined(newVal.dobYear)&&newVal.dobYear.value!==getObjFromArrayByValue($rootScope.years,$rootScope.getYear(user.date_of_birth)).value){$scope.accountEditted=!0}
if(defined(newVal.dobMonth)&&newVal.dobMonth.value!==getObjFromArrayByValue($rootScope.onths,$rootScope.getMonth(user.date_of_birth)).value){$scope.accountEditted=!0}
if(defined(newVal.dobDay)&&newVal.dobDay.value!==getObjFromArrayByValue($rootScope.editDays,$rootScope.getDate(user.date_of_birth)).value){$scope.accountEditted=!0}
if(newVal.alias!==user.alias){$scope.profileEditted=!0}
if(newVal.job_title!==user.job_title){$scope.profileEditted=!0}
if(newVal.avatar){$scope.profileEditted=!0}
if(newVal.cover){$scope.profileEditted=!0}
if(newVal.mature!==user.mature){$scope.securityEditted=!0}
if(newVal.notification_alerts!==user.notification_alerts){$scope.securityEditted=!0}
if(newVal.location_public!==user.location_public){$scope.securityEditted=!0}
if(newVal.email_announcements!==user.email_announcements){$scope.emailEditted=!0}
if(newVal.oldPassword!==''){$scope.passwordEditted=!0}
if(newVal.password1!==''){$scope.passwordEditted=!0}
if(newVal.password2!==''){$scope.passwordEditted=!0}},!0);$scope.processUpdateForm=function(segment){var formData=new FormData($('#update-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);if($rootScope.formFields.avatar){formData.append('avatar',$('#avatarFile')[0].files[0])}
if($rootScope.formFields.cover){formData.append('cover',$('#coverFile')[0].files[0])}
var year=document.getElementById('dob_year').value;var month=document.getElementById('dob_month').value;var day=document.getElementById('dob_day').value;var invalidDate=!1;var isAccount=!0;var segmentInUse='';if(defined(segment)&&segment){segmentInUse=segment;formData.append('segment',segmentInUse);isAccount=segmentInUse==='account'}
switch(day){case "31":switch(month){case "02":case "04":case "06":case "09":case "11":invalidDate=!0;break}
break;case "30":if(month==="02"){invalidDate=!0}
break;case "29":if(month==="02"&&(year==="2000"||year==="1900"||year%4!==0)){invalidDate=!0}
break}
if(isAccount&&$('#location').val()===$rootScope.formFields.location){formData.append('country',$rootScope.formFields.country);formData.append('country-code',$rootScope.formFields.country_code);formData.append('state',$rootScope.formFields.state);formData.append('state-code',$rootScope.formFields.state_code);formData.append('city',$rootScope.formFields.city)}
if(!invalidDate||!isAccount){formData.append('dob',year+'-'+month+'-'+day);$rootScope.ajaxQuery(formData,function(data){if(typeof data.success!=='undefined'){UserService.save(data.user);$scope.updateFormField();$scope.$apply();alert("Your details have been updated.")}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)}else{alert("Invalid Date of Birth")}};var rgbToHex=function(r,g,b){return"#"+r.toString(16)+g.toString(16)+b.toString(16)}}]);app.controller('registerController',['$scope','$http','$rootScope','$location','$routeParams','UserService',function($scope,$http,$rootScope,$location,$routeParams,UserService){var $body=jQuery('body');$scope.formData={};$scope.themeColour='#cce5ff';$scope.submitting=!1;$scope.validationTimeout=500;$scope.toggleable=[];$scope.emailError=!1;$scope.usernameError=!1;$scope.locationVisible='';$scope.beta=$routeParams.beta;$rootScope.$watch('loggedIn',function(newVal){if(newVal&&!$scope.submitting){$location.path('/showcase')}});$rootScope.registerFields.location_public='1';$rootScope.registerFields.alias='';$scope.addError=function(parent,elm,message){$('#'+parent).addClass('is-error');$('#'+elm+'-error').html(message)};$scope.removeError=function(parent,elm){$('#'+parent).removeClass('is-error');$('#'+elm+'-error').html("")};$scope.setLocationVisible=function(){$scope.locationVisible=$('#locationVisible').val()};$scope.performValidation=function(){var error=!1;var $email=$('#email');var $username=$('#username');var $firstname=$('#firstname');var $lastname=$('#lastname');var $year=$('#dob_year');var $month=$('#dob_month');var $day=$('#dob_day');var $location=$('#location');var $locationVisible=$('#locationVisible');var $password=$('#password');var $passwordConf=$('#password2');var $tandc=$('#terms');if($scope.emailError){error=!0}else if(!is_valid_email($email.val())){$scope.addError('email-field','email',"That email address is invalid");error=!0}else{$scope.removeError('email-field','email')}
if($scope.usernameError){error=!0}else if($username.val().length<siteDefaults.users.username.min_length){$scope.addError('username-field','username',"Usernames must be at least "+siteDefaults.users.username.min_length+" characters.");error=!0}else if(/[^a-zA-Z0-9\-_]/.test($username.val())){$scope.addError('username-field','username',"Usernames can only contain alphanumeric characters, hyphens and underscores.");error=!0}else{$scope.removeError('username-field','username')}
if($firstname.val().length<siteDefaults.users.first_name.min_length){$scope.addError('firstname-field','firstname',"First names must be at least "+siteDefaults.users.first_name.min_length+" characters.");error=!0}else if(/[^a-zA-Z0-9\-.'\s]/.test($firstname.val())){$scope.addError('firstname-field','firstname',"First names can only contain alphanumeric characters, spaces, periods, hyphens and apostrophes.");error=!0}else{$scope.removeError('firstname-field','firstname')}
if($lastname.val().length<siteDefaults.users.last_name.min_length){$scope.addError('lastname-field','lastname',"Last names must be at least "+siteDefaults.users.last_name.min_length+" characters.");error=!0}else if(/[^a-zA-Z0-9\-.'\s]/.test($lastname.val())){$scope.addError('lastname-field','lastname',"Last names can only contain alphanumeric characters, spaces, periods, hyphens and apostrophes.");error=!0}else{$scope.removeError('lastname-field','lastname')}
if($location.val()===''){$scope.addError('location-field','location',"You must enter a location");error=!0}else{if($locationVisible.val()!=='0'&&$locationVisible.val()!=='1'){$scope.addError('location-field','location',"You must select a location visibility");error=!0}else{$scope.removeError('location-field','location')}}
if($password.val()===''){$scope.addError('password-field','password',"You must enter a password");error=!0}else if($password.val().length<siteDefaults.users.password.min_length){$scope.addError('password-field','password',"Passwords must be at least "+siteDefaults.users.password.min_length+" characters.");error=!0}else if($password.val()!==$passwordConf.val()){$scope.addError('password-field','password',"Your passwords don't match");error=!0}else{$scope.removeError('password-field','password')}
var invalidDate=!1;switch($day.val()){case "31":switch($month.val()){case "02":case "04":case "06":case "09":case "11":invalidDate=!0;break}
break;case "30":if($month.val()==="02"){invalidDate=!0}
break;case "29":if($month.val()==="02"&&($year.val()==="2000"||$year.val()==="1900"||$year.val()%4!==0)){invalidDate=!0}
break}
if(invalidDate){$scope.addError('date-field','date',"Please select a valid date of birth");error=!0}else if($year.val()===null||$month.val()===null||$day.val()===null){$scope.addError('date-field','date',"Please select a date of birth");error=!0}else if(userUnder13($year.val(),$month.val(),$day.val())){$scope.addError('date-field','date',"You must be 13 or older to register.");error=!0}else{$scope.removeError('date-field','date')}
if(!$tandc.is(':checked')){$scope.addError('terms-field','terms','You must accept the Terms & Conditions to register.');error=!0}else{$scope.removeError('terms-field','terms')}
if(!error){setTimeout(function(){$scope.toggleable['alias-tip']=!0;$scope.$apply()},20000);$rootScope.registerFields.location=$('#location').val()}
return!error};$scope.performPhaseTwoValidation=function(){$scope.toggleable['alias-tip']=!0;var error=!1;var $avatar=$('#avatarFile');var $cover=$('#coverFile');var $alias=$('#alias');if(!$avatar.val().length){$scope.addError('avatar-field','avatar',"An avatar is required");error=!0}else{$scope.removeError('avatar-field','avatar')}
if($alias.val().length<siteDefaults.users.alias.min_length){$scope.addError('alias-field','alias',"Alias must be at least "+siteDefaults.users.alias.min_length+" characters.");error=!0}else if(/[^a-zA-Z0-9\-.'\s]/.test($alias.val())){$scope.addError('alias-field','alias',"Alias can only contain alphanumeric characters, spaces, periods, hyphens and apostrophes.");error=!0}else{$scope.removeError('alias-field','alias')}
return!error};function userUnder13(year,month,day){var today=new Date();var age=today.getFullYear()-year;if(today.getMonth()<(month-1)||(today.getMonth()===(month-1)&&today.getDate()<parseInt(day))){age --}
return age<13}
function is_valid_email(email){return/^.+@.+\..+$/.test(email)}
$('#username').on('change',function(){clearTimeout(usernameValidationTimeout);if($('#username').val()!==''){usernameValidationTimeout=setTimeout(function(){var formData=new FormData();formData.append('schema','userUsernameValidate');formData.append('username',$('#username').val());$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){$scope.removeError('username-field','username');$scope.usernameError=!1}else{$scope.addError('username-field','username',"That username has already been taken");$scope.usernameError=!0}},!1);usernameValidationTimeout=!1},$scope.validationTimeout)}else{$scope.removeError('username-field','username');$scope.usernameError=!1}});$('#email').on('change',function(){clearTimeout(emailValidationTimeout);if($('#email').val()!==''){emailValidationTimeout=setTimeout(function(){var formData=new FormData();formData.append('schema','userEmailValidate');formData.append('email',$('#email').val());$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){$scope.removeError('email-field','email');$scope.emailError=!1}else{$scope.addError('email-field','email',"That email address is already in use");$scope.emailError=!0}},!1);emailValidationTimeout=!1},$scope.validationTimeout)}else{$scope.removeError('email-field','email');$scope.emailError=!1}});$scope.toggleAliasEdit=function(){$scope.toggleable.edit_alias=!$scope.toggleable.edit_alias;setTimeout(function(){$('#alias').focus()},50)};$scope.toggleTitleEdit=function(){$scope.toggleable.edit_job_title=!$scope.toggleable.edit_job_title;setTimeout(function(){$('#jobTitle').focus()},50)};$scope.next=function(){if($scope.performValidation()){$scope.toggleable['step-2']=!$scope.toggleable['step-2']}};$scope.register=function(){if($scope.performValidation()&&$scope.performPhaseTwoValidation()){var formData=new FormData($('#register-form')[0]);if(defined($('#coverFile')[0].files[0])){formData.append('cover',$('#coverFile')[0].files[0])}
formData.append('dob',$('#dob_year').val()+'-'+$('#dob_month').val()+'-'+$('#dob_day').val());$scope.submitting=!0;$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){UserService.save(data.user);if(defined($scope.beta)){$location.path('/ipad/beta')}else{$location.path('/'+data.user.username)}
if(!$scope.$$phase){$scope.$apply()}}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}
$scope.submitting=!1},!0)}};var avatarDrop=function(){addImageDropListener("#avatarDropZone","#avatarFile","#avatarImage","#module-view","#avatarRGB",avatarFileChange)};var coverDrop=function(){addImageDropListener("#coverDropZone","#coverFile",!1,"#module-view","#coverRGB",coverFileChange)};var addImageDropListener=function(dropId,fileId,thumbId,loaderId,rgbId,changeCallback){var dropZone=$(dropId);var $fileInput=$(fileId);dropZone.get(0).ondragover=dropZone.get(0).ondragenter=function(e){$(this).addClass('hover-active');e.preventDefault()};dropZone.get(0).ondragleave=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.get(0).ondrop=function(e){$(this).removeClass('hover-active');e.preventDefault();for(var property in e.dataTransfer){addToDebug(property);addToDebug(e.dataTransfer[property])}
showModuleLoader(loaderId,!0);$fileInput.get(0).files=e.dataTransfer.files;dropZone.removeClass('hover-active')};$fileInput.off('change').on('change',function(){var _this=this;if(_this.files&&_this.files[0]){var reader=new FileReader();reader.onload=function(e){var img=new Image();img.onload=function(){changeCallback(dropZone,thumbId,e,img,rgbId)};img.src=URL.createObjectURL(_this.files[0])};reader.readAsDataURL(_this.files[0])}})};$scope.resetAvatar=function(){var $fileInput=$("#avatarFile");var $thumbObject=$("#avatarImage");$fileInput.get(0).value='';$fileInput.get(0).type='';$fileInput.get(0).type='file';$thumbObject.attr('src','https://assets.procreate.art/community/default/default-avatar.jpg');$('#avatarDropZone').removeClass('user-image');$("#avatarRGB").val('');$rootScope.registerFields.avatar=!1};$scope.resetCover=function(){var $fileInput=jQuery("#coverFile");$fileInput.get(0).value='';$fileInput.get(0).type='';$fileInput.get(0).type='file';$('#coverDropZone').css('background-image','').removeClass('user-image');$("#coverRGB").val('');$rootScope.registerFields.cover=!1};var avatarFileChange=function(dropZone,thumbId,e,img,rgbId){if(img.width<300||img.height<300){alert("Avatar images must be uploaded in JPEG, GIF, or PNG format. Minimum size requirements are 300px x 300px (recommended size: 600px x 600 px).");$scope.resetAvatar()}else{$(thumbId).attr('src',e.target.result);var rgb=getAverageColor(img);$(rgbId).val(rgbToHex(rgb.r,rgb.g,rgb.b));if(!dropZone.hasClass('user-image')){dropZone.addClass('user-image')}
if(!$("#coverRGB").val()){$('#coverDropZone').css('background-color',rgbToHex(rgb.r,rgb.g,rgb.b)).addClass('user-image')}}};var coverFileChange=function(dropZone,thumbId,e,img,rgbId){if(img.width<1262||img.height<316||img.width/img.height>4){alert("Cover images must be uploaded in JPEG, GIF, or PNG format. Minimum size requirements are 1262px x 316px (recommended size: 2524px x 632 px). The image width cannot exceed a 4:1 ratio.");$scope.resetCover();if($("#avatarRGB").val()){$('#coverDropZone').css('background-color',$("#avatarRGB").val())}}else{dropZone.css('background-image','url('+e.target.result+')');var rgb=getAverageColor(img);$(rgbId).val(rgbToHex(rgb.r,rgb.g,rgb.b));if(!dropZone.hasClass('user-image')){dropZone.addClass('user-image')}
$('#coverDropZone').css('background-color',rgbToHex(rgb.r,rgb.g,rgb.b))}};$body.on('avatarDrop',avatarDrop);$body.on('coverDrop',coverDrop);var rgbToHex=function(r,g,b){return"#"+r.toString(16)+g.toString(16)+b.toString(16)};var getAverageColor=function(img){var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var width=canvas.width=img.naturalWidth;var height=canvas.height=img.naturalHeight;ctx.drawImage(img,0,0);var imageData=ctx.getImageData(0,0,width,height);var data=imageData.data;var r=0;var g=0;var b=0;for(var i=0,l=data.length;i<l;i+=4){r+=data[i];g+=data[i+1];b+=data[i+2]}
r=Math.floor(r/(data.length/4));g=Math.floor(g/(data.length/4));b=Math.floor(b/(data.length/4));return{r:r,g:g,b:b}}}]);app.controller('searchController',['$http','$scope','$routeParams','$rootScope','SearchService','UserService',function($http,$scope,$routeParams,$rootScope,SearchService,UserService){$scope.term=defined($routeParams.term)?$routeParams.term:'';$scope.filter=defined($routeParams.filter)?$routeParams.filter:'';$scope.sort=defined($routeParams.sort)?$routeParams.sort:'';$scope.searchTab=defined($routeParams.tab)?$routeParams.tab:'global';$scope.searchPerformed=!1;$scope.finishedLoading=!1;$scope.lazyLoading=!1;$scope.offset=0;$scope.limit=30;if(defined($scope.term)&&$scope.term!==''){$scope.lazyLoading=!0;$scope.finishedLoading=!1;$scope.offset=0;SearchService.clearResults();SearchService.loadResults($scope,!0)}
$scope.toggleTab=function(value){if($scope.searchTab!==value){$rootScope.redirect('/search/'+$scope.term+'?tab='+value)}}}]);app.controller('sliderController',['$scope','SliderService',function($scope,SliderService){$scope.sliderData=SliderService.getData;$scope.close=function(){$scope.sliderData().closeCallback()}}]);app.controller('userController',['$scope','UserService','GalleryService','MarketService','UtilityService','IsotopeService','DiscussionService','$location','$routeParams','$rootScope',function($scope,UserService,GalleryService,MarketService,UtilityService,IsotopeService,DiscussionService,$location,$routeParams,$rootScope){$rootScope.checkAnimatable(!1);$rootScope.applyFooter(!1);$scope.username=$routeParams.username.toLowerCase();$scope.userId='';$scope.storePos=0;$scope.inspirationPos=0;$scope.discussionPos=0;$scope.galleryPos=0;$scope.baseCount=40;$scope.isCurrentUser=!1;$scope.galleryItemUploads=[];$scope.marketItemUploads=[];$rootScope.userDiscussionThreads=[];$scope.redirectOnLoad=!1;$rootScope.galleryFinishedLoading=!1;$scope.prepend=!1;$scope.submitting=!1;$rootScope.adminBucketAvailable=!1;$scope.uploadPercent=0;if(!defined($routeParams.tab)||$routeParams.tab===''){$scope.redirectOnLoad=!0}else{$rootScope.userTab=$routeParams.tab}
GalleryService.loadProfile($scope.username,$scope);window.addEventListener('scroll',function(event){if($('#profile-nav').length){var profileNavHeight=$("#profile-nav").height();var profileContentPos=$(".profile-content").offset();var st=$(this).scrollTop();if(st>=profileContentPos.top-profileNavHeight){if(st>=($rootScope.lastScrollTop)){$rootScope.sectionNavClass=''}else{if(st===0||st<0){$rootScope.sectionNavClass=''}else{$rootScope.sectionNavClass='fixed-section-nav'}}}else{$rootScope.sectionNavClass=''}
$rootScope.lastScrollTop=st;$rootScope.$apply()}});$rootScope.$watch('userTab',function(newVal,oldVal,scope){$rootScope.galleryFinishedLoading=!1;$rootScope.userDiscussionThreads=[];$scope.discussionPos=0;switch(newVal){case "portfolio":GalleryService.loadProfileGallery($scope.username,$scope,function(){$rootScope.galleryLazyLoading=!1;$(window).unbind('scroll').bind('scroll',function(){if($rootScope.galleryLazyLoading||$rootScope.galleryFinishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){$rootScope.galleryLazyLoading=!0;$scope.galleryPos+=$scope.baseCount;GalleryService.loadProfileGallery($scope.username,$scope,function(){$rootScope.galleryLazyLoading=!1},function(){$rootScope.galleryLazyLoading=!1})}})},function(){$rootScope.galleryLazyLoading=!1});break;case "inspiration":GalleryService.loadInspiration($scope.username,$scope.inspirationPos,$scope.baseCount,function(){$rootScope.galleryLazyLoading=!1;$(window).unbind('scroll').bind('scroll',function(){if($rootScope.galleryLazyLoading||$rootScope.galleryFinishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){$rootScope.galleryLazyLoading=!0;$scope.inspirationPos+=$scope.baseCount;GalleryService.loadInspiration($scope.username,$scope.inspirationPos,$scope.baseCount,function(){$rootScope.galleryLazyLoading=!1},function(){$rootScope.galleryLazyLoading=!1})}})},function(){$rootScope.galleryLazyLoading=!1});break;case "discussions":DiscussionService.loadProfileDiscussions($scope.username,$scope.discussionPos,$scope.baseCount,function(){$rootScope.galleryLazyLoading=!1;$(window).unbind('scroll').bind('scroll',function(){if($rootScope.galleryLazyLoading||$rootScope.galleryFinishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){$rootScope.galleryLazyLoading=!0;$scope.discussionPos+=$scope.baseCount;DiscussionService.loadProfileDiscussions($scope.username,$scope.discussionPos,$scope.baseCount,function(){$rootScope.galleryLazyLoading=!1},function(){$rootScope.galleryLazyLoading=!1})}})},function(){$rootScope.galleryLazyLoading=!1});break}},!0);$scope.$watch(function(){return $rootScope.getUser($scope.userId).gallery},function(newVal,oldVal,scope){IsotopeService.synchroniseGroup(newVal,'#userGallery','image','user',$rootScope.getUser($scope.userId).id,$scope)},!0);$scope.$watch(function(){return $rootScope.getUser($scope.userId).inspiration},function(newVal,oldVal,scope){IsotopeService.synchroniseGroup(newVal,'#inspirationGallery','inspiration','user',$rootScope.getUser($scope.userId).id,$scope)},!0);$('body').off("domLoadComplete").on("domLoadComplete",function(){switch($rootScope.userTab){case "portfolio":IsotopeService.synchroniseGroup($rootScope.getUser($scope.userId).gallery,'#userGallery','image','user',$rootScope.getUser($scope.userId).id,$scope);break;case "inspiration":IsotopeService.synchroniseGroup($rootScope.getUser($scope.userId).inspiration,'#inspirationGallery','inspiration','user',$rootScope.getUser($scope.userId).id,$scope);break}});$scope.loadTab=function(tab){$rootScope.userTab=tab;$location.path('/'+$rootScope.getUser($scope.userId).username+'/'+$rootScope.userTab,!1)};$rootScope.$watch('loggedIn',function(newVal){if(newVal){if($rootScope.getUser($rootScope.user).username===$scope.username.toLowerCase()){$scope.isCurrentUser=!0}}else if(!newVal){$scope.isCurrentUser=!1}});$scope.uploadMarketItem=function(uploads,resetCallback){if($rootScope.checkCanPerform(!0,!0)){var formData=new FormData(jQuery('#marketDropZone').find('form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','marketCreate');formData.append('marketItemCount',uploads.length);for(var i=0;i<uploads.length;i ++){switch(uploads[i].type){case "image":case 'brush':case 'swatches':case 'template':formData.append('marketItemCount'+i,1);formData.append('marketItem'+i,uploads[i].file);break;case 'set':case 'bundle':formData.append('marketItemCount'+i,uploads[i].files.length);for(var j=0;j<uploads[i].files.length;j ++){if(typeof uploads[i].files[j].files!=='undefined'){formData.append('marketItemCount'+i+'-'+j,uploads[i].files[j].files.length);for(var k=0;k<uploads[i].files[j].files.length;k ++){formData.append('marketItem'+i+'-'+j+'-'+k,uploads[i].files[j].files[k].file)}}else{formData.append('marketItemCount'+i+'-'+j,1);formData.append('marketItem'+i+'-'+j,uploads[i].files[j].file)}}
break}}
jQuery('#module-view').toggleClass('active');$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){jQuery('.upload-bar').css('width','0%')},xhr:showProgress,success:function(response){var data=JSON.parse(response);jQuery('.upload-bar').css('width','100%');jQuery('#module-view').toggleClass('active');console.log(data);if(defined(data.success)){resetCallback();data.marketItems.forEach(function(marketItem){MarketService.addOrUpdateProduct(MarketService.generateProductFromProductData(marketItem));UserService.addProductToUser(marketItem.id,$rootScope.user,!0)});$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
console.log(errors)}}})}};$scope.uploadGalleryItem=function(uploads,resetCallback){if($rootScope.checkCanPerform(!0,!0)){if($scope.submitting){alert("Please wait for your current submission to complete.")}else{var formData=new FormData(jQuery('#galleryDropZone').find('form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','gallerySave');for(var i=0;i<uploads.length;i++){formData.append('galleryItem'+i,uploads[i].file)}
$scope.submitting=!0;$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadPercent=1},xhr:showProgress,success:function(response){var data=JSON.parse(response);if(defined(data.success)){resetCallback();data.galleryItems.forEach(function(galleryItem){$scope.prepend=!0;GalleryService.addOrUpdateImage(GalleryService.generateImageFromImageData(galleryItem));UserService.addImageToUser(galleryItem.id,$rootScope.user,!0)})}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}
$scope.uploadPercent=0;$scope.submitting=!1;if(!$scope.$$phase){$scope.$apply()}}})}}};var showProgress=function(){var xhr=$.ajaxSettings.xhr();var percentageComplete=1;xhr.upload.onprogress=function(evt){percentageComplete=Math.round(evt.loaded/evt.total*100);if(percentageComplete===99){percentageComplete=percentageComplete+1}
$scope.uploadPercent=percentageComplete};return xhr}}]);app.controller('handbookController',['$scope','HandbookService','UserService','ModalService','$rootScope','$routeParams','$location','$sce',function($scope,HandbookService,UserService,ModalService,$rootScope,$routeParams,$location,$sce){$rootScope.checkAnimatable(!1);$scope.toggleable=[];$scope.handbookArticleFields={};$scope.articleId=$routeParams.id;$scope.articleUrl=$routeParams.articleUrl;$rootScope.adminBucketAvailable=!0;$scope.canvasOptions={percentageValue:50,success:!1};switch($routeParams.page){case 'handbook':HandbookService.loadArticles();break}
$scope.goBack=function(){window.history.back()};$scope.processHandbookArticleForm=function(reference){var formData=new FormData(jQuery(reference)[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('content',$('#content').html());$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){HandbookService.addOrUpdateArticle(data.handbookArticle);$location.path('/admin/handbook/articles');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)};$scope.getSafeDomain=function(url){return url.replace("https://images.procreate.art","/imageBucket")};$scope.parseHandbookContent=function(content){var mediaRegexp=/\[media src="([^"]+)"\]([^\[]*)\[\/media\]/g;var mediaResults=[];var mediaMatch=mediaRegexp.exec(content);var newsRegexp=/\[handbookImage type="([^"]+)" src="([^"]+)" rgb="([^"]*)" src2="([^"]*)" rgb2="([^"]*)"\]([^\[]*)\[\/handbookImage\]/g;var newsResults=[];var newsMatch=newsRegexp.exec(content);var videoRegexp=/\[video src="([^"]+)"\]([^\[]*)\[\/video\]/g;var videoResults=[];var videoMatch=videoRegexp.exec(content);var reviewRegexp=/\[review user="([^"]+)" date="([^"]+)" rating="([^"]*)" title="([^"]*)"\]([^\[]*)\[\/review\]/g;var reviewResults=[];var reviewMatch=reviewRegexp.exec(content);var quoteRegexp=/\[quote name="([^"]+)" date="([^"]+)" link="([^"]+)"\]([^\[]*)\[\/quote\]/g;var quoteResults=[];var quoteMatch=quoteRegexp.exec(content);var result,i,src,origTitle,title,video;while(mediaMatch!==null){result=[];for(i=1;i<mediaMatch.length;i ++){result.push(mediaMatch[i])}
mediaResults.push(result);mediaMatch=mediaRegexp.exec(content)}
while(videoMatch!==null){result=[];for(i=1;i<videoMatch.length;i ++){result.push(videoMatch[i])}
videoResults.push(result);videoMatch=videoRegexp.exec(content)}
while(newsMatch!==null){result=[];for(i=1;i<newsMatch.length;i ++){result.push(newsMatch[i])}
newsResults.push(result);newsMatch=newsRegexp.exec(content)}
while(reviewMatch!==null){result=[];for(i=1;i<reviewMatch.length;i ++){result.push(reviewMatch[i])}
reviewResults.push(result);reviewMatch=reviewRegexp.exec(content)}
while(quoteMatch!==null){result=[];for(i=1;i<quoteMatch.length;i ++){result.push(quoteMatch[i])}
quoteResults.push(result);quoteMatch=quoteRegexp.exec(content)}
for(i=0;i<mediaResults.length;i ++){src=mediaResults[i][0];origTitle=typeof mediaResults[i][1]!=='undefined'?mediaResults[i][1]:'';title=origTitle!==''?origTitle:src;video=createVideo(src);if(src.match(/\.(jpg|jpeg|gif|png)$/)!==null||src.match(/^((http[s]?):\/)?\/?(forums\.procreate\.art\/index\.php\?action=dlattach;)+(.)*(;image)+?$/)!==null){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<div class="embed-image"><div class="container"><img src="'+src+'" title="'+title+'" /></div></div>')}else if(video!==!1){content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]',video)}else{content=content.replace('[media src="'+src+'"]'+origTitle+'[/media]','<a target="_blank" href="'+src+'">'+title+'</a>')}}
for(i=0;i<videoResults.length;i ++){src=videoResults[i][0];origTitle=typeof videoResults[i][1]!=='undefined'?videoResults[i][1]:'';title=origTitle!==''?origTitle:'';video=createNewsVideo(src,title);if(video!==!1){content=content.replace('[video src="'+src+'"]'+origTitle+'[/video]',video)}}
for(i=0;i<newsResults.length;i ++){var type=newsResults[i][0];var src2=newsResults[i][3];var rgb=newsResults[i][2];var rgb2=newsResults[i][4];src=newsResults[i][1];title=typeof newsResults[i][5]!=='undefined'?newsResults[i][5]:'';var old='[handbookImage type="'+type+'" src="'+src+'" rgb="'+rgb+'" src2="'+src2+'" rgb2="'+rgb2+'"]'+title+'[/handbookImage]';switch(type){case '1':content=content.replace(old,'<figure class="generic-image"><img src="'+src+'" alt="'+title+'" style="color: '+rgb+';" /><figcaption>'+title+'</figcaption></figure>');break;case '2':content=content.replace(old,'<figure class="ipad-landscape"><img src="'+src+'" alt="'+title+'" style="color: '+rgb+';" /><figcaption>'+title+'</figcaption></figure>');break;case '3':content=content.replace(old,'<figure class="iphone-landscape"><img src="'+src+'" alt="'+title+'" style="color: '+rgb+';" /><figcaption>'+title+'</figcaption></figure>');break;case '4':content=content.replace(old,'<figure class="iphone-portrait-dual"><div class="split"><img src="'+src+'" title="'+title+'" style="color: '+rgb+';" /><img src="'+src2+'" title="'+title+'" style="color: '+rgb2+';" /></div><figcaption>'+title+'</figcaption></figure>');break}}
for(i=0;i<reviewResults.length;i ++){var reviewUser=reviewResults[i][0];var reviewDate=reviewResults[i][1];var reviewRating=reviewResults[i][2];var reviewTitle=reviewResults[i][3];var reviewText=typeof reviewResults[i][4]!=='undefined'?reviewResults[i][4]:'';var oldReview='[review user="'+reviewUser+'" date="'+reviewDate+'" rating="'+reviewRating+'" title="'+reviewTitle+'"]'+reviewText+'[/review]';content=content.replace(oldReview,'<div class="review"><div class="review-left"><div class="title">'+reviewTitle+'</div><div class="rating type-'+reviewRating+'-star"></div></div><div class="review-right"><div class="date">'+reviewDate+'</div><div class="user">'+reviewUser+'</div></div><div class="review-content">'+reviewText+'</div></div>')}
for(i=0;i<quoteResults.length;i ++){var quoteName=quoteResults[i][0];var quoteDate=quoteResults[i][1];var quoteLink=quoteResults[i][2];var quoteText=typeof quoteResults[i][3]!=='undefined'?quoteResults[i][3]:'';var oldQuote='[quote name="'+quoteName+'" date="'+quoteDate+'" link="'+quoteLink+'"]'+quoteText+'[/quote]';if(quoteLink.length===''){content=content.replace(oldQuote,'<blockquote class="article-quote"><p>'+$scope.parseArticleTitle(quoteText)+'</p><footer class="quote-info"><cite>'+quoteName+'<span class="quote-date">'+quoteDate+'</span></cite></footer></blockquote>')}else{content=content.replace(oldQuote,'<blockquote class="article-quote"><p>'+$scope.parseArticleTitle(quoteText)+'</p><footer class="quote-info"><a target="_blank" href="'+quoteLink+'" title="'+quoteName+'"><cite>'+quoteName+'<span class="quote-date">'+quoteDate+'</span></cite></a></footer></blockquote>')}}
return $sce.trustAsHtml(content)}}]);app.controller('instagramController',['$scope','InstagramService','$rootScope','$routeParams','$location',function($scope,InstagramService,$rootScope,$routeParams,$location){$rootScope.applyFooter(!1);$rootScope.checkAnimatable(!1);$rootScope.adminBucketAvailable=!1;$rootScope.bodyClass='inverse';$scope.toggleable=[];$scope.instagramArticleFields={};$scope.articleId=$routeParams.id;if(defined($routeParams.tab)&&$routeParams.tab!==''){$rootScope.instagramTab=$routeParams.tab}
$scope.switchTabSection=function(newTab){switch(newTab){case 'explore':$rootScope.instagramTab='explore';break;case 'learn':$rootScope.instagramTab='learn';break;default:$rootScope.instagramTab='links';break}};switch($routeParams.page){case 'handbook':InstagramService.loadArticles();break}
$scope.goBack=function(){window.history.back()};$scope.processInstagramArticleForm=function(reference){var formData=new FormData(jQuery(reference)[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){InstagramService.addOrUpdateArticle(data.instagramArticle);$location.path('/admin/instagram/articles');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)}}]);app.controller('prizeController',['$scope','$rootScope','$window','$routeParams','$location','PrizeService','IsotopeService','PopoverService',function($scope,$rootScope,$window,$routeParams,$location,PrizeService,IsotopeService,PopoverService){$rootScope.checkAnimatable(!1);$rootScope.applyFooter(!1);$('html').css('scroll-behavior','smooth');var artPrizeScroll=!1;$rootScope.$watch(function(){return $rootScope.isMobile()},function(newVal){if(newVal){if(artPrizeScroll){artPrizeScroll.off('scrollStart');artPrizeScroll.destroy();artPrizeScroll=!1}}else{if($('#scroller').length){if(!$rootScope.isPad()){$('#swipe-arrow-artprize').hide()}else{$('#swipe-arrow-artprize').show()}
artPrizeScroll=new IScroll('#scroller',{scrollX:!0,scrollY:!1,mouseWheel:!0,disableMouse:!0,disablePointer:!0,tap:!0,tapFunction:function(e){if($rootScope.isPad()){if($(e.target).parent('.checkbox-toggle').length){$(e.target).parent('.checkbox-toggle').trigger('click')}
if($(e.target).is('a')&&$(e.target).attr('href')==='mailto:support@procreate.art'){window.location.href="mailto:support@procreate.art"}
if($(e.target).is('a')&&$(e.target).attr('href')==='/prize/terms-conditions'){$window.open('/prize/terms-conditions','_blank')}
if($(e.target).is('p')&&$(e.target).find('a').attr('href')==='/prize/terms-conditions'){$window.open('/prize/terms-conditions','_blank')}
if($(e.target).attr('data-ng-click')==="toggleLogin()"||$(e.target).attr('data-ng-click')==="removeSubmission()"||$(e.target).attr('data-ng-click')==="redirect('/register?type=prize')"){$(e.target).trigger('click')}}}});artPrizeScroll.on('scrollStart',function(){$('#swipe-arrow-artprize').fadeOut(400)})}}},!0);$scope.uploads=[];$scope.maxUploadCount=1;$scope.competitionAvailable=!1;$scope.submitting=!1;$scope.uploadPercent=0;$scope.compId=defined($routeParams.competition)?$routeParams.competition:'';$scope.process=defined($routeParams.process)?$routeParams.process:'';$scope.baseCount=siteDefaults.gallery.loadCount;$scope.pageCount=siteDefaults.gallery.pageCount;$scope.pos=0;$scope.page=defined($routeParams.pagepos)?$routeParams.pagepos:1;$scope.$watch(function(){return $rootScope.competitions().competitions},function(newVal){$scope.competitionAvailable=!$.isEmptyObject(newVal)},!0);$rootScope.$watch('loggedIn',function(newVal){if(newVal&&$scope.competitionAvailable){PrizeService.loadCompetitionEntry($scope.currentCompetition().id,function(){if($scope.getStatus($scope.currentCompetition())==='submission'){addDropListener()}})}},!0);PrizeService.loadCompetitions($scope.compId,function(){if($scope.compId===''){PrizeService.loadCompetitionEntry($scope.currentCompetition().id,function(){if($scope.getStatus($scope.currentCompetition())==='submission'){addDropListener()}})}else{if($scope.process==='voting'){PrizeService.clearResults();$rootScope.galleryLazyLoading=!0;PrizeService.loadCompetitionEntries($scope.pos,$scope.baseCount,$scope.page,$scope.compId,!1);PrizeService.loadUsersVotes($scope.compId);$(window).unbind('scroll').bind('scroll',function(){if($rootScope.galleryLazyLoading||$rootScope.galleryFinishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){if($scope.pos+$scope.baseCount===$scope.pageCount){$rootScope.galleryNextPage=!0}else{$scope.pos+=$scope.baseCount;$rootScope.galleryLazyLoading=!0;PrizeService.loadCompetitionEntries($scope.pos,$scope.baseCount,$scope.page,$scope.compId,!1)}}});$scope.$watch(function(){return PrizeService.getData().entries},function(newVal){IsotopeService.synchroniseGroup(newVal,'#competition-vote-list','competition','artPrize','',$scope)},!0)}
if($scope.process==='results'){PrizeService.clearResults();$rootScope.galleryLazyLoading=!0;PrizeService.loadCompetitionEntries($scope.pos,$scope.baseCount,$scope.page,$scope.compId,!0);PrizeService.loadUsersVotes($scope.compId);$(window).unbind('scroll').bind('scroll',function(){if($rootScope.galleryLazyLoading||$rootScope.galleryFinishedLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.9){if($scope.pos+$scope.baseCount===$scope.pageCount){$rootScope.galleryNextPage=!0}else{$scope.pos+=$scope.baseCount;$rootScope.galleryLazyLoading=!0;PrizeService.loadCompetitionEntries($scope.pos,$scope.baseCount,$scope.page,$scope.compId,!0)}}});$scope.$watch(function(){return PrizeService.getData().results},function(newVal){IsotopeService.synchroniseGroup(newVal,'#competition-results-list','competition','results','',$scope)},!0)}else{$rootScope.setPageLoader(!1)}}});$scope.viewFullEntry=function(){PopoverService.initialise('artPrizeEntry',{graphic:{classes:'',visible:!1},title:$scope.currentPrize().title,description:$scope.currentPrize().description,confirmButton:{text:'Close',visible:!0},dismissButton:{text:'Close',visible:!0}});PopoverService.show()};$scope.getStatus=function(competition){if(defined(competition.start_date)){var startTime=competition.start_date.getTime();var endTime=competition.end_date.getTime();var currentTime=$rootScope.utcTime.getTime();if(currentTime<startTime){return'promotion'}
if(startTime<currentTime&&endTime>currentTime){return'submission'}
if(currentTime>endTime&&competition.completed==='0'){return'closed'}
return'results'}
return'none'};$scope.currentPrize=function(){if($rootScope.competitions().prizeEntry!==0){return $rootScope.getCompetitionEntry($rootScope.competitions().currentCompetition,$rootScope.competitions().prizeEntry)}
return!1};$scope.currentCompetition=function(){return $rootScope.getCompetition($rootScope.competitions().currentCompetition)};$scope.processCompetitionForm=function(reference){var formData=new FormData(jQuery(reference)[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){PrizeService.addOrUpdateCompetition(data.competition);$location.path('/admin/competitions');$scope.$apply()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)};$scope.removeSubmission=function(){var formData=new FormData();formData.append('schema','prizeEntryDelete');formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('prizeCompetitionId',$scope.currentCompetition().id);formData.append('id',$scope.currentPrize().id);$rootScope.ajaxQuery(formData,function(data){if(defined(data.success)){PrizeService.clearEntryData();$scope.$apply();addDropListener()}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}},!0)};$scope.uploadPrize=function(){if($rootScope.checkCanPerform(!0,!0)){if($scope.submitting){alert("Please wait for your current submission to complete.")}else if($scope.uploads.length===0){alert("Entries must contain an artwork.")}else{var formData=new FormData($('#upload-form')[0]);formData.append('userId',$rootScope.user);formData.append('token',$rootScope.getUser($rootScope.user).token);formData.append('schema','prizeEntryCreate');formData.append('prizeCompetitionId',$scope.currentCompetition().id);formData.append('prizeItem',$scope.uploads[0].file);formData.append('mature',$scope.uploads[0].mature);if(!$('#terms').is(':checked')){PopoverService.initialise('default',{graphic:{visible:!1},title:'Sorry!',description:'You must agree to the Terms and Conditions before entering.',dismissButton:{visible:!0}});PopoverService.show();return}
$scope.submitting=!0;$.ajax({url:APIURL,type:'POST',cache:!1,data:formData,processData:!1,contentType:!1,beforeSend:function(){$scope.uploadPercent=1},xhr:showProgress,success:function(response){var data=JSON.parse(response);if(defined(data.success)){$scope.resetImages();PrizeService.addOrUpdateEntry($scope.currentCompetition().id,data.entry);PrizeService.setPrizeEntry(data.entry.id)}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}
$scope.uploadPercent=0;$scope.submitting=!1;if(!$scope.$$phase){$scope.$apply()}}})}}};var showProgress=function(){var xhr=$.ajaxSettings.xhr();var percentageComplete=1;xhr.upload.onprogress=function(evt){percentageComplete=Math.round(evt.loaded/evt.total*100);if(percentageComplete===99){percentageComplete=percentageComplete+1}
$scope.uploadPercent=percentageComplete;if(!$scope.$$phase){$scope.$apply()}};return xhr};$scope.attemptStageTwo=function(item){if($('#title').val()!==''){item.stage=2}else{PopoverService.initialise('default',{graphic:{visible:!1},title:'Oops!',description:'We need a title for your masterpiece.',dismissButton:{visible:!0}});PopoverService.show()}};$scope.fileDialog=function(){jQuery('#module-view').find('.dropFiles').trigger('click')};$scope.resetImages=function(){var parentContainer=jQuery('#module-view');$scope.uploads=[];parentContainer.find('.dropFiles').val('');parentContainer.find('.upload-bar').css('width','0%')};var addDropListener=function(){var parentContainer=jQuery('#module-view');var dropZone=parentContainer.find('.drop-zone').get(0);var $fileInput=parentContainer.find('.dropFiles');if(defined(dropZone)){dropZone.ondragover=function(e){$(this).addClass('hover-active');e.preventDefault()};dropZone.ondragenter=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.ondragleave=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.ondragout=function(e){$(this).removeClass('hover-active');e.preventDefault()};dropZone.ondrop=function(e){e.preventDefault();$(this).removeClass('hover-active');if($scope.maxUploadCount!==0){if($scope.uploads.length+e.dataTransfer.files.length>$scope.maxUploadCount){alert("Unable to upload these files, you have exceeded the maximum upload count.");return!1}}
$fileInput.get(0).files=e.dataTransfer.files}}
$fileInput.off('change').on('change',function(){if($rootScope.checkCanPerform(!0,!0)){var _this=this;if(_this.files&&_this.files[0]){jQuery.each(_this.files,function(i,elm){switch(isValidItem(elm)){case 'image':generateImage(elm);break;default:alert("Invalid File Type");break}})}}
$fileInput.get(0).value=''})};var generateImage=function(file){var reader=new FileReader();var index=$scope.uploads.length;$scope.uploads.push({thumb:'',type:'image',selected:!1,file:'',color:'',index:index,stage:1});if(!$scope.$$phase){$scope.$apply()}
reader.onload=function(e){var img=new Image();img.onload=function(){$scope.uploads[index].thumb=img.src;$scope.uploads[index].file=file;$scope.uploads[index].color=getAverageColor(img);if(!$scope.$$phase){$scope.$apply()}};img.src=URL.createObjectURL(file)};reader.readAsDataURL(file)};var isValidItem=function(file){switch(file.name.split('.').pop().toLowerCase()){case 'png':case 'jpg':case 'jpeg':return'image'}
return!1};$scope.getEntryThumbHeight=function(entry){var baseWidth=entry.width;var baseHeight=entry.height;var initWidth=278;var initHeight=494;var height=0;if($(window).outerWidth()<656){initWidth=177;initHeight=314}
if($(window).outerWidth()<414){initWidth=157;initHeight=279}
if($(window).outerWidth()<375){initWidth=280;initHeight=497}
if(baseWidth==0){return''}
if(initWidth/baseWidth<=initHeight/baseHeight){var finalWidth=baseWidth>initWidth?initWidth:baseWidth;height=baseHeight/(baseWidth/finalWidth)}else{height=baseHeight>initHeight?initHeight:height}
return height}}]);app.controller('parallaxController',['$scope','$rootScope','$timeout','$routeParams','$location','ModalService','GalleryService',function($scope,$rootScope,$timeout,$routeParams,$location,ModalService,GalleryService){$rootScope.checkAnimatable(!0);$rootScope.bodyClass='content scroll-fix';var bodyHeight=0,$window=$(window),$pageWrapper=$('#page-wrapper'),$body=$('body'),menuHeight=0,windowHeight=0,windowWidth=0,scrollTop=0,isMobilePhone=$body.hasClass('iphone')||isMobile,pocketBlob=!1,isUsingIphone=!1,useBlob=!0,oldScrollValue=0,preparedKeyFrames=[],keyFrames=[];switch($routeParams.page){case 'old-pad-keyframes':pocketBlob=!1;useBlob=!0;keyFrames=oldPadKeyFrames;break;case 'pad-keyframes':pocketBlob=!1;if(defined($routeParams.mobileOverride)&&(isMobilePhone)){keyFrames=mobilePadKeyFrames;useBlob=!0}else{keyFrames=padKeyFrames;useBlob=!0}
break;case 'pocket-keyframes':pocketBlob=!0;useBlob=!0;keyFrames=pocketKeyFrames;break;default:pocketBlob=!1;useBlob=!0;keyFrames=padKeyFrames}
var init=function(){$rootScope.scrollToTop();if(useBlob){if(!pocketBlob){Blob1.mount(document.getElementById('blob-pad'));Blob1.start()}else{}}
if(isMobile&&!$body.hasClass('iphone')){$body.addClass('iphone')}
scrollTop=$window.scrollTop();menuHeight=$('.slim-nav').height();windowHeight=$('#pad-intro').find('.background').height();windowWidth=$window.width();isMobilePhone=isUsingIphone||isMobile;preparedKeyFrames=JSON.parse(JSON.stringify(keyFrames));convertAllPropsToPx();$window.resize(updateCalculations);setTimeout(updateCalculations,2000);$window.unbind('scroll').on('scroll',function(){updatePage();scrollPadPlayVideo()});updatePage()};var updateCalculations=function(){if(((windowHeight>windowWidth&&$window.width()>=$('#pad-intro').find('.background').height())||(windowHeight<windowWidth&&$window.width()<=$('#pad-intro').find('.background').height()))&&useBlob){if(!pocketBlob){Blob1.mount(document.getElementById('blob-pad'));Blob1.start();Blob02.mount(document.getElementById('blob-pad-02'));Blob02.start();Blob03.mount(document.getElementById('blob-pad-03'));Blob03.start()}else{}}
if(isMobile&&!$body.hasClass('iphone')){$body.addClass('iphone')}
menuHeight=$('.slim-nav').height();windowHeight=$('#pad-intro').find('.background').height();windowWidth=$window.width();isMobilePhone=isUsingIphone||isMobile;if(!isMobilePhone&&$body.hasClass('iphone')){$body.removeClass('iphone')}
preparedKeyFrames=JSON.parse(JSON.stringify(keyFrames));convertAllPropsToPx();updatePage()};var convertAllPropsToPx=function(){bodyHeight=0;for(var i=0;i<preparedKeyFrames.length;i++){var height=0;var animation;var useFrameHeight=!1;if((!defined(preparedKeyFrames[i].nonMobile)||(preparedKeyFrames[i].nonMobile&&!isMobilePhone))&&(!defined(preparedKeyFrames[i].mobileOnly)||(preparedKeyFrames[i].mobileOnly&&isMobilePhone))){if(preparedKeyFrames[i].height==='object'){$(preparedKeyFrames[i].frame).css('height','');height=$(preparedKeyFrames[i].frame).height();useFrameHeight=!0}else{height=convertPercentToPx(preparedKeyFrames[i].height,'y');useFrameHeight=!1}
preparedKeyFrames[i].start=bodyHeight;bodyHeight+=height;preparedKeyFrames[i].end=bodyHeight;$(preparedKeyFrames[i].frame).height(height);for(var j=0;j<preparedKeyFrames[i].animations.length;j++){animation=preparedKeyFrames[i].animations[j];var k;animation.start=preparedKeyFrames[i].start+convertPercentToPx(animation.start,'y',useFrameHeight,height);animation.end=preparedKeyFrames[i].start+convertPercentToPx(animation.end,'y',useFrameHeight,height);if(defined(animation.period)){for(k=0;k<animation.period.length;k ++){animation.period[k]=animation.start+convertPercentToPx(animation.period[k],'y',useFrameHeight,height)}}
if(defined(animation.translateY)){for(k=0;k<animation.translateY.length;k ++){animation.translateY[k]=convertPercentToPx(animation.translateY[k],'y',!1,height)}}
if(defined(animation.translateX)){for(k=0;k<animation.translateX.length;k ++){animation.translateX[k]=convertPercentToPx(animation.translateX[k],'x',!1,height)}}
if(defined(animation.width)){for(k=0;k<animation.width.length;k ++){animation.width[k]=convertPercentToPx(animation.width[k],'x',!1,height)}
$(animation.selector).css('width','')}
if(defined(animation.translateY)||defined(animation.translateX)||defined(animation.opacity)){$(animation.selector).css('-webkit-transform','');$(animation.selector).css('transform','');$(animation.selector).css('opacity','')}}}else{for(var j=0;j<preparedKeyFrames[i].animations.length;j++){animation=preparedKeyFrames[i].animations[j];if(defined(animation.translateY)||defined(animation.translateX)||defined(animation.opacity)){$(animation.selector).css('-webkit-transform','');$(animation.selector).css('transform','');$(animation.selector).css('opacity','')}
if(defined(animation.width)){$(animation.selector).css('width','')}}}}
$pageWrapper.height(bodyHeight)};var convertPercentToPx=function(value,axis,useFrameHeight,frameHeight){if(typeof value==="string"&&value.match(/%/g)){if(axis==='y'){if(useFrameHeight){value=parseFloat(((parseFloat(value)/100)*frameHeight).toFixed(2))}else{value=parseFloat(((parseFloat(value)/100)*windowHeight).toFixed(2))}}
if(axis==='x')value=parseFloat(((parseFloat(value)/100)*windowWidth).toFixed(2))}
return value};var updatePage=function(){window.requestAnimationFrame(function(){oldScrollValue=scrollTop;scrollTop=$window.scrollTop();if(scrollTop!==oldScrollValue){animateElements()}})};var animateElements=function(){for(var j=0;j<preparedKeyFrames.length;j++){if(preparedKeyFrames[j].start<=scrollTop&&preparedKeyFrames[j].end>=scrollTop){for(var i=0;i<preparedKeyFrames[j].animations.length;i++){var animation=preparedKeyFrames[j].animations[i];if(scrollTop>=animation.start&&scrollTop<=animation.end&&(!defined(animation.nonMobile)||(animation.nonMobile&&!isMobilePhone))&&(!defined(animation.mobileOnly)||(animation.mobileOnly&&isMobilePhone))){var elm=$(animation.selector);if(defined(animation.special)){elm.css(animation.special)}else if(defined(animation.type)){switch(animation.type){case 'class-toggle':if(scrollTop>=animation.period[0]&&scrollTop<=animation.period[1]){elm.removeClass(animation.class[0]);if(!elm.hasClass(animation.class[1])&&animation.class[1]!==''){elm.addClass(animation.class[1])}}else{elm.removeClass(animation.class[1]);if(!elm.hasClass(animation.class[0])&&animation.class[0]!==''){elm.addClass(animation.class[0])}}
break;case 'resize':$(animation.selector).css({'width':calcPropValue(animation,'width')+'px'});break;case 'toggle-video':var $video=$(animation.selector);if(scrollTop>=animation.period[0]&&scrollTop<=animation.period[1]){$video.get(0).play()}else{$video.get(0).pause()}
break;case 'play-video':var $video02=$(animation.selector);if(scrollTop>=animation.period[0]&&scrollTop<=animation.period[1]){if($video02.get(0).currentTime!==$video02.get(0).duration){$video02.get(0).play()}else{$video02.get(0).pause()}}else{$video02.get(0).pause()}
break}}else{var translateY=calcPropValue(animation,'translateY');var translateX=calcPropValue(animation,'translateX');var opacity=calcPropValue(animation,'opacity');var rotateZ=calcPropValue(animation,'rotateZ');elm.css({'-webkit-transform':'translate3d('+translateX+'px, '+translateY+'px, 0) rotateZ('+rotateZ+'deg)','transform':'translate3d('+translateX+'px, '+translateY+'px, 0) rotateZ('+rotateZ+'deg)','opacity':opacity})}}}}}};var calcPropValue=function(animation,property){if(defined(animation[property])){for(var i=1;i<animation.period.length;i ++){if(scrollTop>=animation.period[i-1]&&scrollTop<=animation.period[i]){return easeInOutQuad(scrollTop-animation.period[i-1],animation[property][i-1],(animation[property][i]-animation[property][i-1]),animation.period[i]-animation.period[i-1])}}}
return getDefaultPropertyValue(property)};var easeInOutQuad=function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b};var getDefaultPropertyValue=function(property){switch(property){case 'translateX':return 0;case 'translateY':return 0;case 'rotateZ':return 0;case 'opacity':return 1;case 'width':return 0;default:return null}};init();var mobileCheck=!1;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))mobileCheck=!0})(navigator.userAgent||navigator.vendor||window.opera);if(isIphone()&&iPhoneVersion()===!0){mobileCheck=!1;isUsingIphone=!0;if(!$body.hasClass('iphone')){$body.addClass('iphone')}}
if(mobileCheck){$body.addClass('mobile')}
function startPadPlayback($video){return $video.get(0).play()}
if(!mobileCheck){$('#position-lock').find('video').each(function(){var $videoElement=$(this);if(typeof $videoElement.attr('loop')==='undefined'||$videoElement.attr('loop')===!1){$videoElement.get(0).addEventListener('ended',function(){$videoElement.removeClass('video-playing');if(!$videoElement.hasClass('video-ended')){$videoElement.addClass('video-ended')}})}})}
function scrollPadPlayVideo(){if(!mobileCheck){if($(this).attr('id')==='mobilePlayer1'||$(this).attr('id')==='mobilePlayer1'){return}
$('#position-lock').find('video').each(function(){if($(this).hasClass('no-autoplay')){return}
if($(this).visible()||$(this).visible(!0)){if(!$(this).hasClass('video-ended')){if(!$(this).hasClass('video-playing')){$(this).addClass('video-playing');startPadPlayback($(this)).then(function(){}).catch(function(error){console.log(error)})}
if($(this).hasClass('video-paused')){$(this).removeClass('video-paused')}}}else{if($(this).hasClass('video-playing')){$(this).removeClass('video-playing');$(this).get(0).pause();$(this).get(0).currentTime=0}
if(!$(this).hasClass('video-paused')){$(this).addClass('video-paused')}}})}}}]);app.service('AclService',['$cookies','UserService','$http',function($cookies,UserService,$http){var _this=this;this.aclData={resources:{}};this.reset=function(){_this.clearResourceData()};this.loadResources=function(){var userId=$cookies.get('user');var token=$cookies.get('token');if(defined(userId)&&defined(token)){$http({method:'POST',url:APIURL,data:'schema=adminListResources&userId='+userId+'&token='+token,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){if(data.resources.length){data.resources.forEach(function(resource){_this.addOrUpdateResource(resource)})}}}).catch(function(response){console.log(response)})}};this.addOrUpdateResource=function(resources){if(defined(_this.aclData.resources[resources.id])){for(var property in resources){if(resources.hasOwnProperty(property)){_this.aclData.resources[resources.id][property]=resources[property]}}}else{_this.aclData.resources[resources.id]=resources}};this.clearResourceData=function(){_this.aclData.resources=[]};this.getData=function(){return _this.aclData}}]);app.service('AdminService',['UserService','$rootScope','$http',function(UserService,$rootScope,$http){var _this=this;this.adminData={imageField:'',rngField:'',images:{}};this.loadBucketImages=function(pos,count,page){if(defined(pos)&&defined(count)){var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
$http({method:'POST',url:APIURL,data:'schema=adminBucketLoad&pos='+pos+'&count='+count+'&page='+page+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.bucketItems.forEach(function(bucketItem){var image=_this.generateImageFromBucketData(bucketItem);_this.addOrUpdateImage(image)})}else if(defined(data.complete)){$rootScope.galleryFinishedLoading=!0}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.initialise=function(imageField,rngField){_this.adminData.imageField=imageField;_this.adminData.rngField=rngField;if(!$rootScope.$$phase){$rootScope.$apply()}};this.show=function(){$rootScope.bucketShow=!0;if(!$rootScope.$$phase){$rootScope.$apply()}};this.select=function(image){$('#'+_this.adminData.imageField).val(image.image);$('#'+_this.adminData.rngField).val(image.averageRGB.r+', '+image.averageRGB.g+', '+image.averageRGB.b);_this.hide()};this.hide=function(){$rootScope.bucketShow=!1;if(!$rootScope.$$phase){$rootScope.$apply()}};this.generateImageFromBucketData=function(bucketData){var image={};image.id=bucketData.id;image.userId=bucketData.userId;image.created=bucketData.created;image.width=bucketData.width;image.height=bucketData.height;image.image=bucketData.image.replace('http://',BASEPROTOCOL);image.title=bucketData.title;image.averageRGB=JSON.parse(bucketData.averageRGB);return image};this.addOrUpdateImage=function(image){if(defined(_this.adminData.images[image.id])){for(var property in image){if(image.hasOwnProperty(property)){_this.adminData.images[image.id][property]=image[property]}}}else{_this.adminData.images[image.id]=image}};this.getData=function(){return _this.adminData}}]);app.service('BetaService',['UserService','$rootScope',function(UserService,$rootScope){var _this=this;this.betaData={types:{}};this.reset=function(){_this.clearBetaData()};this.loadTypes=function($scope){var extra=UserService.getUserDetails();$rootScope.httpQuery('schema=betaTypeLoad'+extra,function(data){if(data.types){data.types.forEach(function(type){_this.addOrUpdateType(type);if(defined($scope)&&type.id==$scope.typeId){$scope.typeFields=type}})}})};this.loadUsers=function(typeId){var extra=UserService.getUserDetails()+'&type_id='+typeId;$rootScope.httpQuery('schema=betaUserLoad'+extra,function(data){if(data.users){if(!defined(_this.betaData.types[typeId])){_this.betaData.types[typeId]={}}
_this.betaData.types[typeId].betaUsers=[];data.users.forEach(function(user){_this.betaData.types[typeId].betaUsers.push(user)})}})};this.editUser=function(typeId,betaUserId,selected){var extra=UserService.getUserDetails()+'&type_id='+typeId+'&beta_user_id='+betaUserId+'&selected='+selected;$rootScope.httpQuery('schema=betaUserUpdate'+extra,function(data){if(data.success){for(var i=0;i<_this.betaData.types[typeId].betaUsers.length;i ++){if(_this.betaData.types[typeId].betaUsers[i].user_id===betaUserId){_this.betaData.types[typeId].betaUsers[i].selected=selected}}}})};this.createBetaUser=function(typeId){var extra=UserService.getUserDetails()+'&type_id='+typeId;$rootScope.httpQuery('schema=betaUserCreate'+extra,function(data){if(data.success){UserService.addBetaUser(data.betaUser)}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}})};this.deleteBetaUser=function(typeId){var extra=UserService.getUserDetails()+'&type_id='+typeId;$rootScope.httpQuery('schema=betaUserDelete'+extra,function(data){if(data.success){UserService.removeBetaUser(typeId)}else{var errors="";for(var error in data.errors){errors+=data.errors[error]}
alert(errors)}})};this.bulkSelect=function(typeId){var extra=UserService.getUserDetails()+'&type_id='+typeId;$rootScope.httpQuery('schema=betaUserBulkSelect'+extra,function(data){if(data.success){for(var i=0;i<_this.betaData.types[typeId].betaUsers.length;i ++){_this.betaData.types[typeId].betaUsers[i].selected=1}}})};this.addOrUpdateType=function(type){if(defined(_this.betaData.types[type.id])){for(var property in type){if(type.hasOwnProperty(property)){_this.betaData.types[type.id][property]=type[property]}}}else{_this.betaData.types[type.id]=type}};this.clearBetaData=function(){_this.betaData={}};this.getData=function(){return _this.betaData}}]);app.service('DiscussionService',['$http','UserService','$cookies','$rootScope',function($http,UserService,$cookies,$rootScope){var _this=this;this.baseLoadable=!0;this.discussionData={boards:{},threads:{},tags:{}};this.load=function(board,category,thread,post,page,$scope){if(this.baseLoadable){var userDetails=UserService.getUserDetails();this.baseLoadable=!1;$rootScope.setPageLoader(!0);if(userDetails===!1){userDetails=''}
$http({method:'POST',url:APIURL,data:'schema=discussionLoad'+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){$rootScope.setPageLoader(!1);var data=response.data;if(defined(data.success)){data.boards.forEach(function(board){_this.addBoard(board)});data.tags.forEach(function(tag){_this.addTag(tag)});_this.loadSection(board,category,thread,post,page,$scope)}}).catch(function(response){$rootScope.setPageLoader(!1);console.log(response)})}else{_this.loadSection(board,category,thread,post,page,$scope)}};this.loadSection=function(board,category,thread,post,page,$scope){if(defined(thread)){_this.loadPosts(thread,post,page,$scope)}else if(defined(category)){_this.loadCategoryThreads(board,category,page)}else if(defined(board)){_this.loadBoardThreads(board,page)}};this.loadBoardThreads=function(board,page){if(defined(board)){var extra='';var userDetails=UserService.getUserDetails();if(defined(page)){extra+='&page='+page}
if(userDetails===!1){userDetails=''}
$rootScope.loadingThreads=!0;$http({method:'POST',url:APIURL,data:'schema=discussionThreadLoad&boardId='+board+extra+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var count=(page-1)*THREADPAGINATIONCOUNT;data.threads.forEach(function(thread){UserService.addOrUpdateUser(_this.generateUserFromForumData(thread));_this.addThreads(thread);_this.addThreadToBoard(board,thread.id,count);count ++});if($rootScope.currentPath.indexOf('discussions/:board')!==-1){var meta={type:metaDefaults.default.type,url:metaDefaults.default.url,site_name:metaDefaults.default.site_name,title:$rootScope.getBoard(board).title,description:$rootScope.getBoard(board).description,image:$rootScope.getBoard(board).cover};updateMetadata(meta)}}
$rootScope.loadingThreads=!1}).catch(function(response){console.log(response);$rootScope.loadingThreads=!1})}};this.loadCategoryThreads=function(board,category,page){if(defined(board)&&defined(category)){var extra='';var userDetails=UserService.getUserDetails();if(defined(page)){extra+='&page='+page}
if(userDetails===!1){userDetails=''}
$rootScope.loadingThreads=!0;$http({method:'POST',url:APIURL,data:'schema=discussionThreadLoad&boardId='+board+'&catId='+category+extra+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var count=(page-1)*THREADPAGINATIONCOUNT;data.threads.forEach(function(thread){UserService.addOrUpdateUser(_this.generateUserFromForumData(thread));_this.addThreads(thread);_this.addThreadToCategory(board,category,thread.id,count);count ++})}
$rootScope.loadingThreads=!1}).catch(function(response){console.log(response);$rootScope.loadingThreads=!1})}};this.loadPosts=function(thread,post,page,$scope){var userId=$cookies.get('user');var token=$cookies.get('token');if(defined(thread)){$rootScope.loadingPosts=!0;var extra='';if(defined(post)){extra+='&post='+post}
if(defined(page)){extra+='&page='+page}
$http({method:'POST',url:APIURL,data:'schema=discussionPostLoad&threadId='+thread+'&userId='+userId+'&token='+token+extra,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){if(defined($scope)){$scope.page=data.page}
_this.addThreads(data.thread,data.page);var count=(data.page-1)*POSTPAGINATIONCOUNT;data.posts.forEach(function(post){UserService.addOrUpdateUser(_this.generateUserFromForumData(post));if(post.replies.length>0){$scope.toggleable['comments'+post.id]=!0}
_this.addPostToThread(thread,post,count);count ++});if($rootScope.currentPath.indexOf('discussions/:board/:category/:thread')!==-1){var meta={type:metaDefaults.default.type,url:metaDefaults.default.url,site_name:metaDefaults.default.site_name,title:data.thread.title,description:$rootScope.getBoard(data.thread.disc_board_id).description,image:$rootScope.getBoard(data.thread.disc_board_id).cover};updateMetadata(meta)}}
$rootScope.loadingPosts=!1}).catch(function(response){console.log(response);$rootScope.loadingPosts=!1})}};this.loadProfileDiscussions=function(username,pos,count,callback,failCallBack){if(defined(username)&&defined(pos)&&defined(count)){$http({method:'POST',url:APIURL,data:'schema=discussionThreadLoadProfile&username='+username+'&pos='+pos+'&count='+count,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.threads.forEach(function(thread){_this.addThreads(thread);UserService.addOrUpdateUser(_this.generateUserFromForumData(thread));if($rootScope.userDiscussionThreads.indexOf(thread.id)===-1){$rootScope.userDiscussionThreads.push(thread.id)}})}else if(defined(data.complete)){$rootScope.galleryFinishedLoading=!0}else{console.log(data)}
callback()}).catch(function(response){console.log(response);failCallBack()})}};this.addTagToBoard=function(userId,token,boardId,tagId){if(defined(userId)&&defined(token)&&defined(boardId)&&defined(tagId)){$http({method:'POST',url:APIURL,data:'schema=discussionAddTagToBoard&userId='+userId+'&token='+token+'&boardId='+boardId+'&tagId='+tagId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.discussionData.boards[boardId].tags.push(tagId)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.removeTagFromBoard=function(userId,token,boardId,tagId){if(defined(userId)&&defined(token)&&defined(boardId)&&defined(tagId)){$http({method:'POST',url:APIURL,data:'schema=discussionRemoveTagFromBoard&userId='+userId+'&token='+token+'&boardId='+boardId+'&tagId='+tagId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.discussionData.boards[boardId].tags.splice(_this.discussionData.boards[boardId].tags.indexOf(tagId),1)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.addTagToThread=function(userId,token,threadId,tagId){if(defined(userId)&&defined(token)&&defined(threadId)&&defined(tagId)){$http({method:'POST',url:APIURL,data:'schema=discussionAddTagToThread&userId='+userId+'&token='+token+'&threadId='+threadId+'&tagId='+tagId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.discussionData.threads[threadId].tags=[];_this.discussionData.threads[threadId].tags.push(tagId);if(!$rootScope.$$phase){$rootScope.$apply()}}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.unFeatureThread=function(userId,token,threadId,boardId){if(defined(userId)&&defined(token)&&defined(threadId)){$http({method:'POST',url:APIURL,data:'schema=discussionThreadUnFeatured&userId='+userId+'&token='+token+'&threadId='+threadId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.discussionData.threads[threadId].featured=0;_this.discussionData.boards[boardId].featured.splice(_this.discussionData.boards[boardId].featured.indexOf(threadId),1)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.updatedThreadFollow=function(userId,token,threadId,boardId){if(defined(userId)&&defined(token)&&defined(threadId)){$http({method:'POST',url:APIURL,data:'schema=discussionThreadFollowUpdate&userId='+userId+'&token='+token+'&threadId='+threadId+'&boardId='+boardId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){if(typeof $rootScope.getUser($rootScope.user).threadFollows==='undefined'){$rootScope.getUser($rootScope.user).threadFollows={}}
if(!defined($rootScope.getUser($rootScope.user).threadFollows[threadId])){$rootScope.getUser($rootScope.user).threadFollows[threadId]=data.result}else{$rootScope.getUser($rootScope.user).threadFollows[threadId].updated=data.result.updated}}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.toggleFollowBoard=function(userId,token,boardId,follow){if(defined(userId)&&defined(token)&&defined(boardId)){if($rootScope.binaryLocked.follow.board.indexOf(boardId)===-1){$rootScope.binaryLocked.follow.board.push(boardId);if(follow){if(typeof $rootScope.getUser($rootScope.user).boardFollows==='undefined'){$rootScope.getUser($rootScope.user).boardFollows={}}
$rootScope.getUser($rootScope.user).boardFollows[boardId]=!0}else{delete $rootScope.getUser($rootScope.user).boardFollows[boardId]}
$http({method:'POST',url:APIURL,data:'schema=discussionBoardFollow&userId='+userId+'&token='+token+'&boardId='+boardId+'&follow='+follow,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){if(follow){$rootScope.getUser($rootScope.user).boardFollows[boardId]=data.result}else{data.result.forEach(function(thread){delete $rootScope.getUser($rootScope.user).threadFollows[thread.disc_thread_id]})}}else{if(!follow){if(typeof $rootScope.getUser($rootScope.user).boardFollows==='undefined'){$rootScope.getUser($rootScope.user).boardFollows={}}
$rootScope.getUser($rootScope.user).boardFollows[boardId]=!0}else{delete $rootScope.getUser($rootScope.user).boardFollows[boardId]}
var binaryIndex=$rootScope.binaryLocked.follow.board.indexOf(boardId);if(binaryIndex!==-1){$rootScope.binaryLocked.follow.board.splice(binaryIndex,1)}}}).catch(function(response){var binaryIndex=$rootScope.binaryLocked.follow.board.indexOf(boardId);if(binaryIndex!==-1){$rootScope.binaryLocked.follow.board.splice(binaryIndex,1)}})}}};this.toggleFollowThread=function(userId,token,threadId,follow){if(defined(userId)&&defined(token)&&defined(threadId)){if($rootScope.binaryLocked.follow.thread.indexOf(threadId)===-1){$rootScope.binaryLocked.follow.thread.push(threadId);if(follow){if(typeof $rootScope.getUser($rootScope.user).threadFollows==='undefined'){$rootScope.getUser($rootScope.user).threadFollows={}}
$rootScope.getUser($rootScope.user).threadFollows[threadId]=!0}else{delete $rootScope.getUser($rootScope.user).threadFollows[threadId]}
$http({method:'POST',url:APIURL,data:'schema=discussionThreadFollow&userId='+userId+'&token='+token+'&threadId='+threadId+'&follow='+follow,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){if(follow){$rootScope.getUser($rootScope.user).threadFollows[threadId]=data.result}}else{if(!follow){if(typeof $rootScope.getUser($rootScope.user).threadFollows==='undefined'){$rootScope.getUser($rootScope.user).threadFollows={}}
$rootScope.getUser($rootScope.user).threadFollows[threadId]=!0}else{delete $rootScope.getUser($rootScope.user).threadFollows[threadId]}}
var binaryIndex=$rootScope.binaryLocked.follow.thread.indexOf(threadId);if(binaryIndex!==-1){$rootScope.binaryLocked.follow.thread.splice(binaryIndex,1)}}).catch(function(response){var binaryIndex=$rootScope.binaryLocked.follow.thread.indexOf(threadId);if(binaryIndex!==-1){$rootScope.binaryLocked.follow.thread.splice(binaryIndex,1)}})}}};this.featureThread=function(userId,token,threadId,boardId){if(defined(userId)&&defined(token)&&defined(threadId)){$http({method:'POST',url:APIURL,data:'schema=discussionThreadFeatured&userId='+userId+'&token='+token+'&threadId='+threadId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.discussionData.threads[threadId].featured=1;_this.discussionData.boards[boardId].threads.splice(_this.discussionData.boards[boardId].threads.indexOf(threadId),1);_this.discussionData.boards[boardId].featured.push(threadId)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.removeTagFromthread=function(userId,token,threadId,tagId){if(defined(userId)&&defined(token)&&defined(threadId)&&defined(tagId)){$http({method:'POST',url:APIURL,data:'schema=discussionRemoveTagFromThread&userId='+userId+'&token='+token+'&threadId='+threadId+'&tagId='+tagId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.discussionData.threads[threadId].tags.splice(_this.discussionData.threads[threadId].tags.indexOf(tagId),1)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.voteThread=function(userId,token,threadId,vote,voted){var vote=vote?1:0;if(defined(userId)&&defined(token)&&defined(threadId)){if($rootScope.binaryLocked.vote.thread.indexOf(threadId)===-1){$rootScope.binaryLocked.vote.thread.push(threadId);if(vote){_this.discussionData.threads[threadId].upVotes.push(userId)}else{_this.discussionData.threads[threadId].downVotes.push(userId)}
if(voted){if(vote){_this.discussionData.threads[threadId].downVotes.splice(_this.discussionData.threads[threadId].downVotes.indexOf(userId),1)}else{_this.discussionData.threads[threadId].upVotes.splice(_this.discussionData.threads[threadId].upVotes.indexOf(userId),1)}}
$http({method:'POST',url:APIURL,data:'schema=discussionThreadVote&userId='+userId+'&token='+token+'&threadId='+threadId+'&vote='+vote,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){if(vote){_this.discussionData.threads[threadId].upVotes.splice(_this.discussionData.threads[threadId].upVotes.indexOf(userId),1)}else{_this.discussionData.threads[threadId].downVotes.splice(_this.discussionData.threads[threadId].downVotes.indexOf(userId),1)}
if(voted){if(vote){_this.discussionData.threads[threadId].downVotes.push(userId)}else{_this.discussionData.threads[threadId].upVotes.push(userId)}}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.vote.thread.indexOf(threadId);if(binaryIndex!==-1){$rootScope.binaryLocked.vote.thread.splice(binaryIndex,1)}}).catch(function(response){console.log(response);if(vote){_this.discussionData.threads[threadId].upVotes.splice(_this.discussionData.threads[threadId].upVotes.indexOf(userId),1)}else{_this.discussionData.threads[threadId].downVotes.splice(_this.discussionData.threads[threadId].downVotes.indexOf(userId),1)}
if(voted){if(vote){_this.discussionData.threads[threadId].downVotes.push(userId)}else{_this.discussionData.threads[threadId].upVotes.push(userId)}}
var binaryIndex=$rootScope.binaryLocked.vote.thread.indexOf(threadId);if(binaryIndex!==-1){$rootScope.binaryLocked.vote.thread.splice(binaryIndex,1)}})}}};this.removeVoteThread=function(userId,token,threadId,vote){var vote=vote?1:0;if(defined(userId)&&defined(token)&&defined(threadId)){if($rootScope.binaryLocked.vote.thread.indexOf(threadId)===-1){$rootScope.binaryLocked.vote.thread.push(threadId);if(vote){_this.discussionData.threads[threadId].upVotes.splice(_this.discussionData.threads[threadId].upVotes.indexOf(userId),1)}else{_this.discussionData.threads[threadId].downVotes.splice(_this.discussionData.threads[threadId].downVotes.indexOf(userId),1)}
$http({method:'POST',url:APIURL,data:'schema=discussionThreadVoteRemove&userId='+userId+'&token='+token+'&threadId='+threadId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){if(vote){_this.discussionData.threads[threadId].upVotes.push(userId)}else{_this.discussionData.threads[threadId].downVotes.push(userId)}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.vote.thread.indexOf(threadId);if(binaryIndex!==-1){$rootScope.binaryLocked.vote.thread.splice(binaryIndex,1)}}).catch(function(response){console.log(response);if(vote){_this.discussionData.threads[threadId].upVotes.push(userId)}else{_this.discussionData.threads[threadId].downVotes.push(userId)}
var binaryIndex=$rootScope.binaryLocked.vote.thread.indexOf(threadId);if(binaryIndex!==-1){$rootScope.binaryLocked.vote.thread.splice(binaryIndex,1)}})}}};this.likePost=function(userId,token,threadId,postRef,postId){if(defined(userId)&&defined(token)&&defined(postId)){if($rootScope.binaryLocked.like.post.indexOf(postId)===-1){$rootScope.binaryLocked.like.post.push(postId);_this.discussionData.threads[threadId].posts[postRef].post.likes.push(userId);$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=discussionPostLike&userId='+userId+'&token='+token+'&postId='+postId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){var index=_this.discussionData.threads[threadId].posts[postRef].post.likes.indexOf(userId);if(index!==-1){_this.discussionData.threads[threadId].posts[postRef].post.likes.splice(index,1)}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.post.indexOf(postId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.post.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.post.indexOf(postId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.post.splice(binaryIndex,1)}})}}};this.likePostRemove=function(userId,token,threadId,postRef,postId){if(defined(userId)&&defined(token)&&defined(postId)){if($rootScope.binaryLocked.like.post.indexOf(postId)===-1){$rootScope.binaryLocked.like.post.push(postId);var index=_this.discussionData.threads[threadId].posts[postRef].post.likes.indexOf(userId);if(index!==-1){_this.discussionData.threads[threadId].posts[postRef].post.likes.splice(index,1)}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=discussionPostLikeRemove&userId='+userId+'&token='+token+'&postId='+postId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){_this.discussionData.threads[threadId].posts[postRef].post.likes.push(userId);console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.post.indexOf(postId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.post.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.post.indexOf(postId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.post.splice(binaryIndex,1)}})}}};this.likeReply=function(userId,token,threadId,postRef,replyId){if(defined(userId)&&defined(token)&&defined(replyId)){if($rootScope.binaryLocked.like.reply.indexOf(replyId)===-1){$rootScope.binaryLocked.like.reply.push(replyId);_this.discussionData.threads[threadId].posts[postRef].post.replies[replyId].likes.push(userId);$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=discussionReplyLike&userId='+userId+'&token='+token+'&replyId='+replyId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){var index=_this.discussionData.threads[threadId].posts[postRef].post.replies[replyId].likes.indexOf(userId);if(index!==-1){_this.discussionData.threads[threadId].posts[postRef].post.replies[replyId].likes.splice(index,1)}}
var binaryIndex=$rootScope.binaryLocked.like.reply.indexOf(replyId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.reply.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.reply.indexOf(replyId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.reply.splice(binaryIndex,1)}})}}};this.likeReplyRemove=function(userId,token,threadId,postRef,replyId){if(defined(userId)&&defined(token)&&defined(replyId)){if($rootScope.binaryLocked.like.reply.indexOf(replyId)===-1){$rootScope.binaryLocked.like.reply.push(replyId);var index=_this.discussionData.threads[threadId].posts[postRef].post.replies[replyId].likes.indexOf(userId);if(index!==-1){_this.discussionData.threads[threadId].posts[postRef].post.replies[replyId].likes.splice(index,1)}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=discussionReplyLikeRemove&userId='+userId+'&token='+token+'&replyId='+replyId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){_this.discussionData.threads[threadId].posts[postRef].post.replies[replyId].likes.push(userId);console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.reply.indexOf(replyId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.reply.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.reply.indexOf(replyId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.reply.splice(binaryIndex,1)}})}}};this.addTag=function(tag){_this.discussionData.tags[tag.id]=tag};this.addBoard=function(board){if(!objInArrayById(_this.discussionData.boards,board)){var tempCat=jQuery.extend({},board.categories);var tempTags=jQuery.extend({},board.tags);var featuredThreads=jQuery.extend({},board.featured);board.categories={};board.threads=[];board.tags=[];board.featured=[];if(defined(tempCat)){for(var cat in tempCat){board.categories[tempCat[cat].id]=tempCat[cat];board.categories[tempCat[cat].id].threads=[]}}
if(defined(featuredThreads)&&featuredThreads!==null){var count=0;for(var thread in featuredThreads){UserService.addOrUpdateUser(_this.generateUserFromForumData(featuredThreads[thread]));_this.addThreads(featuredThreads[thread]);board.featured.push({pos:count,id:featuredThreads[thread].id});count ++}}
if(defined(tempTags)&&tempTags!==null){for(var tag in tempTags){board.tags.push(tempTags[tag].id);_this.addTag(tempTags[tag])}}
for(var i=0;i<board.thread_count-board.featured.length;i ++){board.threads[i]={pos:i,id:0}}
_this.discussionData.boards[board.id]=board}};this.addThreads=function(thread){if(typeof thread==='object'&&!objInArrayById(_this.discussionData.threads,thread)){var tempPosts=jQuery.extend({},thread.posts);thread.upVotes=[];thread.downVotes=[];thread.title=$.parseHTML(thread.title)[0].data;thread.votes=thread.votes!==null&&typeof thread.votes!=='undefined'?thread.votes.split(','):[];thread.votes_alias=thread.votes_alias!==null&&typeof thread.votes_alias!=='undefined'?thread.votes_alias.split(','):[];thread.votes_vote=thread.votes_vote!==null&&typeof thread.votes_vote!=='undefined'?thread.votes_vote.split(','):[];for(var v=0;v<thread.votes.length;v ++){if(thread.votes_vote[v]==1){thread.upVotes.push(thread.votes[v])}else{thread.downVotes.push(thread.votes[v])}}
thread.posts=[];if(typeof thread.tags==='undefined'||thread.tags===null){thread.tags=[]}else{thread.tags=thread.tags.split(',');thread.tags=$.unique(thread.tags)}
if(defined(tempPosts)){var count=0;for(var post in tempPosts){post.replies={};thread.posts.push({position:count,post:tempPosts[post]});count ++}}else{for(var i=0;i<thread.post_count;i ++){thread.posts.push({position:i,post:{replies:{}}})}}
_this.discussionData.threads[thread.id]=thread}};this.addThreadToBoard=function(boardId,threadId,index){if(!defined(_this.discussionData.boards[boardId])){_this.discussionData.boards[boardId]={}}
if(!defined(_this.discussionData.boards[boardId].threads)){_this.discussionData.boards[boardId].threads=[]}
_this.discussionData.boards[boardId].threads[index]={pos:index,id:threadId}};this.addThreadToCategory=function(boardId,categoryId,threadId,index){if(!defined(_this.discussionData.boards[boardId])){_this.discussionData.boards[boardId]={}}
if(!defined(_this.discussionData.boards[boardId].categories)){_this.discussionData.boards[boardId].categories={}}
if(!defined(_this.discussionData.boards[boardId].categories[categoryId])){_this.discussionData.boards[boardId].categories[categoryId]={}}
if(!defined(_this.discussionData.boards[boardId].categories[categoryId].threads)){_this.discussionData.boards[boardId].categories[categoryId].threads=[]}
_this.discussionData.boards[boardId].categories[categoryId].threads[index]={pos:index,id:threadId}};this.deletePostsFromThreadsByOmmission=function(thread,posts){var toDelete=[];for(var t=0;t<_this.discussionData.threads[thread].posts.length;t ++){if(!$rootScope.isEmpty(_this.discussionData.threads[thread].posts[t])){var found=!1;var foundPost={};for(var p=0;p<posts.length;p++){if(_this.discussionData.threads[thread].posts[t].post.id===posts[p].id){found=!0;foundPost=posts[p];break}}
if(!found){toDelete.push(_this.discussionData.threads[thread].posts[t].position)}else if(typeof _this.discussionData.threads[thread].posts[t].post.replies!=='undefined'){$.each(_this.discussionData.threads[thread].posts[t].post.replies,function(index,reply){var replyFound=!1;for(var s=0;s<foundPost.replies.length;s++){if(reply.id===foundPost.replies[s].id){replyFound=!0;break}}
if(!replyFound){_this.deleteReplyFromPost(thread,_this.discussionData.threads[thread].posts[t].position,reply.id)}})}}}
for(var d=0;d<toDelete.length;d ++){_this.deletePostFromThread(thread,toDelete[d])}};this.addorUpdatePostToThread=function(post){var reply;var position=-1;if(!defined(_this.discussionData.threads[post.disc_thread_id])){_this.discussionData.threads[post.disc_thread_id]={};_this.discussionData.threads[post.disc_thread_id].posts=[]}
post.likes=post.likes!==null&&typeof post.likes!=='undefined'?post.likes.split(','):[];var tempReplies=jQuery.extend({},post.replies);delete post.replies;for(var v=0;v<_this.discussionData.threads[post.disc_thread_id].posts.length;v ++){if(!$rootScope.isEmpty(_this.discussionData.threads[post.disc_thread_id].posts[v])){if(_this.discussionData.threads[post.disc_thread_id].posts[v].post.id==post.id){position=v;break}}}
if(position===-1){_this.discussionData.threads[post.disc_thread_id].posts.push({position:_this.discussionData.threads[post.disc_thread_id].post_count,post:post})}else{if(defined(_this.discussionData.threads[post.disc_thread_id].posts[position])){for(var property in post){if(post.hasOwnProperty(property)){_this.discussionData.threads[post.disc_thread_id].posts[position].post[property]=post[property]}}
if(defined(tempReplies)){for(reply in tempReplies){tempReplies[reply].likes=tempReplies[reply].likes!==null&&typeof tempReplies[reply].likes!=='undefined'?tempReplies[reply].likes.split(','):[];if(defined(_this.discussionData.threads[post.disc_thread_id].posts[position].post.replies[tempReplies[reply].id])){for(var replyProperty in tempReplies[reply]){if(post.hasOwnProperty(replyProperty)){_this.discussionData.threads[post.disc_thread_id].posts[position].post.replies[tempReplies[reply].id][replyProperty]=tempReplies[reply][replyProperty]}}}else{_this.discussionData.threads[post.disc_thread_id].posts[position].post.replies[tempReplies[reply].id]=tempReplies[reply]}}}}else{post.replies={};if(defined(tempReplies)){for(reply in tempReplies){tempReplies[reply].likes=tempReplies[reply].likes!==null&&typeof tempReplies[reply].likes!=='undefined'?tempReplies[reply].likes.split(','):[];post.replies[tempReplies[reply].id]=tempReplies[reply]}}
_this.discussionData.threads[post.disc_thread_id].posts[position]={position:position,post:post}}}};this.addPostToThread=function(threadId,post,position){position=defined(position)?position:0;if(!defined(_this.discussionData.threads[threadId])){_this.discussionData.threads[threadId]={};_this.discussionData.threads[threadId].posts=[]}
post.likes=post.likes!==null&&typeof post.likes!=='undefined'?post.likes.split(','):[];var tempReplies=jQuery.extend({},post.replies);post.replies={};if(defined(tempReplies)){for(var reply in tempReplies){tempReplies[reply].likes=tempReplies[reply].likes!==null&&typeof tempReplies[reply].likes!=='undefined'?tempReplies[reply].likes.split(','):[];post.replies[tempReplies[reply].id]=tempReplies[reply]}}
if(position===0){if(_this.discussionData.threads[threadId].posts.length===0){_this.discussionData.threads[threadId].posts.push({position:0,post:post})}else{_this.discussionData.threads[threadId].posts.push({position:_this.discussionData.threads[threadId].posts[_this.discussionData.threads[threadId].posts.length-1].position+1,post:post})}}else{_this.discussionData.threads[threadId].posts[position]={position:position,post:post}}};this.incrementThreadCount=function(boardId,increment){_this.discussionData.boards[boardId].thread_count=parseInt(_this.discussionData.boards[boardId].thread_count)+increment};this.incrementPostCount=function(threadId,increment){_this.discussionData.threads[threadId].post_count=parseInt(_this.discussionData.threads[threadId].post_count)+increment};this.addReplyToPost=function(reply){reply.likes=reply.likes!==null&&typeof reply.likes!=='undefined'?reply.likes.split(','):[];if(defined(_this.discussionData.threads[reply.disc_thread_id])){for(var i=0;i<_this.discussionData.threads[reply.disc_thread_id].posts.length;i ++){if(defined(_this.discussionData.threads[reply.disc_thread_id].posts[i])){if(_this.discussionData.threads[reply.disc_thread_id].posts[i].post.id==reply.disc_post_id){if(!defined(_this.discussionData.threads[reply.disc_thread_id].posts[i].post.replies)){_this.discussionData.threads[reply.disc_thread_id].posts[i].post.replies={}}
_this.discussionData.threads[reply.disc_thread_id].posts[i].post.replies[reply.id]=reply;break}}}}};this.updateThread=function(threadId,boardId,categoryId,thread){var catIndex;_this.discussionData.threads[threadId].posts[0].post.content=thread.content;_this.discussionData.threads[threadId].status=thread.status;_this.discussionData.threads[threadId].updated=thread.updated;_this.discussionData.threads[threadId].title=thread.title};this.updatePost=function(threadId,postPosition,post){_this.discussionData.threads[threadId].posts[postPosition].post.content=post.content;_this.discussionData.threads[threadId].posts[postPosition].post.status=post.status;_this.discussionData.threads[threadId].posts[postPosition].post.updated=post.updated};this.updateReply=function(threadId,postPosition,replyId,reply){_this.discussionData.threads[threadId].posts[postPosition].post.replies[replyId].content=reply.content;_this.discussionData.threads[threadId].posts[postPosition].post.replies[replyId].status=reply.status;_this.discussionData.threads[threadId].posts[postPosition].post.replies[replyId].updated=reply.updated};this.lockThread=function(threadId){_this.discussionData.threads[threadId].status=siteDefaults.discussions.status.thread_locked};this.unlockThread=function(threadId){_this.discussionData.threads[threadId].status=siteDefaults.discussions.status.default};this.deleteThreadFromBoard=function(boardId,position){_this.discussionData.boards[boardId].threads.splice(position,1)};this.deleteThreadFromCategory=function(boardId,catId,position){_this.discussionData.boards[boardId].categories[catId].threads.splice(position,1)};this.deleteThread=function(threadId){delete _this.discussionData.threads[threadId]};this.deletePostFromThread=function(threadId,position){_this.discussionData.threads[threadId].posts.splice(position,1)};this.deleteReplyFromPost=function(threadId,position,replyId){delete _this.discussionData.threads[threadId].posts[position].post.replies[replyId]};this.generateUserFromForumData=function(forumData){var user={};user.id=forumData.userId;user.username=forumData.username;user.avatar=forumData.avatar;user.alias=forumData.alias;user.location=forumData.location;user.job_title=forumData.job_title;user.views=forumData.user_views;user.savage=forumData.savage;return user};this.getData=function(){return _this.discussionData}}]);app.service('GalleryService',['$http','UserService','$location','$cookies','$rootScope',function($http,UserService,$location,$cookies,$rootScope){var _this=this;this.galleryData={popular:[],gallery:[],featured:[],users:[],images:{}};this.loadProfile=function(username,$scope){if(defined(username)){var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
$rootScope.setPageLoader(!0);$http({method:'POST',url:APIURL,data:'schema=galleryProfileLoad&username='+username+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){$rootScope.setPageLoader(!1);var data=response.data;if(defined(data.success)){data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace("store,","");data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace(",store","");data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace("about,","");data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace(",about","");data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace("discussions,","");data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace(",discussions","");if($rootScope.user!==data.userDetails.id&&data.userDetails.inspiration_count==0){data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace("inspiration,","");data.userDetails.profile_tab_order=data.userDetails.profile_tab_order.replace(",inspiration","")}
UserService.addOrUpdateUser(data.userDetails);$scope.userId=data.userDetails.id;if($scope.redirectOnLoad){$rootScope.userTab=data.userDetails.tabOrder[0]}
if($rootScope.currentPath.indexOf(':username')!==-1&&$rootScope.currentPath.indexOf(':username/artwork')===-1){var meta={type:metaDefaults.default.type,url:metaDefaults.default.url,site_name:metaDefaults.default.site_name,title:data.userDetails.alias,description:data.userDetails.job_title,image:data.userDetails.cover};updateMetadata(meta)}}else{console.log(data);$location.url('/404').replace()}}).catch(function(response){$rootScope.setPageLoader(!1);console.log(response);$location.url('/404').replace()})}};this.loadProfileGallery=function(username,$scope,callback,failCallBack){if(defined(username)){var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
$http({method:'POST',url:APIURL,data:'schema=galleryProfileLoadGallery&username='+username+'&pos='+$scope.galleryPos+'&count='+$scope.baseCount+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.galleryItems.forEach(function(galleryItem){var image=_this.generateImageFromImageData(galleryItem);_this.addOrUpdateImage(image);UserService.addImageToUser(image.id,galleryItem.userId)})}else if(defined(data.complete)){$rootScope.galleryFinishedLoading=!0}else{console.log(data)}
callback()}).catch(function(response){console.log(response);failCallBack()})}};this.loadGallery=function(type,pos,count,date,page){if(defined(type)&&defined(pos)&&defined(count)){var userDetails=UserService.getUserDetails();var extra='';if(userDetails===!1){userDetails=''}
if(type==='featured'){extra='&featured=1'}
$http({method:'POST',url:APIURL,data:'schema=galleryLoad&type='+type+'&pos='+pos+'&count='+count+'&page='+page+'&started='+date+extra+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.galleryItems.forEach(function(galleryItem){var image=_this.generateImageFromImageData(galleryItem);var user=_this.generateUserFromImageData(galleryItem);_this.addOrUpdateImage(image);switch(type){case 'recent':_this.addToGallery(image);break;case 'popular':_this.addToPopular(image);break;case 'featured':_this.addToFeatureGallery(image);break}
UserService.addOrUpdateUser(user)})}else if(defined(data.complete)){$rootScope.galleryFinishedLoading=!0}else{console.log(data)}
$rootScope.galleryLazyLoading=!1;$rootScope.loaderOverride=''}).catch(function(response){console.log(response);$rootScope.galleryLazyLoading=!1;$rootScope.loaderOverride=''})}};this.loadComments=function(imageId){var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
$http({method:'POST',url:APIURL,data:'schema=galleryLoadComments&imageId='+imageId+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.comments.forEach(function(comment){if(comment.comment_id==='0'){_this.addCommentToImage(imageId,comment)}else{_this.addCommentToImageComment(imageId,comment.comment_id,comment)}})}else{console.log(data)}}).catch(function(response){console.log(response)})};this.loadUserImage=function(imageId,callback){var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
if(defined(imageId)){$http({method:'POST',url:APIURL,data:'schema=galleryImageLoad&imageId='+imageId+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var image=_this.generateImageFromImageData(data.galleryItem);var user=_this.generateUserFromImageData(data.galleryItem);_this.addOrUpdateImage(image);UserService.addOrUpdateUser(user);UserService.addImageToUser(image.id,user.id);data.comments.forEach(function(comment){if(comment.comment_id==='0'){_this.addCommentToImage(image.id,comment)}else{_this.addCommentToImageComment(image.id,comment.comment_id,comment)}});if($rootScope.currentPath.indexOf(':username/artwork')!==-1){var metaTitle=data.galleryItem.title===''?data.galleryItem.alias:data.galleryItem.title;var meta={type:metaDefaults.default.type,url:metaDefaults.default.url,site_name:metaDefaults.default.site_name,title:metaTitle,description:data.galleryItem.description,image:data.galleryItem.thumb};updateMetadata(meta)}
var $select=$(".keywordPickerSet");if($select.length){if(image.defaultKeywords!==''){image.defaultKeywords.split(',').forEach(function(value){var newOption=new Option(value,value,!0,!0);$select.append(newOption).trigger('change')})}}
callback()}else{console.log(data);$location.url('/404').replace()}}).catch(function(response){console.log(response)})}};this.editComment=function(imageId,comment){if(comment.comment_id!=='0'){_this.galleryData.images[imageId].galleryComments[comment.commentId].replies[comment.id].content=comment.content;_this.galleryData.images[imageId].galleryComments[comment.commentId].replies[comment.id].status=comment.status;_this.galleryData.images[imageId].galleryComments[comment.commentId].replies[comment.id].updated=comment.updated}else{_this.galleryData.images[imageId].galleryComments[comment.id].content=comment.content;_this.galleryData.images[imageId].galleryComments[comment.id].status=comment.status;_this.galleryData.images[imageId].galleryComments[comment.id].updated=comment.updated}};this.deleteComment=function(imageId,commentId,replyId){if(replyId){delete _this.galleryData.images[imageId].galleryComments[commentId].replies[replyId]}else{delete _this.galleryData.images[imageId].galleryComments[commentId]}};this.deleteCommentsFromImageByOmmission=function(imageId,comments){var toDelete=[];var c;$.each(_this.galleryData.images[imageId].galleryComments,function(index,comment){var found=!1;for(c=0;c<comments.length;c ++){if(comment.id===comments[c].id){found=!0;break}}
if(!found){toDelete.push(comment.id)}else if(typeof _this.galleryData.images[imageId].galleryComments[comment.id].replies!=='undefined'){$.each(_this.galleryData.images[imageId].galleryComments[comment.id].replies,function(index,reply){var replyFound=!1;for(c=0;c<comments.length;c ++){if(reply.id===comments[c].id){replyFound=!0;break}}
if(!replyFound){_this.deleteComment(imageId,comment.id,reply.id)}})}});for(var d=0;d<toDelete.length;d ++){_this.deleteComment(imageId,toDelete[d])}};this.addCommentToImage=function(imageId,comment){comment.content=comment.content.replace(/(?:\r\n|\r|\n)/g,'<br />');comment.content=(comment.content.replace(/(<br \/>)*$/g,'').replace(/^(<br \/>)*/,'')).trim();while(comment.content.includes('<br /><br /><br />')){comment.content=comment.content.replace(/(?:<br \/><br \/><br \/>)/g,'<br /><br />')}
if(!defined(_this.galleryData.images[imageId].galleryComments)){_this.galleryData.images[imageId].galleryComments={}}
if(defined(_this.galleryData.images[imageId].galleryComments[comment.id])){for(var property in comment){if(comment.hasOwnProperty(property)){_this.galleryData.images[imageId].galleryComments[comment.id][property]=comment[property]}}}else{_this.galleryData.images[imageId].galleryComments[comment.id]=comment;_this.galleryData.images[imageId].galleryComments[comment.id].replies={}}
_this.galleryData.images[imageId].galleryComments[comment.id].likes=comment.likes!==null&&typeof comment.likes!=='undefined'?comment.likes.split(','):[];_this.galleryData.images[imageId].galleryComments[comment.id].likes_alias=comment.likes_alias!==null&&typeof comment.likes_alias!=='undefined'?comment.likes_alias.split(','):[]};this.addCommentToImageComment=function(imageId,commentId,comment){comment.content=comment.content.replace(/(?:\r\n|\r|\n)/g,'<br />');comment.content=(comment.content.replace(/(<br \/>)*$/g,'').replace(/^(<br \/>)*/,'')).trim();while(comment.content.includes('<br /><br /><br />')){comment.content=comment.content.replace(/(?:<br \/><br \/><br \/>)/g,'<br /><br />')}
if(defined(_this.galleryData.images[imageId].galleryComments[commentId])){if(defined(_this.galleryData.images[imageId].galleryComments[commentId].replies[comment.id])){for(var property in comment){if(comment.hasOwnProperty(property)){_this.galleryData.images[imageId].galleryComments[commentId].replies[comment.id][property]=comment[property]}}}else{_this.galleryData.images[imageId].galleryComments[commentId].replies[comment.id]=comment}
_this.galleryData.images[imageId].galleryComments[commentId].replies[comment.id].likes=comment.likes!==null&&typeof comment.likes!=='undefined'?comment.likes.split(','):[];_this.galleryData.images[imageId].galleryComments[commentId].replies[comment.id].likes_alias=comment.likes_alias!==null&&typeof comment.likes_alias!=='undefined'?comment.likes_alias.split(','):[]}};this.loadInspiration=function(username,pos,count,callback,failCallBack){if(defined(username)&&defined(pos)&&defined(count)){$http({method:'POST',url:APIURL,data:'schema=galleryImageInspiredLoad&username='+username+'&pos='+pos+'&count='+count,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.inspirationItems.forEach(function(inspirationItem){var image=_this.generateImageFromImageData(inspirationItem);var user=_this.generateUserFromImageData(inspirationItem);_this.addOrUpdateImage(image);UserService.addOrUpdateUser(user);UserService.addInspirationToUser(image.id,inspirationItem.inspirationUserId)})}else if(defined(data.complete)){$rootScope.galleryFinishedLoading=!0}else{console.log(data)}
callback()}).catch(function(response){console.log(response);failCallBack()})}};this.updateInspirationImage=function(imageId,inspired){var userId=$rootScope.user;var token=$rootScope.getUser(userId).token;if(defined(userId)&&defined(token)&&defined(imageId)&&defined(inspired)){if(inspired){UserService.addPersonalInspirationToUser(imageId)}else{UserService.removeInspirationFromUser(userId,imageId)}
$http({method:'POST',url:APIURL,data:'schema=galleryImageInspire&userId='+userId+'&token='+token+'&imageId='+imageId+'&inspired='+inspired,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){console.log(data);if(inspired){UserService.removeInspirationFromUser(userId,imageId)}else{UserService.addPersonalInspirationToUser(imageId)}}}).catch(function(response){console.log(response)})}};this.loadFeatureOrder=function($scope){$http({method:'POST',url:APIURL,data:'schema=galleryImageFeaturedOrder',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.featureOrder.forEach(function(featureOrderItem){if($scope.featureOrder!==''){$scope.featureOrder+=','}
$scope.featureOrder+=featureOrderItem.id})}else{console.log(data)}}).catch(function(response){console.log(response)})};this.updateFeatureOrder=function(order){var userId=$rootScope.user;var token=$rootScope.getUser($rootScope.user).token;if(defined(userId)&&defined(token)&&defined(order)){$http({method:'POST',url:APIURL,data:'schema=galleryImageFeaturedOrderUpdate&userId='+userId+'&token='+token+'&order='+order,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.galleryItems.forEach(function(galleryItem){_this.addOrUpdateImage(galleryItem)})}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.flagFeatured=function(imageId,flag){var userId=$rootScope.user;var token=$rootScope.getUser($rootScope.user).token;console.log(flag);if(defined(userId)&&defined(token)&&defined(imageId)&&defined(flag)){$http({method:'POST',url:APIURL,data:'schema=galleryImageFeatured&userId='+userId+'&token='+token+'&imageId='+imageId+'&featured='+flag,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var image=_this.generateImageFromImageData(data.galleryItem);_this.addOrUpdateImage(image);if(image.featured==='1'){_this.addToFeatureGallery(image,!0)}else{_this.removeFromFeatureGallery(image)}}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.likeImage=function(userId,token,imageId){if(defined(userId)&&defined(token)&&defined(imageId)){if($rootScope.binaryLocked.like.image.indexOf(imageId)===-1){$rootScope.binaryLocked.like.image.push(imageId);_this.galleryData.images[imageId].likes.push(userId);$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=gallleryImageLike&userId='+userId+'&token='+token+'&imageId='+imageId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){var index=_this.galleryData.images[imageId].likes.indexOf(userId);if(index!==-1){_this.galleryData.images[imageId].likes.splice(index,1)}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.image.indexOf(imageId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.image.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.image.indexOf(imageId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.image.splice(binaryIndex,1)}})}}};this.removeImageLike=function(userId,token,imageId){if(defined(userId)&&defined(token)&&defined(imageId)){if($rootScope.binaryLocked.like.image.indexOf(imageId)===-1){$rootScope.binaryLocked.like.image.push(imageId);var index=_this.galleryData.images[imageId].likes.indexOf(userId);if(index!==-1){_this.galleryData.images[imageId].likes.splice(index,1);if(!$rootScope.$$phase){$rootScope.$apply()}}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=gallleryImageLikeRemove&userId='+userId+'&token='+token+'&imageId='+imageId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){_this.galleryData.images[imageId].likes.push(userId);console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.image.indexOf(imageId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.image.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.image.indexOf(imageId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.image.splice(binaryIndex,1)}})}}};this.likeComment=function(userId,token,imageId,commentId,replyId){var actualId=commentId;var index;if(replyId){actualId=replyId}
if(defined(userId)&&defined(token)&&defined(actualId)){if($rootScope.binaryLocked.like.comment.indexOf(commentId)===-1){$rootScope.binaryLocked.like.comment.push(commentId);if(replyId){_this.galleryData.images[imageId].galleryComments[commentId].replies[replyId].likes.push(userId)}else{_this.galleryData.images[imageId].galleryComments[commentId].likes.push(userId)}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=galleryCommentLike&userId='+userId+'&token='+token+'&commentId='+actualId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){if(replyId){index=_this.galleryData.images[imageId].galleryComments[commentId].replies[replyId].likes.indexOf(userId);if(index!==-1){_this.galleryData.images[imageId].galleryComments[commentId].replies[replyId].likes.splice(index,1)}}else{index=_this.galleryData.images[imageId].galleryComments[commentId].likes.indexOf(userId);if(index!==-1){_this.galleryData.images[imageId].galleryComments[commentId].likes.splice(index,1)}}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.comment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.comment.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.comment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.comment.splice(binaryIndex,1)}})}}};this.removeCommentLike=function(userId,token,imageId,commentId,replyId){var actualId=commentId;var index;if(replyId){actualId=replyId}
if(defined(userId)&&defined(token)&&defined(actualId)){if($rootScope.binaryLocked.like.comment.indexOf(commentId)===-1){$rootScope.binaryLocked.like.comment.push(commentId);if(replyId){index=_this.galleryData.images[imageId].galleryComments[commentId].replies[replyId].likes.indexOf(userId);if(index!==-1){_this.galleryData.images[imageId].galleryComments[commentId].replies[replyId].likes.splice(index,1)}}else{index=_this.galleryData.images[imageId].galleryComments[commentId].likes.indexOf(userId);if(index!==-1){_this.galleryData.images[imageId].galleryComments[commentId].likes.splice(index,1)}}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=galleryCommentLikeRemove&userId='+userId+'&token='+token+'&commentId='+actualId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){if(replyId){_this.galleryData.images[imageId].galleryComments[commentId].replies[replyId].likes.push(userId)}else{_this.galleryData.images[imageId].galleryComments[commentId].likes.push(userId)}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.comment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.comment.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.comment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.comment.splice(binaryIndex,1)}})}}};this.removeUserImage=function(userId,token,imageId){if(defined(userId)&&defined(token)&&defined(imageId)){$http({method:'POST',url:APIURL,data:'schema=galleryImageRemove&userId='+userId+'&token='+token+'&imageId='+imageId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var index=_this.galleryData.gallery.indexOf(""+imageId);var indexFeatured=_this.galleryData.featured.indexOf(""+imageId);var indexPopular=_this.galleryData.popular.indexOf(""+imageId);var username=$rootScope.getUser(userId,'image').username;if(index>=0){_this.galleryData.gallery.splice(index,1)}
if(indexFeatured>=0){_this.galleryData.featured.splice(indexFeatured,1)}
if(indexPopular>=0){_this.galleryData.popular.splice(indexPopular,1)}
_this.removeImage(imageId);UserService.removeImageFromUser(userId,imageId)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.generateUserFromImageData=function(imageData){var user={};user.id=imageData.userId;user.username=imageData.username;user.avatar=imageData.avatar;user.alias=imageData.alias;user.job_title=imageData.job_title;user.views=imageData.user_views;user.savage=imageData.savage;return user};this.generateImageFromImageData=function(imageData){var image={};image.galleryComments={};image.id=imageData.id;image.userId=imageData.userId;image.created=imageData.created;image.thumb=imageData.thumb.replace('http://',BASEPROTOCOL);image.width=imageData.width;image.height=imageData.height;image.image=imageData.image.replace('http://',BASEPROTOCOL);image.protected=imageData.protected;image.title=imageData.title;image.likes=[];image.description=imageData.description;image.views=imageData.views;image.license=imageData.license;image.mature=imageData.mature;image.comments=imageData.comments;image.private=imageData.private;image.status=imageData.status;image.keywords=imageData.keywords;image.featured=imageData.featured;image.featured_order=imageData.featured_order;image.categories=imageData.categories;image.likesCount=defined(imageData.likesCount)?imageData.likesCount:0;image.defaultKeywords="";image.description=image.description.replace(/(?:\r\n|\r|\n)/g,'<br />');image.description=(image.description.replace(/(<br \/>)*$/g,'').replace(/^(<br \/>)*/,'')).trim();while(image.description.includes('<br /><br /><br />')){image.description=image.description.replace(/(?:<br \/><br \/><br \/>)/g,'<br /><br />')}
if(defined(image.categories)&&image.categories!==null){image.keywords=image.keywords.split(',');image.categories=image.categories.split(',');for(var i=0;i<image.categories.length;i++){if(image.categories[i]==='3'&&image.defaultKeywords.indexOf(image.keywords[i])===-1){image.defaultKeywords+=image.defaultKeywords.length?',':'';image.defaultKeywords+=image.keywords[i]}}}
if(imageData.likes!==null&&typeof imageData.likes!=='undefined'){var imageLikes=imageData.likes.split(',');for(var j=0;j<imageLikes.length;j++){if(image.likes.indexOf(imageLikes[j])===-1){image.likes.push(imageLikes[j])}}}
image.averageRGB=JSON.parse(imageData.averageRGB);return image};this.addToGallery=function(image){if(_this.galleryData.gallery.indexOf(image.id)===-1){_this.galleryData.gallery.push(image.id)}};this.removeFromGallery=function(image){if(_this.galleryData.gallery.indexOf(image.id)!==-1){_this.galleryData.gallery.splice(_this.galleryData.gallery.indexOf(image.id),1)}};this.addToPopular=function(image){if(_this.galleryData.popular.indexOf(image.id)===-1){_this.galleryData.popular.push(image.id)}};this.removeFromPopularGallery=function(image){if(_this.galleryData.popular.indexOf(image.id)!==-1){_this.galleryData.popular.splice(_this.galleryData.popular.indexOf(image.id),1)}};this.addToFeatureGallery=function(image,prepend){if(_this.galleryData.featured.indexOf(image.id)===-1){if(defined(prepend)&&prepend){_this.galleryData.featured.unshift(image.id)}else{_this.galleryData.featured.push(image.id)}}};this.clearGalleries=function(){_this.clearFeaturedGallery();_this.clearPopularGallery();_this.clearRecentGallery()};this.clearFeaturedGallery=function(){this.galleryData.featured=[]};this.clearPopularGallery=function(){this.galleryData.popular=[]};this.clearRecentGallery=function(){this.galleryData.gallery=[]};this.removeFromFeatureGallery=function(image){if(_this.galleryData.featured.indexOf(image.id)!==-1){_this.galleryData.featured.splice(_this.galleryData.featured.indexOf(image.id),1)}};this.removeImage=function(imageId){delete _this.galleryData.images[imageId]};this.addOrUpdateImage=function(image){if(defined(_this.galleryData.images[image.id])){for(var property in image){if(image.hasOwnProperty(property)){_this.galleryData.images[image.id][property]=image[property]}}}else{_this.galleryData.images[image.id]=image}};this.getData=function(){return _this.galleryData}}]);app.service('IsotopeService',['$rootScope','$compile',function($rootScope,$compile){var _this=this;this.scopes={};this.isotopeData={galleries:{image:{recent:{reference:'',$element:{},ids:[]},popular:{reference:'',$element:{},ids:[]},featured:{reference:'',$element:{},ids:[]},users:{}},inspiration:{users:{}},competition:{artPrize:{reference:'',$element:{},ids:[]},results:{reference:'',$element:{},ids:[]}},market:{recent:{reference:'',$element:{},ids:[]},popular:{reference:'',$element:{},ids:[]},featured:{reference:'',$element:{},ids:[]},users:{}}}};this.synchroniseGroup=function(data,container,type,group,user,$usedScope){var isotopeObject;var newItems=[];var toDelete=[];var key='';if(group==="user"){key=type+user;if(typeof _this.isotopeData.galleries[type].users[user]==='undefined'){_this.isotopeData.galleries[type].users[user]={}}
isotopeObject=_this.isotopeData.galleries[type].users[user]}else{key=type+group;isotopeObject=_this.isotopeData.galleries[type][group]}
if($rootScope.isEmpty(isotopeObject.$element)||!jQuery.contains(document,isotopeObject.$element.get(0))){isotopeObject.reference=container;isotopeObject.ids=[];isotopeObject.$element=jQuery(container).isotope({itemSelector:'.layout-cell',transitionDuration:0,masonry:{fitWidth:!0,gutter:'.gallery-gutter'}})}
if(!$rootScope.isEmpty(isotopeObject.$element)&&jQuery.contains(document,isotopeObject.$element.get(0))){$.each(data,function(i,id){if(type==='competition'){if(isotopeObject.ids.indexOf(id)===-1){newItems.push(id);isotopeObject.ids.push(id)}}else{if(defined($rootScope.getImage(id))){if(isotopeObject.ids.indexOf(id)===-1){newItems.push(id);isotopeObject.ids.push(id)}}}});$.each(isotopeObject.ids,function(i,id){if(type==='competition'){if(data.indexOf(id)===-1){toDelete.push(id)}}else{if(defined($rootScope.getImage(id))){if(data.indexOf(id)===-1){toDelete.push(id)}}}});$.each(newItems,function(i,id){var $element;if(type==='competition'){$element=_this.generatePrizeElement(id,i%5,type,group,$usedScope)}else{$element=_this.generateNewElement(id,i%5,type,group)}
if($usedScope.prepend){isotopeObject.$element.prepend($element).isotope('prepended',$element)}else{isotopeObject.$element.append($element).isotope('appended',$element)}
_this.scopes[id+key]=$usedScope.$new();$compile($element.get(0))(_this.scopes[id+key])});$.each(toDelete,function(i,id){var $element=_this.getElementById(id,isotopeObject.$element);_this.scopes[id+key].$destroy();isotopeObject.$element.isotope('remove',$element.get(0));isotopeObject.ids.splice(isotopeObject.ids.indexOf(id),1)});isotopeObject.$element.isotope('layout');$(window).resize(function(){if($rootScope.baseOuterWidth!==$(window).outerWidth()){isotopeObject.$element.find('img').attr('height','').attr('width','').css('height','auto');$rootScope.baseOuterWidth=$(window).outerWidth()}});if(!$rootScope.$$phase){$rootScope.$apply()}}
$usedScope.preppend=!1};this.getElementById=function(id,parent){return parent.find('div[data-id="'+id+'"]')};this.generateNewElement=function(id,count,type,group){var image=$rootScope.getImage(id);var user=$rootScope.getUser(id,'image');var titleClass=defined(image.title)&&image.title.length>0?'title':'';var height=$rootScope.getThumbHeight(id);var width=278;if($(window).outerWidth()<656){width=177}
if($(window).outerWidth()<414){width=157}
if($(window).outerWidth()<375){width=280}
if(height===''){height=width+''}
var url='/'+user.username+'/artwork/'+id;switch(type){case 'image':switch(group){case 'featured':case 'popular':case 'recent':return $('<div id="image-'+id+'" class="item-artwork layout-cell force hvr {{ getImageClass('+id+') }}" data-created="'+image.created+'" data-id="'+id+'" data-url="/'+user.username+'/artwork/'+id+'" data-hover-with-color>'+'<div class="artworkIndicatorShowcase"><span class="artworkIsMature" title="This artwork has been marked as \'Mature content\'"></span></div>'+'<div class="artworkOptions" data-ng-if="!(isMobile() || isPad())" data-ng-click="optionsGalleryItem('+id+')"></div>'+'<div class="forceTouchOptions" data-ng-if="isMobile() || isPad()">'+'<div class="touchOptions-container">'+'<div class="touchOption editArtwork" data-ng-if="loggedIn && isOwner('+id+')" data-touched>'+'<a data-ng-href="'+url+'/edit" title="'+image.title+' Editor" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M5.092,32.356L7.233,24.412L15.588,32.765L7.64,34.908L7.649,34.919C6.949,35.12 6.159,34.946 5.608,34.392C5.056,33.839 4.879,33.053 5.081,32.351L5.092,32.356ZM17.53,30.825L34.409,13.946C35.197,13.158 35.197,11.881 34.409,11.093L28.905,5.591C28.119,4.803 26.841,4.803 26.054,5.591L9.177,22.467L17.53,30.825Z"/>'+'</svg>'+'<span class="touchOptionText">Edit</span>'+'</a>'+'</div>'+'<div class="touchOption likeArtwork {{ isLiked('+id+') ? \'liked\' : \'\' }}" data-ng-if="loggedIn && !isOwner('+id+')" data-ng-click="performImageLike('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M32.836,31.258L15.458,31.258C13.972,31.258 13,30.268 13,28.876C13,28.876 13,22.327 13,18.096C13,16.298 14.21,14.71 15.988,14.178C16.259,14.139 16.497,14.073 16.689,13.995C18.053,13.467 19.034,12.591 20.377,11.019C21.17,10.093 24.053,6.132 25.297,6.261C25.868,6.319 26.281,6.503 26.64,6.726C27.304,7.105 27.708,7.797 27.704,8.54C27.729,12.129 27.754,14.581 27.754,14.593L34.51,14.593C35.261,14.593 35.974,14.921 36.446,15.488C36.917,16.055 37.101,16.798 36.946,17.51C36.104,21.314 34.672,27.77 34.126,30.249C33.996,30.835 33.458,31.258 32.836,31.258ZM11,31.258L4,31.258L4,15.258L11,15.258L11,31.258Z"/>'+'</svg>'+'<span class="touchOptionText">Like</span>'+'</div>'+'<div class="touchOption inspireArtwork" data-ng-if="loggedIn && !isOwner('+id+')" data-ng-click="flagInspiredImage('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M34.978,18.596C35.593,17.993 35.81,17.114 35.544,16.294C35.278,15.473 34.586,14.888 33.731,14.766L26.151,13.664C25.826,13.615 25.548,13.413 25.404,13.122L22.015,6.252C21.635,5.48 20.861,5 20,5C19.141,5 18.369,5.48 17.985,6.252L14.597,13.122C14.453,13.413 14.175,13.618 13.849,13.664L6.269,14.766C5.416,14.888 4.72,15.473 4.455,16.294C4.191,17.114 4.408,17.996 5.024,18.596L10.509,23.941C10.742,24.171 10.85,24.499 10.794,24.82L9.5,32.37C9.387,33.034 9.56,33.683 9.99,34.191C10.66,34.987 11.827,35.23 12.759,34.737L19.538,31.173C19.822,31.023 20.177,31.026 20.462,31.173L27.244,34.737C27.572,34.911 27.923,35 28.288,35C28.95,35 29.58,34.706 30.012,34.191C30.44,33.683 30.615,33.034 30.502,32.37L29.206,24.82C29.151,24.499 29.258,24.171 29.491,23.941L34.978,18.596Z" style="fill-rule:nonzero;"/>'+'</svg>'+'<span class="touchOptionText">Add to Inspiration</span>'+'</div>'+'<div class="touchOption viewArtist" data-ng-if="!loggedIn" data-touched>'+'<a data-ng-href="/'+user.username+'" title="'+user.alias+'" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M20.22,3.001C21.013,3.016 21.803,3.076 22.587,3.196C24.175,3.439 25.726,3.909 27.181,4.589C28.852,5.37 30.392,6.424 31.727,7.697C33.109,9.014 34.268,10.564 35.139,12.263C35.868,13.687 36.394,15.213 36.696,16.784C37.048,18.623 37.095,20.521 36.835,22.376C36.593,24.105 36.081,25.795 35.323,27.367C34.433,29.212 33.208,30.891 31.727,32.303C30.192,33.766 28.386,34.94 26.423,35.743C24.389,36.574 22.197,37 20,37C17.803,37 15.611,36.574 13.577,35.743C11.614,34.94 9.808,33.766 8.273,32.303C6.792,30.891 5.567,29.212 4.677,27.367C3.919,25.795 3.407,24.105 3.165,22.376C2.905,20.521 2.952,18.623 3.304,16.784C3.606,15.213 4.132,13.687 4.861,12.263C5.732,10.564 6.891,9.014 8.273,7.697C9.608,6.424 11.148,5.37 12.819,4.589C14.274,3.909 15.825,3.439 17.413,3.196C18.197,3.076 18.987,3.016 19.78,3.001C20,3 20,3 20.22,3.001ZM31.803,27.527C32.104,27.056 32.377,26.568 32.62,26.065C33.244,24.771 33.665,23.382 33.864,21.96C34.086,20.373 34.037,18.747 33.715,17.178C33.452,15.891 33.004,14.643 32.391,13.481C31.683,12.139 30.755,10.915 29.656,9.868C28.557,8.819 27.288,7.95 25.911,7.307C24.715,6.748 23.439,6.361 22.134,6.162C21.487,6.063 20.836,6.014 20.182,6.001C20,6 20,6 19.818,6.001C19.164,6.014 18.513,6.063 17.866,6.162C16.561,6.361 15.285,6.748 14.089,7.307C12.712,7.95 11.443,8.819 10.344,9.868C9.245,10.915 8.317,12.139 7.609,13.481C6.996,14.643 6.548,15.891 6.285,17.178C5.963,18.747 5.914,20.373 6.136,21.96C6.335,23.382 6.756,24.771 7.38,26.065C7.623,26.568 7.896,27.056 8.197,27.527C8.236,27.505 8.275,27.484 8.314,27.462C9.069,27.054 9.875,26.739 10.697,26.483C11.766,26.147 12.867,25.91 13.976,25.732C15.273,25.525 16.584,25.402 17.897,25.339C17.945,25.337 17.993,25.335 18.042,25.332C16.962,24.822 16.081,23.939 15.416,22.957C15.295,22.777 15.18,22.594 15.071,22.407C14.913,22.137 14.769,21.859 14.637,21.576C14.422,21.114 14.24,20.637 14.091,20.152C13.976,19.783 13.88,19.408 13.804,19.029C13.747,18.744 13.701,18.456 13.665,18.167C13.472,16.569 13.62,14.888 14.335,13.428C14.432,13.229 14.539,13.035 14.657,12.848C14.829,12.572 15.023,12.311 15.237,12.066C15.517,11.748 15.831,11.459 16.172,11.207C16.613,10.881 17.099,10.619 17.612,10.425C18.076,10.248 18.561,10.129 19.053,10.063C19.314,10.027 19.578,10.009 19.841,10.001C19.92,10 19.96,10 20,10L20.065,10C20.089,10.001 20.119,10.001 20.159,10.001C20.422,10.009 20.686,10.027 20.947,10.063C21.439,10.129 21.924,10.248 22.388,10.425C22.901,10.619 23.387,10.881 23.828,11.207C24.169,11.459 24.483,11.748 24.763,12.066C24.977,12.311 25.171,12.572 25.343,12.848C25.461,13.035 25.568,13.229 25.665,13.428C26.38,14.888 26.528,16.569 26.335,18.167C26.299,18.456 26.253,18.744 26.196,19.029C26.12,19.408 26.024,19.783 25.909,20.152C25.76,20.637 25.578,21.114 25.363,21.576C25.231,21.859 25.087,22.137 24.929,22.407C24.82,22.594 24.705,22.777 24.584,22.957C23.919,23.939 23.038,24.822 21.958,25.332C22.007,25.335 22.055,25.337 22.103,25.339C23.416,25.402 24.727,25.525 26.024,25.732C27.133,25.91 28.234,26.147 29.303,26.483C30.125,26.739 30.931,27.054 31.686,27.462C31.725,27.484 31.764,27.505 31.803,27.527Z"/>'+'</svg>'+'<span class="touchOptionText">View Artist</span>'+'</a>'+'</div>'+'<div class="touchOption openTab" data-ng-if="(loggedIn && isOwner('+id+')) || !loggedIn" data-touched>'+'<a target="_blank" data-ng-href="'+url+'" title="'+image.title+'" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M15.107,4.969L31.5,4.969C33.439,4.969 35.013,6.543 35.013,8.482L35.013,24.875C35.013,26.813 33.439,28.387 31.5,28.388L28.458,28.388C28.457,28.901 28.456,29.414 28.456,29.928C28.454,30.093 28.447,30.257 28.43,30.421C28.392,30.797 28.312,31.167 28.191,31.525C27.969,32.179 27.612,32.785 27.147,33.296C26.63,33.865 25.983,34.312 25.268,34.594C24.88,34.748 24.473,34.852 24.059,34.905C23.89,34.926 23.72,34.937 23.55,34.943C19.015,35.001 14.479,35.001 9.944,34.943C9.773,34.937 9.604,34.926 9.434,34.905C9.021,34.852 8.613,34.748 8.225,34.594C7.548,34.327 6.931,33.911 6.428,33.384C5.953,32.885 5.581,32.289 5.344,31.641C5.215,31.288 5.125,30.921 5.078,30.548C5.056,30.378 5.045,30.209 5.039,30.039C4.982,25.541 5.037,21.042 5.037,16.543C5.04,16.378 5.046,16.214 5.063,16.05C5.101,15.675 5.182,15.304 5.303,14.947C5.537,14.254 5.924,13.616 6.428,13.087C6.931,12.56 7.548,12.144 8.225,11.877C8.613,11.724 9.021,11.619 9.434,11.566C9.604,11.545 9.773,11.534 9.944,11.528C10.494,11.521 11.044,11.515 11.595,11.512L11.595,8.482C11.595,6.543 13.169,4.969 15.107,4.969ZM24.709,18.084L24.709,21.83C24.709,22.606 24.08,23.236 23.304,23.236C22.528,23.236 21.899,22.606 21.899,21.83L21.899,18.084L18.152,18.084C17.376,18.083 16.747,17.454 16.747,16.678C16.747,15.902 17.376,15.273 18.152,15.273L21.899,15.273L21.899,11.526C21.899,10.75 22.528,10.121 23.304,10.121C24.08,10.121 24.709,10.75 24.709,11.526L24.709,15.273L28.456,15.273C29.232,15.273 29.861,15.902 29.861,16.678C29.861,17.454 29.232,18.083 28.456,18.084L24.709,18.084ZM15.107,28.388C13.168,28.387 11.595,26.813 11.595,24.875L11.595,14.32C11.068,14.325 10.542,14.331 10.015,14.337C9.773,14.346 9.536,14.388 9.308,14.472C8.716,14.689 8.233,15.16 8.002,15.746C7.906,15.989 7.858,16.244 7.848,16.504C7.792,20.991 7.792,25.48 7.848,29.967C7.858,30.227 7.906,30.483 8.002,30.725C8.233,31.312 8.716,31.783 9.308,31.999C9.536,32.083 9.773,32.125 10.015,32.134C14.483,32.19 18.952,32.135 23.421,32.135C23.682,32.131 23.94,32.09 24.186,31.999C24.795,31.776 25.287,31.284 25.511,30.674C25.594,30.447 25.636,30.209 25.645,29.967C25.652,29.441 25.658,28.914 25.663,28.388L15.107,28.388Z"/>'+'</svg>'+'<span class="touchOptionText">Open in New Tab</span>'+'</a>'+'</div>'+'<div class="touchOption adminTools" data-ng-click="optionsGalleryItem('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M6,16C8.208,16 10,17.792 10,20C10,22.208 8.208,24 6,24C3.792,24 2,22.208 2,20C2,17.792 3.792,16 6,16ZM20,16C22.208,16 24,17.792 24,20C24,22.208 22.208,24 20,24C17.792,24 16,22.208 16,20C16,17.792 17.792,16 20,16ZM34,16C36.208,16 38,17.792 38,20C38,22.208 36.208,24 34,24C31.792,24 30,22.208 30,20C30,17.792 31.792,16 34,16Z"/>'+'</svg>'+'<span class="touchOptionText">Admin Tools</span>'+'</div>'+'</div>'+'</div>'+'<div class="artworkInfoAndActions" data-ng-if="!isMobile() && !isPad()">'+'<div class="owner artworkItem">'+'<a class="ownerLink" href="/'+user.username+'" title="'+user.alias+'">'+'<div class="ownerAvatar">'+'<img data-ng-if="getUser('+id+', \'image\').avatar.length > 0" data-ng-src="'+user.avatar+'" alt="'+user.alias+'" />'+'</div>'+'<div class="ownerDetails">'+'<div class="ownerName">'+user.alias+'</div>'+'</div>'+'</a>'+'</div>'+'<div class="artworkLike artworkAction {{ isLiked('+id+') ? \'liked\' : \'\' }}" data-ng-if="!isMobile() && (loggedIn && !isOwner('+id+'))" data-ng-click="performImageLike('+id+')">{{ isLiked('+id+') ? \'Liked\' : \'Like\' }}</div>'+'<div class="artworkInspire artworkAction" data-ng-if="!isMobile() && (loggedIn && !isOwner('+id+'))" data-ng-click="flagInspiredImage('+id+')"></div>'+'<div class="artworkEdit artworkAction" data-ng-if="!isMobile() && (loggedIn && isOwner('+id+'))" data-ng-click="redirect(\''+url+'/edit\')"></div>'+'</div>'+'<a data-ng-href="'+url+'" class="artworkLink longHoldEnabled" data-on-long-press="flagLongPress('+id+')" data-on-click="flagLinkClicked()"></a>'+'<div class="item-object artwork '+titleClass+'" data-r="'+image.averageRGB.r+'" data-g="'+image.averageRGB.g+'" data-b="'+image.averageRGB.b+'">'+'<div class="item-mature-flag"></div>'+'<div class="item-content">'+'<img data-ng-src="{{ getImage('+id+').mature == \'1\' && (!loggedIn || getUser(user).mature != \'1\') ? \''+image.protected+'\' : \''+image.thumb+'\' }}" width="'+width+'" height="'+height+'" >'+'<div class="default-color" style="background-color: rgb('+image.averageRGB.r+', '+image.averageRGB.g+', '+image.averageRGB.b+');"></div>'+'</div>'+'</div>'+'</div>');break;case 'user':return $('<div id="image-'+id+'" class="item-artwork layout-cell force hvr {{ getImageClass('+id+') }}" data-created="'+image.created+'" data-id="'+id+'" data-url="/'+user.username+'/artwork/'+id+'" data-hover-with-color>'+'<div class="artworkIndicatorShowcase"><span class="artworkIsMature" title="This artwork has been marked as \'Mature content\'"></span></div>'+'<div class="artworkOptions" data-ng-if="!(isMobile() || isPad())" data-ng-click="optionsGalleryItem('+id+')"></div>'+'<div class="forceTouchOptions" data-ng-if="isMobile() || isPad()">'+'<div class="touchOptions-container">'+'<div class="touchOption editArtwork" data-ng-if="loggedIn && isOwner('+id+')" data-touched>'+'<a data-ng-href="'+url+'/edit" title="'+image.title+' Editor" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M5.092,32.356L7.233,24.412L15.588,32.765L7.64,34.908L7.649,34.919C6.949,35.12 6.159,34.946 5.608,34.392C5.056,33.839 4.879,33.053 5.081,32.351L5.092,32.356ZM17.53,30.825L34.409,13.946C35.197,13.158 35.197,11.881 34.409,11.093L28.905,5.591C28.119,4.803 26.841,4.803 26.054,5.591L9.177,22.467L17.53,30.825Z"/>'+'</svg>'+'<span class="touchOptionText">Edit</span>'+'</a>'+'</div>'+'<div class="touchOption likeArtwork {{ isLiked('+id+') ? \'liked\' : \'\' }}" data-ng-if="loggedIn && !isOwner('+id+')" data-ng-click="performImageLike('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M32.836,31.258L15.458,31.258C13.972,31.258 13,30.268 13,28.876C13,28.876 13,22.327 13,18.096C13,16.298 14.21,14.71 15.988,14.178C16.259,14.139 16.497,14.073 16.689,13.995C18.053,13.467 19.034,12.591 20.377,11.019C21.17,10.093 24.053,6.132 25.297,6.261C25.868,6.319 26.281,6.503 26.64,6.726C27.304,7.105 27.708,7.797 27.704,8.54C27.729,12.129 27.754,14.581 27.754,14.593L34.51,14.593C35.261,14.593 35.974,14.921 36.446,15.488C36.917,16.055 37.101,16.798 36.946,17.51C36.104,21.314 34.672,27.77 34.126,30.249C33.996,30.835 33.458,31.258 32.836,31.258ZM11,31.258L4,31.258L4,15.258L11,15.258L11,31.258Z"/>'+'</svg>'+'<span class="touchOptionText">Like</span>'+'</div>'+'<div class="touchOption inspireArtwork" data-ng-if="loggedIn && !isOwner('+id+')" data-ng-click="flagInspiredImage('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M34.978,18.596C35.593,17.993 35.81,17.114 35.544,16.294C35.278,15.473 34.586,14.888 33.731,14.766L26.151,13.664C25.826,13.615 25.548,13.413 25.404,13.122L22.015,6.252C21.635,5.48 20.861,5 20,5C19.141,5 18.369,5.48 17.985,6.252L14.597,13.122C14.453,13.413 14.175,13.618 13.849,13.664L6.269,14.766C5.416,14.888 4.72,15.473 4.455,16.294C4.191,17.114 4.408,17.996 5.024,18.596L10.509,23.941C10.742,24.171 10.85,24.499 10.794,24.82L9.5,32.37C9.387,33.034 9.56,33.683 9.99,34.191C10.66,34.987 11.827,35.23 12.759,34.737L19.538,31.173C19.822,31.023 20.177,31.026 20.462,31.173L27.244,34.737C27.572,34.911 27.923,35 28.288,35C28.95,35 29.58,34.706 30.012,34.191C30.44,33.683 30.615,33.034 30.502,32.37L29.206,24.82C29.151,24.499 29.258,24.171 29.491,23.941L34.978,18.596Z" style="fill-rule:nonzero;"/>'+'</svg>'+'<span class="touchOptionText">Add to Inspiration</span>'+'</div>'+'<div class="touchOption viewArtist" data-ng-if="!loggedIn" data-touched>'+'<a data-ng-href="/'+user.username+'" title="'+user.alias+'" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M20.22,3.001C21.013,3.016 21.803,3.076 22.587,3.196C24.175,3.439 25.726,3.909 27.181,4.589C28.852,5.37 30.392,6.424 31.727,7.697C33.109,9.014 34.268,10.564 35.139,12.263C35.868,13.687 36.394,15.213 36.696,16.784C37.048,18.623 37.095,20.521 36.835,22.376C36.593,24.105 36.081,25.795 35.323,27.367C34.433,29.212 33.208,30.891 31.727,32.303C30.192,33.766 28.386,34.94 26.423,35.743C24.389,36.574 22.197,37 20,37C17.803,37 15.611,36.574 13.577,35.743C11.614,34.94 9.808,33.766 8.273,32.303C6.792,30.891 5.567,29.212 4.677,27.367C3.919,25.795 3.407,24.105 3.165,22.376C2.905,20.521 2.952,18.623 3.304,16.784C3.606,15.213 4.132,13.687 4.861,12.263C5.732,10.564 6.891,9.014 8.273,7.697C9.608,6.424 11.148,5.37 12.819,4.589C14.274,3.909 15.825,3.439 17.413,3.196C18.197,3.076 18.987,3.016 19.78,3.001C20,3 20,3 20.22,3.001ZM31.803,27.527C32.104,27.056 32.377,26.568 32.62,26.065C33.244,24.771 33.665,23.382 33.864,21.96C34.086,20.373 34.037,18.747 33.715,17.178C33.452,15.891 33.004,14.643 32.391,13.481C31.683,12.139 30.755,10.915 29.656,9.868C28.557,8.819 27.288,7.95 25.911,7.307C24.715,6.748 23.439,6.361 22.134,6.162C21.487,6.063 20.836,6.014 20.182,6.001C20,6 20,6 19.818,6.001C19.164,6.014 18.513,6.063 17.866,6.162C16.561,6.361 15.285,6.748 14.089,7.307C12.712,7.95 11.443,8.819 10.344,9.868C9.245,10.915 8.317,12.139 7.609,13.481C6.996,14.643 6.548,15.891 6.285,17.178C5.963,18.747 5.914,20.373 6.136,21.96C6.335,23.382 6.756,24.771 7.38,26.065C7.623,26.568 7.896,27.056 8.197,27.527C8.236,27.505 8.275,27.484 8.314,27.462C9.069,27.054 9.875,26.739 10.697,26.483C11.766,26.147 12.867,25.91 13.976,25.732C15.273,25.525 16.584,25.402 17.897,25.339C17.945,25.337 17.993,25.335 18.042,25.332C16.962,24.822 16.081,23.939 15.416,22.957C15.295,22.777 15.18,22.594 15.071,22.407C14.913,22.137 14.769,21.859 14.637,21.576C14.422,21.114 14.24,20.637 14.091,20.152C13.976,19.783 13.88,19.408 13.804,19.029C13.747,18.744 13.701,18.456 13.665,18.167C13.472,16.569 13.62,14.888 14.335,13.428C14.432,13.229 14.539,13.035 14.657,12.848C14.829,12.572 15.023,12.311 15.237,12.066C15.517,11.748 15.831,11.459 16.172,11.207C16.613,10.881 17.099,10.619 17.612,10.425C18.076,10.248 18.561,10.129 19.053,10.063C19.314,10.027 19.578,10.009 19.841,10.001C19.92,10 19.96,10 20,10L20.065,10C20.089,10.001 20.119,10.001 20.159,10.001C20.422,10.009 20.686,10.027 20.947,10.063C21.439,10.129 21.924,10.248 22.388,10.425C22.901,10.619 23.387,10.881 23.828,11.207C24.169,11.459 24.483,11.748 24.763,12.066C24.977,12.311 25.171,12.572 25.343,12.848C25.461,13.035 25.568,13.229 25.665,13.428C26.38,14.888 26.528,16.569 26.335,18.167C26.299,18.456 26.253,18.744 26.196,19.029C26.12,19.408 26.024,19.783 25.909,20.152C25.76,20.637 25.578,21.114 25.363,21.576C25.231,21.859 25.087,22.137 24.929,22.407C24.82,22.594 24.705,22.777 24.584,22.957C23.919,23.939 23.038,24.822 21.958,25.332C22.007,25.335 22.055,25.337 22.103,25.339C23.416,25.402 24.727,25.525 26.024,25.732C27.133,25.91 28.234,26.147 29.303,26.483C30.125,26.739 30.931,27.054 31.686,27.462C31.725,27.484 31.764,27.505 31.803,27.527Z"/>'+'</svg>'+'<span class="touchOptionText">View Artist</span>'+'</a>'+'</div>'+'<div class="touchOption openTab" data-ng-if="(loggedIn && isOwner('+id+')) || !loggedIn" data-touched>'+'<a target="_blank" data-ng-href="'+url+'" title="'+image.title+'" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M15.107,4.969L31.5,4.969C33.439,4.969 35.013,6.543 35.013,8.482L35.013,24.875C35.013,26.813 33.439,28.387 31.5,28.388L28.458,28.388C28.457,28.901 28.456,29.414 28.456,29.928C28.454,30.093 28.447,30.257 28.43,30.421C28.392,30.797 28.312,31.167 28.191,31.525C27.969,32.179 27.612,32.785 27.147,33.296C26.63,33.865 25.983,34.312 25.268,34.594C24.88,34.748 24.473,34.852 24.059,34.905C23.89,34.926 23.72,34.937 23.55,34.943C19.015,35.001 14.479,35.001 9.944,34.943C9.773,34.937 9.604,34.926 9.434,34.905C9.021,34.852 8.613,34.748 8.225,34.594C7.548,34.327 6.931,33.911 6.428,33.384C5.953,32.885 5.581,32.289 5.344,31.641C5.215,31.288 5.125,30.921 5.078,30.548C5.056,30.378 5.045,30.209 5.039,30.039C4.982,25.541 5.037,21.042 5.037,16.543C5.04,16.378 5.046,16.214 5.063,16.05C5.101,15.675 5.182,15.304 5.303,14.947C5.537,14.254 5.924,13.616 6.428,13.087C6.931,12.56 7.548,12.144 8.225,11.877C8.613,11.724 9.021,11.619 9.434,11.566C9.604,11.545 9.773,11.534 9.944,11.528C10.494,11.521 11.044,11.515 11.595,11.512L11.595,8.482C11.595,6.543 13.169,4.969 15.107,4.969ZM24.709,18.084L24.709,21.83C24.709,22.606 24.08,23.236 23.304,23.236C22.528,23.236 21.899,22.606 21.899,21.83L21.899,18.084L18.152,18.084C17.376,18.083 16.747,17.454 16.747,16.678C16.747,15.902 17.376,15.273 18.152,15.273L21.899,15.273L21.899,11.526C21.899,10.75 22.528,10.121 23.304,10.121C24.08,10.121 24.709,10.75 24.709,11.526L24.709,15.273L28.456,15.273C29.232,15.273 29.861,15.902 29.861,16.678C29.861,17.454 29.232,18.083 28.456,18.084L24.709,18.084ZM15.107,28.388C13.168,28.387 11.595,26.813 11.595,24.875L11.595,14.32C11.068,14.325 10.542,14.331 10.015,14.337C9.773,14.346 9.536,14.388 9.308,14.472C8.716,14.689 8.233,15.16 8.002,15.746C7.906,15.989 7.858,16.244 7.848,16.504C7.792,20.991 7.792,25.48 7.848,29.967C7.858,30.227 7.906,30.483 8.002,30.725C8.233,31.312 8.716,31.783 9.308,31.999C9.536,32.083 9.773,32.125 10.015,32.134C14.483,32.19 18.952,32.135 23.421,32.135C23.682,32.131 23.94,32.09 24.186,31.999C24.795,31.776 25.287,31.284 25.511,30.674C25.594,30.447 25.636,30.209 25.645,29.967C25.652,29.441 25.658,28.914 25.663,28.388L15.107,28.388Z"/>'+'</svg>'+'<span class="touchOptionText">Open in New Tab</span>'+'</a>'+'</div>'+'<div class="touchOption adminTools" data-ng-click="optionsGalleryItem('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M6,16C8.208,16 10,17.792 10,20C10,22.208 8.208,24 6,24C3.792,24 2,22.208 2,20C2,17.792 3.792,16 6,16ZM20,16C22.208,16 24,17.792 24,20C24,22.208 22.208,24 20,24C17.792,24 16,22.208 16,20C16,17.792 17.792,16 20,16ZM34,16C36.208,16 38,17.792 38,20C38,22.208 36.208,24 34,24C31.792,24 30,22.208 30,20C30,17.792 31.792,16 34,16Z"/>'+'</svg>'+'<span class="touchOptionText">Admin Tools</span>'+'</div>'+'</div>'+'</div>'+'<div class="artworkInfoAndActions" data-ng-if="!isMobile() && !isPad()">'+'<div class="owner artworkItem">'+'<a class="ownerLink" href="/'+user.username+'" title="'+user.alias+'">'+'<div class="ownerAvatar">'+'<img data-ng-if="getUser('+id+', \'image\').avatar.length > 0" data-ng-src="'+user.avatar+'" alt="'+user.alias+'" />'+'</div>'+'<div class="ownerDetails">'+'<div class="ownerName">'+user.alias+'</div>'+'</div>'+'</a>'+'</div>'+'<div class="artworkLike artworkAction {{ isLiked('+id+') ? \'liked\' : \'\' }}" data-ng-if="!isMobile() && (loggedIn && !isOwner('+id+'))" data-ng-click="performImageLike('+id+')">{{ isLiked('+id+') ? \'Liked\' : \'Like\' }}</div>'+'<div class="artworkInspire artworkAction" data-ng-if="!isMobile() && (loggedIn && !isOwner('+id+'))" data-ng-click="flagInspiredImage('+id+')"></div>'+'<div class="artworkEdit artworkAction" data-ng-if="!isMobile() && (loggedIn && isOwner('+id+'))" data-ng-click="redirect(\''+url+'/edit\')"></div>'+'</div>'+'<a data-ng-href="'+url+'" class="artworkLink" data-ng-click="flagLinkClicked()"></a>'+'<div class="item-object artwork '+titleClass+'" data-r="'+image.averageRGB.r+'" data-g="'+image.averageRGB.g+'" data-b="'+image.averageRGB.b+'">'+'<div class="item-mature-flag"></div>'+'<div class="item-content">'+'<img data-ng-src="{{ getImage('+id+').mature == \'1\' && (!loggedIn || getUser(user).mature != \'1\') ? \''+image.protected+'\' : \''+image.thumb+'\' }}" width="'+width+'" height="'+height+'" >'+'<div class="default-color" style="background-color: rgb('+image.averageRGB.r+', '+image.averageRGB.g+', '+image.averageRGB.b+');"></div>'+'</div>'+'</div>'+'</div>');break}
break;case 'inspiration':return $('<div id="image-'+id+'" class="item-artwork layout-cell force hvr {{ getImageClass('+id+') }}" data-created="'+image.created+'" data-id="'+id+'" data-url="/'+user.username+'/artwork/'+id+'" data-hover-with-color>'+'<div class="artworkIndicatorShowcase"><span class="artworkIsMature" title="This artwork has been marked as \'Mature content\'"></span></div>'+'<div class="artworkOptions" data-ng-if="!(isMobile() || isPad())" data-ng-click="optionsGalleryItem('+id+')"></div>'+'<div class="forceTouchOptions" data-ng-if="isMobile() || isPad()">'+'<div class="touchOptions-container">'+'<div class="touchOption editArtwork" data-ng-if="loggedIn && isOwner('+id+')" data-touched>'+'<a data-ng-href="'+url+'/edit" title="'+image.title+' Editor" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M5.092,32.356L7.233,24.412L15.588,32.765L7.64,34.908L7.649,34.919C6.949,35.12 6.159,34.946 5.608,34.392C5.056,33.839 4.879,33.053 5.081,32.351L5.092,32.356ZM17.53,30.825L34.409,13.946C35.197,13.158 35.197,11.881 34.409,11.093L28.905,5.591C28.119,4.803 26.841,4.803 26.054,5.591L9.177,22.467L17.53,30.825Z"/>'+'</svg>'+'<span class="touchOptionText">Edit</span>'+'</a>'+'</div>'+'<div class="touchOption likeArtwork {{ isLiked('+id+') ? \'liked\' : \'\' }}" data-ng-if="loggedIn && !isOwner('+id+')" data-ng-click="performImageLike('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M32.836,31.258L15.458,31.258C13.972,31.258 13,30.268 13,28.876C13,28.876 13,22.327 13,18.096C13,16.298 14.21,14.71 15.988,14.178C16.259,14.139 16.497,14.073 16.689,13.995C18.053,13.467 19.034,12.591 20.377,11.019C21.17,10.093 24.053,6.132 25.297,6.261C25.868,6.319 26.281,6.503 26.64,6.726C27.304,7.105 27.708,7.797 27.704,8.54C27.729,12.129 27.754,14.581 27.754,14.593L34.51,14.593C35.261,14.593 35.974,14.921 36.446,15.488C36.917,16.055 37.101,16.798 36.946,17.51C36.104,21.314 34.672,27.77 34.126,30.249C33.996,30.835 33.458,31.258 32.836,31.258ZM11,31.258L4,31.258L4,15.258L11,15.258L11,31.258Z"/>'+'</svg>'+'<span class="touchOptionText">Like</span>'+'</div>'+'<div class="touchOption inspireArtwork" data-ng-if="loggedIn && !isOwner('+id+')" data-ng-click="flagInspiredImage('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M34.978,18.596C35.593,17.993 35.81,17.114 35.544,16.294C35.278,15.473 34.586,14.888 33.731,14.766L26.151,13.664C25.826,13.615 25.548,13.413 25.404,13.122L22.015,6.252C21.635,5.48 20.861,5 20,5C19.141,5 18.369,5.48 17.985,6.252L14.597,13.122C14.453,13.413 14.175,13.618 13.849,13.664L6.269,14.766C5.416,14.888 4.72,15.473 4.455,16.294C4.191,17.114 4.408,17.996 5.024,18.596L10.509,23.941C10.742,24.171 10.85,24.499 10.794,24.82L9.5,32.37C9.387,33.034 9.56,33.683 9.99,34.191C10.66,34.987 11.827,35.23 12.759,34.737L19.538,31.173C19.822,31.023 20.177,31.026 20.462,31.173L27.244,34.737C27.572,34.911 27.923,35 28.288,35C28.95,35 29.58,34.706 30.012,34.191C30.44,33.683 30.615,33.034 30.502,32.37L29.206,24.82C29.151,24.499 29.258,24.171 29.491,23.941L34.978,18.596Z" style="fill-rule:nonzero;"/>'+'</svg>'+'<span class="touchOptionText">Add to Inspiration</span>'+'</div>'+'<div class="touchOption viewArtist" data-ng-if="!loggedIn" data-touched>'+'<a data-ng-href="/'+user.username+'" title="'+user.alias+'" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M20.22,3.001C21.013,3.016 21.803,3.076 22.587,3.196C24.175,3.439 25.726,3.909 27.181,4.589C28.852,5.37 30.392,6.424 31.727,7.697C33.109,9.014 34.268,10.564 35.139,12.263C35.868,13.687 36.394,15.213 36.696,16.784C37.048,18.623 37.095,20.521 36.835,22.376C36.593,24.105 36.081,25.795 35.323,27.367C34.433,29.212 33.208,30.891 31.727,32.303C30.192,33.766 28.386,34.94 26.423,35.743C24.389,36.574 22.197,37 20,37C17.803,37 15.611,36.574 13.577,35.743C11.614,34.94 9.808,33.766 8.273,32.303C6.792,30.891 5.567,29.212 4.677,27.367C3.919,25.795 3.407,24.105 3.165,22.376C2.905,20.521 2.952,18.623 3.304,16.784C3.606,15.213 4.132,13.687 4.861,12.263C5.732,10.564 6.891,9.014 8.273,7.697C9.608,6.424 11.148,5.37 12.819,4.589C14.274,3.909 15.825,3.439 17.413,3.196C18.197,3.076 18.987,3.016 19.78,3.001C20,3 20,3 20.22,3.001ZM31.803,27.527C32.104,27.056 32.377,26.568 32.62,26.065C33.244,24.771 33.665,23.382 33.864,21.96C34.086,20.373 34.037,18.747 33.715,17.178C33.452,15.891 33.004,14.643 32.391,13.481C31.683,12.139 30.755,10.915 29.656,9.868C28.557,8.819 27.288,7.95 25.911,7.307C24.715,6.748 23.439,6.361 22.134,6.162C21.487,6.063 20.836,6.014 20.182,6.001C20,6 20,6 19.818,6.001C19.164,6.014 18.513,6.063 17.866,6.162C16.561,6.361 15.285,6.748 14.089,7.307C12.712,7.95 11.443,8.819 10.344,9.868C9.245,10.915 8.317,12.139 7.609,13.481C6.996,14.643 6.548,15.891 6.285,17.178C5.963,18.747 5.914,20.373 6.136,21.96C6.335,23.382 6.756,24.771 7.38,26.065C7.623,26.568 7.896,27.056 8.197,27.527C8.236,27.505 8.275,27.484 8.314,27.462C9.069,27.054 9.875,26.739 10.697,26.483C11.766,26.147 12.867,25.91 13.976,25.732C15.273,25.525 16.584,25.402 17.897,25.339C17.945,25.337 17.993,25.335 18.042,25.332C16.962,24.822 16.081,23.939 15.416,22.957C15.295,22.777 15.18,22.594 15.071,22.407C14.913,22.137 14.769,21.859 14.637,21.576C14.422,21.114 14.24,20.637 14.091,20.152C13.976,19.783 13.88,19.408 13.804,19.029C13.747,18.744 13.701,18.456 13.665,18.167C13.472,16.569 13.62,14.888 14.335,13.428C14.432,13.229 14.539,13.035 14.657,12.848C14.829,12.572 15.023,12.311 15.237,12.066C15.517,11.748 15.831,11.459 16.172,11.207C16.613,10.881 17.099,10.619 17.612,10.425C18.076,10.248 18.561,10.129 19.053,10.063C19.314,10.027 19.578,10.009 19.841,10.001C19.92,10 19.96,10 20,10L20.065,10C20.089,10.001 20.119,10.001 20.159,10.001C20.422,10.009 20.686,10.027 20.947,10.063C21.439,10.129 21.924,10.248 22.388,10.425C22.901,10.619 23.387,10.881 23.828,11.207C24.169,11.459 24.483,11.748 24.763,12.066C24.977,12.311 25.171,12.572 25.343,12.848C25.461,13.035 25.568,13.229 25.665,13.428C26.38,14.888 26.528,16.569 26.335,18.167C26.299,18.456 26.253,18.744 26.196,19.029C26.12,19.408 26.024,19.783 25.909,20.152C25.76,20.637 25.578,21.114 25.363,21.576C25.231,21.859 25.087,22.137 24.929,22.407C24.82,22.594 24.705,22.777 24.584,22.957C23.919,23.939 23.038,24.822 21.958,25.332C22.007,25.335 22.055,25.337 22.103,25.339C23.416,25.402 24.727,25.525 26.024,25.732C27.133,25.91 28.234,26.147 29.303,26.483C30.125,26.739 30.931,27.054 31.686,27.462C31.725,27.484 31.764,27.505 31.803,27.527Z"/>'+'</svg>'+'<span class="touchOptionText">View Artist</span>'+'</a>'+'</div>'+'<div class="touchOption openTab" data-ng-if="(loggedIn && isOwner('+id+')) || !loggedIn" data-touched>'+'<a target="_blank" data-ng-href="'+url+'" title="'+image.title+'" data-ng-click="endLongHold()">'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M15.107,4.969L31.5,4.969C33.439,4.969 35.013,6.543 35.013,8.482L35.013,24.875C35.013,26.813 33.439,28.387 31.5,28.388L28.458,28.388C28.457,28.901 28.456,29.414 28.456,29.928C28.454,30.093 28.447,30.257 28.43,30.421C28.392,30.797 28.312,31.167 28.191,31.525C27.969,32.179 27.612,32.785 27.147,33.296C26.63,33.865 25.983,34.312 25.268,34.594C24.88,34.748 24.473,34.852 24.059,34.905C23.89,34.926 23.72,34.937 23.55,34.943C19.015,35.001 14.479,35.001 9.944,34.943C9.773,34.937 9.604,34.926 9.434,34.905C9.021,34.852 8.613,34.748 8.225,34.594C7.548,34.327 6.931,33.911 6.428,33.384C5.953,32.885 5.581,32.289 5.344,31.641C5.215,31.288 5.125,30.921 5.078,30.548C5.056,30.378 5.045,30.209 5.039,30.039C4.982,25.541 5.037,21.042 5.037,16.543C5.04,16.378 5.046,16.214 5.063,16.05C5.101,15.675 5.182,15.304 5.303,14.947C5.537,14.254 5.924,13.616 6.428,13.087C6.931,12.56 7.548,12.144 8.225,11.877C8.613,11.724 9.021,11.619 9.434,11.566C9.604,11.545 9.773,11.534 9.944,11.528C10.494,11.521 11.044,11.515 11.595,11.512L11.595,8.482C11.595,6.543 13.169,4.969 15.107,4.969ZM24.709,18.084L24.709,21.83C24.709,22.606 24.08,23.236 23.304,23.236C22.528,23.236 21.899,22.606 21.899,21.83L21.899,18.084L18.152,18.084C17.376,18.083 16.747,17.454 16.747,16.678C16.747,15.902 17.376,15.273 18.152,15.273L21.899,15.273L21.899,11.526C21.899,10.75 22.528,10.121 23.304,10.121C24.08,10.121 24.709,10.75 24.709,11.526L24.709,15.273L28.456,15.273C29.232,15.273 29.861,15.902 29.861,16.678C29.861,17.454 29.232,18.083 28.456,18.084L24.709,18.084ZM15.107,28.388C13.168,28.387 11.595,26.813 11.595,24.875L11.595,14.32C11.068,14.325 10.542,14.331 10.015,14.337C9.773,14.346 9.536,14.388 9.308,14.472C8.716,14.689 8.233,15.16 8.002,15.746C7.906,15.989 7.858,16.244 7.848,16.504C7.792,20.991 7.792,25.48 7.848,29.967C7.858,30.227 7.906,30.483 8.002,30.725C8.233,31.312 8.716,31.783 9.308,31.999C9.536,32.083 9.773,32.125 10.015,32.134C14.483,32.19 18.952,32.135 23.421,32.135C23.682,32.131 23.94,32.09 24.186,31.999C24.795,31.776 25.287,31.284 25.511,30.674C25.594,30.447 25.636,30.209 25.645,29.967C25.652,29.441 25.658,28.914 25.663,28.388L15.107,28.388Z"/>'+'</svg>'+'<span class="touchOptionText">Open in New Tab</span>'+'</a>'+'</div>'+'<div class="touchOption adminTools" data-ng-click="optionsGalleryItem('+id+'); endLongHold()" data-touched>'+'<svg width="100%" height="100%" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:1.41421;">'+'<path class="svg-path" d="M6,16C8.208,16 10,17.792 10,20C10,22.208 8.208,24 6,24C3.792,24 2,22.208 2,20C2,17.792 3.792,16 6,16ZM20,16C22.208,16 24,17.792 24,20C24,22.208 22.208,24 20,24C17.792,24 16,22.208 16,20C16,17.792 17.792,16 20,16ZM34,16C36.208,16 38,17.792 38,20C38,22.208 36.208,24 34,24C31.792,24 30,22.208 30,20C30,17.792 31.792,16 34,16Z"/>'+'</svg>'+'<span class="touchOptionText">Admin Tools</span>'+'</div>'+'</div>'+'</div>'+'<div class="artworkInfoAndActions" data-ng-if="!isMobile() && !isPad()">'+'<div class="owner artworkItem">'+'<a class="ownerLink" href="/'+user.username+'" title="'+user.alias+'">'+'<div class="ownerAvatar">'+'<img data-ng-if="getUser('+id+', \'image\').avatar.length > 0" data-ng-src="'+user.avatar+'" alt="'+user.alias+'" />'+'</div>'+'<div class="ownerDetails">'+'<div class="ownerName">'+user.alias+'</div>'+'</div>'+'</a>'+'</div>'+'<div class="artworkLike artworkAction {{ isLiked('+id+') ? \'liked\' : \'\' }}" data-ng-if="!isMobile() && (loggedIn && !isOwner('+id+'))" data-ng-click="performImageLike('+id+')">{{ isLiked('+id+') ? \'Liked\' : \'Like\' }}</div>'+'<div class="artworkInspire artworkAction" data-ng-if="!isMobile() && (loggedIn && !isOwner('+id+'))" data-ng-click="flagInspiredImage('+id+')"></div>'+'<div class="artworkEdit artworkAction" data-ng-if="!isMobile() && (loggedIn && isOwner('+id+'))" data-ng-click="redirect(\''+url+'/edit\')"></div>'+'</div>'+'<a data-ng-href="'+url+'" class="artworkLink" data-ng-click="flagLinkClicked()"></a>'+'<div class="item-object artwork '+titleClass+'" data-r="'+image.averageRGB.r+'" data-g="'+image.averageRGB.g+'" data-b="'+image.averageRGB.b+'">'+'<div class="item-mature-flag"></div>'+'<div class="item-content">'+'<img data-ng-src="{{ getImage('+id+').mature == \'1\' && (!loggedIn || getUser(user).mature != \'1\') ? \''+image.protected+'\' : \''+image.thumb+'\' }}" width="'+width+'" height="'+height+'" >'+'<div class="default-color" style="background-color: rgb('+image.averageRGB.r+', '+image.averageRGB.g+', '+image.averageRGB.b+');"></div>'+'</div>'+'</div>'+'</div>');break;case 'market':return!1;break;default:break}};this.generatePrizeElement=function(id,count,type,group,$usedScope){var compId=$usedScope.currentCompetition().id;var image=$usedScope.currentCompetition().entries[id];var titleClass=defined(image.title)&&image.title.length>0?'title':'';var height=$usedScope.getEntryThumbHeight(image);var width=278;if($(window).outerWidth()<656){width=177}
if($(window).outerWidth()<414){width=157}
if($(window).outerWidth()<375){width=280}
if(height===''){height=width+''}
switch(group){case 'artPrize':return $('<div id="image-'+id+'" class="item-artwork layout-cell force hvr {{ getEntryVotedClass('+id+') }} {{ getImageClass('+id+') }}" data-created="'+image.created+'">'+'<a data-ng-href="#" class="artworkLink" data-ng-click="loadFullEntry('+compId+', '+id+', true)"></a>'+'<div class="item-object artwork '+titleClass+'" data-r="'+image.averageRGB.r+'" data-g="'+image.averageRGB.g+'" data-b="'+image.averageRGB.b+'">'+'<div class="artworkInfoAndActions" data-ng-if="!isMobile() && !isPad()">'+'<div class="owner artworkItem">'+'<a class="ownerLink" href="#">'+'</a>'+'</div>'+'<div class="voteYes artworkAction" data-ng-click="performVote('+id+', true)">Yes</div>'+'<div class="voteNo artworkAction" data-ng-click="performVote('+id+', false)">No</div>'+'</div>'+'<div class="item-mature-flag"></div>'+'<div class="item-content">'+'<img data-ng-src="'+image.thumb+'" width="'+width+'" height="'+height+'" >'+'<div class="default-color" style="background-color: rgb('+image.averageRGB.r+', '+image.averageRGB.g+', '+image.averageRGB.b+');"></div>'+'</div>'+'</div>'+'</div>');break;case 'results':return $('<div id="image-'+id+'" class="item-artwork layout-cell force hvr {{ getImageClass('+id+') }}" data-created="'+image.created+'">'+'<a data-ng-href="#" class="artworkLink" data-ng-click="loadFullEntry('+compId+', '+id+', false)"></a>'+'<div class="item-object artwork '+titleClass+'" data-r="'+image.averageRGB.r+'" data-g="'+image.averageRGB.g+'" data-b="'+image.averageRGB.b+'">'+'<div class="item-mature-flag"></div>'+'<div class="item-content">'+'<img data-ng-src="'+image.thumb+'" width="'+width+'" height="'+height+'" >'+'<div class="default-color" style="background-color: rgb('+image.averageRGB.r+', '+image.averageRGB.g+', '+image.averageRGB.b+');"></div>'+'</div>'+'</div>'+'</div>');break}};this.clearGalleryData=function(type,group,user){var isotopeObject;var key='';if(group==="user"){key=type+user;isotopeObject=_this.isotopeData.galleries[type].users[user]}else{key=type+group;isotopeObject=_this.isotopeData.galleries[type][group]}
$.each(isotopeObject.ids,function(i,id){_this.scopes[id+key].$destroy()});if(group==="user"){_this.isotopeData.galleries[type].users[user]={}}else{_this.isotopeData.galleries[type][group]={reference:'',$element:{},ids:[]}}};this.getData=function(){return _this.isotopeData}}]);app.service('LikeService',['$compile','$http','$rootScope','$compile',function($compile,$http,$rootScope,$compile){var _this=this;this.loadLikesByType=function(type,id){if($('#likeSection').length){$('#likeSection').addClass('loading');$('#likeSection').find('.display-likes').empty()}
$http({method:'POST',url:APIURL,data:'schema=likeLoadByType&type='+type+'&id='+id,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.users.forEach(function(user){var $like=$('<div class="owner like">'+'<a href="/'+user.username+'" title="'+user.alias+'">'+'<div class="ownerAvatar">'+'<img src="'+user.avatar+'" alt="'+user.alias+'" />'+'</div>'+'<div class="ownerDetails">'+'<div class="ownerName">'+user.alias+'</div>'+'</div>'+'<div class="ownerButton" data-events>See Profile</div>'+'</a>'+'</div>');$('#likeSection').find('.display-likes').append($like);$compile($like.get(0))($rootScope)})}
$('#likeSection').removeClass('loading')}).catch(function(response){console.log(response)})}}]);app.service('MarketService',['$http','UserService','$location','$rootScope',function($http,UserService,$location,$rootScope){var _this=this;this.marketData={market:[],users:[],products:{}};this.loadMarket=function(pos,count){if(defined(pos)&&defined(count)){$http({method:'POST',url:APIURL,data:'schema=marketLoad&pos='+pos+'&count='+count,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.productItems.forEach(function(productItem){var product=_this.generateProductFromProductData(productItem);var user=_this.generateUserFromProductData(productItem);_this.addOrUpdateProduct(product);_this.addToMarket(product);UserService.addOrUpdateUser(user)})}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.loadProfile=function(username){if(defined(username)){$http({method:'POST',url:APIURL,data:'schema=marketProfileLoad&username='+username,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.productItems.forEach(function(productItem){var product=_this.generateProductFromProductData(productItem);_this.addOrUpdateProduct(product);UserService.addProductToUser(product.id,productItem.userId)})}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.loadUserProduct=function(productId){if(defined(productId)){$http({method:'POST',url:APIURL,data:'schema=marketProductLoad&productId='+productId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var product=_this.generateProductFromProductData(data.productItem);var user=_this.generateUserFromProductData(data.productItem);_this.addOrUpdateProduct(product);UserService.addOrUpdateUser(user);UserService.addProductToUser(product.id,user.id);if(document.title===(user.username+"'s Image")){document.title=data.productItem.title}}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.removeUserProduct=function(userId,token,imageId){console.log("remove user product")};this.generateUserFromProductData=function(productData){var user={};user.id=productData.userId;user.username=productData.username;user.avatar=productData.avatar;user.alias=productData.alias;user.location=productData.location;user.job_title=productData.job_title;user.views=productData.user_views;user.fname=productData.fname;user.lname=productData.lname;return user};this.generateProductFromProductData=function(productData){var product={};product.id=productData.id;product.type=productData.type;product.userId=productData.userId;product.created=productData.created;product.example=productData.example;product.file_data=JSON.parse(productData.file_data);product.title=productData.title;product.description=productData.description;product.views=productData.views;product.price=productData.price;product.likes=productData.likes;product.comments=productData.comments;product.status=productData.status;product.keywords=productData.keywords;product.categories=productData.categories;product.defaultKeywords="";if(product.categories!==null){product.keywords=product.keywords.split(',');product.categories=product.categories.split(',');for(var i=0;i<product.categories.length;i++){if(product.categories[i]==='3'){product.defaultKeywords+=product.defaultKeywords.length?',':'';product.defaultKeywords+=product.keywords[i]}}}
if(product.type==="1"){var swatchElements=[];for(var i=0;i<30;i ++){var swatchItem=product.file_data.files[0].data[0].swatches[i];if(defined(swatchItem)&&swatchItem!==null){var hue=swatchItem.hue;var saturation=swatchItem.saturation;var brightness=swatchItem.brightness;var rgb=_this.hsvToRgb(hue,saturation,brightness);swatchElements.push({"position":i,"colour":'background-color: rgb('+rgb.r+', '+rgb.g+', '+rgb.b+'); border: none;',"status":'filled'})}else{swatchElements.push({"position":i,"colour":'',"status":'blank'})}}
product.swatchElements=swatchElements}
return product};this.addToMarket=function(product){if(_this.marketData.market.indexOf(product.id)===-1){_this.marketData.market.push(product.id)}};this.removeProduct=function(productId){delete _this.marketData.products[productId]};this.addOrUpdateProduct=function(product){if(defined(_this.marketData.products[product.id])){for(var property in product){if(product.hasOwnProperty(property)){_this.marketData.products[product.id][property]=product[property]}}}else{_this.marketData.products[product.id]=product}};this.getData=function(){return _this.marketData};this.hsvToRgb=function(hue,saturation,brightness){var rgb={};var h=Math.round(hue*360);var s=Math.round(saturation*255);var v=Math.round(brightness*255);if(s===0){rgb.r=rgb.g=rgb.b=v}else{var t1=v;var t2=(255-s)*v/255;var t3=(t1-t2)*(h%60)/60;if(h===360)h=0;if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}else{rgb.r=0;rgb.g=0;rgb.b=0}}
return{r:Math.round(rgb.r),g:Math.round(rgb.g),b:Math.round(rgb.b)}}}]);app.service('ModalService',['LikeService','$rootScope',function(LikeService,$rootScope){var _this=this;this.modalData={active:!1,title:'',content:'',type:'default',extra:'',confirmClass:'blue-fill',cancelClass:'grey-fill red',confirmText:'',confirmCallback:this.hide,cancelText:'',cancelCallback:this.hide,cancelVisible:!1,finished:!1,modalEvent:'',videoId:'',posterUrl:'',videoUrl:'',showFirst:!0};this.initialise=function(title,content,confirmText,confirmCallback,cancelText,cancelCallback,cancelVisible,type,extra){_this.modalData.title=title;_this.modalData.content=content;_this.modalData.type=defined(type)?type:'default';_this.modalData.extra=defined(extra)?extra:'';_this.modalData.confirmText=confirmText;_this.modalData.confirmCallback=confirmCallback;_this.modalData.cancelText=cancelText;_this.modalData.cancelCallback=cancelCallback;_this.modalData.cancelVisible=cancelVisible;if(!$rootScope.$$phase){$rootScope.$apply()}};this.show=function(){$rootScope.modalShow=!0;if(!$rootScope.$$phase){$rootScope.$apply()}};this.hide=function(){$rootScope.modalShow=!1;if(!$rootScope.$$phase){$rootScope.$apply()}};this.generateContent=function(type,$extra){switch(type){case 'disc_media':return _this.generateDiscMedia($extra);case 'disc_link':return _this.generateDiscLink();case 'disc_thread_move':return _this.generateMoveThread($extra);case 'likes_view':return _this.generateLikesView($extra);case 'image_report':return _this.generateImageReport();case 'report':return _this.generateReport();case 'loader':return _this.generateLoader();case 'login':return _this.generateLogin()}};this.generateDiscMedia=function($extra){return'<fieldset class="stacked">'+'<div class="field-item mb-20">'+'<input type="text" id="pro-modal-url" name="url" placeholder="Paste URL Here" />'+'<div class="field-message">e.g. https://youtu.be/stZKasFYAEo</div>'+'<div class="field-error"></div>'+'</div>'+'<div class="field-item mb-20">'+'<input type="text" id="pro-modal-title" name="text" placeholder="Add Caption" />'+'<div class="field-error"></div>'+'</div>'+'<hr />'+'<div class="field-item">'+'<label class="shadow-button bold blue grey-fill margin-reset upload-button" for="'+$extra+'" style="text-align: center" >Upload Image</label>'+'<div id="modal-image-holder"></div>'+'</div>'+'</fieldset>'};this.generateMoveThread=function($thread){var content='<fieldset class="stacked">'+'<div class="field-item mb-20">'+'<select id="threadMoveSelect" name="threadMoveSelect">'+'<option disabled selected>Select Board</option>';for(var key in $rootScope.discussions().boards){if($rootScope.discussions().boards.hasOwnProperty(key)){var board=$rootScope.discussions().boards[key];var disabled=$thread.disc_board_id==board.id;content+='<option value="'+board.id+'"'+(disabled?' disabled':'')+'>'+board.title+'</option>'}}
content+='</select>'+'</fieldset>';return content};this.generateLikesView=function($extra){LikeService.loadLikesByType($extra.type,$extra.id);return'<fieldset id="likeSection" class="stacked likes-view loading">'+'<div class="likes-container"></div>'+'<div class="loader">'+'<svg width="20px" height="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-ring-alt">'+'<rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>'+'<circle cx="50" cy="50" r="40" stroke="none" fill="none" stroke-width="10" stroke-linecap="round"></circle>'+'<circle cx="50" cy="50" r="40" stroke="#e6e6e6" fill="none" stroke-width="10" stroke-linecap="round">'+'<animate attributeName="stroke-dashoffset" dur="2.5s" repeatCount="indefinite" from="0" to="502"></animate>'+'<animate attributeName="stroke-dasharray" dur="2.5s" repeatCount="indefinite" values="175.7 75.30000000000001;1 250;175.7 75.30000000000001"></animate>'+'</circle>'+'</svg>'+'</div>'+'</fieldset>'};this.generateDiscLink=function(){return'<fieldset class="stacked">'+'<div class="field-item mb-20">'+'<input type="text" id="pro-modal-url" name="url" placeholder="Paste URL Here" />'+'<div class="field-error"></div>'+'</div>'+'<div class="field-item mb-20">'+'<input type="text" id="pro-modal-title" name="text" placeholder="Add Title" />'+'<div class="field-error"></div>'+'</div>'+'</fieldset>'};this.generateImageReport=function(){return'<fieldset class="stacked">'+'<div class="field-item mb-20 select-box">'+'<select id="report-level" name="report-level" >'+'<option disabled selected>What\'s wrong?</option>'+'<option value="2">This is Mature Content</option>'+'<option value="1">This isn\'t Appropriate Content</option>'+'</select>'+'<div class="field-error"></div>'+'</div>'+'<div class="field-item mb-20">'+'<textarea id="report-content" name="report-content" rowspan="5" placeholder="Tell us more..."></textarea>'+'<div class="field-error"></div>'+'</div>'+'</fieldset>'};this.generateLoader=function(){return'<div class="loader">'+'<svg width="20px" height="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-ring-alt">'+'<rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>'+'<circle cx="50" cy="50" r="40" stroke="none" fill="none" stroke-width="10" stroke-linecap="round"></circle>'+'<circle cx="50" cy="50" r="40" stroke="#0076ff" fill="none" stroke-width="5" stroke-linecap="round">'+'<animate attributeName="stroke-dashoffset" dur="2.5s" repeatCount="indefinite" from="0" to="502"></animate>'+'<animate attributeName="stroke-dasharray" dur="2.5s" repeatCount="indefinite" values="175.7 75.30000000000001;1 250;175.7 75.30000000000001"></animate>'+'</circle>'+'</svg>'+'</div>'};this.generateLogin=function(){return'<form data-ng-submit="processForm(\'popover\')" class="login" id="login-form-popover" data-ng-controller="loginController">'+'<fieldset class="stacked">'+'<div class="field-item mb-20">'+'<input type="text" id="pro_username" name="username" min="4" placeholder="Procreate ID (Username or Email)" autocorrect="off" autocapitalize="none" />'+'<div class="field-error"></div>'+'</div>'+'<div class="field-item mb-20">'+'<input type="password" id="pro_password" name="password" min="4" placeholder="Password" />'+'<div class="field-error"></div>'+'</div>'+'<div class="field-item mb-20">'+'<span class="help-link redirect" data-ng-click="redirect(\'/forgot\')">Forgot username or password?</span>'+'<input class="shadow-button bold blue-fill margin-reset" type="submit" value="Login"/>'+'</div>'+'</fieldset>'+'<fieldset class="stacked m-none">'+'<div class="field-item mb-20">'+'<h2 class="formTitle">Don\'t have an account?</h2>'+'<p>Just sign-up to the Procreate Community today!</p>'+'</div>'+'<div class="field-item">'+'<span class="shadow-button bold blue-fill margin-reset redirect" data-ng-click="redirect(\'/register\')" >Register</span>'+'</div>'+'</fieldset>'+'</form>'};this.generateReport=function(){return'<fieldset class="stacked">'+'<div class="field-item mb-20 select-box">'+'<select id="report-level" name="report-level" >'+'<option disabled selected>What\'s wrong?</option>'+'<option value="1">This isn\'t Appropriate Content</option>'+'</select>'+'<div class="field-error"></div>'+'</div>'+'<div class="field-item mb-20">'+'<textarea id="report-content" name="report-content" rowspan="5" placeholder="Tell us more..."></textarea>'+'<div class="field-error"></div>'+'</div>'+'</fieldset>'};this.getData=function(){return _this.modalData}}]);app.service('NewsService',['UserService','$rootScope','$http',function(UserService,$rootScope,$http){var _this=this;this.newsData={categories:{},featuredArticles:{},articles:{}};this.reset=function(){_this.clearNewsData()};this.loadArticles=function($scope){$rootScope.setPageLoader(!0);var extra=defined($scope.articleId)?'&articleId='+$scope.articleId:'';extra+=defined($scope.year)?'&year='+$scope.year:'';extra+=defined($scope.articleUrl)?'&articleUrl='+$scope.articleUrl:'';$rootScope.httpQuery('schema=newsArticleLoad'+extra,function(data){if(data.articles){$rootScope.setPageLoader(!1);data.articles.forEach(function(article){article.display_date=new Date(article.display_date.replace(/-/g,"/"));article.live_date=new Date(article.live_date.replace(/-/g,"/"));if(article.featured==1){_this.addOrUpdateFeaturedArticle(article)}
_this.addOrUpdateArticle(article);if(defined($scope.articleId)||defined($scope.articleUrl)){$scope.newsArticleFields=article;if($rootScope.currentPath.indexOf('insight/:year/:articleUrl')!==-1){var meta={type:'article',url:metaDefaults.default.url,site_name:metaDefaults.default.site_name,title:article.title,description:article.blurb,image:article.display_image};updateMetadata(meta)}}})}
if(data.comments){data.comments.forEach(function(comment){if(comment.news_comment_id==='0'){_this.addCommentToNews(comment.news_article_id,comment)}else{_this.addCommentToNewsComment(comment.news_article_id,comment.news_comment_id,comment)}})}})};this.loadCategories=function(){$rootScope.httpQuery('schema=newsCategoryLoad',function(data){if(data.categories){data.categories.forEach(function(category){_this.addOrUpdateCategory(category)})}})};this.editComment=function(articleId,comment){if(comment.news_comment_id!=='0'){_this.newsData.articles[articleId].comments[comment.news_comment_id].replies[comment.id].content=comment.content;_this.newsData.articles[articleId].comments[comment.news_comment_id].replies[comment.id].status=comment.status;_this.newsData.articles[articleId].comments[comment.news_comment_id].replies[comment.id].updated=comment.updated}else{_this.newsData.articles[articleId].comments[comment.id].content=comment.content;_this.newsData.articles[articleId].comments[comment.id].status=comment.status;_this.newsData.articles[articleId].comments[comment.id].updated=comment.updated}};this.deleteComment=function(articleId,commentId,replyId){if(replyId){delete _this.newsData.articles[articleId].comments[commentId].replies[replyId]}else{delete _this.newsData.articles[articleId].comments[commentId]}};this.likeComment=function(userId,token,articleId,commentId,replyId){var actualId=commentId;var index;if(replyId){actualId=replyId}
if(defined(userId)&&defined(token)&&defined(actualId)){if($rootScope.binaryLocked.like.newsComment.indexOf(commentId)===-1){$rootScope.binaryLocked.like.newsComment.push(commentId);if(replyId){_this.newsData.articles[articleId].comments[commentId].replies[replyId].likes.push(userId)}else{_this.newsData.articles[articleId].comments[commentId].likes.push(userId)}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=newsCommentLike&userId='+userId+'&token='+token+'&commentId='+actualId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){if(replyId){index=_this.newsData.articles[articleId].comments[commentId].replies[replyId].likes.indexOf(userId);if(index!==-1){_this.newsData.articles[articleId].comments[commentId].replies[replyId].likes.splice(index,1)}}else{index=_this.newsData.articles[articleId].comments[commentId].likes.indexOf(userId);if(index!==-1){_this.newsData.articles[articleId].comments[commentId].likes.splice(index,1)}}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.newsComment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.newsComment.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.newsComment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.newsComment.splice(binaryIndex,1)}})}}};this.removeCommentLike=function(userId,token,articleId,commentId,replyId){var actualId=commentId;var index;if(replyId){actualId=replyId}
if(defined(userId)&&defined(token)&&defined(actualId)){if($rootScope.binaryLocked.like.newsComment.indexOf(commentId)===-1){$rootScope.binaryLocked.like.newsComment.push(commentId);if(replyId){index=_this.newsData.articles[articleId].comments[commentId].replies[replyId].likes.indexOf(userId);if(index!==-1){_this.newsData.articles[articleId].comments[commentId].replies[replyId].likes.splice(index,1)}}else{index=_this.newsData.articles[articleId].comments[commentId].likes.indexOf(userId);if(index!==-1){_this.newsData.articles[articleId].comments[commentId].likes.splice(index,1)}}
$rootScope.contentUpdate=!0;$http({method:'POST',url:APIURL,data:'schema=newsCommentLikeRemove&userId='+userId+'&token='+token+'&commentId='+actualId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){if(replyId){_this.newsData.articles[articleId].comments[commentId].replies[replyId].likes.push(userId)}else{_this.newsData.articles[articleId].comments[commentId].likes.push(userId)}
console.log(data)}
var binaryIndex=$rootScope.binaryLocked.like.newsComment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.newsComment.splice(binaryIndex,1)}}).catch(function(response){console.log(response);var binaryIndex=$rootScope.binaryLocked.like.newsComment.indexOf(commentId);if(binaryIndex!==-1){$rootScope.binaryLocked.like.newsComment.splice(binaryIndex,1)}})}}};this.deleteCommentsFromNewsByOmmission=function(newsId,comments){var toDelete=[];var c;$.each(_this.newsData.articles[newsId].comments,function(index,comment){var found=!1;for(c=0;c<comments.length;c ++){if(comment.id===comments[c].id){found=!0;break}}
if(!found){toDelete.push(comment.id)}else if(typeof _this.newsData.articles[newsId].comments[comment.id].replies!=='undefined'){$.each(_this.newsData.articles[newsId].comments[comment.id].replies,function(index,reply){var replyFound=!1;for(c=0;c<comments.length;c ++){if(reply.id===comments[c].id){replyFound=!0;break}}
if(!replyFound){_this.deleteComment(newsId,comment.id,reply.id)}})}});for(var d=0;d<toDelete.length;d ++){_this.deleteComment(newsId,toDelete[d])}};this.addCommentToNews=function(newsId,comment){comment.content=comment.content.replace(/(?:\r\n|\r|\n)/g,'<br />');comment.content=(comment.content.replace(/(<br \/>)*$/g,'').replace(/^(<br \/>)*/,'')).trim();while(comment.content.includes('<br /><br /><br />')){comment.content=comment.content.replace(/(?:<br \/><br \/><br \/>)/g,'<br /><br />')}
if(!defined(_this.newsData.articles[newsId].comments)){_this.newsData.articles[newsId].comments={}}
if(defined(_this.newsData.articles[newsId].comments[comment.id])){for(var property in comment){if(comment.hasOwnProperty(property)){_this.newsData.articles[newsId].comments[comment.id][property]=comment[property]}}}else{_this.newsData.articles[newsId].comments[comment.id]=comment;_this.newsData.articles[newsId].comments[comment.id].replies={}}
_this.newsData.articles[newsId].comments[comment.id].likes=comment.likes!==null&&typeof comment.likes!=='undefined'?comment.likes.split(','):[];_this.newsData.articles[newsId].comments[comment.id].likes_alias=comment.likes_alias!==null&&typeof comment.likes_alias!=='undefined'?comment.likes_alias.split(','):[]};this.addCommentToNewsComment=function(newsId,commentId,comment){comment.content=comment.content.replace(/(?:\r\n|\r|\n)/g,'<br />');comment.content=(comment.content.replace(/(<br \/>)*$/g,'').replace(/^(<br \/>)*/,'')).trim();while(comment.content.includes('<br /><br /><br />')){comment.content=comment.content.replace(/(?:<br \/><br \/><br \/>)/g,'<br /><br />')}
if(defined(_this.newsData.articles[newsId].comments[commentId])){if(defined(_this.newsData.articles[newsId].comments[commentId].replies[comment.id])){for(var property in comment){if(comment.hasOwnProperty(property)){_this.newsData.articles[newsId].comments[commentId].replies[comment.id][property]=comment[property]}}}else{_this.newsData.articles[newsId].comments[commentId].replies[comment.id]=comment}
_this.newsData.articles[newsId].comments[commentId].replies[comment.id].likes=comment.likes!==null&&typeof comment.likes!=='undefined'?comment.likes.split(','):[];_this.newsData.articles[newsId].comments[commentId].replies[comment.id].likes_alias=comment.likes_alias!==null&&typeof comment.likes_alias!=='undefined'?comment.likes_alias.split(','):[]}};this.addOrUpdateFeaturedArticle=function(article){if(defined(_this.newsData.featuredArticles[article.id])){for(var property in article){if(article.hasOwnProperty(property)){_this.newsData.featuredArticles[article.id][property]=article[property]}}}else{_this.newsData.featuredArticles[article.id]=article}};this.addOrUpdateArticle=function(article){if(defined(_this.newsData.articles[article.id])){for(var property in article){if(article.hasOwnProperty(property)){_this.newsData.articles[article.id][property]=article[property]}}}else{_this.newsData.articles[article.id]=article}};this.addOrUpdateCategory=function(category){if(defined(_this.newsData.categories[category.id])){for(var property in category){if(category.hasOwnProperty(property)){_this.newsData.categories[category.id][property]=category[property]}}}else{_this.newsData.categories[category.id]=category}};this.clearNewsData=function(){_this.newsData.categories={};_this.newsData.articles={}};this.getData=function(){return _this.newsData}}]);app.service('NotificationsService',['$cookies','$http','$rootScope','UserService',function($cookies,$http,$rootScope,UserService){var _this=this;this.notificationData={menuNotifications:[],notifications:[],updated:!0,hasUnread:!1};this.load=function(){var userDetails=UserService.getUserDetails();if(userDetails){$http({method:'POST',url:APIURL,data:'schema=notificationLoad&pos=0&count=5'+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){if(data.notifications.length>0&&data.notifications[0].viewed==0){_this.notificationData.hasUnread=!0}
_this.clearMenuData();data.notifications.forEach(function(notification){_this.notificationData.menuNotifications.push(notification)})}}).catch(function(response){console.log(response)})}};this.loadFull=function(pos,count,callback){var userDetails=UserService.getUserDetails();if(userDetails){$http({method:'POST',url:APIURL,data:'schema=notificationLoad&pos='+pos+'&count='+count+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.notifications.forEach(function(notification){_this.notificationData.notifications.push(notification)});_this.flagNotificationsRead(!1)}
callback(data.notifications.length)}).catch(function(response){console.log(response);callback(!1)})}};this.flagNotificationsRead=function(menu){var notificationIds;var notificationRefs;var notificationArray=[];var notificationRefArray=[];var count=0;if(menu){_this.notificationData.hasUnread=!1;_this.notificationData.menuNotifications.forEach(function(notification){if(notification.viewed==0){if(notification.reference_key!=='unique'){notificationRefArray.push(notification.reference_key)}else{notificationArray.push(notification.id)}}
count ++})}else{if(_this.notificationData.menuNotifications[0].id===_this.notificationData.notifications[0].id){_this.notificationData.hasUnread=!1}
_this.notificationData.notifications.forEach(function(notification){if(notification.viewed==0){if(notification.reference_key!=='unique'){notificationRefArray.push(notification.reference_key)}else{notificationArray.push(notification.id)}}})}
notificationIds=notificationArray.join(',');notificationRefs=notificationRefArray.join(',');var query='schema=notificationFlagRead&notification_ids='+notificationIds+'&notification_reference_keys='+notificationRefs+UserService.getUserDetails();$rootScope.httpQuery(query,function(data){if(defined(data.success)){console.log("read flag successful")}})};this.updateMenuData=function(notifications){if(!$rootScope.notificationsOpen&&$rootScope.getUser($rootScope.user).notification_alerts=='1'){if(notifications.length>0&&_this.notificationData.menuNotifications.length>0){if(notifications[0].id!==_this.notificationData.menuNotifications[0].id&&notifications[0].viewed==0){$rootScope.notificationsBanner.message=notifications[0].messageSingle;$rootScope.notificationsBanner.notifications=notifications;$rootScope.notificationsBanner.visible=!0;setTimeout(function(){$rootScope.notificationsBanner.visible=!1},3500)}}}
if(!$rootScope.notificationsOpen){_this.clearMenuData();if(notifications.length>0&&notifications[0].viewed==0&&!$rootScope.notificationsOpen){_this.notificationData.hasUnread=!0}
notifications.forEach(function(notification){_this.notificationData.menuNotifications.push(notification)})}};this.clearMenuData=function(){_this.notificationData.menuNotifications=[]};this.clearFullData=function(){_this.notificationData.notifications=[]};this.getData=function(){return _this.notificationData}}]);app.service('PollService',['UserService','GalleryService','DiscussionService','NotificationsService','NewsService','$rootScope','$timeout','$http',function(UserService,GalleryService,DiscussionService,NotificationsService,NewsService,$rootScope,$timeout,$http){var _this=this;var pollPromise;var pollPeriod=15000;var failed=!1;var broken=!1;this.performPolling=function(){var data='schema=utilPoll';var wasLoggedIn=$rootScope.loggedIn;var currentPage=$rootScope.pollObject.page;var pageId=$rootScope.pollObject.page;if(wasLoggedIn){data+='&userId='+$rootScope.user;data+='&token='+$rootScope.getUser($rootScope.user).token}
switch(currentPage){case 'discussions':if(typeof $rootScope.pollObject.scope.threadId!=='undefined'){pageId+=$rootScope.pollObject.scope.threadId+$rootScope.pollObject.scope.page+$rootScope.pollObject.scope.post;data+='&threadId='+$rootScope.pollObject.scope.threadId;data+='&threadPage='+$rootScope.pollObject.scope.page;data+='&threadPost='+$rootScope.pollObject.scope.post}
pollPeriod=10000;break;case 'image':pageId+=$rootScope.pollObject.scope.imageId;data+='&imageId='+$rootScope.pollObject.scope.imageId;pollPeriod=10000;break;case 'news':pageId+=$rootScope.pollObject.scope.articleUrl;data+='&articleUrl='+$rootScope.pollObject.scope.articleUrl;data+='&articleYear='+$rootScope.pollObject.scope.articleYear;pollPeriod=15000;break;case 'gallery':case 'profile':default:pollPeriod=15000;break}
if(data!=='schema=utilPoll'){if($rootScope.contentUpdate){$rootScope.contentUpdate=!1}
$http({method:'POST',url:APIURL,timeout:pollPeriod,data:data,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;failed=!1;broken=!1;if(!$rootScope.contentUpdate){if(defined(data.success)){if(wasLoggedIn){if(data.userLoggedOut){UserService.reset()}else{UserService.addOrUpdateUser(data.user);NotificationsService.updateMenuData(data.notifications)}}
if(currentPage===$rootScope.pollObject.page){switch(currentPage){case 'discussions':if(pageId===(currentPage+$rootScope.pollObject.scope.threadId+$rootScope.pollObject.scope.page+$rootScope.pollObject.scope.post)){DiscussionService.deletePostsFromThreadsByOmmission($rootScope.pollObject.scope.threadId,data.posts);data.posts.forEach(function(post){UserService.addOrUpdateUser(DiscussionService.generateUserFromForumData(post));DiscussionService.addorUpdatePostToThread(post)})}
break;case 'image':if(pageId===(currentPage+$rootScope.pollObject.scope.imageId)){GalleryService.deleteCommentsFromImageByOmmission($rootScope.pollObject.scope.imageId,data.comments);data.comments.forEach(function(comment){if(comment.comment_id==='0'){GalleryService.addCommentToImage($rootScope.pollObject.scope.imageId,comment,!1)}else{GalleryService.addCommentToImageComment($rootScope.pollObject.scope.imageId,comment.comment_id,comment,!1)}})}
break;case 'news':if(pageId===(currentPage+$rootScope.pollObject.scope.articleUrl)){NewsService.deleteCommentsFromNewsByOmmission(data.news_article_id,data.comments);data.comments.forEach(function(comment){if(comment.news_comment_id==='0'){NewsService.addCommentToNews(data.news_article_id,comment)}else{NewsService.addCommentToNewsComment(data.news_article_id,comment.news_comment_id,comment)}})}
break;case 'gallery':break;case 'profile':break}}
$rootScope.latestPollTime=data.utcTime}else{}}
_this.beginPolling()}).catch(function(response){if(!failed){_this.beginPolling(20000);failed=!0}else{broken=!0}})}else{_this.beginPolling()}};this.restartPolling=function(){_this.beginPolling();broken=!1};this.beginPolling=function(newTimeout){var period=typeof newTimeout!=='undefined'?newTimeout:pollPeriod;pollPromise=$timeout(_this.performPolling,period);$rootScope.contentUpdate=!1};this.cancelPolling=function(){$timeout.cancel(pollPromise)};this.isBroken=function(){return broken}}]);app.service('PopoverService',['LikeService','$rootScope',function(LikeService,$rootScope){var _this=this;this.popoverDefaults={active:!1,type:'default',options:{graphic:{classes:'',visible:!1},title:'',description:'',confirmButton:{text:'Confirm',action:function(){_this.hide()},classes:'',visible:!1},dismissButton:{text:'Dismiss',action:function(){_this.hide()},classes:'',visible:!1},topLeftLink:{text:'Back',action:function(){_this.hide()},classes:'',visible:!1},topRightLink:{text:'Next',action:function(){_this.hide()},classes:'',visible:!1},buttonOptions:!1,listOptions:!1,content:''}};this.popoverData={};this.initialise=function(type,options){_this.popoverData={active:!1,type:defined(type)?type:_this.popoverDefaults.type,options:{graphic:defined(options.graphic)?{classes:defined(options.graphic.classes)?options.graphic.classes:_this.popoverDefaults.options.graphic.classes,visible:defined(options.graphic.visible)?options.graphic.visible:_this.popoverDefaults.options.graphic.visible}:_this.popoverDefaults.options.graphic,title:defined(options.title)?options.title:_this.popoverDefaults.options.title,description:defined(options.description)?options.description:_this.popoverDefaults.options.description,confirmButton:defined(options.confirmButton)?{text:defined(options.confirmButton.text)?options.confirmButton.text:_this.popoverDefaults.options.confirmButton.text,action:defined(options.confirmButton.action)?options.confirmButton.action:_this.popoverDefaults.options.confirmButton.action,classes:defined(options.confirmButton.classes)?options.confirmButton.classes:_this.popoverDefaults.options.confirmButton.classes,visible:defined(options.confirmButton.visible)?options.confirmButton.visible:_this.popoverDefaults.options.confirmButton.visible}:_this.popoverDefaults.options.confirmButton,dismissButton:defined(options.dismissButton)?{text:defined(options.dismissButton.text)?options.dismissButton.text:_this.popoverDefaults.options.dismissButton.text,action:defined(options.dismissButton.action)?options.dismissButton.action:_this.popoverDefaults.options.dismissButton.action,classes:defined(options.dismissButton.classes)?options.dismissButton.classes:_this.popoverDefaults.options.dismissButton.classes,visible:defined(options.dismissButton.visible)?options.dismissButton.visible:_this.popoverDefaults.options.dismissButton.visible}:_this.popoverDefaults.options.dismissButton,topLeftLink:defined(options.topLeftLink)?{text:defined(options.topLeftLink.text)?options.topLeftLink.text:_this.popoverDefaults.options.topLeftLink.text,action:defined(options.topLeftLink.action)?options.topLeftLink.action:_this.popoverDefaults.options.topLeftLink.action,classes:defined(options.topLeftLink.classes)?options.topLeftLink.classes:_this.popoverDefaults.options.topLeftLink.classes,visible:defined(options.topLeftLink.visible)?options.topLeftLink.visible:_this.popoverDefaults.options.topLeftLink.visible}:_this.popoverDefaults.options.topLeftLink,topRightLink:defined(options.topRightLink)?{text:defined(options.topRightLink.text)?options.topRightLink.text:_this.popoverDefaults.options.topRightLink.text,action:defined(options.topRightLink.action)?options.topRightLink.action:_this.popoverDefaults.options.topRightLink.action,classes:defined(options.topRightLink.classes)?options.topRightLink.classes:_this.popoverDefaults.options.topRightLink.classes,visible:defined(options.topRightLink.visible)?options.topRightLink.visible:_this.popoverDefaults.options.topRightLink.visible}:_this.popoverDefaults.options.topRightLink,buttonOptions:defined(options.buttonOptions)?options.buttonOptions:_this.popoverDefaults.options.buttonOptions,listOptions:defined(options.listOptions)?options.listOptions:_this.popoverDefaults.options.listOptions,content:defined(options.content)?options.content:_this.popoverDefaults.options.content}};if(!$rootScope.$$phase){$rootScope.$apply()}};this.show=function(){$rootScope.popoverShow=!0;if(!$rootScope.$$phase){$rootScope.$apply()}};this.hide=function(){$rootScope.popoverShow=!1;if(!$rootScope.$$phase){$rootScope.$apply()}};this.generateContent=function(type,$extra){switch(type){case 'default':return _this.generateWorld();case 'disc_thread_move':return _this.generateMoveThread($extra);case 'likes_view':return _this.generateLikesView($extra);case 'thread_likes_view':return _this.generateThreadLikesView($extra)}};this.generateWorld=function(){return'<p>Hello World</p>'};this.generateMoveThread=function($thread){var content='<fieldset class="stacked">'+'<div class="field-item mb-20">'+'<select id="threadMoveSelect" name="threadMoveSelect" data-ng-model="moveThreadForm.newBoardId">'+'<option disabled selected>Select Board</option>';for(var key in $rootScope.discussions().boards){if($rootScope.discussions().boards.hasOwnProperty(key)){var board=$rootScope.discussions().boards[key];var disabled=$thread.disc_board_id==board.id;content+='<option value="'+board.id+'"'+(disabled?' disabled':'')+'>'+board.title+'</option>'}}
content+='</select>'+'</fieldset>';return content};this.generateLikesView=function($extra){LikeService.loadLikesByType($extra.type,$extra.id);return'<div id="likeSection" class="likes-view loading">'+'<div class="likes-view-scroll"></div>'+'<div class="display-likes-container"><div class="display-likes-view"><div class="display-likes"></div></div></div>'+'</div>'};this.generateThreadLikesView=function($extra){LikeService.loadLikesByType($extra.type,$extra.id);return'<div id="likeSection" class="likes-view loading">'+'<div class="likes-view-scroll"></div>'+'<div class="display-likes-container"><div class="display-likes-view"><div class="display-likes"></div></div></div>'+'</div>'};this.generateLoader=function(){return'<div class="loader">'+'<svg width="20px" height="20px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-ring-alt">'+'<rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect>'+'<circle cx="50" cy="50" r="40" stroke="none" fill="none" stroke-width="10" stroke-linecap="round"></circle>'+'<circle cx="50" cy="50" r="40" stroke="#0076ff" fill="none" stroke-width="5" stroke-linecap="round">'+'<animate attributeName="stroke-dashoffset" dur="2.5s" repeatCount="indefinite" from="0" to="502"></animate>'+'<animate attributeName="stroke-dasharray" dur="2.5s" repeatCount="indefinite" values="175.7 75.30000000000001;1 250;175.7 75.30000000000001"></animate>'+'</circle>'+'</svg>'+'</div>'};this.getData=function(){return _this.popoverData}}]);app.service('ReportService',['$cookies','UserService','GalleryService','$http','$rootScope',function($cookies,UserService,GalleryService,$http,$rootScope){var _this=this;this.reportData={reports:{},categories:{gallery_item:{new:!1,galleryItems:{}},market_item:{new:!1,marketItems:{}},gallery_item_comment:{new:!1,galleryItemComments:{}},news_article_comment:{new:!1,newsArticleComments:{}},market_item_comment:{new:!1,marketItemComments:{}},disc_post:{new:!1,discPosts:{}},disc_reply:{new:!1,discReplies:{}}},bannedItems:{gallery_items:{}}};this.loadImageBannings=function(){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=galleryBannedImageLoad'+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){data.galleryItems.forEach(function(galleryItem){if(defined(_this.reportData.bannedItems.gallery_items[galleryItem.id])){for(var property in galleryItem){if(resources.hasOwnProperty(property)){_this.reportData.bannedItems.gallery_items[galleryItem.id][property]=galleryItem[property]}}}else{_this.reportData.bannedItems.gallery_items[galleryItem.id]=galleryItem}})}})}};this.loadReports=function(type){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportViewByType&type='+type+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){data.reportItems.forEach(function(report){_this.addOrUpdateReport(report);switch(type){case 'galleryItem':if(!defined(_this.reportData.categories.gallery_item.galleryItems[report.gallery_item_id])){_this.reportData.categories.gallery_item.galleryItems[report.gallery_item_id]={};_this.reportData.categories.gallery_item.galleryItems[report.gallery_item_id].reports=[]}
if(_this.reportData.categories.gallery_item.galleryItems[report.gallery_item_id].reports.indexOf(report.id)===-1){_this.reportData.categories.gallery_item.galleryItems[report.gallery_item_id].reports.push(report.id)}
break;case 'marketItem':if(!defined(_this.reportData.categories.market_item.marketItems[report.market_item_id])){_this.reportData.categories.market_item.marketItems[report.market_item_id]={};_this.reportData.categories.market_item.marketItems[report.market_item_id].reports=[]}
if(_this.reportData.categories.market_item.marketItems[report.market_item_id].reports.indexOf(report.id)===-1){_this.reportData.categories.market_item.marketItems[report.market_item_id].reports.push(report.id)}
break;case 'galleryItemComments':if(!defined(_this.reportData.categories.gallery_item_comment.galleryItemComments[report.gallery_item_comment_id])){_this.reportData.categories.gallery_item_comment.galleryItemComments[report.gallery_item_comment_id]={};_this.reportData.categories.gallery_item_comment.galleryItemComments[report.gallery_item_comment_id].reports=[]}
if(_this.reportData.categories.gallery_item_comment.galleryItemComments[report.gallery_item_comment_id].reports.indexOf(report.id)===-1){_this.reportData.categories.gallery_item_comment.galleryItemComments[report.gallery_item_comment_id].reports.push(report.id)}
break;case 'newsArticleComments':if(!defined(_this.reportData.categories.news_article_comment.newsArticleComments[report.news_article_comment_id])){_this.reportData.categories.news_article_comment.newsArticleComments[report.news_article_comment_id]={};_this.reportData.categories.news_article_comment.newsArticleComments[report.news_article_comment_id].reports=[]}
if(_this.reportData.categories.news_article_comment.newsArticleComments[report.news_article_comment_id].reports.indexOf(report.id)===-1){_this.reportData.categories.news_article_comment.newsArticleComments[report.news_article_comment_id].reports.push(report.id)}
break;case 'marketItemComments':if(!defined(_this.reportData.categories.gallery_item.marketItemComments[report.market_item_comment_id])){_this.reportData.categories.gallery_item.marketItemComments[report.market_item_comment_id]={};_this.reportData.categories.gallery_item.marketItemComments[report.market_item_comment_id].reports=[]}
if(_this.reportData.categories.gallery_item.marketItemComments[report.market_item_comment_id].reports.indexOf(report.id)===-1){_this.reportData.categories.gallery_item.marketItemComments[report.market_item_comment_id].reports.push(report.id)}
break;case 'discPosts':if(!defined(_this.reportData.categories.disc_post.discPosts[report.disc_post_id])){_this.reportData.categories.disc_post.discPosts[report.disc_post_id]={};_this.reportData.categories.disc_post.discPosts[report.disc_post_id].reports=[]}
if(_this.reportData.categories.disc_post.discPosts[report.disc_post_id].reports.indexOf(report.id)===-1){_this.reportData.categories.disc_post.discPosts[report.disc_post_id].reports.push(report.id)}
break;case 'discReplies':if(!defined(_this.reportData.categories.disc_reply.discReplies[report.disc_reply_id])){_this.reportData.categories.disc_reply.discReplies[report.disc_reply_id]={};_this.reportData.categories.disc_reply.discReplies[report.disc_reply_id].reports=[]}
if(_this.reportData.categories.disc_reply.discReplies[report.disc_reply_id].reports.indexOf(report.id)===-1){_this.reportData.categories.disc_reply.discReplies[report.disc_reply_id].reports.push(report.id)}
break}})}})}};this.galleryImageFine=function(imageId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemFine&imageId='+imageId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.gallery_item.galleryItems[imageId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1})}})}};this.galleryImagePermanentlyFine=function(imageId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemFlagFine&imageId='+imageId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){var image={id:imageId,status:1};_this.reportData.categories.gallery_item.galleryItems[imageId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=1});GalleryService.addOrUpdateImage(image)}})}};this.galleryImageFlagMature=function(imageId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemFlagMature&imageId='+imageId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){var image={id:imageId,mature:1};_this.reportData.categories.gallery_item.galleryItems[imageId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].mature=1});GalleryService.addOrUpdateImage(image)}})}};this.galleryImageFlagBan=function(imageId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemFlagBanned&imageId='+imageId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){var image={id:imageId,status:2};_this.reportData.categories.gallery_item.galleryItems[imageId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=2});GalleryService.addOrUpdateImage(image)}})}};this.galleryImageCommentFine=function(imageCommentId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemCommentFine&imageCommentId='+imageCommentId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.gallery_item_comment.galleryItemComments[imageCommentId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1})}})}};this.galleryImageCommentPermanentlyFine=function(imageCommentId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemCommentFlagFine&imageCommentId='+imageCommentId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.gallery_item_comment.galleryItemComments[imageCommentId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=1})}})}};this.galleryImageCommentFlagBan=function(imageCommentId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportGalleryItemCommentFlagBanned&imageCommentId='+imageCommentId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.gallery_item_comment.galleryItemComments[imageCommentId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=2})}})}};this.newsArticleCommentFine=function(commentId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportNewsArticleCommentFine&commentId='+commentId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.news_article_comment.newsArticleComments[commentId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1})}})}};this.newsArticleCommentPermanentFine=function(commentId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportNewsArticleCommentFlagFine&commentId='+commentId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.news_article_comment.newsArticleComments[commentId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=1})}})}};this.newsArticleCommentFlagBan=function(commentId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportNewsArticleCommentFlagBanned&commentId='+commentId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.news_article_comment.newsArticleComments[commentId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=2})}})}};this.postFine=function(postId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportPostFine&postId='+postId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.disc_post.discPosts[postId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1})}})}};this.postPermanentlyFine=function(postId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportPostFlagFine&postId='+postId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.disc_post.discPosts[postId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=1})}})}};this.postFlagBan=function(postId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportPostFlagBanned&postId='+postId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.disc_post.discPosts[postId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=2})}})}};this.replyFine=function(replyId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportReplyFine&replyId='+replyId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.disc_reply.discReplies[replyId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1})}})}};this.replyPermanentlyFine=function(replyId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportReplyFlagFine&replyId='+replyId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.disc_reply.discReplies[replyId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=1})}})}};this.replyFlagBan=function(replyId){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportReplyFlagBanned&replyId='+replyId+userDetails;$rootScope.httpQuery(query,function(data){if(defined(data.success)){_this.reportData.categories.disc_reply.discReplies[replyId].reports.forEach(function(report){_this.reportData.reports[report].actioned=1;_this.reportData.reports[report].status=2})}})}};this.loadReportCategories=function(){var userDetails=UserService.getUserDetails();if(userDetails){var query='schema=reportCategories'+userDetails;_this.clearReportCategoryData();$rootScope.httpQuery(query,function(data){if(defined(data.success)){if(data.reportItems.length){data.reportItems.forEach(function(report){if(report.gallery_item_id){_this.reportData.categories.gallery_item.new=!0}
if(report.market_item_id){_this.reportData.categories.market_item.new=!0}
if(report.gallery_item_comment_id){_this.reportData.categories.gallery_item_comment.new=!0}
if(report.news_article_comment_id){_this.reportData.categories.news_article_comment.new=!0}
if(report.market_item_comment_id){_this.reportData.categories.market_item_comment.new=!0}
if(report.disc_post_id){_this.reportData.categories.disc_post.new=!0}
if(report.disc_reply_id){_this.reportData.categories.disc_reply.new=!0}})}}})}};this.addOrUpdateReport=function(report){if(defined(_this.reportData.reports[report.id])){for(var property in report){if(resources.hasOwnProperty(property)){_this.reportData.reports[report.id][property]=report[property]}}}else{_this.reportData.reports[report.id]=report}};this.clearReportCategoryData=function(){_this.reportData.categories.gallery_item.new=!1;_this.reportData.categories.market_item.new=!1;_this.reportData.categories.gallery_item_comment.new=!1;_this.reportData.categories.news_article_comment.new=!1;_this.reportData.categories.market_item_comment.new=!1;_this.reportData.categories.disc_post.new=!1;_this.reportData.categories.disc_reply.new=!1};this.getData=function(){return _this.reportData}}]);app.service('RoleService',['$cookies','UserService','$http',function($cookies,UserService,$http){var _this=this;this.roleData={roles:{}};this.reset=function(){_this.clearRoleData()};this.loadRoleUsers=function(roleId){var userId=$cookies.get('user');var token=$cookies.get('token');if(defined(userId)&&defined(token)){$http({method:'POST',url:APIURL,data:'schema=roleLoadUsers&userId='+userId+'&token='+token+'&roleId='+roleId,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.addOrUpdateRole(data.role);data.users.forEach(function(user){UserService.addOrUpdateUser(_this.generateUserFromRoleData(user));_this.addUserToRole(user.id,data.role.id,!1)})}}).catch(function(response){console.log(response)})}};this.loadRoles=function(){var userId=$cookies.get('user');var token=$cookies.get('token');if(defined(userId)&&defined(token)){$http({method:'POST',url:APIURL,data:'schema=adminListRoles&userId='+userId+'&token='+token,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.roles.forEach(function(role){_this.addOrUpdateRole(role)})}}).catch(function(response){console.log(response)})}};this.addOrUpdateRole=function(role){if(defined(_this.roleData.roles[role.id])){for(var property in role){if(role.hasOwnProperty(property)){_this.roleData.roles[role.id][property]=role[property]}}}else{_this.roleData.roles[role.id]=role}};this.clearRoleData=function(){_this.roleData.roles=[]};this.addUserToRole=function(userId,roleId,prepend){prepend=defined(prepend)?prepend:!1;if(!defined(_this.roleData.roles[roleId])){_this.roleData.roles[roleId]={}}
if(!defined(_this.roleData.roles[roleId].users)){_this.roleData.roles[roleId].users=[]}
if(_this.roleData.roles[roleId].users.indexOf(userId)===-1){if(prepend){_this.roleData.roles[roleId].users.unshift(userId)}else{_this.roleData.roles[roleId].users.push(userId)}}};this.removeUserFromRole=function(userId,roleId){if(defined(_this.roleData.roles[roleId])&&defined(_this.roleData.roles[roleId].users)&&_this.roleData.roles[roleId].users.indexOf(userId)!==-1){_this.roleData.roles[roleId].users.splice(_this.roleData.roles[roleId].users.indexOf(userId),1)}};this.generateUserFromRoleData=function(roleUser){var user={};user.id=roleUser.id;user.username=roleUser.username;user.avatar=roleUser.avatar;user.alias=roleUser.alias;user.location=roleUser.location;user.job_title=roleUser.job_title;user.views=roleUser.user_views;user.fname=roleUser.fname;user.lname=roleUser.lname;return user};this.getData=function(){return _this.roleData}}]);app.service('SearchService',['$http','$location','$rootScope','UserService','GalleryService','DiscussionService',function($http,$location,$rootScope,UserService,GalleryService,DiscussionService){var _this=this;this.searchData={userResults:[],galleryResults:[],discussionResults:[],linkResults:[],linkData:{},terms:{},suggested:[]};this.loadResults=function($scope,clear){if(defined($scope)&&defined($scope.term)){$scope.searchPerformed=!1;if(clear){_this.clearResults()}
$http({method:'POST',url:APIURL,data:'schema=search&tab='+$scope.searchTab+'&offset='+$scope.offset+'&limit='+$scope.limit+'&searchTerm='+$scope.term,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){var resultLength=0;$scope.offset=$scope.offset+$scope.limit;if(defined(data.users)&&data.users){resultLength=data.users.length;data.users.forEach(function(user){user.link=_this.generateUserLink(user);if(!objInArrayById(_this.searchData.userResults,user)){_this.searchData.userResults.push(user);UserService.addOrUpdateUser(user)}})}
if(defined(data.galleryItems)&&data.galleryItems){resultLength=data.galleryItems.length;data.galleryItems.forEach(function(image){image.link=_this.generateGalleryLink(image);if(!objInArrayById(_this.searchData.galleryResults,image)){_this.searchData.galleryResults.push(image);GalleryService.addOrUpdateImage(GalleryService.generateImageFromImageData(image));UserService.addOrUpdateUser(GalleryService.generateUserFromImageData(image))}})}
if(defined(data.threads)&&data.threads){resultLength=data.threads.length;data.threads.forEach(function(thread){thread.link=_this.generateDiscussionLink(thread);if(!objInArrayById(_this.searchData.discussionResults,thread)){_this.searchData.discussionResults.push(thread);DiscussionService.addThreads(thread);UserService.addOrUpdateUser(DiscussionService.generateUserFromForumData(thread))}})}
if(defined(data.links)&&data.links){resultLength=data.links.length;data.links.forEach(function(link){if(!objInArrayById(_this.searchData.linkResults,link)){_this.searchData.linkResults.push(link)}})}
$(window).unbind('scroll');if($scope.searchTab!=='global'){$(window).bind('scroll',function(){if($scope.lazyLoading)return;if($(this).height()+$(this).scrollTop()>$('body').get(0).scrollHeight*0.8){$scope.lazyLoading=!0;$scope.offset+=$scope.limit;_this.loadResults($scope,!1)}})}
if(resultLength<$scope.limit){$(window).unbind('scroll')}
$scope.lazyLoading=!1;$scope.finishedLoading=!0;$scope.searchPerformed=!0}else if(defined(data.complete)){$scope.lazyLoading=!1;$scope.finishedLoading=!0}else{console.log(data);$scope.searchPerformed=!0}}).catch(function(response){console.log(response)})}};this.termSearched=function(term){if(typeof term!=='undefined'){$http({method:'POST',url:APIURL,data:'schema=searchTerm&term='+term,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(!defined(data.success)){console.log(data)}}).catch(function(response){console.log(response)})}};this.loadInitialSuggested=function(){var searchHistory=UserService.getCurrentSearchHistory();if(searchHistory.length>0){_this.searchData.suggested=searchHistory}else{_this.searchData.suggested=[];_this.loadTerms(!1,4,0,!1,function(terms){terms.forEach(function(term){_this.searchData.suggested.push(term)})})}};this.updateSuggested=function($scope,term){_this.searchData.suggested=[];_this.loadTerms(term,4,0,!1,function(terms){if($scope.term===term){terms.forEach(function(term){_this.searchData.suggested.push(term)})}})};this.loadTerms=function(value,limit,offset,$scope,callback){var query="schema=searchTermsLoad";if(defined(value)&&value){query+="&searchTerm="+value}
if(defined(limit)&&limit){query+="&limit="+limit}
if(defined(offset)&&offset){query+="&offset="+offset}
$rootScope.httpQuery(''+query,function(data){if(defined(data.success)){if(defined(data.terms)){data.terms.forEach(function(term){_this.addOrUpdateTerm(term);if(defined($scope)&&$scope){if(term.id==$scope.itemId){$scope.itemObject=term}}});if(defined(callback)&&callback){callback(data.terms)}}}})};this.loadLinks=function(value,limit,offset,$scope){var query='schema=searchLinksLoad';if(defined(value)&&value){query+="&searchTerm="+value}
if(defined(limit)&&value){query+="&limit="+limit}
if(defined(offset)&&value){query+="&offset="+offset}
$rootScope.httpQuery(''+query,function(data){if(defined(data.success)){if(defined(data.links)){data.links.forEach(function(link){_this.addOrUpdateLink(link);if(defined($scope)){if(link.id==$scope.itemId){$scope.itemObject=link}}})}}})};this.generateUserLink=function(user){return"/"+user.username};this.generateGalleryLink=function(image){return"/"+image.username+"/artwork/"+image.id};this.generateDiscussionLink=function(thread){return"/discussions/"+thread.disc_board_id+"/"+thread.disc_cat_id+"/"+thread.id};this.deleteLink=function(linkId){var query='schema=searchLinksDelete&linkId='+linkId;var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
$rootScope.httpQuery(query+userDetails,function(data){if(defined(data.success)){delete _this.searchData.linkData[linkId]}})};this.deleteTerm=function(termId){var query='schema=searchTermsDelete&termId='+termId;var userDetails=UserService.getUserDetails();if(userDetails===!1){userDetails=''}
$rootScope.httpQuery(query+userDetails,function(data){if(defined(data.success)){delete _this.searchData.terms[termId]}})};this.addToUsers=function(user){if(_this.searchData.userResults.indexOf(user.id)===-1){_this.searchData.userResults.push(user.id)}};this.addToGallery=function(image){if(_this.searchData.galleryResults.indexOf(image.id)===-1){_this.searchData.galleryResults.push(image.id)}};this.addToDiscussions=function(thread){if(_this.searchData.discussionResults.indexOf(thread.id)===-1){_this.searchData.discussionResults.push(thread.id)}};this.addToLinks=function(link){if(_this.searchData.linkResults.indexOf(link.id)===-1){_this.searchData.linkResults.push(link.id)}};this.addOrUpdateLink=function(link){if(defined(_this.searchData.linkData[link.id])){for(var property in link){if(link.hasOwnProperty(property)){_this.searchData.linkData[link.id][property]=link[property]}}}else{_this.searchData.linkData[link.id]=link}};this.addOrUpdateTerm=function(term){if(defined(_this.searchData.terms[term.id])){for(var property in term){if(term.hasOwnProperty(property)){_this.searchData.terms[term.id][property]=term[property]}}}else{_this.searchData.terms[term.id]=term}};this.clearUsers=function(){_this.searchData.userResults=[]};this.clearGallery=function(){_this.searchData.galleryResults=[]};this.clearDiscussions=function(){_this.searchData.discussionResults=[]};this.clearLinks=function(){_this.searchData.linkResults=[]};this.clearResults=function(){_this.clearUsers();_this.clearGallery();_this.clearDiscussions();_this.clearLinks()};this.getData=function(){return _this.searchData}}]);app.service('SliderService',['$rootScope','$compile',function($rootScope,$compile){var _this=this;this.sliderData={active:!1,top:0,title:'',modelData:{},type:'',closeCallback:this.hide};this.initialise=function(title,type,modelData,closeCallback){_this.sliderData.title=title;_this.sliderData.type=type;_this.sliderData.modelData=modelData;_this.sliderData.closeCallback=closeCallback};this.addCommentToSlider=function(comment){_this.sliderData.modelData.replies[comment.id]=comment};this.show=function(){_this.sliderData.top=$(document).scrollTop();$('#pro-mobile-window').css('width','100%');$('#pro-mobile-window-nav').css('width','100%');$('#main').css({'position':'fixed','top':(_this.sliderData.top)+'px'});$rootScope.sliderShow=!0;$(document).scrollTop(0);if(!$rootScope.$$phase){$rootScope.$apply()}};this.hide=function(){$rootScope.sliderShow=!1;$('#pro-mobile-window').css('top',_this.sliderData.top+'px');$('#main').css({'position':'relative','top':'auto'});$(document).scrollTop(_this.sliderData.top);setTimeout(function(){$('#pro-mobile-window').css({'top':'0px','width':'0'});$('#pro-mobile-window-nav').css({'top':'0px','width':'0'});_this.sliderData.type=''},300)};this.getData=function(){return _this.sliderData}}]);app.service('UserService',['$cookies','$http','$rootScope',function($cookies,$http,$rootScope){var _this=this;this.userData={users:{},inspiration:[]};this.getUserDetails=function(){var userId=$cookies.get('user');var token=$cookies.get('token');if(defined(userId)&&defined(token)){return'&userId='+userId+'&token='+token}
return!1};this.updateSearchHistory=function(value){var cookieExpires=new Date();var oldHistory=$cookies.get('searchHistory');var history=[];value=value.toLowerCase();if(defined(oldHistory)){var valueTest='{"term":"'+value+'"}';history=JSON.parse(oldHistory);if(oldHistory.indexOf(valueTest)>-1){var re=new RegExp(valueTest.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&'),'gi');oldHistory=oldHistory.replace(re,'');oldHistory=oldHistory.replace(/,,/g,',');oldHistory=oldHistory.replace(/,\]/g,']');oldHistory=oldHistory.replace(/\[,/g,'[');history=JSON.parse(oldHistory)}else if(history.length>3){history.pop()}}
history.unshift({'term':value});cookieExpires.setDate(cookieExpires.getDate()+365);$cookies.put('searchHistory',JSON.stringify(history),{'expires':cookieExpires})};this.getCurrentSearchHistory=function(){var history=$cookies.get('searchHistory');if(defined(history)){return JSON.parse(history)}
return[]};this.save=function(user){var cookieExpires=new Date();cookieExpires.setDate(cookieExpires.getDate()+365);_this.addOrUpdateUser(user);$rootScope.canClaim=user.canClaim;$rootScope.user=user.id;$cookies.put('user',user.id,{'expires':cookieExpires});$cookies.put('token',user.token,{'expires':cookieExpires});$cookies.put('previousUser',!0,{'expires':cookieExpires});$rootScope.loggedIn=!0};this.load=function(){var userDetails=_this.getUserDetails();if(userDetails){$http({method:'POST',url:APIURL,data:'schema=userLoad'+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.save(data.user);data.inspiration.forEach(function(inspiration){_this.addPersonalInspirationToUser(inspiration.imageId)})}}).catch(function(response){console.log(response)})}};this.loadUsers=function(){var userDetails=_this.getUserDetails();if(userDetails){$http({method:'POST',url:APIURL,data:'schema=adminListUsers'+userDetails,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.users.forEach(function(user){_this.addOrUpdateUser(user)})}}).catch(function(response){console.log(response)})}};this.claimDiscussionElements=function(){var query='schema=userClaimDiscussionElements'+_this.getUserDetails();showLoader(!0);$rootScope.httpQuery(query,function(data){showLoader(!1);if(defined(data.success)){$rootScope.canClaim=!1;alert("Relevant thread and post ownership has been transferred to you.")}})};this.reset=function(){_this.clearUserData($rootScope.user);_this.userData.inspiration=[];$rootScope.canClaim=!1;$rootScope.user='';$rootScope.loggedIn=!1;$cookies.remove('user');$cookies.remove('token')};this.addOrUpdateUser=function(user){if(defined(user.profile_tab_order)){user.tabOrder=user.profile_tab_order.split(',')}
if(typeof user.board_follows!=='undefined'&&user.board_follows!==null){user.boardFollows={};var boardFollowIds=user.board_follows.split(',');var boardFollowBoardIds=user.board_follows_board.split(',');var boardFollowUpdate=user.board_follows_updated.split(',');for(var i=0;i<boardFollowIds.length;i ++){user.boardFollows[boardFollowBoardIds[i]]={'id':boardFollowIds[i],'disc_board_id':boardFollowBoardIds[i],'updated':boardFollowUpdate[i]}}}
if(typeof user.thread_follows!=='undefined'&&user.thread_follows!==null){user.threadFollows={};var threadFollowIds=user.thread_follows.split(',');var threadFollowThreadIds=user.thread_follows_thread.split(',');var threadFollowLinked=user.thread_linked.split(',');var threadFollowUpdate=user.thread_follows_updated.split(',');for(var j=0;j<threadFollowIds.length;j ++){user.threadFollows[threadFollowThreadIds[j]]={'id':threadFollowIds[j],'disc_thread_id':threadFollowThreadIds[j],'linked':threadFollowLinked[j],'updated':threadFollowUpdate[j]}}}
delete user.board_follows;delete user.board_follows_board;delete user.board_follows_updated;delete user.thread_follows;delete user.thread_follows_thread;delete user.thread_linked;delete user.thread_follows_updated;if(defined(_this.userData.users[user.id])){for(var property in user){if(user.hasOwnProperty(property)){_this.userData.users[user.id][property]=user[property]}}}else{_this.userData.users[user.id]=user}
if($rootScope.isDefined(_this.userData.users[user.id].website)&&_this.userData.users[user.id].website!==null&&!(_this.userData.users[user.id].website.indexOf('http')===0||_this.userData.users[user.id].website.indexOf('/')===0)){_this.userData.users[user.id].website='//'+_this.userData.users[user.id].website}
if(defined(_this.userData.users[user.id].avatar)){_this.userData.users[user.id].avatar=_this.userData.users[user.id].avatar.replace('http://',BASEPROTOCOL)}
if(defined(_this.userData.users[user.id].cover)&&_this.userData.users[user.id].cover!==null&&_this.userData.users[user.id].cover!==null){_this.userData.users[user.id].cover=_this.userData.users[user.id].cover.replace('http://',BASEPROTOCOL)}};this.removeImageFromUser=function(userId,imageId){if(defined(_this.userData.users[userId])){var index=_this.userData.users[userId].gallery.indexOf(""+imageId);if(index>=0){_this.userData.users[userId].gallery.splice(index,1)}}};this.removeInspirationFromUser=function(userId,imageId){if(defined(_this.userData.users[userId])){if(defined(_this.userData.users[userId].inspiration)){var index=_this.userData.users[userId].inspiration.indexOf(""+imageId);if(index>=0){_this.userData.users[userId].inspiration.splice(index,1)}}
if(defined(_this.userData.inspiration)){var personalIndex=_this.userData.inspiration.indexOf(""+imageId);if(personalIndex>=0){_this.userData.inspiration.splice(personalIndex,1)}}}};this.clearUserData=function(userId){_this.userData.users[userId].token='';_this.userData.users[userId].date_of_birth='';_this.userData.users[userId].token_updated='';_this.userData.users[userId].images='';_this.userData.users[userId].permissions_id=''};this.addImageToUser=function(imageId,userId,prepend){prepend=defined(prepend)?prepend:!1;if(!defined(_this.userData.users[userId])){_this.userData.users[userId]={}}
if(!defined(_this.userData.users[userId].gallery)){_this.userData.users[userId].gallery=[]}
if(_this.userData.users[userId].gallery.indexOf(imageId)===-1){if(prepend){_this.userData.users[userId].gallery.unshift(""+imageId)}else{_this.userData.users[userId].gallery.push(""+imageId)}}};this.addPersonalInspirationToUser=function(imageId){if(_this.userData.inspiration.indexOf(""+imageId)===-1){_this.userData.inspiration.push(""+imageId)}};this.addInspirationToUser=function(imageId,userId,prepend){prepend=defined(prepend)?prepend:!1;if(!defined(_this.userData.users[userId])){_this.userData.users[userId]={}}
if(!defined(_this.userData.users[userId].inspiration)){_this.userData.users[userId].inspiration=[]}
if(_this.userData.users[userId].inspiration.indexOf(""+imageId)===-1){if(prepend){_this.userData.users[userId].inspiration.unshift(""+imageId)}else{_this.userData.users[userId].inspiration.push(""+imageId)}}};this.addBetaUser=function(user){if(!defined(_this.userData.users[$rootScope.user].betaUsers)||!_this.userData.users[$rootScope.user].betaUsers){_this.userData.users[$rootScope.user].betaUsers=[]}
for(var i=0;i<_this.userData.users[$rootScope.user].betaUsers.length;i ++){if(_this.userData.users[$rootScope.user].betaUsers[i].type_id=user.type_id){_this.userData.users[$rootScope.user].betaUsers[i]=user;return}}
_this.userData.users[$rootScope.user].betaUsers.push(user)};this.removeBetaUser=function(typeId){for(var i=0;i<_this.userData.users[$rootScope.user].betaUsers.length;i ++){if(_this.userData.users[$rootScope.user].betaUsers[i].type_id=typeId){_this.userData.users[$rootScope.user].betaUsers.splice(i,1);return}}};this.addProductToUser=function(productId,userId,prepend){prepend=defined(prepend)?prepend:!1;if(!defined(_this.userData.users[userId])){_this.userData.users[userId]={}}
if(!defined(_this.userData.users[userId].market)){_this.userData.users[userId].market=[]}
if(_this.userData.users[userId].market.indexOf(productId)===-1){if(prepend){_this.userData.users[userId].market.unshift(productId)}else{_this.userData.users[userId].market.push(productId)}}};this.getData=function(){return _this.userData}}]);app.service('UtilityService',['$http','$rootScope','DiscussionService',function($http,$rootScope,DiscussionService){var _this=this;this.utilityData={tagCategories:{0:{id:0,label:'No Category'}}};this.getUTCTime=function(){$http({method:'POST',url:APIURL,data:'schema=utilGetUTCTime',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){$rootScope.utcTime=new Date(data.utcTime.replace(/\s/,'T'));$rootScope.latestPollTime=data.utcTime;$rootScope.initialLoad=data.utcTime;_this.runTimeUpdate()}else{console.log(data)}}).catch(function(response){console.log(response)})};this.runTimeUpdate=function(){setTimeout(function(){$rootScope.utcTime=new Date($rootScope.utcTime.getTime()+5000);if(!$rootScope.$$phase){$rootScope.$apply()}
_this.runTimeUpdate()},5000)};this.loadTagCategories=function(){$http({method:'POST',url:APIURL,data:'schema=tagCategoryLoad',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;console.log("loaded tag categories");if(defined(data.success)){data.categories.forEach(function(category){_this.addOrUpdateCategories(category)})}else{console.log(data)}}).catch(function(response){console.log(response)})};this.loadKeywordCategories=function(){$http({method:'POST',url:APIURL,data:'schema=tagKeywordCategoryLoad',headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){data.keywords.forEach(function(keyword){var category=_this.generateCategoryFromKeywordData(keyword);_this.addOrUpdateCategories(category)})}else{console.log(data)}}).catch(function(response){console.log(response)})};this.createDiscussionsTag=function(userId,token,tagLabel){if(defined(userId)&&defined(token)&&defined(tagLabel)){$http({method:'POST',url:APIURL,data:'schema=discussionTagCreate&userId='+userId+'&token='+token+'&tagLabel='+tagLabel,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){DiscussionService.addTag(data.tag)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.createCategoryTag=function(userId,token,catLabel){if(defined(userId)&&defined(token)&&defined(catLabel)){$http({method:'POST',url:APIURL,data:'schema=tagCategoryCreate&userId='+userId+'&token='+token+'&catLabel='+catLabel,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){_this.addOrUpdateCategories(data.category)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.createKeywordTag=function(userId,token,keywordCategory,keywordLabel){userId=defined(userId)?userId:'';token=defined(token)?token:'';keywordCategory=defined(keywordCategory)?keywordCategory:0;if(defined(keywordLabel)){$http({method:'POST',url:APIURL,data:'schema=tagKeywordCreate&userId='+userId+'&token='+token+'&keywordCategory='+keywordCategory+'&keywordLabel='+keywordLabel,headers:{'Content-Type':'application/x-www-form-urlencoded; charset=utf-8'}}).then(function(response){var data=response.data;if(defined(data.success)){console.log(data.keyword)}else{console.log(data)}}).catch(function(response){console.log(response)})}};this.generateCategoryFromKeywordData=function(keywordData){var category={};category.id=keywordData.tag_categories_id;category.label=keywordData.label;return category};this.addOrUpdateCategories=function(category){if(defined(_this.utilityData.tagCategories[category.id])){for(var property in category){if(category.hasOwnProperty(property)){_this.utilityData.tagCategories[category.id][property]=category[property]}}}else{_this.utilityData.tagCategories[category.id]=category}};this.getData=function(){return _this.utilityData}}]);app.service('PrizeService',['UserService','$rootScope',function(UserService,$rootScope){var _this=this;this.competitionData={competitions:{},currentCompetition:0,prizeEntry:0,entries:[],results:[],votes:{}};this.reset=function(){_this.cleaHandbookData()};this.loadCompetitions=function(compId,callback){var extra='';if(compId!==''){extra='&id='+compId}
$rootScope.setPageLoader(!0);$rootScope.httpQuery('schema=prizeCompetitionLoad'+extra,function(data){if(data.competitions){data.competitions.forEach(function(competition){_this.addOrUpdateCompetition(competition);if(compId!==''||_this.competitionData.currentCompetition===0){_this.competitionData.currentCompetition=competition.id}
if(defined(callback)){callback();return}})}
$rootScope.setPageLoader(!1)})};this.loadCompetitionEntry=function(compId,callback){$rootScope.setPageLoader(!0);var userDetails=UserService.getUserDetails();$rootScope.httpQuery('schema=prizeEntryLoad'+userDetails+'&competition_id='+compId+'&personal=1',function(data){if(data.entries){data.entries.forEach(function(entry){_this.addOrUpdateEntry(compId,entry);entry.thumb=entry.thumb.replace('http://',BASEPROTOCOL);entry.image=entry.image.replace('http://',BASEPROTOCOL);entry.full=entry.full.replace('http://',BASEPROTOCOL);_this.competitionData.prizeEntry=entry.id})}
callback();$rootScope.setPageLoader(!1)})};this.performVote=function(id,vote){var userDetails=UserService.getUserDetails();$rootScope.httpQuery('schema=prizeEntryVote'+userDetails+'&entry='+id+'&vote='+vote,function(data){if(data.success){if(data.vote){_this.addOrUpdateVote(data.vote)}}else{console.log(data.errors)}})};this.loadCompetitionEntries=function(pos,count,page,compId,results){var userDetails=UserService.getUserDetails();$rootScope.httpQuery('schema=prizeEntryLoad'+userDetails+'&pos='+pos+'&count='+count+'&page='+page+'&competition_id='+compId+'&results='+results,function(data){if(data.entries){data.entries.forEach(function(entry){entry.averageRGB=JSON.parse(entry.averageRGB);entry.thumb=entry.thumb.replace('http://',BASEPROTOCOL);entry.image=entry.image.replace('http://',BASEPROTOCOL);entry.full=entry.full.replace('http://',BASEPROTOCOL);_this.addOrUpdateEntry(compId,entry);if(results){if(_this.competitionData.results.indexOf(entry.id)===-1){_this.competitionData.results.push(entry.id)}}else{if(_this.competitionData.entries.indexOf(entry.id)===-1){_this.competitionData.entries.push(entry.id)}}})}
$rootScope.galleryLazyLoading=!1})};this.loadUsersVotes=function(compId){var userDetails=UserService.getUserDetails();$rootScope.httpQuery('schema=prizeVoteLoad'+userDetails+'&competition_id='+compId,function(data){if(data.success){data.votes.forEach(function(vote){_this.addOrUpdateVote(vote)})}else{console.log(data.errors)}
$rootScope.galleryLazyLoading=!1})};this.addOrUpdateCompetition=function(competition){competition.start_date=new Date(competition.start_date.replace(/-/g,"/"));competition.end_date=new Date(competition.end_date.replace(/-/g,"/"));competition.entries={};if(defined(_this.competitionData.competitions[competition.id])){for(var property in competition){if(competition.hasOwnProperty(property)){_this.competitionData.competitions[competition.id][property]=competition[property]}}}else{_this.competitionData.competitions[competition.id]=competition}};this.setPrizeEntry=function(id){_this.competitionData.prizeEntry=id};this.addOrUpdateEntry=function(competition,entry){if(defined(_this.competitionData.competitions[competition].entries[entry.id])){for(var property in entry){if(entry.hasOwnProperty(property)){_this.competitionData.competitions[competition].entries[entry.id][property]=entry[property]}}}else{_this.competitionData.competitions[competition].entries[entry.id]=entry}};this.addOrUpdateVote=function(vote){if(defined(_this.competitionData.votes[vote.prize_entry_id])){for(var property in vote){if(vote.hasOwnProperty(property)){_this.competitionData.votes[vote.prize_entry_id][property]=vote[property]}}}else{_this.competitionData.votes[vote.prize_entry_id]=vote}};this.clearResults=function(){_this.competitionData.entries=[];_this.competitionData.results=[]};this.clearEntryData=function(){_this.competitionData.prizeEntry=0;if(_this.competitionData.currentCompetition!==0){_this.competitionData.competitions[_this.competitionData.currentCompetition].entries={}}};this.getData=function(){return _this.competitionData}}]);app.service('HandbookService',['UserService','$rootScope','$http',function(UserService,$rootScope,$http){var _this=this;this.handbookData={articles:{}};this.reset=function(){_this.cleaHandbookData()};this.loadArticles=function(){$rootScope.setPageLoader(!0);$rootScope.httpQuery('schema=handbookLoad',function(data){if(data.handbookArticles){$rootScope.setPageLoader(!1);data.handbookArticles.forEach(function(article){_this.addOrUpdateArticle(article)})}})};this.addOrUpdateArticle=function(article){if(defined(_this.handbookData.articles[article.id])){for(var property in article){if(article.hasOwnProperty(property)){_this.handbookData.articles[article.id][property]=article[property]}}}else{_this.handbookData.articles[article.id]=article}};this.cleaHandbookData=function(){_this.handbookData.articles={}};this.getData=function(){return _this.handbookData}}]);app.service('InstagramService',['UserService','$rootScope','$http',function(UserService,$rootScope,$http){var _this=this;this.instagramData={articles:{}};this.reset=function(){_this.cleanInstagramData()};this.loadArticles=function(){$rootScope.setPageLoader(!0);$rootScope.httpQuery('schema=instagramLoad',function(data){if(data.instagramArticles){$rootScope.setPageLoader(!1);data.instagramArticles.forEach(function(article){_this.addOrUpdateArticle(article)})}})};this.addOrUpdateArticle=function(article){if(defined(_this.instagramData.articles[article.id])){for(var property in article){if(article.hasOwnProperty(property)){_this.instagramData.articles[article.id][property]=article[property]}}}else{_this.instagramData.articles[article.id]=article}};this.cleanInstagramData=function(){_this.instagramData.articles={}};this.getData=function(){return _this.instagramData}}]);var inTransition=!1;var scrollPos=0;function iPhoneVersion(){var iHeight=window.screen.height;var iWidth=window.screen.width;if(iWidth===320&&iHeight===480){return"4"}else if(iWidth===320&&iHeight===568){return"5"}else if(iHeight<=480){return"2-3"}
return!0}
function isIphone(){return!!navigator.userAgent.match(/iPhone/i)}
jQuery(document).ready(function(){var $body=jQuery('body');$body.on('popoverTab',popoverTab);$body.on('targetTab',targetTab);$body.on('wysiwygForm',applyWysiwyg);$body.on('newsWysiwygForm',applyNewsWysiwyg);$body.on('handbookWysiwygForm',applyHandbookWysiwyg);$body.on('uploadItemTab',uploadItemTab);$body.on('selectTouchMove',selectTouchMove);$body.on('resetIsotope',resetIsotope);$body.on('galleryItemHover',galleryItemHover);$body.on('galleryLoad',gallerySetup);$body.on('marketLoad',marketSetup);$body.on('fullGalleryLoad',fullGallerySetup);$body.on('fullMarketLoad',fullMarketLoad);$body.on('discussionItemHover',discussionItemHover);$body.on('reflowIsotope',initReflowIsotope);$body.on('dragHover',dragHover);$body.on('fullViewActivated',toggleNav);$body.on('stickyNav',stickyNav);$body.on('tagCategorySelect',tagCategorySelect);$body.on('keywordCategorySelect',keywordCategorySelect);$body.on('enableGeocomplete',enableGeocomplete);$body.on('touchItemOptions',touchItemOptions);setupVideos();setupModal()});var setupDragDrop=function(editor){var $dropZone=jQuery('#'+editor.id);formFiles[editor.id]=[];$dropZone.get(0).ondragover=function(e){$(this).addClass('hover-active');e.preventDefault()};$dropZone.get(0).ondragenter=function(e){$(this).removeClass('hover-active');e.preventDefault()};$dropZone.get(0).ondrop=function(e){e.preventDefault();$(this).removeClass('hover-active');addFilesToEditor(editor,e.dataTransfer.files)}};var addFilesToEditor=function(editor,files){$.each(files,function(i,elm){if(isValidImage(elm)){var found=!1;for(var f=0;f<formFiles[editor.id].length;f++){if(formFiles[editor.id][f].name===elm.name&&formFiles[editor.id][f].size===elm.size){found=!0;break}}
if(!found){formFiles[editor.id].push(elm)}
editor.focus();editor.insertContent('[media src="'+elm.name+'" ref="'+elm.size+'"][/media]')}})};var isValidImage=function(file){switch(file.name.split('.').pop().toLowerCase()){case 'png':case 'jpg':case 'jpeg':return!0}
return!1};var applyWysiwyg=function(){setTimeout(function(){if(typeof(tinyMCE)!=="undefined"){tinymce.remove(".wysiwyg_editor")}
tinymce.init({selector:'.wysiwyg_editor',plugins:'autolink link image lists preview paste',menubar:!1,browser_spellcheck:!0,paste_as_text:!0,inline:!0,toolbar:!1,advlist_bullet_styles:"default",init_instance_callback:function(editor){var fireLink=function(link){var referenceId=editor.id.split("-content")[0];var $button=$('#wysiwyg_toolbar-'+referenceId).find(link+'-button');$button.trigger('click')};editor.shortcuts.add("meta+k","Open Correct Link 1",function(){fireLink('.link')});editor.shortcuts.add("shift+meta+k","Open Correct Link 1",function(){fireLink('.media')})},setup:function(editor){setupDragDrop(editor);var modal=angular.element(document).find('html').injector().get("ModalService");var referenceId=editor.id.split("-content")[0];var $toolbar=$('#wysiwyg_toolbar-'+referenceId);var $boldButton=$toolbar.find('.bold-button');var $italicButton=$toolbar.find('.italic-button');var $underlineButton=$toolbar.find('.underline-button');var $strikeThrough=$toolbar.find('.strikethrough-button');var $linkButton=$toolbar.find('.link-button');var $mediaButton=$toolbar.find('.media-button');editor.on('NodeChange',function(){if(editor.queryCommandState('Bold')){if(!$boldButton.hasClass('blue-fill')){$boldButton.addClass('blue-fill')}}else{if($boldButton.hasClass('blue-fill')){$boldButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Italic')){if(!$italicButton.hasClass('blue-fill')){$italicButton.addClass('blue-fill')}}else{if($italicButton.hasClass('blue-fill')){$italicButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Underline')){if(!$underlineButton.hasClass('blue-fill')){$underlineButton.addClass('blue-fill')}}else{if($underlineButton.hasClass('blue-fill')){$underlineButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Strikethrough')){if(!$strikeThrough.hasClass('blue-fill')){$strikeThrough.addClass('blue-fill')}}else{if($strikeThrough.hasClass('blue-fill')){$strikeThrough.removeClass('blue-fill')}}});$boldButton.on('click touch',function(){editor.execCommand('Bold',!1)});$italicButton.on('click touch',function(){editor.execCommand('Italic',!1)});$underlineButton.on('click touch',function(){editor.execCommand('Underline',!1)});$strikeThrough.on('click touch',function(){editor.execCommand('Strikethrough',!1)});$linkButton.on('click touch',function(){modal.initialise('Insert Link',modal.generateContent('disc_link',!1),'Select',function(){var $source=$('#pro-modal-url').val();var $title=$('#pro-modal-title').val();editor.focus();if($source.length){editor.insertContent('[media src="'+$source+'"]'+$title+'[/media]')}
modal.hide()},'Cancel',function(){modal.hide()},!0);modal.show()});$mediaButton.on('click touch',function(){modal.initialise('Insert Media',modal.generateContent('disc_media',referenceId+'-files'),'Select',function(){var $files=$('#'+referenceId+'-files');var $source=$('#pro-modal-url').val();var $title=$('#pro-modal-title').val();editor.focus();if($source.length){editor.insertContent('[media src="'+$source+'"]'+$title+'[/media]')}
addFilesToEditor(editor,$files.get(0).files);$files.val('');modal.hide()},'Cancel',function(){var $files=$('#'+referenceId+'-files');$files.val('');modal.hide()},!0);modal.show();$('#'+referenceId+'-files').off('change').on('change',function(){var _this=this;var $imageHolder=$('#modal-image-holder');$imageHolder.empty();if(_this.files&&_this.files[0]){jQuery.each(_this.files,function(i,file){if(isValidImage(file)){var reader=new FileReader();reader.onload=function(){var img=new Image();img.onload=function(){$imageHolder.append('<img src="'+img.src+'" width="50" height="50" />')};img.src=URL.createObjectURL(file)};reader.readAsDataURL(file)}else{console.log("not a image")}})}})})}})},100)};var applyNewsWysiwyg=function(){setTimeout(function(){if(typeof(tinyMCE)!=="undefined"){tinymce.remove(".wysiwyg_editor")}
tinymce.init({selector:'.wysiwyg_editor',plugins:'autolink link lists paste',menubar:!1,paste_as_text:!0,browser_spellcheck:!0,inline:!0,toolbar:!1,advlist_bullet_styles:"default",init_instance_callback:function(editor){var fireLink=function(link){var $button=$('#wysiwyg_toolbar').find(link+'-button');$button.trigger('click')};editor.shortcuts.add("meta+k","Open Correct Link 1",function(){fireLink('.link')});editor.shortcuts.add("shift+meta+k","Open Correct Link 1",function(){fireLink('.image')})},setup:function(editor){setupDragDrop(editor);var modal=angular.element(document).find('html').injector().get("ModalService");var $toolbar=$('#wysiwyg_toolbar');var $boldButton=$toolbar.find('.bold-button');var $italicButton=$toolbar.find('.italic-button');var $underlineButton=$toolbar.find('.underline-button');var $strikeThrough=$toolbar.find('.strikethrough-button');var $linkButton=$toolbar.find('.link-button');var $mediaButton=$toolbar.find('.media-button');editor.on('NodeChange',function(){if(editor.queryCommandState('Bold')){if(!$boldButton.hasClass('blue-fill')){$boldButton.addClass('blue-fill')}}else{if($boldButton.hasClass('blue-fill')){$boldButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Italic')){if(!$italicButton.hasClass('blue-fill')){$italicButton.addClass('blue-fill')}}else{if($italicButton.hasClass('blue-fill')){$italicButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Underline')){if(!$underlineButton.hasClass('blue-fill')){$underlineButton.addClass('blue-fill')}}else{if($underlineButton.hasClass('blue-fill')){$underlineButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Strikethrough')){if(!$strikeThrough.hasClass('blue-fill')){$strikeThrough.addClass('blue-fill')}}else{if($strikeThrough.hasClass('blue-fill')){$strikeThrough.removeClass('blue-fill')}}});$boldButton.on('click touch',function(){editor.execCommand('Bold',!1)});$italicButton.on('click touch',function(){editor.execCommand('Italic',!1)});$underlineButton.on('click touch',function(){editor.execCommand('Underline',!1)});$strikeThrough.on('click touch',function(){editor.execCommand('Strikethrough',!1)});$linkButton.on('click touch',function(){modal.initialise('Insert Link','','Select',function(){var $source=$('#pro-modal-url').val();var $title=$('#pro-modal-title').val();editor.focus();if($source.length){editor.insertContent('[media src="'+$source+'"]'+$title+'[/media]')}
modal.hide()},'Cancel',modal.hide,!0,'disc_link');modal.show()});$mediaButton.on('click touch',function(){modal.initialise('Insert Image','','Insert',function(){var $source1=$('#pro-modal-source1').val();var $sourceRGB1=$('#pro-modal-rgb1').val();var $source2=$('#pro-modal-source2').val();var $sourceRGB2=$('#pro-modal-rgb2').val();var $title=$('#pro-modal-title').val();var $type=$('input[name=type]:checked').val();editor.focus();editor.insertContent('[newsImage type="'+$type+'" src="'+$source1+'" rgb="'+$sourceRGB1+'" src2="'+$source2+'" rgb2="'+$sourceRGB2+'"]'+$title+'[/newsImage]');modal.hide()},'Cancel',modal.hide,!0,'news_image');modal.show()})}})},100)};var applyHandbookWysiwyg=function(){setTimeout(function(){if(typeof(tinyMCE)!=="undefined"){tinymce.remove(".wysiwyg_editor")}
tinymce.init({selector:'.wysiwyg_editor',plugins:'autolink link lists paste',menubar:!1,paste_as_text:!0,browser_spellcheck:!0,inline:!0,toolbar:!1,advlist_bullet_styles:"default",init_instance_callback:function(editor){var fireLink=function(link){var $button=$('#wysiwyg_toolbar').find(link+'-button');$button.trigger('click')};editor.shortcuts.add("meta+k","Open Correct Link 1",function(){fireLink('.link')});editor.shortcuts.add("shift+meta+k","Open Correct Link 1",function(){fireLink('.image')})},setup:function(editor){setupDragDrop(editor);var modal=angular.element(document).find('html').injector().get("ModalService");var $toolbar=$('#wysiwyg_toolbar');var $boldButton=$toolbar.find('.bold-button');var $italicButton=$toolbar.find('.italic-button');var $underlineButton=$toolbar.find('.underline-button');var $strikeThrough=$toolbar.find('.strikethrough-button');var $linkButton=$toolbar.find('.link-button');var $mediaButton=$toolbar.find('.media-button');editor.on('NodeChange',function(){if(editor.queryCommandState('Bold')){if(!$boldButton.hasClass('blue-fill')){$boldButton.addClass('blue-fill')}}else{if($boldButton.hasClass('blue-fill')){$boldButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Italic')){if(!$italicButton.hasClass('blue-fill')){$italicButton.addClass('blue-fill')}}else{if($italicButton.hasClass('blue-fill')){$italicButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Underline')){if(!$underlineButton.hasClass('blue-fill')){$underlineButton.addClass('blue-fill')}}else{if($underlineButton.hasClass('blue-fill')){$underlineButton.removeClass('blue-fill')}}
if(editor.queryCommandState('Strikethrough')){if(!$strikeThrough.hasClass('blue-fill')){$strikeThrough.addClass('blue-fill')}}else{if($strikeThrough.hasClass('blue-fill')){$strikeThrough.removeClass('blue-fill')}}});$boldButton.on('click touch',function(){editor.execCommand('Bold',!1)});$italicButton.on('click touch',function(){editor.execCommand('Italic',!1)});$underlineButton.on('click touch',function(){editor.execCommand('Underline',!1)});$strikeThrough.on('click touch',function(){editor.execCommand('Strikethrough',!1)});$linkButton.on('click touch',function(){modal.initialise('Insert Link','','Select',function(){var $source=$('#pro-modal-url').val();var $title=$('#pro-modal-title').val();editor.focus();if($source.length){editor.insertContent('[media src="'+$source+'"]'+$title+'[/media]')}
modal.hide()},'Cancel',modal.hide,!0,'disc_link');modal.show()});$mediaButton.on('click touch',function(){modal.initialise('Insert Image','','Insert',function(){var $source1=$('#pro-modal-source1').val();var $sourceRGB1=$('#pro-modal-rgb1').val();var $source2=$('#pro-modal-source2').val();var $sourceRGB2=$('#pro-modal-rgb2').val();var $title=$('#pro-modal-title').val();var $type=$('input[name=type]:checked').val();editor.focus();editor.insertContent('[handbookImage type="'+$type+'" src="'+$source1+'" rgb="'+$sourceRGB1+'" src2="'+$source2+'" rgb2="'+$sourceRGB2+'"]'+$title+'[/handbookImage]');modal.hide()},'Cancel',modal.hide,!0,'handbook_image');modal.show()})}})},100)};var setupVideos=function(){var mobileCheck=!1;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))mobileCheck=!0})(navigator.userAgent||navigator.vendor||window.opera);if(isIphone()&&iPhoneVersion()===!0){mobileCheck=!1}
if(mobileCheck){$('body').addClass('mobile')}
function startPlayback($video){return $video.get(0).play()}
if(!mobileCheck){$('video').each(function(){var $videoElement=$(this);if(typeof $videoElement.attr('loop')==='undefined'||$videoElement.attr('loop')===!1){$videoElement.get(0).addEventListener('ended',function(){$videoElement.removeClass('video-playing');if(!$videoElement.hasClass('video-ended')){$videoElement.addClass('video-ended')}})}})}
function scrollPlayVideo(){if(!mobileCheck&&!$('#position-lock').length){$('video').each(function(){if($(this).parents('.block').visible()||$(this).parents('.block').visible(!0)){if(!$(this).hasClass('video-ended')){if(!$(this).hasClass('video-playing')){$(this).addClass('video-playing');startPlayback($(this)).then(function(){}).catch(function(error){console.log(error)})}
if($(this).hasClass('video-paused')){$(this).removeClass('video-paused')}}}else{if($(this).hasClass('video-playing')){$(this).removeClass('video-playing');$(this).get(0).pause()}
if(!$(this).hasClass('video-paused')){$(this).addClass('video-paused')}}})}}
window.onscroll=function(){scrollPlayVideo()}};var setupModal=function(){var $body=$('body');var $modalWrapper=$('#modalWrapper');var $modalWindow=$('#modalWindow');var $modalDownload=$modalWindow.find('.btn_download');var $modalCancel=$modalWindow.find('.btn_cancel');$('.modalToggle').on('click',function(e){e.preventDefault();var $this=$(this);$body.toggleClass('show-modal');if($body.hasClass('show-modal')){$body.find('.filename').html($this.attr('data-filename'));$body.find('.filesize').html($this.attr('data-size'))}
$modalDownload.off('click');$modalDownload.on('click',function(e){window.open($this.attr('href'),'_blank');$body.removeClass('show-modal')})});$modalWindow.on('click',function(){$body.removeClass('show-modal')});$modalCancel.on('click',function(){$body.removeClass('show-modal')});$modalWrapper.on('click',function(e){e.stopPropagation()})};var tagCategorySelect=function(placeholder){var placeholderText=(placeholder?placeholder:'');$(".autoPickerSet").select2({placeholder:placeholderText})};var keywordCategorySelect=function(){var $select=$(".keywordPickerSet");$select.select2({placeholder:$select.attr('data-default'),tags:!0,tokenSeparators:[',',' '],maximumSelectionLength:6})};var galleryItemHover=function(){var $img=$('.item-artwork');$img.mouseenter(function(){var red=$(this).find('.item-object').data('r');var green=$(this).find('.item-object').data('g');var blue=$(this).find('.item-object').data('b');var rgba=''+red+', '+green+', '+blue;var boxShadow='0px 64px 64px 0px rgba('+rgba+', 0.25), 0px 32px 32px 0px rgba('+rgba+', 0.25), 0px 16px 16px 0px rgba('+rgba+', 0.25), 0px 8px 8px 0px rgba('+rgba+', 0.25), 0px 4px 4px 0px rgba('+rgba+', 0.25)';$(this).find('.item-object').css('box-shadow',boxShadow)}).mouseleave(function(){$(this).find('.item-object').css('box-shadow','')})};var discussionItemHover=function(){var $img=jQuery('.discussionItem');$img.mouseenter(function(){var red=$(this).find('.discussionItemContent').data('r');var green=$(this).find('.discussionItemContent').data('g');var blue=$(this).find('.discussionItemContent').data('b');var rgba=''+red+', '+green+', '+blue;var boxShadow='0px 64px 64px 0px rgba('+rgba+', 0.25), 0px 32px 32px 0px rgba('+rgba+', 0.25), 0px 16px 16px 0px rgba('+rgba+', 0.25), 0px 8px 8px 0px rgba('+rgba+', 0.25), 0px 4px 4px 0px rgba('+rgba+', 0.25)';$(this).find('.discussionItemContent').css('box-shadow',boxShadow)}).mouseleave(function(){$(this).find('.discussionItemContent').css('box-shadow','')})};var forceTouchEvent=function(elm){var rootScope=angular.element($('html')).scope();var $body=$('body');var forceTouchSetScroll;var forceTouchCurrentScroll;var forceTouchScrollThreshold=100;var forceTouchEnabled;rootScope.forceTouch=0;rootScope.pressureEventType='none';Pressure.set('#'+$(elm).attr('id'),{start:function(e){if(!$(this).hasClass('forceTouchActive')){forceTouchSetScroll=$body.scrollTop();forceTouchCurrentScroll=$body.scrollTop();forceTouchEnabled=!0;var thisImageId=$(this).attr('id');$('.force').each(function(){if($(this).attr('id')!==thisImageId){$(this).removeClass('forceTouchActive')}});$(this).addClass('forceTouch');$(this).addClass('foForceTouch');if(rootScope.isPad()&&e.touches[0].force){rootScope.pressureEventType='applePencil'}else{rootScope.pressureEventType='touch'}}},change:function(force,e){if(!$(this).hasClass('forceTouchActive')){forceTouchCurrentScroll=$body.scrollTop();if(((forceTouchCurrentScroll-forceTouchSetScroll>forceTouchScrollThreshold)||(forceTouchCurrentScroll-forceTouchSetScroll<-Math.abs(forceTouchScrollThreshold))||!forceTouchEnabled)){forceTouchEnabled=!1}else{forceTouchEnabled=!0}
if(force>=0.17){e.preventDefault();e.stopPropagation()}else{}
console.log(force);var forceStart=0.35;if(force>=forceStart&&forceTouchEnabled){$(this).removeClass('foForceTouch');var setPoint=1;var forceObject={};var setNewForce=function(originForce,name,startPoint,endPoint){var newForce=Pressure.map(originForce,startPoint,endPoint,0,1);if(newForce<=startPoint){newForce=0}else if(newForce>=endPoint){newForce=1}
newForce=Math.round(newForce*100)/100;forceObject[name]=newForce};var setAllForces=function(num){force=num;Object.keys(forceObject).forEach(function(key){forceObject[key]=num})};if(rootScope.isPad()&&e.touches[0].force){rootScope.pressureEventType='applePencil';setNewForce(force,'apple',forceStart,0.8);force=forceObject.apple;setNewForce(force,'scale',forceStart,1);setNewForce(force,'opacity',forceStart,1)}else{rootScope.pressureEventType='touch';setNewForce(force,'scale',forceStart,1);setNewForce(force,'opacity',forceStart,1)}
if($body.hasClass('forceTouchEvent')){setAllForces(1)}
if(force>=setPoint){$(this).addClass('forceTouchActive');$body.addClass('forceTouchEvent');setAllForces(1)}
var scale='scale('+forceObject.scale+')';$('.gallery-overlay').css({'opacity':forceObject.opacity,'-webkit-backdrop':''});$(this).css('z-index','250');$(this).find('.forceTouchOptions').css({'opacity':forceObject.opacity,'transform':scale,'-webkit-transform':scale})}else{$(this).removeClass('forceTouch');rootScope.pressureEventType='none';$('.gallery-overlay').css({'opacity':'','-webkit-backdrop':''});$(this).css('z-index','');$(this).find('.forceTouchOptions').css({'opacity':'','transform':'','-webkit-transform':''})}}},end:function(){$(this).removeClass('forceTouch');rootScope.pressureEventType='none';$('.gallery-overlay').css('opacity','');$(this).css('z-index','');$(this).find('.forceTouchOptions').css({'opacity':'','transform':'','-webkit-transform':''})}},{polyfillSpeedUp:250,polyfillSpeedDown:250,only:'touch',preventDefault:!1})};var enableGeocomplete=function(){$("#location").geocomplete_edit({details:"form",detailsAttribute:"data-geo",types:["(regions)"],blur:!0})};var stickyNav=function(){var navElem=$('.nav-tabs');var navShadow=$('.nav-shadow');var navAlias=$('.nav-alias');var stickyNavElem=navElem.offset().top;$(window).scroll(function(){if($(window).scrollTop()>(stickyNavElem-45)){if(!navElem.hasClass('fixed')&&navShadow.hasClass('profile')){navElem.addClass('fixed');navShadow.removeClass('profile')}
navAlias.css('display','block')}else{if(navElem.hasClass('fixed')&&!navShadow.hasClass('profile')){navElem.removeClass('fixed');navShadow.addClass('profile')}
navAlias.css('display','none')}})};var touchItemOptions=function(){var $item=$('.item-artwork')};var dragHover=function(){var dropZone=$('.drop-zone');dropZone.bind({dragenter:function(e){$(this).addClass('hover-active');e.preventDefault()},dragleave:function(){$(this).removeClass('hover-active')},drop:function(){$(this).removeClass('hover-active')}})};var popoverTab=function(){var $leftTab=jQuery('.popover .toggle-option.left');var $rightTab=jQuery('.popover .toggle-option.right');var $popover=jQuery('.popover');if($popover.length){$rightTab.off('click touch').on('click touch',function(e){if(!$popover.hasClass('alt')){$popover.addClass('alt')}});$leftTab.off('click touch').on('click touch',function(e){if($popover.hasClass('alt')){$popover.removeClass('alt')}})}};var targetTab=function(id){var $leftTab=jQuery('#'+id+'-tab-toggle.tab-toggle-container .toggle-option.left');var $rightTab=jQuery('#'+id+'-tab-toggle.tab-toggle-container .toggle-option.right');var $targetTabToggle=jQuery('#'+id+'-tab-toggle.tab-toggle-container');var $targetTabContent=jQuery('#'+id+'-tab-content.tab-content-container');if($targetTabToggle.length&&$targetTabContent.length){$rightTab.off('click touch').on('click touch',function(e){if(!$targetTabToggle.hasClass('alt')&&!$targetTabContent.hasClass('alt')){$targetTabToggle.addClass('alt');$targetTabContent.addClass('alt')}});$leftTab.off('click touch').on('click touch',function(e){if($targetTabToggle.hasClass('alt')&&$targetTabContent.hasClass('alt')){$targetTabToggle.removeClass('alt');$targetTabContent.removeClass('alt')}})}};var selectTouchMove=function(){function dragSelect(x,y,state){$('.uploadItemPreview').each(function(){if(!(x<=$(this).offset().left||x>=$(this).offset().left+$(this).outerWidth()||y+$(document).scrollTop()<=$(this).offset().top||y+$(document).scrollTop()>=$(this).offset().top+$(this).outerHeight())){var $scope=angular.element($("#galleryDropZone")).scope();$scope.$apply();if(!$scope.isSelected($(this).data('index'))){$scope.select($(this).data('index'))}}})}
$('.uploadItemPreview').bind("touchmove",function(evt){var $scope=angular.element($("#galleryDropZone")).scope();$scope.$apply();var touch=evt.originalEvent.touches[0];dragSelect(touch.clientX,touch.clientY)})};var uploadItemTab=function(){var $leftTab=jQuery('.uploadItem .toggle-option.left');var $rightTab=jQuery('.uploadItem .toggle-option.right');var $uploadItem=jQuery('.uploadItem');if($uploadItem.length){$rightTab.off('click touch').on('click touch',function(e){if(!jQuery(this).parents('.uploadItem').hasClass('alt')){jQuery(this).parents('.uploadItem').addClass('alt')}});$leftTab.off('click touch').on('click touch',function(e){if(jQuery(this).parents('.uploadItem').hasClass('alt')){jQuery(this).parents('.uploadItem').removeClass('alt')}})}};var getAverageColor=function(img){var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var width=canvas.width=img.naturalWidth;var height=canvas.height=img.naturalHeight;ctx.drawImage(img,0,0);var imageData=ctx.getImageData(0,0,width,height);var data=imageData.data;var r=0;var g=0;var b=0;for(var i=0,l=data.length;i<l;i+=4){r+=data[i];g+=data[i+1];b+=data[i+2]}
r=Math.floor(r/(data.length/4));g=Math.floor(g/(data.length/4));b=Math.floor(b/(data.length/4));return{r:r,g:g,b:b}};var isotopeGenerator=function(galleryId,$controller){if(!$controller||!jQuery(galleryId).data('isotope')){$controller=jQuery(galleryId).isotope({itemSelector:'.layout-cell',transitionDuration:0,masonry:{fitWidth:!0,gutter:50}})}else{$controller.isotope('reloadItems')}
$controller.isotope('layout').isotope({sortBy:'original-order'});$controller.imagesLoaded().progress(function(){$controller.isotope('layout').isotope({sortBy:'original-order'});window.clearTimeout(timeoutControl);timeoutControl=window.setTimeout(function(){$controller.isotope('layout').isotope({sortBy:'original-order'})},100)});return $controller};var timeoutControl;var $gallery=!1;var gallerySetup=function(){$gallery=isotopeGenerator('#gallery',$gallery);galleryItemHover();addSwipeOptions()};var $market=!1;var marketSetup=function(){$market=isotopeGenerator('#market',$market);galleryItemHover();addSwipeOptions()};var $fullGallery=!1;var fullGallerySetup=function(){$fullGallery=isotopeGenerator('#fullGallery',$fullGallery);galleryItemHover();addSwipeOptions()};var $fullMarket=!1;var fullMarketLoad=function(){$fullMarket=isotopeGenerator('#fullMarket',$fullMarket);galleryItemHover();addSwipeOptions()};var resetIsotope=function(){$gallery=!1;$market=!1;$userGallery=!1;$fullGallery=!1;$fullMarket=!1};var initReflowIsotope=function(){if(typeof $gallery.isotope==="function"&&$gallery.data('isotope')){$gallery.isotope('reloadItems').isotope({sortBy:'original-order'})}
if(typeof $market.isotope==="function"&&$market.data('isotope')){$market.isotope('reloadItems').isotope({sortBy:'original-order'})}
if(typeof $fullGallery.isotope==="function"&&$fullGallery.data('isotope')){$fullGallery.isotope('reloadItems').isotope({sortBy:'original-order'})}
if(typeof $fullMarket.isotope==="function"&&$fullMarket.data('isotope')){$fullMarket.isotope('reloadItems').isotope({sortBy:'original-order'})}};var reflowIsotope=function(){if(typeof $gallery.isotope==="function"&&$gallery.data('isotope')){$gallery.isotope('reloadItems').isotope({sortBy:'original-order'})}
if(typeof $market.isotope==="function"&&$market.data('isotope')){$market.isotope('reloadItems').isotope({sortBy:'original-order'})}
if(typeof $fullGallery.isotope==="function"&&$fullGallery.data('isotope')){$fullGallery.isotope('reloadItems').isotope({sortBy:'original-order'})}
if(typeof $fullMarket.isotope==="function"&&$fullMarket.data('isotope')){$fullMarket.isotope('reloadItems').isotope({sortBy:'original-order'})}};var touchRecords=[];var toggleNav=function(){var $image=jQuery('#mainImageContainer');setupPanZoom();$image.bind("touchstart",function(e){forEachChangedFinger(e,function(e2,id){if(touchRecords.indexOf(id)===-1){touchRecords.push(id)}
if(touchRecords.length===4){$('#mainImageContainer').toggleClass('hide-nav');touchRecords=[]}})}).bind("touchend",function(e){forEachChangedFinger(e,function(e2,id){if(touchRecords.indexOf(id)!==-1){touchRecords.splice(touchRecords.indexOf(id),1)}})}).bind("touchcancel",function(e){touchRecords=[]})};var forEachChangedFinger=function(e,callBack){e=e.originalEvent;for(var i=0;i<e.changedTouches.length;i++){var finger=e.changedTouches[i];var id=finger.identifier;callBack(finger,id)}};var fingersOnScreen=function(){var $body=$('body');$body.bind("touchstart",function(e){forEachChangedFinger(e,function(e2,id){if(touchRecords.indexOf(id)===-1){touchRecords.push(id)}
alert('Fingers = '+touchRecords.length);if(touchRecords.length===4){$('#mainImageContainer').toggleClass('hide-nav');touchRecords=[]}});e.stopPropagation()}).bind("touchend",function(e){forEachChangedFinger(e,function(e2,id){if(touchRecords.indexOf(id)!==-1){touchRecords.splice(touchRecords.indexOf(id),1)}
console.log('No Fingers')});e.stopPropagation()}).bind("touchcancel",function(e){touchRecords=[];console.log('Event Cancelled');e.stopPropagation()})};var setupPanZoom=function(){var $cover=$('#panZoomCover');var $options=$('#panZoomOptions');var $img=$cover.find('img');$img.on('load',function(){var startPoint=$cover.width()/2-$img.width()/2;var startHeight=$cover.height()/2-$img.height()/2;$img.css('margin-top',startHeight+'px');$img.panzoom({$zoomIn:$options.find(".zoom-in"),$zoomOut:$options.find(".zoom-out"),$zoomRange:$options.find(".zoom-range"),$reset:$options.find(".reset"),startTransform:'matrix(1, 0, 0, 1, '+startPoint+', 0)',increment:0.25,minScale:0.5,maxScale:1,contain:'automatic'});$img.bind("touchstart",function(e){forEachChangedFinger(e,function(e2,id){if(touchRecords.indexOf(id)===-1){touchRecords.push(id)}
if(touchRecords.length===4){$('#mainImageContainer').toggleClass('hide-nav');touchRecords=[]}});e.preventBubble()}).bind("touchend",function(e){forEachChangedFinger(e,function(e2,id){if(touchRecords.indexOf(id)!==-1){touchRecords.splice(touchRecords.indexOf(id),1)}});e.preventBubble()}).bind("touchcancel",function(e){touchRecords=[];e.preventBubble()})})}